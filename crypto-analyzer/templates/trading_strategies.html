<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>äº¤æ˜“ç­–ç•¥ - AlphaFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* AlphaFlow - Multi-Dimensional Crypto Intelligence Platform */
        :root {
            --primary-blue: #2B6FED; --primary-blue-hover: #1E5DD6; --primary-blue-light: #EBF3FF; --primary-blue-dark: #1A4BA8;
            --secondary-purple: #7C3AED; --secondary-orange: #F97316;
            --success-green: #10B981; --success-green-bg: #D1FAE5; --danger-red: #EF4444; --danger-red-bg: #FEE2E2;
            --warning-yellow: #F59E0B; --warning-yellow-bg: #FEF3C7; --info-blue: #3B82F6;
            --bg-primary: #0D1117; --bg-secondary: #161B22; --bg-tertiary: #21262D; --bg-card: #1C2128; --bg-hover: #2A3038;
            --text-primary: #E6EDF3; --text-secondary: #8B949E; --text-tertiary: #6E7681; --text-disabled: #484F58;
            --border-default: #30363D; --border-muted: #21262D; --border-subtle: #1C2128;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.15); --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.25); --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.3);
            --radius-sm: 4px; --radius-md: 8px; --radius-lg: 12px; --radius-xl: 16px; --radius-full: 9999px;
            --spacing-xs: 4px; --spacing-sm: 8px; --spacing-md: 12px; --spacing-lg: 16px; --spacing-xl: 24px; --spacing-2xl: 32px;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1); --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--bg-primary); color: var(--text-primary); line-height: 1.6; font-size: 14px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .container { max-width: 1600px; margin: 0 auto; padding: var(--spacing-xl); }
        .header { background: var(--bg-secondary); border: 1px solid var(--border-default); padding: var(--spacing-lg) var(--spacing-xl); margin-bottom: var(--spacing-xl); border-radius: var(--radius-lg); }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-lg); }
        .header-title { font-size: 24px; font-weight: 700; color: var(--text-primary); display: flex; align-items: center; gap: var(--spacing-md); }
        .header-subtitle { color: var(--text-secondary); font-size: 13px; margin-top: var(--spacing-xs); }
        .nav-container { background: rgba(44, 68, 100, 0.85); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl); border: 1px solid var(--border-default); }
        .nav-links { display: flex; gap: var(--spacing-sm); flex-wrap: wrap; font-size: 16px; }
        .nav-link { padding: 0.75rem 1.5rem; background: transparent; color: var(--text-secondary); text-decoration: none; border-radius: var(--radius-md); transition: all var(--transition-base); font-weight: 600; font-size: 16px; border: 1px solid transparent; }
        .nav-link:hover { background: var(--bg-hover); color: var(--text-primary); border-color: var(--border-default); }
        .nav-link.active { background: var(--primary-blue); color: white; border-color: var(--primary-blue); }
        
        /* ç­–ç•¥ç±»å‹æ ‡ç­¾é¡µ */
        .strategy-type-tabs { display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-xl); border-bottom: 2px solid var(--border-default); }
        .strategy-type-tab { padding: var(--spacing-md) var(--spacing-xl); background: transparent; border: none; border-bottom: 3px solid transparent; color: var(--text-secondary); cursor: pointer; font-size: 15px; font-weight: 600; transition: all var(--transition-base); margin-bottom: -2px; display: flex; align-items: center; gap: var(--spacing-sm); }
        .strategy-type-tab:hover { color: var(--text-primary); background: var(--bg-hover); }
        .strategy-type-tab.active { color: var(--primary-blue); border-bottom-color: var(--primary-blue); background: transparent; }
        
        /* ç­–ç•¥å†…å®¹åŒºåŸŸ */
        .strategy-content { display: none; }
        .strategy-content.active { display: block; }
        
        /* å¡ç‰‡æ ·å¼ */
        .card { background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); transition: all var(--transition-base); }
        .card:hover { border-color: var(--border-muted); box-shadow: var(--shadow-md); }
        .card-header { padding-bottom: var(--spacing-lg); margin-bottom: var(--spacing-lg); border-bottom: 1px solid var(--border-default); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 18px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: var(--spacing-sm); }
        .card-body { padding: 0; }
        
        /* å ä½å†…å®¹ */
        .placeholder-content { text-align: center; padding: var(--spacing-2xl); color: var(--text-secondary); }
        .placeholder-icon { font-size: 64px; margin-bottom: var(--spacing-lg); opacity: 0.5; }
        .placeholder-text { font-size: 16px; margin-bottom: var(--spacing-sm); }
        .placeholder-subtext { font-size: 13px; color: var(--text-tertiary); }
        
        /* è¡¨å•æ ·å¼ */
        .form-group { margin-bottom: var(--spacing-lg); }
        .form-label { display: block; font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-sm); }
        .form-label .required { color: var(--danger-red); margin-left: 2px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: var(--spacing-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); color: var(--text-primary); font-size: 14px; font-family: var(--font-family); transition: all var(--transition-base); }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(43, 111, 237, 0.1); }
        .form-input:disabled { opacity: 0.5; cursor: not-allowed; }
        .form-textarea { min-height: 80px; resize: vertical; }
        .form-row { display: flex; gap: var(--spacing-lg); flex-wrap: wrap; }
        .form-row > .form-section { flex: 1; min-width: 300px; }
        .form-section { background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); }
        .form-section-title { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 1px solid var(--border-default); display: flex; align-items: center; gap: var(--spacing-sm); }

        /* å¤§æ¿å—å®¹å™¨æ ·å¼ */
        .major-block {
            background: linear-gradient(135deg, rgba(43, 111, 237, 0.03), rgba(124, 58, 237, 0.03));
            border: 2px solid var(--border-default);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-2xl);
            position: relative;
        }
        .major-block-header {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--primary-blue);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        .major-block-header i {
            font-size: 22px;
        }
        .major-block-description {
            font-size: 13px;
            color: var(--text-secondary);
            margin-left: auto;
            font-weight: 400;
        }
        
        /* å•é€‰æŒ‰é’®ç»„ */
        .radio-group { display: flex; gap: var(--spacing-md); flex-wrap: wrap; }
        .radio-option { display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-md); background: var(--bg-secondary); border: 2px solid var(--border-default); border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition-base); flex: 1; min-width: 120px; }
        .radio-option:hover { border-color: var(--primary-blue); background: var(--bg-hover); }
        .radio-option input[type="radio"] { width: 18px; height: 18px; cursor: pointer; }
        .radio-option input[type="radio"]:checked + label { color: var(--primary-blue); font-weight: 600; }
        .radio-option:has(input[type="radio"]:checked) { border-color: var(--primary-blue); background: rgba(43, 111, 237, 0.1); }
        .radio-label { cursor: pointer; font-size: 14px; color: var(--text-primary); }

        /* ä»·æ ¼ç½‘æ ¼å¸ƒå±€ */
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
        }
        .price-grid .radio-option {
            min-width: auto;
            padding: 10px 12px;
            justify-content: center;
            flex: none;
        }
        .price-grid .radio-label {
            font-size: 13px;
            font-weight: 500;
        }
        
        /* å¤é€‰æ¡†ç»„ */
        .checkbox-group { display: flex; flex-direction: column; gap: var(--spacing-sm); }
        .checkbox-option { display: flex; align-items: center; gap: var(--spacing-sm); padding: var(--spacing-sm) var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border-default); border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition-base); }
        .checkbox-option:hover { border-color: var(--primary-blue); background: var(--bg-hover); }
        .checkbox-option input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .checkbox-option:has(input[type="checkbox"]:checked) { border-color: var(--primary-blue); background: rgba(43, 111, 237, 0.1); }
        .checkbox-label { cursor: pointer; font-size: 14px; color: var(--text-primary); }
        
        /* Modalå¼¹æ¡†æ ·å¼ - å…¨å±æ»šåŠ¨ï¼Œæ— å†…éƒ¨æ»šåŠ¨æ¡ */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(4px); z-index: 10000; display: none; padding: 20px; overflow-y: auto; }
        .modal-overlay.show { display: block; }
        .modal-container { background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-lg); width: 100%; max-width: 1400px; margin: 20px auto 40px auto; box-shadow: var(--shadow-xl); }
        .modal-header { padding: var(--spacing-lg) var(--spacing-xl); border-bottom: 1px solid var(--border-default); display: flex; justify-content: space-between; align-items: center; background: var(--bg-card); border-radius: var(--radius-lg) var(--radius-lg) 0 0; }
        .modal-title { font-size: 18px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: var(--spacing-sm); }
        .modal-close { background: transparent; border: none; color: var(--text-secondary); font-size: 24px; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-md); transition: all var(--transition-base); }
        .modal-close:hover { background: var(--bg-hover); color: var(--text-primary); }
        .modal-body { padding: var(--spacing-xl); }
        
        /* å¤šé€‰ä¸‹æ‹‰æ¡† */
        .multi-select-wrapper { position: relative; }
        .multi-select-display { padding: var(--spacing-md); background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); min-height: 44px; display: flex; flex-wrap: wrap; gap: var(--spacing-sm); align-items: center; cursor: pointer; }
        .multi-select-tag { display: inline-flex; align-items: center; gap: var(--spacing-xs); padding: var(--spacing-xs) var(--spacing-sm); background: var(--primary-blue); color: white; border-radius: var(--radius-sm); font-size: 12px; }
        .multi-select-tag .remove { cursor: pointer; margin-left: 4px; }
        .multi-select-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-md); margin-top: var(--spacing-xs); max-height: 200px; overflow-y: auto; z-index: 100; display: none; }
        .multi-select-dropdown.show { display: block; }
        .multi-select-item { padding: var(--spacing-sm) var(--spacing-md); cursor: pointer; transition: background var(--transition-fast); }
        .multi-select-item:hover { background: var(--bg-hover); }
        .multi-select-item input[type="checkbox"] { margin-right: var(--spacing-sm); }
        
        /* ç­–ç•¥åˆ—è¡¨ */
        .strategy-list { margin-bottom: var(--spacing-xl); }
        .strategy-item { background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--spacing-lg); margin-bottom: var(--spacing-md); transition: all var(--transition-base); }
        .strategy-item:hover { border-color: var(--primary-blue); box-shadow: var(--shadow-md); }
        .strategy-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md); }
        .strategy-item-title { font-size: 16px; font-weight: 600; color: var(--text-primary); }
        .strategy-item-actions { display: flex; gap: var(--spacing-sm); }
        .strategy-item-body { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md); }
        .strategy-item-field-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
        .strategy-item-field-value { font-size: 14px; color: var(--text-primary); }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-sm); padding: var(--spacing-md) var(--spacing-xl); font-size: 14px; font-weight: 500; line-height: 1; text-decoration: none; border: 1px solid transparent; border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition-base); white-space: nowrap; }
        .btn-primary { background: var(--primary-blue); color: white; border-color: var(--primary-blue); }
        .btn-primary:hover { background: var(--primary-blue-hover); border-color: var(--primary-blue-hover); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border-color: var(--border-default); }
        .btn-secondary:hover { background: var(--bg-hover); border-color: var(--border-muted); }
        .btn-success { background: var(--success-green); color: white; border-color: var(--success-green); }
        .btn-success:hover { background: #059669; border-color: #059669; transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-danger { background: var(--danger-red); color: white; border-color: var(--danger-red); }
        .btn-danger:hover { background: #DC2626; border-color: #DC2626; transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-sm { padding: var(--spacing-sm) var(--spacing-md); font-size: 12px; }
        .btn-detail { padding: 4px 8px; font-size: 11px; background: var(--primary-blue); color: white; border: none; border-radius: var(--radius-sm); cursor: pointer; transition: all var(--transition-base); }
        .btn-detail:hover { background: var(--primary-blue-hover); transform: translateY(-1px); box-shadow: var(--shadow-sm); }
        
        /* è‡ªå®šä¹‰æç¤ºæ¡† */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: var(--spacing-md); max-width: 400px; }
        .toast { background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--spacing-lg); box-shadow: var(--shadow-xl); display: flex; align-items: flex-start; gap: var(--spacing-md); animation: slideInRight 0.3s ease-out; min-width: 320px; }
        .toast.success { border-left: 4px solid var(--success-green); }
        .toast.error { border-left: 4px solid var(--danger-red); }
        .toast.warning { border-left: 4px solid var(--warning-yellow); }
        .toast.info { border-left: 4px solid var(--info-blue); }
        .toast-icon { font-size: 24px; flex-shrink: 0; margin-top: 2px; }
        .toast.success .toast-icon { color: var(--success-green); }
        .toast.error .toast-icon { color: var(--danger-red); }
        .toast.warning .toast-icon { color: var(--warning-yellow); }
        .toast.info .toast-icon { color: var(--info-blue); }
        .toast-content { flex: 1; }
        .toast-title { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: var(--spacing-xs); }
        .toast-message { font-size: 14px; color: var(--text-secondary); line-height: 1.5; white-space: pre-line; }
        .toast-close { background: none; border: none; color: var(--text-tertiary); cursor: pointer; font-size: 20px; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius-sm); transition: all var(--transition-fast); flex-shrink: 0; }
        .toast-close:hover { background: var(--bg-hover); color: var(--text-primary); }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .toast.hiding { animation: slideOutRight 0.3s ease-out forwards; }
        
        /* è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† */
        .confirm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .confirm-modal-dialog {
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-xl);
            padding: 0;
            min-width: 400px;
            max-width: 500px;
            box-shadow: var(--shadow-xl), 0 0 40px rgba(0, 0, 0, 0.4);
            animation: slideUpModal 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }
        @keyframes slideUpModal {
            from {
                transform: translateY(20px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        .confirm-modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-default);
        }
        .confirm-modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        .confirm-modal-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .confirm-modal-body {
            padding: var(--spacing-xl);
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 15px;
        }
        .confirm-modal-footer {
            padding: var(--spacing-lg) var(--spacing-xl);
            border-top: 1px solid var(--border-default);
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            background: var(--bg-secondary);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container { padding: var(--spacing-md); }
            .header-content { flex-direction: column; align-items: flex-start; }
            .strategy-type-tabs { flex-direction: column; }
            .strategy-type-tab { width: 100%; }
        }

        /* å¼€å…³æŒ‰é’®æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: .4s;
            border: 1px solid var(--border-default);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .slider.round {
            border-radius: 24px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
        
    </style>
</head>
<body>
    <!-- æç¤ºæ¡†å®¹å™¨ -->
    <div id="toastContainer" class="toast-container"></div>
    
    <script>
        // è‡ªå®šä¹‰æç¤ºæ¡†å‡½æ•°
        function showToast(message, type = 'info', duration = 3000) {
            let container = document.getElementById('toastContainer');
            if (!container) {
                // å¦‚æœå®¹å™¨ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª
                container = document.createElement('div');
                container.id = 'toastContainer';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: 'bi-check-circle-fill',
                error: 'bi-x-circle-fill',
                warning: 'bi-exclamation-triangle-fill',
                info: 'bi-info-circle-fill'
            };
            
            const titles = {
                success: 'æˆåŠŸ',
                error: 'é”™è¯¯',
                warning: 'è­¦å‘Š',
                info: 'æç¤º'
            };
            
            toast.innerHTML = `
                <i class="bi ${icons[type]} toast-icon"></i>
                <div class="toast-content">
                    <div class="toast-title">${titles[type]}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="bi-x"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // è‡ªåŠ¨å…³é—­
            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.add('hiding');
                    setTimeout(() => {
                        if (toast.parentElement) {
                            toast.remove();
                        }
                    }, 300);
                }, duration);
            }
            
            return toast;
        }
        
        // å…¼å®¹æ—§çš„ alert è°ƒç”¨
        function showAlert(message, type = 'info') {
            showToast(message, type, 4000);
        }
    </script>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div>
                    <h1 class="header-title">
                        <i class="bi bi-diagram-3"></i>
                        äº¤æ˜“ç­–ç•¥
                    </h1>
                    <p class="header-subtitle">ç®¡ç†æ‚¨çš„ç°è´§å’Œåˆçº¦äº¤æ˜“ç­–ç•¥é…ç½®</p>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-container">
            <div class="nav-links">
                <a href="/" class="nav-link">
                    <i class="bi bi-house"></i> é¦–é¡µ
                </a>
                <a href="/dashboard" class="nav-link">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
                <a href="/technical-signals" class="nav-link">
                    <i class="bi bi-graph-up-arrow"></i> æŠ€æœ¯ä¿¡å·
                </a>
                <a href="/paper_trading" class="nav-link">
                    <i class="bi bi-journals"></i> æ¨¡æ‹Ÿç°è´§
                </a>
                <a href="/futures_trading" class="nav-link">
                    <i class="bi bi-graph-up-arrow"></i> æ¨¡æ‹Ÿåˆçº¦
                </a>
                <a href="/futures_review" class="nav-link">
                    <i class="bi bi-journal-check"></i> å¤ç›˜(24H)
                </a>
                <a href="/live_trading" class="nav-link">
                    <i class="bi bi-currency-exchange"></i> å®ç›˜åˆçº¦
                </a>
                <a href="/trading-strategies" class="nav-link active">
                    <i class="bi bi-diagram-3"></i> äº¤æ˜“ç­–ç•¥
                </a>
                <a href="/etf_data" class="nav-link">
                    <i class="bi bi-pie-chart"></i> ETF æ•°æ®
                </a>
                <a href="/corporate_treasury" class="nav-link">
                    <i class="bi bi-building"></i> ä¼ä¸šé‡‘åº“
                </a>
                <a href="/blockchain_gas" class="nav-link">
                    <i class="bi bi-lightning-charge"></i> Gasç»Ÿè®¡
                </a>
                <a href="/data_management" class="nav-link">
                    <i class="bi bi-database"></i> æ•°æ®ç®¡ç†
                </a>
            </div>
        </nav>

        <!-- Strategy Type Tabs -->
        <div class="strategy-type-tabs">
            <button class="strategy-type-tab active" onclick="switchStrategyType('spot', event)">
                <i class="bi bi-currency-exchange"></i>
                ç°è´§äº¤æ˜“ç­–ç•¥
            </button>
            <button class="strategy-type-tab" onclick="switchStrategyType('futures', event)">
                <i class="bi bi-graph-up-arrow"></i>
                åˆçº¦äº¤æ˜“ç­–ç•¥
            </button>
            <button class="strategy-type-tab" onclick="switchStrategyType('execution', event)">
                <i class="bi bi-list-check"></i>
                ç­–ç•¥æ‰§è¡Œæ¸…å•
            </button>
        </div>

        <!-- Spot Trading Strategy Content -->
        <div id="spotStrategyContent" class="strategy-content active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="bi bi-currency-exchange"></i>
                        ç°è´§äº¤æ˜“ç­–ç•¥
                    </h2>
                </div>
                <div class="card-body">
                    <div class="placeholder-content">
                        <div class="placeholder-icon">
                            <i class="bi bi-currency-exchange"></i>
                        </div>
                        <div class="placeholder-text">ç°è´§äº¤æ˜“ç­–ç•¥é…ç½®</div>
                        <div class="placeholder-subtext">æ­¤éƒ¨åˆ†åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Futures Trading Strategy Content -->
        <div id="futuresStrategyContent" class="strategy-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="bi bi-graph-up-arrow"></i>
                        åˆçº¦äº¤æ˜“ç­–ç•¥
                    </h2>
                    <button class="btn btn-primary" onclick="showAddStrategyModal()">
                        <i class="bi bi-plus-circle"></i>
                        æ·»åŠ ç­–ç•¥
                    </button>
                </div>
                <div class="card-body">
                    <!-- ç­–ç•¥åˆ—è¡¨ -->
                    <div class="strategy-list" id="futuresStrategyList">
                        <!-- ç­–ç•¥é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                    </div>
                    
                    <!-- ç­–ç•¥åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->

                    <!-- ç©ºçŠ¶æ€ -->
                    <div class="placeholder-content" id="emptyState">
                        <div class="placeholder-icon">
                            <i class="bi bi-graph-up-arrow"></i>
                        </div>
                        <div class="placeholder-text">æš‚æ— ç­–ç•¥</div>
                        <div class="placeholder-subtext">ç‚¹å‡»"æ·»åŠ ç­–ç•¥"æŒ‰é’®åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªåˆçº¦äº¤æ˜“ç­–ç•¥</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategy Execution List Content -->
        <div id="executionListContent" class="strategy-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="bi bi-list-check"></i>
                        ç­–ç•¥æ‰§è¡Œæ¸…å•
                    </h2>
                    <button class="btn btn-secondary" onclick="refreshExecutionList()">
                        <i class="bi bi-arrow-clockwise"></i>
                        åˆ·æ–°
                    </button>
                </div>
                <div class="card-body">
                    <!-- ç­›é€‰å™¨ -->
                    <div style="display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); flex-wrap: wrap; align-items: center;">
                        <div style="flex: 1; min-width: 200px;">
                            <label class="form-label">å¸‚åœºç±»å‹</label>
                            <select class="form-select" id="executionMarketType" onchange="loadExecutionList()">
                                <option value="all">å…¨éƒ¨ç±»å‹</option>
                                <option value="test">æµ‹è¯•</option>
                                <option value="live">å®ç›˜</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label class="form-label">æ“ä½œç±»å‹</label>
                            <select class="form-select" id="executionActionType" onchange="loadExecutionList()">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="buy">ä¹°å…¥/å¼€ä»“</option>
                                <option value="sell">å–å‡º/å¹³ä»“</option>
                                <option value="order">ä¸‹å•</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label class="form-label">äº¤æ˜“å¯¹</label>
                            <input type="text" class="form-input" id="executionSymbol" placeholder="ä¾‹å¦‚: BTC/USDT" onchange="loadExecutionList()">
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label class="form-label">æ—¶é—´èŒƒå›´</label>
                            <select class="form-select" id="executionTimeRange" onchange="loadExecutionList()">
                                <option value="1h">æœ€è¿‘1å°æ—¶</option>
                                <option value="24h">æœ€è¿‘24å°æ—¶</option>
                                <option value="7d">æœ€è¿‘7å¤©</option>
                                <option value="30d" selected>æœ€è¿‘30å¤©</option>
                                <option value="all">å…¨éƒ¨</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 200px;">
                            <label class="form-label">çŠ¶æ€</label>
                            <select class="form-select" id="executionStatus" onchange="loadExecutionList()">
                                <option value="all">å…¨éƒ¨</option>
                                <option value="FILLED">å·²æˆäº¤</option>
                                <option value="PENDING">å¾…æˆäº¤</option>
                                <option value="CANCELLED">å·²å–æ¶ˆ</option>
                            </select>
                        </div>
                    </div>

                    <!-- æ‰§è¡Œç»“æœåˆ—è¡¨ -->
                    <div id="executionListContainer" style="max-height: 600px; overflow-y: auto; border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--spacing-md);">
                        <div class="placeholder-content">
                            <div class="placeholder-icon">
                                <i class="bi bi-hourglass-split"></i>
                            </div>
                            <div class="placeholder-text">æ­£åœ¨åŠ è½½æ‰§è¡Œè®°å½•...</div>
                        </div>
                    </div>

                    <!-- åˆ†é¡µæ§ä»¶ -->
                    <div id="executionPagination" style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: var(--radius-md);">
                        <div id="executionPageInfo" style="color: var(--text-secondary); font-size: 13px;">
                            å…± <span id="executionTotalCount">0</span> æ¡è®°å½•
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                            <button class="btn btn-secondary btn-sm" id="executionPrevPage" onclick="changeExecutionPage(-1)" disabled>
                                <i class="bi bi-chevron-left"></i> ä¸Šä¸€é¡µ
                            </button>
                            <span id="executionCurrentPage" style="padding: 0 var(--spacing-md); color: var(--text-primary);">1</span>
                            <span style="color: var(--text-secondary);">/</span>
                            <span id="executionTotalPages" style="padding: 0 var(--spacing-md); color: var(--text-secondary);">1</span>
                            <button class="btn btn-secondary btn-sm" id="executionNextPage" onclick="changeExecutionPage(1)" disabled>
                                ä¸‹ä¸€é¡µ <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                        <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                            <label style="color: var(--text-secondary); font-size: 13px;">æ¯é¡µæ˜¾ç¤º:</label>
                            <select class="form-select" id="executionPageSize" onchange="loadExecutionList()" style="width: auto; padding: 4px 8px;">
                                <option value="20">20</option>
                                <option value="50" selected>50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç­–ç•¥ç¼–è¾‘Modalå¼¹æ¡† -->
        <div class="modal-overlay" id="strategyModal">
            <div class="modal-container">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle">
                        <i class="bi bi-plus-circle"></i>
                        æ–°å»ºåˆçº¦äº¤æ˜“ç­–ç•¥
                    </h3>
                    <button class="modal-close" onclick="closeStrategyModal()" type="button">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="strategyForm" onsubmit="saveStrategy(event)">
                            <!-- ç­–ç•¥åŸºæœ¬ä¿¡æ¯ -->
                            <div class="form-group">
                                <label class="form-label">ç­–ç•¥åç§°<span class="required">*</span></label>
                                <input type="text" class="form-input" id="strategyName" placeholder="ä¾‹å¦‚ï¼šEMAå¤šç©ºç­–ç•¥" required>
                            </div>

                            <!-- ç­–ç•¥ç‰ˆæœ¬é€‰æ‹© -->
                            <div class="form-group">
                                <label class="form-label">ç­–ç•¥ç‰ˆæœ¬<span class="required">*</span></label>
                                <div class="radio-group" style="flex-direction: row; gap: 16px;">
                                    <div class="radio-option">
                                        <input type="radio" id="strategyTypeV2" name="strategyType" value="v2" checked onchange="updateStrategyTypeDescription()">
                                        <label for="strategyTypeV2" class="radio-label">
                                            <i class="bi bi-graph-up-arrow"></i>
                                            V2 (é‡‘å‰/æ­»å‰)
                                        </label>
                                    </div>
                                    <div class="radio-option">
                                        <input type="radio" id="strategyTypeV3" name="strategyType" value="v3" onchange="updateStrategyTypeDescription()">
                                        <label for="strategyTypeV3" class="radio-label">
                                            <i class="bi bi-arrows-move"></i>
                                            V3 (æŒç»­è¶‹åŠ¿è¿½å•)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- V2ç­–ç•¥è¯´æ˜ -->
                            <input type="hidden" id="useV2Strategy" value="true">
                            <div id="v2Description" class="form-group" style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(43, 111, 237, 0.1)); border-radius: var(--radius-lg); border-left: 4px solid var(--success-green);">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <i class="bi bi-lightning-charge-fill" style="color: var(--success-green); font-size: 18px;"></i>
                                    <span style="font-weight: 700; font-size: 14px; color: var(--success-green);">V2 é‡‘å‰/æ­»å‰ç­–ç•¥</span>
                                </div>
                                <small style="color: var(--text-secondary); font-size: 12px; line-height: 1.6;">
                                    æ•æ‰è¶‹åŠ¿åˆæœŸä¿¡å·ï¼š15M EMA(9,26)é‡‘å‰/æ­»å‰ + 1Hæ–¹å‘ç¡®è®¤ + é™ä»·å•ç­‰å›è°ƒå…¥åœº<br>
                                    ä¿¡å·å¼ºåº¦ï¼š1.2%-2.5% | ç¡¬æ­¢æŸï¼š2.5% | ç§»åŠ¨æ­¢ç›ˆï¼š3.4%æ¿€æ´»â†’0.3%å›è°ƒ
                                </small>
                            </div>

                            <!-- V3ç­–ç•¥è¯´æ˜ -->
                            <div id="v3Description" class="form-group" style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1)); border-radius: var(--radius-lg); border-left: 4px solid var(--primary-purple); display: none;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <i class="bi bi-arrows-move" style="color: var(--primary-purple); font-size: 18px;"></i>
                                    <span style="font-weight: 700; font-size: 14px; color: var(--primary-purple);">V3 æŒç»­è¶‹åŠ¿è¿½å•ç­–ç•¥</span>
                                </div>
                                <small style="color: var(--text-secondary); font-size: 12px; line-height: 1.6;">
                                    æ•æ‰å¼ºè¶‹åŠ¿å»¶ç»­æœºä¼šï¼š15Mè¿ç»­3æ ¹Kçº¿EMA9åŒå‘ç§»åŠ¨(æ¯æ ¹â‰¥0.3%) + æ€»ä¿¡å·å¼ºåº¦â‰¥1.0% + 1Hæ–¹å‘ç¡®è®¤<br>
                                    å›ºå®šé™ä»·å•ï¼šåšå¤šmarket_minus_1%, åšç©ºmarket_plus_1% | ç¡¬æ­¢æŸï¼š2.5% | ç§»åŠ¨æ­¢ç›ˆï¼š3.4%æ¿€æ´»â†’0.3%å›è°ƒ<br>
                                    <span style="color: var(--warning-yellow); font-weight: 600;">âš ï¸ V3è¦æ±‚å¸‚åœºå·²ç»å½¢æˆæ˜æ˜¾è¶‹åŠ¿ï¼Œæ›´é€‚åˆè¶‹åŠ¿å»¶ç»­é˜¶æ®µ</span>
                                </small>
                            </div>

                            <!-- åå‘æ“ä½œç­–ç•¥é…ç½® âš¡ æ–°å¢ -->
                            <div class="form-group" style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(234, 179, 8, 0.1)); border-radius: var(--radius-lg); border-left: 4px solid var(--secondary-orange);">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <i class="bi bi-arrow-left-right" style="color: var(--secondary-orange); font-size: 18px;"></i>
                                        <span style="font-weight: 700; font-size: 14px; color: var(--secondary-orange);">ğŸ”„ åå‘æ“ä½œç­–ç•¥ï¼ˆéœ‡è¡å¸‚ç¥å™¨ï¼‰</span>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="contrarianEnabled" onchange="toggleContrarianConfig()">
                                        <span class="slider round"></span>
                                    </label>
                                </div>

                                <small style="color: var(--text-secondary); font-size: 12px; line-height: 1.6; display: block; margin-bottom: 12px;">
                                    å½“æ£€æµ‹åˆ°V3ä¿¡å·æ—¶ï¼Œåå‘å¼€ä»“ï¼Œåˆ©ç”¨éœ‡è¡å¸‚å‡å€¼å›å½’ç‰¹æ€§è·åˆ©<br>
                                    <span style="color: var(--success-green); font-weight: 600;">âœ… æ•°æ®éªŒè¯ï¼šåå‘æ“ä½œèƒœç‡94.7% vs è¶‹åŠ¿è·Ÿéš5.3%ï¼ˆ2026-01-17ï¼‰</span>
                                </small>

                                <!-- åå‘æ“ä½œè¯¦ç»†é…ç½® -->
                                <div id="contrarianConfigPanel" style="display: none; margin-top: 12px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">

                                    <!-- å¸‚åœºç¯å¢ƒæ¨¡å¼ -->
                                    <div class="form-group" style="margin-bottom: 12px;">
                                        <label class="form-label" style="font-size: 12px; margin-bottom: 6px;">å¸‚åœºç¯å¢ƒæ£€æµ‹æ¨¡å¼</label>
                                        <div class="radio-group" style="flex-direction: row; gap: 8px; flex-wrap: wrap;">
                                            <div class="radio-option" style="padding: 6px 12px;">
                                                <input type="radio" id="marketRegimeAuto" name="marketRegime" value="auto_detect" checked onchange="toggleMarketDetectionConfig()">
                                                <label for="marketRegimeAuto" class="radio-label" style="font-size: 11px;">
                                                    <i class="bi bi-gear-fill"></i> è‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰
                                                </label>
                                            </div>
                                            <div class="radio-option" style="padding: 6px 12px;">
                                                <input type="radio" id="marketRegimeAlways" name="marketRegime" value="always_contrarian" onchange="toggleMarketDetectionConfig()">
                                                <label for="marketRegimeAlways" class="radio-label" style="font-size: 11px;">
                                                    <i class="bi bi-arrow-left-right"></i> å¼ºåˆ¶åå‘
                                                </label>
                                            </div>
                                            <div class="radio-option" style="padding: 6px 12px;">
                                                <input type="radio" id="marketRegimeNever" name="marketRegime" value="never_contrarian" onchange="toggleMarketDetectionConfig()">
                                                <label for="marketRegimeNever" class="radio-label" style="font-size: 11px;">
                                                    <i class="bi bi-arrow-up-right"></i> ç¦ç”¨åå‘
                                                </label>
                                            </div>
                                        </div>
                                        <small style="color: var(--text-tertiary); font-size: 10px; display: block; margin-top: 4px;">
                                            è‡ªåŠ¨æ£€æµ‹ï¼šç³»ç»Ÿæ ¹æ®æœ€è¿‘24häº¤æ˜“æ•°æ®åˆ¤æ–­æ˜¯å¦éœ‡è¡å¸‚ï¼Œè‡ªåŠ¨åˆ‡æ¢ç­–ç•¥
                                        </small>
                                    </div>

                                    <!-- å¸‚åœºæ£€æµ‹å‚æ•°ï¼ˆä»…è‡ªåŠ¨æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
                                    <div id="marketDetectionPanel" style="margin-bottom: 12px;">
                                        <label class="form-label" style="font-size: 12px; margin-bottom: 6px;">å¸‚åœºæ£€æµ‹å‚æ•°</label>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                            <div>
                                                <label style="font-size: 10px; color: var(--text-secondary);">å›æº¯æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</label>
                                                <input type="number" id="lookbackHours" class="form-input" style="padding: 6px; font-size: 12px;" value="24" min="12" max="72">
                                            </div>
                                            <div>
                                                <label style="font-size: 10px; color: var(--text-secondary);">æœ€å°äº¤æ˜“æ•°</label>
                                                <input type="number" id="minTrades" class="form-input" style="padding: 6px; font-size: 12px;" value="10" min="5" max="50">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- åå‘æ“ä½œé£é™©å‚æ•° -->
                                    <div class="form-group" style="margin-bottom: 8px;">
                                        <label class="form-label" style="font-size: 12px; margin-bottom: 6px;">åå‘æ“ä½œé£é™©å‚æ•°ï¼ˆæ›´ä¿å®ˆï¼‰</label>
                                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                                            <div>
                                                <label style="font-size: 10px; color: var(--text-secondary);">æ­¢æŸ(%)</label>
                                                <input type="number" id="contrarianStopLoss" class="form-input" style="padding: 6px; font-size: 12px;" value="1.5" step="0.1">
                                            </div>
                                            <div>
                                                <label style="font-size: 10px; color: var(--text-secondary);">æ­¢ç›ˆ(%)</label>
                                                <input type="number" id="contrarianTakeProfit" class="form-input" style="padding: 6px; font-size: 12px;" value="1.0" step="0.1">
                                            </div>
                                            <div>
                                                <label style="font-size: 10px; color: var(--text-secondary);">é™ä»·å•åç§»(%)</label>
                                                <input type="number" id="contrarianLimitOffset" class="form-input" style="padding: 6px; font-size: 12px;" value="0.5" step="0.1">
                                            </div>
                                        </div>
                                    </div>

                                    <small style="color: var(--warning-yellow); font-size: 10px; display: flex; align-items: center; gap: 4px;">
                                        <i class="bi bi-exclamation-triangle-fill"></i>
                                        åå‘æ“ä½œåœ¨è¶‹åŠ¿å¸‚å¯èƒ½äºæŸï¼Œå»ºè®®å¯ç”¨è‡ªåŠ¨æ£€æµ‹æ¨¡å¼
                                    </small>
                                </div>
                            </div>

                            <!-- ä¹°å…¥æ¡ä»¶ï¼ˆå…¨å®½æ˜¾ç¤ºï¼‰ -->
                        <!-- ============================================ -->
                        <!-- æ¿å—1ï¼šå¼€ä»“è®¾ç½® -->
                        <!-- ============================================ -->
                        <div class="major-block">
                            <div class="major-block-header">
                                <i class="bi bi-door-open"></i>
                                å¼€ä»“è®¾ç½®
                                <span class="major-block-description">é…ç½®å…¥åœºä¿¡å·ã€æ¡ä»¶å’Œæ§åˆ¶ç­–ç•¥</span>
                            </div>

                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-arrow-down-circle" style="color: var(--success-green);"></i>
                                    ä¹°å…¥æ¡ä»¶
                                </div>

                                <!-- åŸºç¡€è®¾ç½®ï¼šæ–¹å‘ã€å€æ•°ã€ä¿¡å·ï¼ˆä¸‰æ å¸ƒå±€ï¼‰ -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
                                    <div class="form-group">
                                        <label class="form-label">äº¤æ˜“æ–¹å‘<span class="required">*</span></label>
                                        <div class="checkbox-group" style="flex-direction: row; flex-wrap: wrap;">
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="buyDirectionLong" name="buyDirection" value="long" onchange="updatePriceOptions()">
                                                <label for="buyDirectionLong" class="checkbox-label">
                                                    <i class="bi bi-arrow-up-circle" style="color: var(--success-green);"></i>
                                                    åšå¤š
                                                </label>
                                            </div>
                                            <div class="checkbox-option">
                                                <input type="checkbox" id="buyDirectionShort" name="buyDirection" value="short" onchange="updatePriceOptions()">
                                                <label for="buyDirectionShort" class="checkbox-label">
                                                    <i class="bi bi-arrow-down-circle" style="color: var(--danger-red);"></i>
                                                    åšç©º
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">äº¤æ˜“å€æ•°<span class="required">*</span></label>
                                        <div class="radio-group" style="flex-direction: row; flex-wrap: wrap;">
                                            <div class="radio-option">
                                                <input type="radio" id="leverage5" name="leverage" value="5" checked>
                                                <label for="leverage5" class="radio-label">X5</label>
                                            </div>
                                            <div class="radio-option">
                                                <input type="radio" id="leverage10" name="leverage" value="10">
                                                <label for="leverage10" class="radio-label">X10</label>
                                            </div>
                                            <div class="radio-option">
                                                <input type="radio" id="leverage20" name="leverage" value="20">
                                                <label for="leverage20" class="radio-label">X20</label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">å¼€ä»“ä¿¡å·</label>
                                        <!-- V2ç­–ç•¥å›ºå®šä½¿ç”¨ EMA 15åˆ†é’Ÿä¿¡å· -->
                                        <div style="padding: 12px; background: rgba(16, 185, 129, 0.08); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.2);">
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <i class="bi bi-graph-up-arrow" style="color: var(--success-green);"></i>
                                                <span style="font-weight: 600; color: var(--text-primary);">EMA(9,26) 15åˆ†é’Ÿ é‡‘å‰/æ­»å‰</span>
                                            </div>
                                            <small style="color: var(--text-secondary); font-size: 12px; margin-top: 6px; display: block;">
                                                é‡‘å‰ï¼ˆEMA9ä¸Šç©¿EMA26ï¼‰= åšå¤šä¿¡å· | æ­»å‰ï¼ˆEMA9ä¸‹ç©¿EMA26ï¼‰= åšç©ºä¿¡å·<br>
                                                é…åˆ MA10/EMA10 æ–¹å‘ä¸€è‡´æ€§è¿‡æ»¤ï¼Œä¿¡å·å¼ºåº¦â‰¥0.15%
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <!-- ç»“æŸä¸‰æ å¸ƒå±€ -->

                                <!-- æŠ€æœ¯æŒ‡æ ‡è¿‡æ»¤å™¨ -->
                                <div class="form-group" style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--border-default);">
                                        <label class="form-label" style="font-size: 14px; font-weight: 600; margin-bottom: var(--spacing-md);">
                                            <i class="bi bi-funnel"></i> æŠ€æœ¯æŒ‡æ ‡è¿‡æ»¤å™¨
                                        </label>
                                        
                                        <!-- RSIè¿‡æ»¤å™¨ -->
                                        <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                <input type="checkbox" id="rsiFilterEnabled" name="rsiFilterEnabled">
                                                <label for="rsiFilterEnabled" class="checkbox-label" style="margin: 0; font-weight: 500;">å¯ç”¨ RSI è¿‡æ»¤</label>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 26px; margin-top: 8px;">
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">åšå¤šæ—¶RSIæœ€å¤§å€¼</label>
                                                    <input type="number" class="form-input" id="rsiLongMax" placeholder="70" min="50" max="90" step="1" value="70" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">åšå¤šæ—¶RSIéœ€å°äºæ­¤å€¼</small>
                                                </div>
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">åšç©ºæ—¶RSIæœ€å°å€¼</label>
                                                    <input type="number" class="form-input" id="rsiShortMin" placeholder="30" min="10" max="50" step="1" value="30" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">åšç©ºæ—¶RSIéœ€å¤§äºæ­¤å€¼</small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- MACDè¿‡æ»¤å™¨ -->
                                        <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                <input type="checkbox" id="macdFilterEnabled" name="macdFilterEnabled">
                                                <label for="macdFilterEnabled" class="checkbox-label" style="margin: 0; font-weight: 500;">å¯ç”¨ MACD è¿‡æ»¤</label>
                                            </div>
                                            <div style="margin-left: 26px; margin-top: 8px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                                    <input type="checkbox" id="macdLongRequirePositive" name="macdLongRequirePositive" checked>
                                                    <label for="macdLongRequirePositive" class="checkbox-label" style="margin: 0; font-size: 13px;">åšå¤šæ—¶è¦æ±‚MACDæŸ±çŠ¶å›¾ > 0</label>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <input type="checkbox" id="macdShortRequireNegative" name="macdShortRequireNegative" checked>
                                                    <label for="macdShortRequireNegative" class="checkbox-label" style="margin: 0; font-size: 13px;">åšç©ºæ—¶è¦æ±‚MACDæŸ±çŠ¶å›¾ < 0</label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- KDJè¿‡æ»¤å™¨ -->
                                        <div style="padding: var(--spacing-md); background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                <input type="checkbox" id="kdjFilterEnabled" name="kdjFilterEnabled">
                                                <label for="kdjFilterEnabled" class="checkbox-label" style="margin: 0; font-weight: 500;">å¯ç”¨ KDJ è¿‡æ»¤</label>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 26px; margin-top: 8px;">
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">åšå¤šæ—¶KDJ Kå€¼æœ€å¤§å€¼</label>
                                                    <input type="number" class="form-input" id="kdjLongMaxK" placeholder="80" min="60" max="95" step="1" value="80" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">åšå¤šæ—¶KDJ Kå€¼éœ€å°äºæ­¤å€¼</small>
                                                </div>
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">åšç©ºæ—¶KDJ Kå€¼æœ€å°å€¼</label>
                                                    <input type="number" class="form-input" id="kdjShortMinK" placeholder="20" min="5" max="40" step="1" value="20" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">åšç©ºæ—¶KDJ Kå€¼éœ€å¤§äºæ­¤å€¼</small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- æŒç»­è¶‹åŠ¿ä¿¡å·é…ç½® -->
                                        <div style="margin-top: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                <input type="checkbox" id="sustainedTrendEnabled" name="sustainedTrendEnabled">
                                                <label for="sustainedTrendEnabled" class="checkbox-label" style="margin: 0; font-weight: 500;">ğŸ“‰ å¯ç”¨æŒç»­è¶‹åŠ¿ä¿¡å·</label>
                                            </div>
                                            <small style="color: var(--text-secondary); font-size: 11px; margin-bottom: 8px; display: block; margin-left: 26px;">
                                                åœ¨è¶‹åŠ¿å·²ç»ç¡®ç«‹åä»å¯å¼€ä»“ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨ç©¿è¶Šå‘ç”Ÿæ—¶å¼€ä»“
                                            </small>
                                            <div style="background: rgba(76, 175, 80, 0.1); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 6px; padding: 8px 12px; margin-left: 26px; margin-bottom: 12px;">
                                                <small style="color: #4caf50; font-size: 11px; display: block;">
                                                    ğŸ’¡ <strong>ä½¿ç”¨åœºæ™¯ï¼š</strong>å½“é”™è¿‡ç©¿è¶Šæ—¶æœºåï¼Œå¦‚æœè¶‹åŠ¿æŒç»­ä¸”ç¬¦åˆæ¡ä»¶ï¼Œç­–ç•¥ä»ç„¶å¯ä»¥å¼€ä»“ï¼š
                                                </small>
                                                <small style="color: var(--text-secondary); font-size: 10px; display: block; margin-top: 4px; line-height: 1.5;">
                                                    â€¢ è¶‹åŠ¿å¼ºåº¦åœ¨åˆç†èŒƒå›´å†…ï¼ˆä¸è¿½é«˜æ€ä½ï¼‰<br>
                                                    â€¢ MA10/EMA10ç¡®è®¤è¶‹åŠ¿æ–¹å‘<br>
                                                    â€¢ ä»·æ ¼ç¬¦åˆè¶‹åŠ¿æ–¹å‘<br>
                                                    â€¢ å†·å´æ—¶é—´é˜²æ­¢é¢‘ç¹å¼€ä»“
                                                </small>
                                            </div>
                                            <div style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 6px; padding: 8px 12px; margin-left: 26px; margin-bottom: 12px;">
                                                <small style="color: #ffc107; font-size: 11px; display: block;">
                                                    âš¡ <strong>æ³¨æ„ï¼š</strong>æŒç»­è¶‹åŠ¿ä¿¡å·ä¼šè·³è¿‡ä»¥ä¸‹è¿‡æ»¤å™¨ï¼ˆå·²åœ¨ä¿¡å·æ£€æµ‹é˜¶æ®µå®Œæˆæ£€æŸ¥ï¼‰ï¼š
                                                </small>
                                                <small style="color: var(--text-secondary); font-size: 10px; display: block; margin-top: 4px; line-height: 1.5;">
                                                    è·³è¿‡ï¼šMA10/EMA10ä¿¡å·å¼ºåº¦æ£€æŸ¥ã€è¶‹åŠ¿æŒç»­æ€§æ£€æŸ¥(trend_confirm_bars)<br>
                                                    ä¿ç•™ï¼šRSIè¿‡æ»¤ã€MACDè¿‡æ»¤ã€KDJè¿‡æ»¤ã€æˆäº¤é‡æ¡ä»¶ã€æŒä»“é™åˆ¶
                                                </small>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 26px; margin-top: 8px;">
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">æœ€å°è¶‹åŠ¿å¼ºåº¦(%)</label>
                                                    <input type="number" class="form-input" id="sustainedTrendMinStrength" placeholder="0.15" min="0.05" max="1.0" step="0.05" value="0.15" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">EMAå·®è·éœ€å¤§äºæ­¤å€¼æ‰è§¦å‘ï¼ˆè¿‡æ»¤å¼±åŠ¿è¶‹åŠ¿ï¼‰</small>
                                                </div>
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">æœ€å¤§è¶‹åŠ¿å¼ºåº¦(%)</label>
                                                    <input type="number" class="form-input" id="sustainedTrendMaxStrength" placeholder="1.0" min="0.2" max="3.0" step="0.1" value="1.0" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">EMAå·®è·éœ€å°äºæ­¤å€¼ï¼ˆé˜²æ­¢è¿½é«˜æ€ä½ï¼‰</small>
                                                </div>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 26px; margin-top: 12px;">
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">å·®å€¼æ”¾å¤§Kçº¿æ•°</label>
                                                    <input type="number" class="form-input" id="sustainedTrendMinBars" placeholder="3" min="0" max="10" step="1" value="3" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">EMAå·®å€¼éœ€è¿ç»­æ”¾å¤§çš„Kçº¿æ•°ï¼ˆ0ä¸æ£€æŸ¥ï¼‰</small>
                                                </div>
                                                <div>
                                                    <label style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; display: block;">å†·å´æ—¶é—´(åˆ†é’Ÿ)</label>
                                                    <input type="number" class="form-input" id="sustainedTrendCooldownMinutes" placeholder="60" min="0" max="1440" step="15" value="60" style="width: 100%; padding: 6px; font-size: 13px;">
                                                    <small style="color: var(--text-secondary); font-size: 11px; margin-top: 4px; display: block;">åŒæ–¹å‘å¼€ä»“åçš„å†·å´æ—¶é—´ï¼ˆé˜²æ­¢é¢‘ç¹å¼€ä»“ï¼‰</small>
                                                </div>
                                            </div>
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-left: 26px; margin-top: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <input type="checkbox" id="sustainedTrendRequireMA10Confirm" name="sustainedTrendRequireMA10Confirm" checked>
                                                    <label for="sustainedTrendRequireMA10Confirm" class="checkbox-label" style="margin: 0; font-size: 12px;">è¦æ±‚MA10/EMA10ç¡®è®¤è¶‹åŠ¿</label>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <input type="checkbox" id="sustainedTrendRequirePriceConfirm" name="sustainedTrendRequirePriceConfirm" checked>
                                                    <label for="sustainedTrendRequirePriceConfirm" class="checkbox-label" style="margin: 0; font-size: 12px;">è¦æ±‚ä»·æ ¼ç¡®è®¤è¶‹åŠ¿æ–¹å‘</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ä»·æ ¼è·ç¦»EMAé™åˆ¶é…ç½®ï¼ˆé˜²æ­¢è¿½é«˜æ€ä½ï¼‰ -->
                                <div class="form-section" style="margin-top: 16px; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" id="priceDistanceLimitEnabled" name="priceDistanceLimitEnabled">
                                            <label for="priceDistanceLimitEnabled" class="checkbox-label" style="margin: 0; font-weight: 500;">ğŸ“ ä»·æ ¼è·ç¦»EMAé™åˆ¶</label>
                                        </div>
                                        <small style="color: var(--text-secondary); font-size: 11px; margin-left: auto;">
                                            é˜²æ­¢è¿½é«˜æ€ä½ï¼šå…¥åœºä»·åç¦»EMA9è¿‡å¤šæ—¶ä¸å¼€ä»“
                                        </small>
                                    </div>
                                    <div style="margin-left: 26px; margin-top: 8px; padding: 8px; background: rgba(33, 150, 243, 0.1); border-radius: 4px; border-left: 3px solid #2196f3;">
                                        <small style="font-size: 10px; color: #2196f3;">
                                            ğŸ’¡ å¸‚ä»·å•ç”¨å®æ—¶ä»·æ ¼åˆ¤æ–­ï¼Œé™ä»·å•ç”¨é™ä»·åˆ¤æ–­ï¼ˆå¦‚-0.2%åçš„ä»·æ ¼ï¼‰
                                        </small>
                                    </div>
                                    <div id="priceDistanceLimitConfig" style="margin-left: 26px; margin-top: 12px;">
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                                <label style="font-size: 12px; color: var(--text-secondary);">åšå¤šï¼šå…¥åœºä»·é«˜äºEMA9æœ€å¤§%</label>
                                                <input type="number" class="form-input" id="priceDistanceMaxAboveEMA" placeholder="1.0" min="0.1" max="5.0" step="0.1" value="1.0" style="width: 100%; padding: 6px; font-size: 13px;">
                                                <small style="font-size: 10px; color: var(--text-secondary);">å…¥åœºä»·é«˜äºEMA9è¶…è¿‡æ­¤å€¼æ—¶ä¸å¼€ä»“</small>
                                            </div>
                                            <div style="display: flex; flex-direction: column; gap: 4px;">
                                                <label style="font-size: 12px; color: var(--text-secondary);">åšç©ºï¼šå…¥åœºä»·ä½äºEMA9æœ€å¤§%</label>
                                                <input type="number" class="form-input" id="priceDistanceMaxBelowEMA" placeholder="1.0" min="0.1" max="5.0" step="0.1" value="1.0" style="width: 100%; padding: 6px; font-size: 13px;">
                                                <small style="font-size: 10px; color: var(--text-secondary);">å…¥åœºä»·ä½äºEMA9è¶…è¿‡æ­¤å€¼æ—¶ä¸å¼€ä»“</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- è¡Œæƒ…è‡ªé€‚åº”é…ç½® -->
                                <div class="form-section" style="margin-top: 16px; padding: 12px; background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(43, 111, 237, 0.1)); border-radius: var(--radius-md); border: 1px solid rgba(124, 58, 237, 0.3);">
                                    <div style="display: flex; align-items: flex-start; gap: 12px;">
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <input type="checkbox" id="adaptiveRegimeEnabled" name="adaptiveRegimeEnabled" onchange="toggleAdaptiveRegimeConfig()">
                                            <label for="adaptiveRegimeEnabled" class="checkbox-label" style="margin: 0; font-weight: 500;">ğŸ¯ è¡Œæƒ…è‡ªé€‚åº”</label>
                                        </div>
                                        <small style="color: var(--text-secondary); font-size: 11px; margin-left: auto;">
                                            è‡ªåŠ¨è¯†åˆ«è¶‹åŠ¿/éœ‡è¡è¡Œæƒ…ï¼ŒæŒ‰è¡Œæƒ…ç±»å‹åˆ‡æ¢å‚æ•°
                                        </small>
                                    </div>

                                    <!-- è¡Œæƒ…è‡ªé€‚åº”è¯¦ç»†é…ç½®ï¼ˆå‹¾é€‰åæ˜¾ç¤ºï¼‰ -->
                                    <div id="adaptiveRegimeConfig" style="display: none; margin-top: 12px;">
                                        <div style="padding: 10px; background: rgba(124, 58, 237, 0.1); border-radius: 6px; border-left: 3px solid #7c3aed; margin-bottom: 12px;">
                                            <small style="font-size: 11px; color: #a78bfa; display: block; margin-bottom: 6px;">
                                                <strong>ğŸ“Š å·¥ä½œåŸç†ï¼š</strong>
                                            </small>
                                            <small style="font-size: 10px; color: var(--text-secondary); display: block; line-height: 1.6;">
                                                â€¢ ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å½“å‰è¡Œæƒ…ç±»å‹ï¼ˆå¼º/å¼±è¶‹åŠ¿ã€éœ‡è¡ï¼‰<br>
                                                â€¢ æ ¹æ®è¡Œæƒ…ç±»å‹è‡ªåŠ¨åº”ç”¨ä¸‹æ–¹é…ç½®çš„å‚æ•°<br>
                                                â€¢ è¡Œæƒ…å‚æ•°ä¼š<strong>è¦†ç›–</strong>ä¸Šæ–¹çš„åŸºç¡€æ­¢æŸæ­¢ç›ˆè®¾ç½®<br>
                                                â€¢ ç•™ç©ºçš„å‚æ•°å°†ä½¿ç”¨åŸºç¡€é…ç½®
                                            </small>
                                        </div>

                                        <!-- è¡Œæƒ…å‚æ•°é…ç½®è¡¨æ ¼ -->
                                        <div style="overflow-x: auto;">
                                            <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                                <thead>
                                                    <tr style="background: rgba(124, 58, 237, 0.15);">
                                                        <th style="padding: 8px; text-align: left; border: 1px solid rgba(124, 58, 237, 0.3); white-space: nowrap;">è¡Œæƒ…ç±»å‹</th>
                                                        <th style="padding: 8px; text-align: center; border: 1px solid rgba(124, 58, 237, 0.3);">äº¤æ˜“æ–¹å‘</th>
                                                        <th style="padding: 8px; text-align: center; border: 1px solid rgba(124, 58, 237, 0.3);">æ­¢æŸ%</th>
                                                        <th style="padding: 8px; text-align: center; border: 1px solid rgba(124, 58, 237, 0.3);">æ­¢ç›ˆ%</th>
                                                        <th style="padding: 8px; text-align: center; border: 1px solid rgba(124, 58, 237, 0.3);">æŒç»­è¶‹åŠ¿</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- å¼ºä¸Šå‡è¶‹åŠ¿ -->
                                                    <tr style="border-left: 3px solid #3fb950;">
                                                        <td style="padding: 8px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <span style="color: #3fb950; font-weight: 500;">ğŸ“ˆ å¼ºä¸Šå‡</span>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <select id="regime_strong_uptrend_direction" style="width: 100%; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px;">
                                                                <option value="both">åŒå‘</option>
                                                                <option value="long_only">ä»…åšå¤š</option>
                                                                <option value="short_only">ä»…åšç©º</option>
                                                                <option value="none">ç¦æ­¢</option>
                                                            </select>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_strong_uptrend_sl" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_strong_uptrend_tp" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2); text-align: center;">
                                                            <input type="checkbox" id="regime_strong_uptrend_sustained" checked>
                                                        </td>
                                                    </tr>
                                                    <!-- å¼±ä¸Šå‡è¶‹åŠ¿ -->
                                                    <tr style="border-left: 3px solid #7ee787;">
                                                        <td style="padding: 8px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <span style="color: #7ee787; font-weight: 500;">ğŸ“Š å¼±ä¸Šå‡</span>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <select id="regime_weak_uptrend_direction" style="width: 100%; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px;">
                                                                <option value="both">åŒå‘</option>
                                                                <option value="long_only">ä»…åšå¤š</option>
                                                                <option value="short_only">ä»…åšç©º</option>
                                                                <option value="none">ç¦æ­¢</option>
                                                            </select>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_weak_uptrend_sl" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_weak_uptrend_tp" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2); text-align: center;">
                                                            <input type="checkbox" id="regime_weak_uptrend_sustained">
                                                        </td>
                                                    </tr>
                                                    <!-- éœ‡è¡è¡Œæƒ… -->
                                                    <tr style="border-left: 3px solid #8b949e;">
                                                        <td style="padding: 8px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <span style="color: #8b949e; font-weight: 500;">ğŸ“‰ éœ‡è¡</span>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <select id="regime_ranging_direction" style="width: 100%; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px;">
                                                                <option value="both">åŒå‘</option>
                                                                <option value="long_only">ä»…åšå¤š</option>
                                                                <option value="short_only">ä»…åšç©º</option>
                                                                <option value="none">ç¦æ­¢</option>
                                                            </select>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_ranging_sl" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_ranging_tp" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2); text-align: center;">
                                                            <input type="checkbox" id="regime_ranging_sustained">
                                                        </td>
                                                    </tr>
                                                    <!-- å¼±ä¸‹è·Œè¶‹åŠ¿ -->
                                                    <tr style="border-left: 3px solid #f0883e;">
                                                        <td style="padding: 8px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <span style="color: #f0883e; font-weight: 500;">ğŸ“‰ å¼±ä¸‹è·Œ</span>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <select id="regime_weak_downtrend_direction" style="width: 100%; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px;">
                                                                <option value="both">åŒå‘</option>
                                                                <option value="long_only">ä»…åšå¤š</option>
                                                                <option value="short_only">ä»…åšç©º</option>
                                                                <option value="none">ç¦æ­¢</option>
                                                            </select>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_weak_downtrend_sl" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_weak_downtrend_tp" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2); text-align: center;">
                                                            <input type="checkbox" id="regime_weak_downtrend_sustained">
                                                        </td>
                                                    </tr>
                                                    <!-- å¼ºä¸‹è·Œè¶‹åŠ¿ -->
                                                    <tr style="border-left: 3px solid #f85149;">
                                                        <td style="padding: 8px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <span style="color: #f85149; font-weight: 500;">ğŸ“‰ å¼ºä¸‹è·Œ</span>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <select id="regime_strong_downtrend_direction" style="width: 100%; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px;">
                                                                <option value="both">åŒå‘</option>
                                                                <option value="long_only">ä»…åšå¤š</option>
                                                                <option value="short_only">ä»…åšç©º</option>
                                                                <option value="none">ç¦æ­¢</option>
                                                            </select>
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_strong_downtrend_sl" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2);">
                                                            <input type="number" id="regime_strong_downtrend_tp" style="width: 60px; padding: 4px; background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: 4px; color: var(--text-primary); font-size: 11px; text-align: center;" step="0.1" placeholder="åŸºç¡€">
                                                        </td>
                                                        <td style="padding: 6px; border: 1px solid rgba(124, 58, 237, 0.2); text-align: center;">
                                                            <input type="checkbox" id="regime_strong_downtrend_sustained" checked>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div style="margin-top: 10px; padding: 8px; background: rgba(255, 193, 7, 0.1); border-radius: 4px; border-left: 3px solid #ffc107;">
                                            <small style="font-size: 10px; color: var(--text-secondary);">
                                                ğŸ’¡ <strong>æç¤ºï¼š</strong>æ­¢æŸ/æ­¢ç›ˆç•™ç©ºè¡¨ç¤ºä½¿ç”¨ä¸Šæ–¹åŸºç¡€è®¾ç½®ã€‚"ç¦æ­¢"æ–¹å‘ä¼šæš‚åœè¯¥è¡Œæƒ…ä¸‹çš„äº¤æ˜“ã€‚
                                            </small>
                                        </div>

                                        <div style="margin-top: 8px;">
                                            <a href="/market_regime" target="_blank" style="font-size: 11px; color: #58a6ff; text-decoration: none;">
                                                <i class="bi bi-bar-chart"></i> æŸ¥çœ‹å®æ—¶è¡Œæƒ…è¯†åˆ« â†’
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- ä¹°å…¥æ¡ä»¶ç»“æŸ -->

                            <!-- äº¤æ˜“å¸ç§ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-currency-exchange"></i>
                                    äº¤æ˜“å¸ç§
                                </div>
                                <div class="form-group">
                                    <label class="form-label">äº¤æ˜“å¸ç§<span class="required">*</span></label>
                                    <div id="symbolCheckboxGroup" class="checkbox-group" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: var(--spacing-sm); padding: var(--spacing-sm); background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                        <!-- å¸ç§å¤é€‰æ¡†å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ä»“ä½æ§åˆ¶ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-pie-chart"></i>
                                    ä»“ä½æ§åˆ¶
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">ä»“ä½å¤§å°<span class="required">*</span></label>
                                        <input type="number" class="form-input" id="positionSize" placeholder="ä¾‹å¦‚ï¼š10" min="0.01" max="100" step="0.01" required>
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">å æ€»èµ„é‡‘çš„æ¯”ä¾‹ï¼ˆ%ï¼‰</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">æœ€å¤§æŒä»“æ•°é‡</label>
                                        <input type="number" class="form-input" id="maxPositions" placeholder="ä¾‹å¦‚ï¼š5" min="1" step="1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                            åŒæ—¶æŒæœ‰çš„æœ€å¤§ä»“ä½æ€»æ•°ï¼ˆå¤šç©ºåˆè®¡ï¼‰ã€‚ç•™ç©ºåˆ™ä¸é™åˆ¶æ€»æ•°ï¼Œä»…æŒ‰æ–¹å‘é™åˆ¶ã€‚
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">æœ€å¤§åšå¤šæŒä»“æ•°</label>
                                        <input type="number" class="form-input" id="maxLongPositions" placeholder="ä¾‹å¦‚ï¼š2" min="1" step="1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                            åŒæ—¶æŒæœ‰çš„æœ€å¤§åšå¤šä»“ä½æ•°é‡ã€‚ç•™ç©ºåˆ™ä¸é™åˆ¶åšå¤šæ•°é‡ã€‚
                                        </small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">æœ€å¤§åšç©ºæŒä»“æ•°</label>
                                        <input type="number" class="form-input" id="maxShortPositions" placeholder="ä¾‹å¦‚ï¼š2" min="1" step="1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                            åŒæ—¶æŒæœ‰çš„æœ€å¤§åšç©ºä»“ä½æ•°é‡ã€‚ç•™ç©ºåˆ™ä¸é™åˆ¶åšç©ºæ•°é‡ã€‚
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group" style="width: 100%;">
                                        <small style="color: var(--text-secondary); font-size: 12px; display: block; padding: 8px; background: var(--bg-secondary); border-radius: var(--radius-sm);">
                                            <strong>ğŸ’¡ æŒä»“é™åˆ¶è¯´æ˜ï¼š</strong><br>
                                            â€¢ å¦‚æœè®¾ç½®äº†"æœ€å¤§æŒä»“æ•°é‡"ï¼Œåˆ™å¤šç©ºåˆè®¡ä¸èƒ½è¶…è¿‡æ­¤æ•°é‡<br>
                                            â€¢ å¦‚æœè®¾ç½®äº†"æœ€å¤§åšå¤š/åšç©ºæŒä»“æ•°"ï¼Œåˆ™åˆ†åˆ«é™åˆ¶å„æ–¹å‘çš„æŒä»“æ•°<br>
                                            â€¢ å»ºè®®ï¼šè®¾ç½®æ–¹å‘é™åˆ¶ï¼ˆå¦‚åšå¤š2ä¸ªã€åšç©º2ä¸ªï¼‰æ¯”è®¾ç½®æ€»æ•°é™åˆ¶æ›´çµæ´»
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <!-- å¼€ä»“å†·å´ä¸é™åˆ¶ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-clock-history"></i>
                                    å¼€ä»“å†·å´ä¸é™åˆ¶
                                    <span style="font-size: 11px; color: var(--text-secondary); font-weight: normal; margin-left: 8px;">æ§åˆ¶å¼€ä»“é¢‘ç‡å’Œæ¯æ–¹å‘æŒä»“æ•°é‡</span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="entryCooldownEnabled" style="margin-right: 8px;" checked>
                                            å¯ç”¨å¼€ä»“å†·å´
                                        </label>
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block; margin-left: 24px;">
                                            æ§åˆ¶åŒä¸€æ–¹å‘çš„å¼€ä»“é¢‘ç‡ï¼Œé¿å…è¿‡åº¦äº¤æ˜“
                                        </small>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">å†·å´æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                        <input type="number" class="form-input" id="entryCooldownMinutes" value="30" min="0" max="1440" step="5">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                            å¹³ä»“åNåˆ†é’Ÿå†…ä¸å†åŒæ–¹å‘å¼€ä»“ï¼ˆ0ç¦ç”¨ï¼‰
                                        </small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">æ¯æ–¹å‘æœ€å¤§æŒä»“æ•°</label>
                                        <input type="number" class="form-input" id="entryCooldownMaxPositionsPerDirection" value="1" min="1" max="10" step="1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                                            åŒä¸€å¸ç§ã€åŒä¸€æ–¹å‘æœ€å¤šåŒæ—¶æŒæœ‰å‡ ä¸ªä»“ä½ï¼ˆå»ºè®®1ä¸ªï¼‰
                                        </small>
                                    </div>
                                </div>

                                <div style="margin-top: 8px; padding: 8px; background: rgba(43, 111, 237, 0.1); border-radius: 4px; border-left: 3px solid var(--primary-blue);">
                                    <small style="color: var(--text-secondary); font-size: 11px;">
                                        <i class="bi bi-info-circle" style="margin-right: 4px;"></i>
                                        <strong>ç¤ºä¾‹ï¼š</strong>å†·å´30åˆ†é’Ÿï¼Œæ¯æ–¹å‘1ä¸ªã€‚åšå¤šBTCå¹³ä»“å30åˆ†é’Ÿå†…ä¸å†åšå¤šBTCï¼Œä½†å¯ä»¥åšç©ºBTCæˆ–åšå¤šå…¶ä»–å¸ç§ã€‚
                                    </small>
                                </div>
                            </div>

                            <!-- é£é™©æ§åˆ¶ -->
                        </div> <!-- ç»“æŸæ¿å—1: å¼€ä»“è®¾ç½® -->

                        <!-- ============================================ -->
                        <!-- æ¿å—2ï¼šå¹³ä»“è®¾ç½® -->
                        <!-- ============================================ -->
                        <div class="major-block">
                            <div class="major-block-header">
                                <i class="bi bi-door-closed"></i>
                                å¹³ä»“è®¾ç½®
                                <span class="major-block-description">é…ç½®æ­¢æŸã€æ­¢ç›ˆå’Œå‡ºåœºç­–ç•¥</span>
                            </div>

                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-shield-exclamation"></i>
                                    é£é™©æ§åˆ¶
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">æ­¢æŸï¼ˆ%ï¼‰</label>
                                        <input type="number" class="form-input" id="stopLoss" placeholder="ä¾‹å¦‚ï¼š3" min="0" max="50" step="0.1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">äºæŸè¾¾åˆ°æ­¤ç™¾åˆ†æ¯”æ—¶è‡ªåŠ¨å¹³ä»“ï¼ˆå»ºè®®3-5%ï¼‰</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">æœ€å¤§æŒä»“æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</label>
                                        <input type="number" class="form-input" id="maxHoldingHours" placeholder="ä¾‹å¦‚ï¼š8" min="0" max="72" step="1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">æŒä»“è¶…è¿‡æ­¤æ—¶é•¿è‡ªåŠ¨å¹³ä»“ï¼ˆ0=ä¸é™åˆ¶ï¼Œå»ºè®®8-24å°æ—¶ï¼‰</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">æ­¢ç›ˆï¼ˆ%ï¼‰</label>
                                        <input type="number" class="form-input" id="takeProfit" placeholder="ä¾‹å¦‚ï¼š5" min="0" max="100" step="0.1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">ç›ˆåˆ©è¾¾åˆ°æ­¤ç™¾åˆ†æ¯”æ—¶è‡ªåŠ¨å¹³ä»“ï¼ˆå»ºè®®5-10%ï¼‰</small>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="closeOppositeOnEntry" style="margin-right: 8px;">
                                            å¼€ä»“å‰å…ˆå¹³æ‰ç›¸åæ–¹å‘æŒä»“
                                        </label>
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block; margin-left: 24px;">
                                            å¯ç”¨åï¼Œå¼€å¤šä»“å‰ä¼šå…ˆå¹³æ‰æ‰€æœ‰ç©ºä»“ï¼Œå¼€ç©ºä»“å‰ä¼šå…ˆå¹³æ‰æ‰€æœ‰å¤šä»“ã€‚é¿å…åŒæ—¶æŒæœ‰å¤šç©ºä»“ä½ï¼Œé€‚åˆè¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ã€‚
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <!-- åè½¬é¢„è­¦ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    åè½¬é¢„è­¦
                                    <span style="font-size: 11px; color: var(--warning-yellow); font-weight: normal; margin-left: 8px;">æ£€æµ‹è¶‹åŠ¿åè½¬ä¿¡å·ï¼Œé¿å…é€†åŠ¿å¼€ä»“</span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="reversalWarningEnabled" style="margin-right: 8px;" checked>
                                            å¯ç”¨åè½¬é¢„è­¦
                                        </label>
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block; margin-left: 24px;">
                                            å½“EMAæ–œç‡åè½¬æˆ–å·®è·å¿«é€Ÿæ”¶çª„æ—¶ï¼Œæš‚åœå¼€ä»“ç›´åˆ°å‡ºç°æ˜ç¡®äº¤å‰
                                        </small>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">æ–œç‡çªå˜é˜ˆå€¼ï¼ˆ%ï¼‰</label>
                                        <input type="number" class="form-input" id="reversalSlopeThreshold" value="0.3" min="0.1" max="1.0" step="0.05">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">æ–œç‡å˜åŒ–å¹…åº¦è¶…è¿‡æ­¤å€¼è§¦å‘é¢„è­¦ï¼ˆå¦‚-0.5%â†’+0.3%å˜åŒ–0.8%ï¼‰</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">å·®è·æ”¶çª„é˜ˆå€¼ï¼ˆ%ï¼‰</label>
                                        <input type="number" class="form-input" id="reversalShrinkThreshold" value="30" min="10" max="50" step="5">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">EMAå·®è·æ”¶çª„è¶…è¿‡æ­¤æ¯”ä¾‹è§¦å‘é¢„è­¦</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">å†·å´æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                        <input type="number" class="form-input" id="reversalCooldownMinutes" value="30" min="10" max="60" step="5">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">é¢„è­¦åæš‚åœå¼€ä»“çš„æœ€é•¿æ—¶é—´</small>
                                    </div>
                                </div>

                                <div style="margin-top: 8px; padding: 8px; background: rgba(245, 158, 11, 0.1); border-radius: 4px; border-left: 3px solid var(--warning-yellow);">
                                    <small style="color: var(--text-secondary); font-size: 11px;">
                                        <i class="bi bi-info-circle" style="margin-right: 4px;"></i>
                                        æ£€æµ‹EMAæ–œç‡çªç„¶å‰§å˜ï¼ˆè´¨å˜ä¿¡å·ï¼‰ï¼Œè§¦å‘åè¿›å…¥å†·å´æœŸã€‚åšå¤šéœ€ç­‰å¾…é‡‘å‰ã€åšç©ºéœ€ç­‰å¾…æ­»å‰æ‰è§£é™¤å†·å´ã€‚
                                    </small>
                                </div>
                            </div>

                            <!-- å¾…å¼€ä»“è‡ªæ£€ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-search"></i>
                                    å¾…å¼€ä»“è‡ªæ£€
                                    <span style="font-size: 11px; color: var(--text-secondary); font-weight: normal; margin-left: 8px;">ä¿¡å·è§¦å‘åè‡ªæ£€é€šè¿‡æ‰å¼€ä»“</span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="pendingValidationEnabled" style="margin-right: 8px;" checked>
                                            å¯ç”¨å¾…å¼€ä»“è‡ªæ£€
                                        </label>
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block; margin-left: 24px;">
                                            ä¿¡å·è§¦å‘åè¿›å…¥å¾…å¼€ä»“çŠ¶æ€ï¼Œè‡ªæ£€é€šè¿‡åæ‰çœŸæ­£å¼€ä»“ï¼Œé¿å…è¯¯å¼€ä»“
                                        </small>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">è‡ªæ£€è¶…æ—¶ï¼ˆç§’ï¼‰</label>
                                        <input type="number" class="form-input" id="pendingExpireSeconds" value="300" min="60" max="600" step="30">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">è¶…æ—¶æœªé€šè¿‡è‡ªæ£€åˆ™å–æ¶ˆå¼€ä»“ï¼ˆå»ºè®®300ç§’ï¼‰</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">è‡ªæ£€é—´éš”ï¼ˆç§’ï¼‰</label>
                                        <input type="number" class="form-input" id="pendingCheckInterval" value="10" min="5" max="60" step="5">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">æ¯éš”å¤šå°‘ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆå»ºè®®10ç§’ï¼‰</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">æœ€å¤§ä»·æ ¼åå·®ï¼ˆ%ï¼‰</label>
                                        <input type="number" class="form-input" id="pendingMaxPriceDiff" value="0.5" min="0.1" max="2.0" step="0.1">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">å½“å‰ä»·ä¸ä¿¡å·ä»·åå·®è¶…è¿‡æ­¤å€¼ä¸å¼€ä»“</small>
                                    </div>
                                </div>

                                <div style="margin-top: 12px; padding: 12px; background: var(--bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--border-default);">
                                    <div style="font-weight: 600; margin-bottom: 8px; font-size: 13px;">è‡ªæ£€é¡¹ç›®</div>
                                    <small style="color: var(--text-tertiary); font-size: 10px; display: block; margin-bottom: 8px;">æ³¨ï¼šEMA/MAæ–¹å‘æ£€æŸ¥å·²ç§»é™¤ï¼Œé™ä»·å•æ˜¯å›è°ƒå…¥åœºç­–ç•¥ï¼ŒçŸ­æš‚åå‘æ˜¯æ­£å¸¸çš„</small>
                                    <div class="form-row" style="gap: 16px;">
                                        <div class="form-group" style="flex: none; margin-bottom: 8px;">
                                            <label class="form-label" style="cursor: pointer;">
                                                <input type="checkbox" id="pendingCheckTrendEnd" style="margin-right: 8px;" checked>
                                                è¶‹åŠ¿æœ«ç«¯æ£€æŸ¥
                                            </label>
                                        </div>
                                        <div class="form-group" style="flex: none; margin-bottom: 8px;">
                                            <label class="form-label" style="cursor: pointer;">
                                                <input type="checkbox" id="pendingCheckEmaConverging" style="margin-right: 8px;" checked>
                                                EMAæ”¶æ•›æ£€æŸ¥
                                            </label>
                                            <small style="color: var(--text-tertiary); font-size: 10px; display: block; margin-left: 24px;">EMAå·®å€¼æ”¶çª„è¶…30%æ—¶æ‹’ç»å¼€ä»“</small>
                                        </div>
                                    </div>
                                    <div class="form-row" style="margin-top: 12px; gap: 12px;">
                                        <div class="form-group" style="flex: 1; min-width: 120px;">
                                            <label class="form-label" style="font-size: 11px;">è¶‹åŠ¿æœ«ç«¯é˜ˆå€¼</label>
                                            <input type="number" class="form-input" id="pendingTrendEndThreshold" value="0.5" step="0.05" min="0" max="1" style="padding: 6px 10px; font-size: 13px;">
                                            <small style="color: var(--text-tertiary); font-size: 10px;">EMAå·®å€¼ä½äºæ­¤æ¯”ä¾‹(0.5=ç¼©å°50%)æ—¶è§†ä¸ºè¶‹åŠ¿ç»“æŸ</small>
                                        </div>
                                        <div class="form-group" style="flex: 1; min-width: 120px;">
                                            <label class="form-label" style="font-size: 11px;">æœ€å°EMAå·®å€¼ï¼ˆ%ï¼‰</label>
                                            <input type="number" class="form-input" id="pendingMinEmaDiffPct" value="0.05" step="0.01" min="0" style="padding: 6px 10px; font-size: 13px;">
                                            <small style="color: var(--text-tertiary); font-size: 10px;">ä½äºæ­¤å€¼è§†ä¸ºå¼±è¶‹åŠ¿ï¼Œæ‹’ç»å¼€ä»“</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¹³ä»“å†·å´ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-hourglass-split"></i>
                                    å¹³ä»“å†·å´
                                    <span style="font-size: 11px; color: var(--text-secondary); font-weight: normal; margin-left: 8px;">é˜²æ­¢é¢‘ç¹å¼€å¹³ä»“</span>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">å†·å´æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                        <input type="number" class="form-input" id="closeReopenCooldownMinutes" value="15" min="0" max="60" step="5">
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">å¹³ä»“åNåˆ†é’Ÿå†…ä¸å†å¼€ä»“ï¼ˆè®¾ä¸º0ç¦ç”¨ï¼‰</small>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="closeReopenSameDirectionOnly" style="margin-right: 8px;">
                                            ä»…é™åˆ¶åŒæ–¹å‘
                                        </label>
                                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block; margin-left: 24px;">
                                            å‹¾é€‰ï¼šåšå¤šå¹³ä»“ååªé™åˆ¶åšå¤šï¼Œå¯ä»¥åšç©º<br>
                                            ä¸å‹¾é€‰ï¼šåšå¤šå¹³ä»“åï¼Œåšå¤šå’Œåšç©ºéƒ½é™åˆ¶
                                        </small>
                                    </div>
                                </div>

                                <div style="margin-top: 8px; padding: 8px; background: rgba(43, 111, 237, 0.1); border-radius: 4px; border-left: 3px solid var(--primary-blue);">
                                    <small style="color: var(--text-secondary); font-size: 11px;">
                                        <i class="bi bi-info-circle" style="margin-right: 4px;"></i>
                                        <strong>ä½œç”¨ï¼š</strong>é¿å…åœ¨ä»·æ ¼ä¸´ç•Œç‚¹åå¤å¼€å¹³ä»“é€ æˆæ‰‹ç»­è´¹æŸå¤±ã€‚å»ºè®®è®¾ç½®15åˆ†é’Ÿï¼Œè®©å¸‚åœºæ–¹å‘æ›´æ˜ç¡®åå†å¼€ä»“ã€‚
                                    </small>
                                </div>
                            </div>

                            <!-- æ™ºèƒ½å‡ºåœº -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-graph-down-arrow"></i>
                                    æ™ºèƒ½å‡ºåœº
                                    <span style="font-size: 11px; color: var(--text-secondary); font-weight: normal; margin-left: 8px;">ä¼˜åŒ–å‡ºåœºæ—¶æœºï¼Œä¿æŠ¤åˆ©æ¶¦</span>
                                </div>

                                <!-- ç§»åŠ¨æ­¢ç›ˆï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <span style="font-weight: 600;">ç§»åŠ¨æ­¢ç›ˆï¼ˆè·Ÿè¸ªæ­¢ç›ˆï¼‰</span>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">ç›ˆåˆ©è¾¾åˆ°é˜ˆå€¼åï¼Œä»æœ€é«˜ç‚¹å›æ’¤ä¸€å®šæ¯”ä¾‹å¹³ä»“</span>
                                    </div>
                                    <div style="margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æ¿€æ´»é˜ˆå€¼ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="trailingActivate" value="1.5" step="0.1" min="0.1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ç›ˆåˆ©è¶…è¿‡æ­¤å€¼æ¿€æ´»ç§»åŠ¨æ­¢ç›ˆ</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">å›è°ƒè§¦å‘ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="trailingCallback" value="0.5" step="0.1" min="0.1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ä»æœ€é«˜ç‚¹å›æ’¤æ­¤æ¯”ä¾‹è§¦å‘å¹³ä»“</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">å†·å´æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                                                <input type="number" class="form-input" id="trailingCooldownMinutes" value="15" step="1" min="0" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">å¼€ä»“åNåˆ†é’Ÿå†…ä¸æ£€æŸ¥ç§»åŠ¨æ­¢ç›ˆ</small>
                                            </div>
                                        </div>
                                        <div style="background: var(--bg-tertiary); border-radius: 6px; padding: 8px; margin-top: 8px;">
                                            <small style="color: var(--text-secondary);">
                                                ğŸ’¡ <strong>ç¤ºä¾‹ï¼š</strong>æ¿€æ´»1.5%ï¼Œå›è°ƒ0.5%ï¼Œå†·å´15åˆ†é’Ÿã€‚å¼€ä»“15åˆ†é’Ÿåå¼€å§‹æ£€æŸ¥ï¼Œè‹¥ç›ˆåˆ©è¾¾åˆ°3%ï¼Œä»·æ ¼ä»æœ€é«˜ç‚¹å›è½0.5%æ—¶å¹³ä»“ã€‚
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- EMAå·®å€¼æ­¢ç›ˆ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-top: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="emaDiffTakeProfitEnabled" style="margin-right: 8px;">
                                        <label for="emaDiffTakeProfitEnabled" style="font-weight: 600; cursor: pointer;">EMAå·®å€¼æ­¢ç›ˆ</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">EMAå·®å€¼è¶…è¿‡é˜ˆå€¼æ—¶æ­¢ç›ˆå¹³ä»“</span>
                                    </div>
                                    <div id="emaDiffTakeProfitParams" style="display: none; margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">EMAå·®å€¼é˜ˆå€¼ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="emaDiffTakeProfitThreshold" value="0.5" step="0.01" min="0.01" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">EMAå·®å€¼æ”¶çª„åˆ°æ­¤å€¼ä»¥ä¸‹æ—¶æ­¢ç›ˆ</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æœ€å°ç›ˆåˆ©è¦æ±‚ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="emaDiffTakeProfitMinProfit" value="0.3" step="0.1" min="0" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ç›ˆåˆ©è¾¾åˆ°æ­¤å€¼æ‰è§¦å‘æ­¢ç›ˆ</small>
                                            </div>
                                        </div>
                                        <div style="margin-top: 8px; padding: 8px; background: var(--bg-primary); border-radius: var(--radius-sm);">
                                            <small style="color: var(--text-tertiary); font-size: 11px;">
                                                ğŸ’¡ <strong>è¯´æ˜ï¼š</strong>å½“EMA9ä¸EMA26çš„å·®å€¼ç™¾åˆ†æ¯”è¶…è¿‡è®¾å®šé˜ˆå€¼ï¼Œä¸”æŒä»“ç›ˆåˆ©è¾¾åˆ°æœ€å°ç›ˆåˆ©è¦æ±‚æ—¶ï¼Œè§¦å‘æ­¢ç›ˆå¹³ä»“ã€‚é€‚ç”¨äºè¶‹åŠ¿è¿‡åº¦å»¶ä¼¸åçš„å›æ’¤é£é™©æ§åˆ¶ã€‚
                                            </small>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- æ™ºèƒ½æ­¢æŸ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-shield-exclamation"></i>
                                    æ™ºèƒ½æ­¢æŸ
                                    <span style="font-size: 11px; color: var(--text-secondary); font-weight: normal; margin-left: 8px;">æ ¹æ®å¸‚åœºæ¡ä»¶åŠ¨æ€è°ƒæ•´æ­¢æŸ</span>
                                </div>

                                <!-- ATRåŠ¨æ€æ­¢æŸ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="atrStopLossEnabled" style="margin-right: 8px;">
                                        <label for="atrStopLossEnabled" style="font-weight: 600; cursor: pointer;">ATRåŠ¨æ€æ­¢æŸ</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">æ ¹æ®å¸‚åœºæ³¢åŠ¨ç‡è‡ªåŠ¨è°ƒæ•´æ­¢æŸè·ç¦»</span>
                                    </div>
                                    <div id="atrStopLossParams" style="display: none; margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">ATRå€æ•°</label>
                                                <input type="number" class="form-input" id="atrStopLossMultiplier" value="2.0" step="0.1" min="0.5" max="5" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">æ­¢æŸè·ç¦»=ATRÃ—å€æ•°</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æœ€å°æ­¢æŸ%</label>
                                                <input type="number" class="form-input" id="atrStopLossMinPct" value="0.5" step="0.1" min="0.1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ATRæ­¢æŸä¸‹é™</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æœ€å¤§æ­¢æŸ%</label>
                                                <input type="number" class="form-input" id="atrStopLossMaxPct" value="5.0" step="0.5" min="1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ATRæ­¢æŸä¸Šé™</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç§»åŠ¨æ­¢æŸï¼ˆè¿½è¸ªæ­¢æŸï¼‰ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="trailingStopLossEnabled" style="margin-right: 8px;">
                                        <label for="trailingStopLossEnabled" style="font-weight: 600; cursor: pointer;">ç§»åŠ¨æ­¢æŸï¼ˆè¿½è¸ªæ­¢æŸï¼‰</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">ç›ˆåˆ©æ—¶æ­¢æŸä»·è·Ÿéšä¸Šç§»ï¼Œå‡å°‘äºæŸ</span>
                                    </div>
                                    <div id="trailingStopLossParams" style="display: none; margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æ¿€æ´»é˜ˆå€¼ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="trailingStopLossActivatePct" value="0.5" step="0.1" min="0.1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ç›ˆåˆ©è¶…æ­¤å€¼å¼€å§‹ç§»åŠ¨æ­¢æŸ</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æ­¢æŸè·ç¦»ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="trailingStopLossDistancePct" value="1.0" step="0.1" min="0.1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">æ­¢æŸä»·ä¸å½“å‰ä»·çš„è·ç¦»</small>
                                            </div>
                                        </div>
                                        <div style="background: var(--bg-tertiary); border-radius: 6px; padding: 8px; margin-top: 8px;">
                                            <small style="color: var(--text-secondary);">
                                                ğŸ’¡ <strong>ç¤ºä¾‹ï¼š</strong>æ¿€æ´»0.5%ï¼Œè·ç¦»1.0%ã€‚åšå¤šç›ˆåˆ©1%æ—¶ï¼Œæ­¢æŸä»-2.5%ç§»åˆ°å½“å‰ä»·-1%ï¼Œå‡å°‘æ½œåœ¨äºæŸã€‚<br>
                                                â±ï¸ å†·å´æ—¶é—´ä¸ç§»åŠ¨æ­¢ç›ˆå…±ç”¨ï¼ˆä¸Šæ–¹é…ç½®ï¼‰ã€‚
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- æ—¶é—´è¡°å‡æ­¢æŸ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="timeDecayStopLossEnabled" style="margin-right: 8px;">
                                        <label for="timeDecayStopLossEnabled" style="font-weight: 600; cursor: pointer;">æ—¶é—´è¡°å‡æ­¢æŸ</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">æŒä»“æ—¶é—´è¶Šé•¿ï¼Œæ­¢æŸè¶Šç´§</span>
                                    </div>
                                    <div id="timeDecayStopLossParams" style="display: none; margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">åˆå§‹æ­¢æŸï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="timeDecayInitialPct" value="3.0" step="0.5" min="0.5" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">å¼€ä»“æ—¶çš„æ­¢æŸ</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æœ€ç»ˆæ­¢æŸï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="timeDecayFinalPct" value="1.0" step="0.1" min="0.1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">è¡°å‡åçš„æ­¢æŸ</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 120px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">è¡°å‡æ—¶é—´ï¼ˆå°æ—¶ï¼‰</label>
                                                <input type="number" class="form-input" id="timeDecayHours" value="24" step="1" min="1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">å®Œå…¨è¡°å‡æ‰€éœ€æ—¶é—´</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- EMAæ”¯æ’‘æ­¢æŸ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="emaSupportStopLossEnabled" style="margin-right: 8px;">
                                        <label for="emaSupportStopLossEnabled" style="font-weight: 600; cursor: pointer;">EMAæ”¯æ’‘æ­¢æŸ</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">ä½¿ç”¨EMA26ä½œä¸ºåŠ¨æ€æ­¢æŸæ”¯æ’‘ä½</span>
                                    </div>
                                    <div id="emaSupportStopLossParams" style="display: none; margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">ç¼“å†²åŒºï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="emaSupportBufferPct" value="0.3" step="0.1" min="0" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ä½äºEMAå¤šå°‘è§¦å‘</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">ç›ˆåˆ©é—¨æ§›ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="emaSupportMinProfitPct" value="0" step="0.1" min="0" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">ç›ˆåˆ©è¶…æ­¤å€¼æ‰å¯ç”¨ï¼ˆ0=ç«‹å³å¯ç”¨ï¼‰</small>
                                            </div>
                                        </div>
                                        <div style="margin-top: 8px; padding: 8px; background: rgba(43, 111, 237, 0.1); border-radius: 4px; border-left: 3px solid var(--primary-blue);">
                                            <small style="color: var(--text-secondary); font-size: 11px;">
                                                <i class="bi bi-info-circle" style="margin-right: 4px;"></i>
                                                <strong>ç›ˆåˆ©é—¨æ§›è¯´æ˜ï¼š</strong>ç”¨äºä¿æŠ¤åˆ©æ¶¦è€Œéé˜²æ­¢äºæŸã€‚è®¾ä¸º0åˆ™ç«‹å³å¯ç”¨ï¼›è®¾ä¸º0.5åˆ™ç›ˆåˆ©0.5%åæ‰å¯ç”¨EMAæ”¯æ’‘æ­¢æŸã€‚
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- 5Mä¿¡å·æ­¢æŸ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="signalStopLossEnabled" style="margin-right: 8px;" checked onchange="toggleSignalStopLossParams()">
                                        <label for="signalStopLossEnabled" style="font-weight: 600; cursor: pointer;">5Mä¿¡å·æ­¢æŸ</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">äºæŸæ—¶5åˆ†é’ŸEMAåå‘åˆ™ç«‹å³æ­¢æŸ</span>
                                    </div>
                                    <div id="signalStopLossParams" style="margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">EMAå·®å€¼é˜ˆå€¼ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="signalStopLossMinDiff" value="0.15" step="0.05" min="0.05" max="1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">EMA9ä¸EMA26å·®è·è¶…è¿‡æ­¤å€¼æ‰è§¦å‘</small>
                                            </div>
                                        </div>
                                        <div style="margin-top: 8px; padding: 8px; background: rgba(239, 68, 68, 0.1); border-radius: 4px; border-left: 3px solid var(--danger-red);">
                                            <small style="color: var(--text-secondary); font-size: 11px;">
                                                <i class="bi bi-exclamation-triangle" style="margin-right: 4px;"></i>
                                                <strong>è§¦å‘æ¡ä»¶ï¼š</strong>æŒä»“äºæŸ + 5åˆ†é’ŸEMAè¶‹åŠ¿åå‘ï¼ˆåšå¤šé‡æ­»å‰/åšç©ºé‡é‡‘å‰ï¼‰+ å·®å€¼è¶…é˜ˆå€¼ â†’ ç«‹å³æ­¢æŸ
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <!-- è¶‹åŠ¿å‡å¼±å¹³ä»“ -->
                                <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-default);">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <input type="checkbox" id="trendWeakeningExitEnabled" style="margin-right: 8px;" checked onchange="toggleTrendWeakeningParams()">
                                        <label for="trendWeakeningExitEnabled" style="font-weight: 600; cursor: pointer;">è¶‹åŠ¿å‡å¼±å¹³ä»“</label>
                                        <span style="font-size: 11px; color: var(--text-secondary); margin-left: 8px;">EMAå·®å€¼æ”¶çª„åˆ°å…¥åœºæ—¶çš„50%æ—¶å¹³ä»“</span>
                                    </div>
                                    <div id="trendWeakeningParams" style="margin-top: 8px;">
                                        <div class="form-row" style="gap: 12px;">
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">EMAå·®å€¼æ”¶çª„é˜ˆå€¼ï¼ˆ0-1ï¼‰</label>
                                                <input type="number" class="form-input" id="trendWeakeningEmaDiffThreshold" value="0.5" step="0.1" min="0.1" max="1" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">å½“å‰EMAå·®å€¼ < å…¥åœºæ—¶Ã—é˜ˆå€¼æ—¶è§¦å‘ï¼ˆ0.5=50%ï¼‰</small>
                                            </div>
                                            <div class="form-group" style="flex: 1; min-width: 150px; margin-bottom: 8px;">
                                                <label class="form-label" style="font-size: 11px;">æœ€å°ç›ˆåˆ©è¦æ±‚ï¼ˆ%ï¼‰</label>
                                                <input type="number" class="form-input" id="trendWeakeningMinProfitPct" value="1.0" step="0.1" min="0" style="padding: 6px 10px; font-size: 13px;">
                                                <small style="color: var(--text-tertiary); font-size: 10px;">å¿…é¡»ç›ˆåˆ©è¶…æ­¤å€¼æ‰å…è®¸è¶‹åŠ¿å‡å¼±å¹³ä»“</small>
                                            </div>
                                        </div>
                                        <div style="margin-top: 8px; padding: 8px; background: rgba(250, 204, 21, 0.1); border-radius: 4px; border-left: 3px solid #facc15;">
                                            <small style="color: var(--text-secondary); font-size: 11px;">
                                                <i class="bi bi-lightbulb" style="margin-right: 4px;"></i>
                                                <strong>è§¦å‘æ¡ä»¶ï¼š</strong>å½“å‰EMA9-EMA26å·®å€¼æ”¶çª„åˆ°å…¥åœºæ—¶çš„50%ï¼ˆé»˜è®¤ï¼‰ä¸”ç›ˆåˆ©è¶…è¿‡1%ï¼ˆé»˜è®¤ï¼‰æ—¶ï¼Œè®¤ä¸ºè¶‹åŠ¿å‡å¼±ï¼Œæå‰å¹³ä»“ä¿æŠ¤åˆ©æ¶¦ã€‚
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- äº¤æ˜“ä»·æ ¼ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-currency-dollar"></i>
                                    äº¤æ˜“ä»·æ ¼
                                </div>

                                <!-- é™ä»·å•å¼€å…³ -->
                                <div class="form-group">
                                    <div style="display: flex; align-items: center; justify-content: space-between;">
                                        <div>
                                            <label class="form-label" style="margin-bottom: 0;">å¯ç”¨é™ä»·å•</label>
                                            <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 4px;">
                                                å¼€å¯åå¯è®¾ç½®åç¦»å¸‚ä»·çš„é™ä»·å•ï¼Œå…³é—­åˆ™ç»Ÿä¸€ä½¿ç”¨å¸‚ä»·
                                            </small>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" id="enableLimitOrder" name="enableLimitOrder" onchange="toggleLimitOrderOptions()">
                                            <span class="slider round"></span>
                                        </label>
                                    </div>
                                </div>

                                <!-- åšå¤šä»·æ ¼é€‰é¡¹ -->
                                <div class="form-group" id="longPriceGroup">
                                    <label class="form-label">åšå¤šä»·æ ¼<span class="required">*</span></label>
                                    <div class="price-grid">
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMarket" name="longPrice" value="market" checked>
                                            <label for="longPriceMarket" class="radio-label">å¸‚ä»·</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus0_8" name="longPrice" value="market_minus_0_8">
                                            <label for="longPriceMinus0_8" class="radio-label">-0.8%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus1" name="longPrice" value="market_minus_1">
                                            <label for="longPriceMinus1" class="radio-label">-1%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus1_2" name="longPrice" value="market_minus_1_2">
                                            <label for="longPriceMinus1_2" class="radio-label">-1.2%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus1_4" name="longPrice" value="market_minus_1_4">
                                            <label for="longPriceMinus1_4" class="radio-label">-1.4%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus1_6" name="longPrice" value="market_minus_1_6">
                                            <label for="longPriceMinus1_6" class="radio-label">-1.6%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus1_8" name="longPrice" value="market_minus_1_8">
                                            <label for="longPriceMinus1_8" class="radio-label">-1.8%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus2" name="longPrice" value="market_minus_2">
                                            <label for="longPriceMinus2" class="radio-label">-2%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus3" name="longPrice" value="market_minus_3">
                                            <label for="longPriceMinus3" class="radio-label">-3%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus4" name="longPrice" value="market_minus_4">
                                            <label for="longPriceMinus4" class="radio-label">-4%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus5" name="longPrice" value="market_minus_5">
                                            <label for="longPriceMinus5" class="radio-label">-5%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus6" name="longPrice" value="market_minus_6">
                                            <label for="longPriceMinus6" class="radio-label">-6%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="longPriceMinus8" name="longPrice" value="market_minus_8">
                                            <label for="longPriceMinus8" class="radio-label">-8%</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- åšç©ºä»·æ ¼é€‰é¡¹ -->
                                <div class="form-group" id="shortPriceGroup" style="display: none;">
                                    <label class="form-label">åšç©ºä»·æ ¼<span class="required">*</span></label>
                                    <div class="price-grid">
                                        <div class="radio-option">
                                            <input type="radio" id="shortPriceMarket" name="shortPrice" value="market" checked>
                                            <label for="shortPriceMarket" class="radio-label">å¸‚ä»·</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus0_8" name="shortPrice" value="market_plus_0_8">
                                            <label for="shortPricePlus0_8" class="radio-label">+0.8%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus1" name="shortPrice" value="market_plus_1">
                                            <label for="shortPricePlus1" class="radio-label">+1%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus1_2" name="shortPrice" value="market_plus_1_2">
                                            <label for="shortPricePlus1_2" class="radio-label">+1.2%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus1_4" name="shortPrice" value="market_plus_1_4">
                                            <label for="shortPricePlus1_4" class="radio-label">+1.4%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus1_6" name="shortPrice" value="market_plus_1_6">
                                            <label for="shortPricePlus1_6" class="radio-label">+1.6%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus1_8" name="shortPrice" value="market_plus_1_8">
                                            <label for="shortPricePlus1_8" class="radio-label">+1.8%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus2" name="shortPrice" value="market_plus_2">
                                            <label for="shortPricePlus2" class="radio-label">+2%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus3" name="shortPrice" value="market_plus_3">
                                            <label for="shortPricePlus3" class="radio-label">+3%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus4" name="shortPrice" value="market_plus_4">
                                            <label for="shortPricePlus4" class="radio-label">+4%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus5" name="shortPrice" value="market_plus_5">
                                            <label for="shortPricePlus5" class="radio-label">+5%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus6" name="shortPrice" value="market_plus_6">
                                            <label for="shortPricePlus6" class="radio-label">+6%</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="shortPricePlus8" name="shortPrice" value="market_plus_8">
                                            <label for="shortPricePlus8" class="radio-label">+8%</label>
                                        </div>
                                    </div>
                                </div>

                        </div> <!-- ç»“æŸæ¿å—2: å¹³ä»“è®¾ç½® -->

                        <!-- ============================================ -->
                        <!-- æ¿å—3ï¼šè®¢å•ç®¡ç† -->
                        <!-- ============================================ -->
                        <div class="major-block">
                            <div class="major-block-header">
                                <i class="bi bi-list-check"></i>
                                è®¢å•ç®¡ç†
                                <span class="major-block-description">é…ç½®è®¢å•æ‰§è¡Œã€å®ç›˜åŒæ­¥å’Œé€šçŸ¥</span>
                            </div>

                                <!-- é™ä»·å•è¶…æ—¶è½¬å¸‚ä»· -->
                                <div class="form-group" id="limitOrderTimeoutGroup">
                                    <label class="form-label">é™ä»·å•è¶…æ—¶è½¬å¸‚ä»·</label>
                                    <small style="color: var(--text-secondary); font-size: 12px; margin-bottom: 8px; display: block;">
                                        é™ä»·å•è¶…æ—¶åè‡ªåŠ¨è½¬å¸‚ä»·æ‰§è¡Œï¼ˆ0è¡¨ç¤ºä¸è¶…æ—¶ï¼‰
                                    </small>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <input type="number" id="limitOrderTimeoutMinutes" name="limitOrderTimeoutMinutes"
                                               step="1" min="0" max="120"
                                               placeholder="15"
                                               style="width: 80px; padding: 4px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 12px;">
                                        <small style="color: var(--text-secondary); font-size: 11px;">åˆ†é’Ÿï¼ˆå»ºè®®5-15åˆ†é’Ÿï¼‰</small>
                                    </div>
                                </div>

                                <!-- é™ä»·å•æœ€å¤§åç¦»ç™¾åˆ†æ¯” -->
                                <div class="form-group" id="limitOrderMaxDeviationGroup">
                                    <label class="form-label">é™ä»·å•æœ€å¤§åç¦»</label>
                                    <small style="color: var(--text-secondary); font-size: 12px; margin-bottom: 8px; display: block;">
                                        è¶…æ—¶è½¬å¸‚ä»·æ—¶ï¼Œåªæœ‰åç¦»â‰¤æ­¤å€¼æ‰æ‰§è¡Œï¼›åç¦»è¿‡å¤§æ—¶ä¹Ÿè½¬å¸‚ä»·ï¼ˆé¿å…é”™è¿‡ä¿¡å·ï¼‰
                                    </small>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <input type="number" id="limitOrderMaxDeviation" name="limitOrderMaxDeviation"
                                               step="0.1" min="0.5" max="5"
                                               placeholder="1.5"
                                               style="width: 80px; padding: 4px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 12px;">
                                        <small style="color: var(--text-secondary); font-size: 11px;">%ï¼ˆå»ºè®®1-2%ï¼‰</small>
                                    </div>
                                </div>

                                <!-- é‡‘å‰/æ­»å‰å¼ºåˆ¶å¸‚ä»·å• -->
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" id="crossSignalForceMarket" name="crossSignalForceMarket" checked
                                               style="margin-right: 8px;">
                                        é‡‘å‰/æ­»å‰ä¿¡å·å¼ºåˆ¶å¸‚ä»·å•
                                    </label>
                                    <small style="color: var(--text-secondary); font-size: 12px; display: block; margin-top: 4px;">
                                        ç©¿è¶Šä¿¡å·éœ€è¦ç«‹å³æˆäº¤ï¼Œåªæœ‰æŒç»­è¶‹åŠ¿ä¿¡å·æ‰ä½¿ç”¨é™ä»·å•
                                    </small>
                                </div>
                            </div>

                            <!-- å–å‡ºæ¡ä»¶ï¼ˆå¹³ä»“ï¼‰ -->
                            <div class="form-section">
                                <div class="form-section-title">
                                    <i class="bi bi-arrow-up-circle" style="color: var(--danger-red);"></i>
                                    å–å‡ºæ¡ä»¶ï¼ˆå¹³ä»“ï¼‰
                                </div>

                                <div class="form-group">
                                    <label class="form-label">å–å‡ºä¿¡å·<span class="required">*</span></label>
                                    <small style="color: var(--text-secondary); font-size: 12px; margin-bottom: 8px; display: block;">
                                        å¹³ä»“æ—¶ä½¿ç”¨çš„ä¿¡å·å‘¨æœŸï¼Œå»ºè®®ä½¿ç”¨æ¯”ä¹°å…¥ä¿¡å·æ›´çŸ­çš„å‘¨æœŸä»¥ä¾¿åŠæ—¶æ­¢ç›ˆæ­¢æŸ
                                    </small>
                                    <div class="radio-group" style="flex-direction: row; flex-wrap: wrap;">
                                        <div class="radio-option">
                                            <input type="radio" id="sellSignalEma5m" name="sellSignals" value="ema_5m" checked onchange="autoUpdateDirection('sell')">
                                            <label for="sellSignalEma5m" class="radio-label">EMA 5åˆ†é’Ÿ</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="sellSignalEma15m" name="sellSignals" value="ema_15m" onchange="autoUpdateDirection('sell')">
                                            <label for="sellSignalEma15m" class="radio-label">EMA 15åˆ†é’Ÿ</label>
                                        </div>
                                        <div class="radio-option">
                                            <input type="radio" id="sellSignalEma1h" name="sellSignals" value="ema_1h" onchange="autoUpdateDirection('sell')">
                                            <label for="sellSignalEma1h" class="radio-label">EMA 1å°æ—¶</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div> <!-- ç»“æŸæ¿å—3: è®¢å•ç®¡ç† -->

                            <!-- æŒ‰é’®åŒºåŸŸ -->
                            <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-default);">
                                <button type="button" class="btn btn-secondary" onclick="closeStrategyModal()">å–æ¶ˆ</button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜ç­–ç•¥</button>
                            </div>
                    </form>
                </div>
            </div>
        </div>

    <script>
        let strategies = []; // å­˜å‚¨ç­–ç•¥åˆ—è¡¨
        let availableSymbols = []; // å¯ç”¨å¸ç§åˆ—è¡¨
        let editingStrategyId = null; // æ­£åœ¨ç¼–è¾‘çš„ç­–ç•¥ID
        
        // åˆ‡æ¢ç­–ç•¥ç±»å‹
        function switchStrategyType(type, event) {
            // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
            document.querySelectorAll('.strategy-type-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // å¦‚æœæ²¡æœ‰eventï¼Œé€šè¿‡typeæ‰¾åˆ°å¯¹åº”çš„tab
                const tabs = document.querySelectorAll('.strategy-type-tab');
                tabs.forEach(tab => {
                    if (tab.textContent.includes(type === 'spot' ? 'ç°è´§' : 'åˆçº¦')) {
                        tab.classList.add('active');
                    }
                });
            }
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.strategy-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (type === 'spot') {
                document.getElementById('spotStrategyContent').classList.add('active');
            } else if (type === 'futures') {
                document.getElementById('futuresStrategyContent').classList.add('active');
                loadStrategies();
            } else if (type === 'execution') {
                document.getElementById('executionListContent').classList.add('active');
                loadExecutionList();
            }
        }

        // æ˜¾ç¤ºæ·»åŠ ç­–ç•¥è¡¨å•ï¼ˆModalå¼¹æ¡†ï¼‰
        function showAddStrategyModal() {
            const modal = document.getElementById('strategyModal');
            const modalTitle = document.getElementById('modalTitle');
            
            // æ›´æ–°Modalæ ‡é¢˜
            if (editingStrategyId !== null && editingStrategyId !== undefined) {
                modalTitle.innerHTML = '<i class="bi bi-pencil"></i> ç¼–è¾‘åˆçº¦äº¤æ˜“ç­–ç•¥';
            } else {
                modalTitle.innerHTML = '<i class="bi bi-plus-circle"></i> æ–°å»ºåˆçº¦äº¤æ˜“ç­–ç•¥';
            }
            
            // æ˜¾ç¤ºModal
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            
            loadAvailableSymbols();
            
            // å¦‚æœä¸æ˜¯ç¼–è¾‘æ¨¡å¼ï¼Œåˆå§‹åŒ–é»˜è®¤å€¼
            if (editingStrategyId === null || editingStrategyId === undefined) {
                // åˆå§‹åŒ–ï¼šé»˜è®¤é€‰æ‹©åšå¤š
                document.getElementById('buyDirectionLong').checked = true;
                // åˆå§‹åŒ–ä»·æ ¼é€‰é¡¹
                updatePriceOptions();
            }
        }

        // å…³é—­ç­–ç•¥Modal
        let isClosingModal = false; // é˜²æ­¢é€’å½’è°ƒç”¨
        function closeStrategyModal() {
            // é˜²æ­¢é€’å½’è°ƒç”¨
            if (isClosingModal) {
                return;
            }
            isClosingModal = true;
            
            try {
                const modal = document.getElementById('strategyModal');
                if (modal) {
                    modal.classList.remove('show');
                }
                document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
                
                // é‡ç½®è¡¨å•
                const form = document.getElementById('strategyForm');
                if (form) {
                    form.reset();
                }
                
                // V2ç­–ç•¥ä½¿ç”¨å›ºå®šå‚æ•°ï¼Œä»¥ä¸‹å­—æ®µå·²è¢«ç§»é™¤
                // æ¸…é™¤å¼€ä»“å‰å…ˆå¹³æ‰ç›¸åæ–¹å‘æŒä»“
                const closeOppositeOnEntry = document.getElementById('closeOppositeOnEntry');
                if (closeOppositeOnEntry) closeOppositeOnEntry.checked = false;

                // æ¸…é™¤åŒæ–¹å‘æŒä»“é™åˆ¶
                const maxLongPositions = document.getElementById('maxLongPositions');
                if (maxLongPositions) maxLongPositions.value = '';
                const maxShortPositions = document.getElementById('maxShortPositions');
                if (maxShortPositions) maxShortPositions.value = '';

                // æ¸…é™¤é™ä»·å•è¶…æ—¶
                const limitOrderTimeoutMinutes = document.getElementById('limitOrderTimeoutMinutes');
                if (limitOrderTimeoutMinutes) limitOrderTimeoutMinutes.value = '';

                // æ¸…é™¤æŠ€æœ¯æŒ‡æ ‡è¿‡æ»¤å™¨
                const rsiFilterEnabled = document.getElementById('rsiFilterEnabled');
                if (rsiFilterEnabled) {
                    rsiFilterEnabled.checked = false;
                    const rsiLongMax = document.getElementById('rsiLongMax');
                    if (rsiLongMax) rsiLongMax.value = '70';
                    const rsiShortMin = document.getElementById('rsiShortMin');
                    if (rsiShortMin) rsiShortMin.value = '30';
                }
                const rsiSignalEnabled = document.getElementById('rsiSignalEnabled');
                if (rsiSignalEnabled) {
                    rsiSignalEnabled.checked = false;
                    const rsiSignalLongThreshold = document.getElementById('rsiSignalLongThreshold');
                    if (rsiSignalLongThreshold) rsiSignalLongThreshold.value = '30';
                    const rsiSignalShortThreshold = document.getElementById('rsiSignalShortThreshold');
                    if (rsiSignalShortThreshold) rsiSignalShortThreshold.value = '75';
                    const rsiSignalMinEmaStrengthLong = document.getElementById('rsiSignalMinEmaStrengthLong');
                    if (rsiSignalMinEmaStrengthLong) rsiSignalMinEmaStrengthLong.value = '0.15';
                    const rsiSignalMaxEmaStrengthShort = document.getElementById('rsiSignalMaxEmaStrengthShort');
                    if (rsiSignalMaxEmaStrengthShort) rsiSignalMaxEmaStrengthShort.value = '1.0';
                    const rsiSignalEmaStrengthTrendBars = document.getElementById('rsiSignalEmaStrengthTrendBars');
                    if (rsiSignalEmaStrengthTrendBars) rsiSignalEmaStrengthTrendBars.value = '2';
                }
                const macdFilterEnabled = document.getElementById('macdFilterEnabled');
                if (macdFilterEnabled) {
                    macdFilterEnabled.checked = false;
                    const macdLongRequirePositive = document.getElementById('macdLongRequirePositive');
                    if (macdLongRequirePositive) macdLongRequirePositive.checked = true;
                    const macdShortRequireNegative = document.getElementById('macdShortRequireNegative');
                    if (macdShortRequireNegative) macdShortRequireNegative.checked = true;
                }
                const kdjFilterEnabled = document.getElementById('kdjFilterEnabled');
                if (kdjFilterEnabled) {
                    kdjFilterEnabled.checked = false;
                    const kdjLongMaxK = document.getElementById('kdjLongMaxK');
                    if (kdjLongMaxK) kdjLongMaxK.value = '80';
                    const kdjShortMinK = document.getElementById('kdjShortMinK');
                    if (kdjShortMinK) kdjShortMinK.value = '20';
                }
                // æ¸…é™¤æŒç»­è¶‹åŠ¿ä¿¡å·é…ç½®
                const sustainedTrendEnabled = document.getElementById('sustainedTrendEnabled');
                if (sustainedTrendEnabled) {
                    sustainedTrendEnabled.checked = false;
                    const sustainedTrendMinStrength = document.getElementById('sustainedTrendMinStrength');
                    if (sustainedTrendMinStrength) sustainedTrendMinStrength.value = '0.15';
                    const sustainedTrendMaxStrength = document.getElementById('sustainedTrendMaxStrength');
                    if (sustainedTrendMaxStrength) sustainedTrendMaxStrength.value = '1.0';
                    const sustainedTrendMinBars = document.getElementById('sustainedTrendMinBars');
                    if (sustainedTrendMinBars) sustainedTrendMinBars.value = '2';
                    const sustainedTrendCooldownMinutes = document.getElementById('sustainedTrendCooldownMinutes');
                    if (sustainedTrendCooldownMinutes) sustainedTrendCooldownMinutes.value = '60';
                    const sustainedTrendRequireMA10Confirm = document.getElementById('sustainedTrendRequireMA10Confirm');
                    if (sustainedTrendRequireMA10Confirm) sustainedTrendRequireMA10Confirm.checked = true;
                    const sustainedTrendRequirePriceConfirm = document.getElementById('sustainedTrendRequirePriceConfirm');
                    if (sustainedTrendRequirePriceConfirm) sustainedTrendRequirePriceConfirm.checked = true;
                }
                // æ¸…é™¤ä»·æ ¼è·ç¦»EMAé™åˆ¶é…ç½®
                const priceDistanceLimitEnabled = document.getElementById('priceDistanceLimitEnabled');
                if (priceDistanceLimitEnabled) {
                    priceDistanceLimitEnabled.checked = false;
                    const priceDistanceMaxAboveEMA = document.getElementById('priceDistanceMaxAboveEMA');
                    if (priceDistanceMaxAboveEMA) priceDistanceMaxAboveEMA.value = '1.0';
                    const priceDistanceMaxBelowEMA = document.getElementById('priceDistanceMaxBelowEMA');
                    if (priceDistanceMaxBelowEMA) priceDistanceMaxBelowEMA.value = '1.0';
                }

                // æ¸…é™¤è¡Œæƒ…è‡ªé€‚åº”é…ç½®
                const adaptiveRegimeEnabled = document.getElementById('adaptiveRegimeEnabled');
                if (adaptiveRegimeEnabled) {
                    adaptiveRegimeEnabled.checked = false;
                    toggleAdaptiveRegimeConfig();
                    resetRegimeParams();
                }

                // V2ç­–ç•¥å§‹ç»ˆå¯ç”¨ï¼Œè°ƒç”¨åˆå§‹åŒ–å‡½æ•°
                toggleV2Mode();

                editingStrategyId = null;
                updateEmptyState();
            } catch (error) {
                console.error('å…³é—­Modalæ—¶å‡ºé”™:', error);
            } finally {
                // é‡ç½®é€’å½’ä¿æŠ¤æ ‡å¿—ï¼ˆå»¶è¿Ÿé‡ç½®ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œå®Œæˆï¼‰
                setTimeout(() => {
                    isClosingModal = false;
                }, 100);
            }
        }
        
        // æ›´æ–°ç­–ç•¥ç‰ˆæœ¬æè¿°æ˜¾ç¤º
        function updateStrategyTypeDescription() {
            const strategyTypeV2 = document.getElementById('strategyTypeV2');
            const strategyTypeV3 = document.getElementById('strategyTypeV3');
            const v2Description = document.getElementById('v2Description');
            const v3Description = document.getElementById('v3Description');

            if (strategyTypeV3 && strategyTypeV3.checked) {
                // V3ç­–ç•¥
                if (v2Description) v2Description.style.display = 'none';
                if (v3Description) v3Description.style.display = 'block';

                // V3å¼ºåˆ¶è®¾ç½®å›ºå®š1%é™ä»·å•
                const longPriceMarketMinus1 = document.getElementById('longPriceMarketMinus1');
                const shortPricemarketPlus1 = document.getElementById('shortPricemarketPlus1');
                if (longPriceMarketMinus1) longPriceMarketMinus1.checked = true;
                if (shortPricemarketPlus1) shortPricemarketPlus1.checked = true;

                // V3ä½¿ç”¨2.5%ç¡¬æ­¢æŸ
                const stopLoss = document.getElementById('stopLoss');
                if (stopLoss) stopLoss.value = '2.5';

            } else {
                // V2ç­–ç•¥
                if (v2Description) v2Description.style.display = 'block';
                if (v3Description) v3Description.style.display = 'none';
            }

        // åˆ‡æ¢åå‘æ“ä½œé…ç½®é¢æ¿
        function toggleContrarianConfig() {
            const enabled = document.getElementById('contrarianEnabled').checked;
            const panel = document.getElementById('contrarianConfigPanel');
            if (panel) {
                panel.style.display = enabled ? 'block' : 'none';
            }
        }

        // åˆ‡æ¢å¸‚åœºæ£€æµ‹é…ç½®
            const enabled = document.getElementById('contrarianEnabled').checked;
            const panel = document.getElementById('contrarianConfigPanel');
            if (panel) {
                panel.style.display = enabled ? 'block' : 'none';
            }
        }

        // åˆ‡æ¢å¸‚åœºæ£€æµ‹é…ç½®
        function toggleMarketDetectionConfig() {
            const autoMode = document.getElementById('marketRegimeAuto').checked;
            const panel = document.getElementById('marketDetectionPanel');
            if (panel) {
                panel.style.display = autoMode ? 'block' : 'none';
            }
        }

        // V2ç­–ç•¥é»˜è®¤è®¾ç½®ï¼ˆå·²ç®€åŒ–ï¼ŒV2å§‹ç»ˆå¯ç”¨ï¼‰
        function toggleV2Mode() {
            // V2ç­–ç•¥å§‹ç»ˆå¯ç”¨ï¼Œè®¾ç½®é»˜è®¤å€¼

            // è®¾ç½®é»˜è®¤æ æ†10X
            const leverage10 = document.getElementById('leverage10');
            if (leverage10) leverage10.checked = true;

            // è®¾ç½®é»˜è®¤ä»“ä½5%
            const positionSize = document.getElementById('positionSize');
            if (positionSize && !positionSize.value) positionSize.value = '5';

            // è®¾ç½®é»˜è®¤æ­¢æŸ2.5%ï¼ˆV2çš„ç¡¬æ­¢æŸï¼‰ï¼Œä½†å…è®¸ç”¨æˆ·ä¿®æ”¹
            const stopLoss = document.getElementById('stopLoss');
            if (stopLoss && !stopLoss.value) {
                stopLoss.value = '2.5';
            }

            // è®¾ç½®é»˜è®¤æ­¢ç›ˆ8%ï¼ˆV2çš„æœ€å¤§æ­¢ç›ˆï¼‰ï¼Œä½†å…è®¸ç”¨æˆ·ä¿®æ”¹
            const takeProfit = document.getElementById('takeProfit');
            if (takeProfit && !takeProfit.value) {
                takeProfit.value = '8';
            }

            // å¼ºåˆ¶å¸‚ä»·å•
            const marketLong = document.getElementById('longPrice_market');
            if (marketLong) marketLong.checked = true;
            const marketShort = document.getElementById('shortPrice_market');
            if (marketShort) marketShort.checked = true;

            // å¼€ä»“å‰å…ˆå¹³åå‘
            const closeOpposite = document.getElementById('closeOppositeOnEntry');
            if (closeOpposite) closeOpposite.checked = true;
        }

        // ç‚¹å‡»ModalèƒŒæ™¯å…³é—­
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('strategyModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeStrategyModal();
                    }
                });
            }
            
            // ESCé”®å…³é—­Modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('strategyModal');
                    if (modal && modal.classList.contains('show')) {
                        closeStrategyModal();
                    }
                }
            });
        });

        // æ ¹æ®äº¤æ˜“æ–¹å‘æ›´æ–°ä»·æ ¼é€‰é¡¹æ˜¾ç¤º
        function updatePriceOptions() {
            const longChecked = document.getElementById('buyDirectionLong').checked;
            const shortChecked = document.getElementById('buyDirectionShort').checked;
            
            // æ˜¾ç¤º/éšè—åšå¤šä»·æ ¼é€‰é¡¹
            const longPriceGroup = document.getElementById('longPriceGroup');
            if (longChecked) {
                longPriceGroup.style.display = 'block';
            } else {
                longPriceGroup.style.display = 'none';
            }
            
            // æ˜¾ç¤º/éšè—åšç©ºä»·æ ¼é€‰é¡¹
            const shortPriceGroup = document.getElementById('shortPriceGroup');
            if (shortChecked) {
                shortPriceGroup.style.display = 'block';
            } else {
                shortPriceGroup.style.display = 'none';
            }
        }

        // åˆ‡æ¢é™ä»·å•é€‰é¡¹æ˜¾ç¤º/éšè—
        function toggleLimitOrderOptions() {
            const enableLimitOrder = document.getElementById('enableLimitOrder').checked;

            // è·å–æ‰€æœ‰éå¸‚ä»·çš„é™ä»·é€‰é¡¹
            const longPriceOptions = document.querySelectorAll('#longPriceGroup .radio-option');
            const shortPriceOptions = document.querySelectorAll('#shortPriceGroup .radio-option');

            longPriceOptions.forEach((option, index) => {
                if (index > 0) { // è·³è¿‡ç¬¬ä¸€ä¸ªï¼ˆå¸‚ä»·ï¼‰
                    option.style.display = enableLimitOrder ? 'flex' : 'none';
                }
            });

            shortPriceOptions.forEach((option, index) => {
                if (index > 0) { // è·³è¿‡ç¬¬ä¸€ä¸ªï¼ˆå¸‚ä»·ï¼‰
                    option.style.display = enableLimitOrder ? 'flex' : 'none';
                }
            });

            // å¦‚æœç¦ç”¨é™ä»·å•ï¼Œå¼ºåˆ¶é€‰ä¸­å¸‚ä»·
            if (!enableLimitOrder) {
                const longMarket = document.getElementById('longPriceMarket');
                const shortMarket = document.getElementById('shortPriceMarket');
                if (longMarket) longMarket.checked = true;
                if (shortMarket) shortMarket.checked = true;
            }
        }

        // æ ¹æ®EMAä¿¡å·è‡ªåŠ¨å†³å®šå¤šç©ºæ–¹å‘
        function autoUpdateDirection(type) {
            if (type === 'buy') {
                const buySignal = document.querySelector('input[name="buySignals"]:checked').value;
                // EMAä¿¡å·é€šå¸¸é‡‘å‰è¡¨ç¤ºçœ‹æ¶¨ï¼ˆåšå¤šï¼‰ï¼Œæ­»å‰è¡¨ç¤ºçœ‹è·Œï¼ˆåšç©ºï¼‰
                // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é€»è¾‘
                // æš‚æ—¶æ ¹æ®EMAæ—¶é—´å‘¨æœŸåˆ¤æ–­ï¼š5må’Œ15mé€šå¸¸ç”¨äºçŸ­æœŸåšå¤šï¼Œ1hç”¨äºä¸­æœŸ
                if (buySignal === 'ema_5m' || buySignal === 'ema_15m') {
                    // çŸ­æœŸEMAä¿¡å·ï¼Œå€¾å‘äºåšå¤š
                    if (!document.getElementById('buyDirectionLong').checked) {
                        document.getElementById('buyDirectionLong').checked = true;
                        updatePriceOptions();
                    }
                } else if (buySignal === 'ema_1h') {
                    // 1å°æ—¶EMAä¿¡å·ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒå¤šç©º
                    // ä¸åšè‡ªåŠ¨é€‰æ‹©ï¼Œè®©ç”¨æˆ·è‡ªå·±å†³å®š
                }
            } else if (type === 'sell') {
                const sellSignal = document.querySelector('input[name="sellSignals"]:checked').value;
                // å–å‡ºä¿¡å·é€šå¸¸ç”¨äºå¹³ä»“ï¼Œä¸åšæ–¹å‘è‡ªåŠ¨é€‰æ‹©
            }
        }

        // æˆäº¤é‡ç›¸å…³å‡½æ•°å·²ç§»é™¤ï¼ˆV2ç­–ç•¥ä¸ä½¿ç”¨ï¼‰
        function toggleBuyVolumeOptions() {}
        function toggleBuyVolumeLongOptions() {}
        function toggleBuyVolumeShortOptions() {}

        // æ™ºèƒ½å‡ºåœºç›¸å…³åˆ‡æ¢å‡½æ•°

        function toggleEmaDiffTakeProfitParams() {
            const enabled = document.getElementById('emaDiffTakeProfitEnabled').checked;
            const params = document.getElementById('emaDiffTakeProfitParams');
            params.style.display = enabled ? 'block' : 'none';
        }



        // æ™ºèƒ½æ­¢æŸç›¸å…³åˆ‡æ¢å‡½æ•°
        function toggleAtrStopLossParams() {
            const enabled = document.getElementById('atrStopLossEnabled').checked;
            const params = document.getElementById('atrStopLossParams');
            params.style.display = enabled ? 'block' : 'none';
        }

        function toggleTrailingStopLossParams() {
            const enabled = document.getElementById('trailingStopLossEnabled').checked;
            const params = document.getElementById('trailingStopLossParams');
            params.style.display = enabled ? 'block' : 'none';
        }

        function toggleTimeDecayStopLossParams() {
            const enabled = document.getElementById('timeDecayStopLossEnabled').checked;
            const params = document.getElementById('timeDecayStopLossParams');
            params.style.display = enabled ? 'block' : 'none';
        }

        function toggleEmaSupportStopLossParams() {
            const enabled = document.getElementById('emaSupportStopLossEnabled').checked;
            const params = document.getElementById('emaSupportStopLossParams');
            params.style.display = enabled ? 'block' : 'none';
        }

        function toggleSignalStopLossParams() {
            const enabled = document.getElementById('signalStopLossEnabled').checked;
            const params = document.getElementById('signalStopLossParams');
            params.style.display = enabled ? 'block' : 'none';
        }

        // è¶‹åŠ¿å‡å¼±å¹³ä»“é…ç½®åˆ‡æ¢å‡½æ•°
        function toggleTrendWeakeningParams() {
            const enabled = document.getElementById('trendWeakeningExitEnabled').checked;
            const params = document.getElementById('trendWeakeningParams');
            params.style.display = enabled ? 'block' : 'none';
        }

        // è¡Œæƒ…è‡ªé€‚åº”é…ç½®åˆ‡æ¢å‡½æ•°
        function toggleAdaptiveRegimeConfig() {
            const enabled = document.getElementById('adaptiveRegimeEnabled').checked;
            const config = document.getElementById('adaptiveRegimeConfig');
            config.style.display = enabled ? 'block' : 'none';
        }

        // è·å–è¡Œæƒ…è‡ªé€‚åº”é…ç½®
        function getRegimeParams() {
            const regimeTypes = ['strong_uptrend', 'weak_uptrend', 'ranging', 'weak_downtrend', 'strong_downtrend'];
            const params = {};

            regimeTypes.forEach(regime => {
                const directionEl = document.getElementById(`regime_${regime}_direction`);
                const slEl = document.getElementById(`regime_${regime}_sl`);
                const tpEl = document.getElementById(`regime_${regime}_tp`);
                const sustainedEl = document.getElementById(`regime_${regime}_sustained`);

                params[regime] = {
                    allowDirection: directionEl ? directionEl.value : 'both',
                    stopLossPercent: slEl && slEl.value ? parseFloat(slEl.value) : null,
                    takeProfitPercent: tpEl && tpEl.value ? parseFloat(tpEl.value) : null,
                    sustainedTrend: sustainedEl ? sustainedEl.checked : false
                };
            });

            return params;
        }

        // è®¾ç½®è¡Œæƒ…è‡ªé€‚åº”é…ç½®
        function setRegimeParams(params) {
            if (!params) return;

            const regimeTypes = ['strong_uptrend', 'weak_uptrend', 'ranging', 'weak_downtrend', 'strong_downtrend'];

            regimeTypes.forEach(regime => {
                const regimeConfig = params[regime];
                if (!regimeConfig) return;

                const directionEl = document.getElementById(`regime_${regime}_direction`);
                const slEl = document.getElementById(`regime_${regime}_sl`);
                const tpEl = document.getElementById(`regime_${regime}_tp`);
                const sustainedEl = document.getElementById(`regime_${regime}_sustained`);

                if (directionEl && regimeConfig.allowDirection) {
                    directionEl.value = regimeConfig.allowDirection;
                }
                if (slEl) {
                    slEl.value = regimeConfig.stopLossPercent !== null && regimeConfig.stopLossPercent !== undefined ? regimeConfig.stopLossPercent : '';
                }
                if (tpEl) {
                    tpEl.value = regimeConfig.takeProfitPercent !== null && regimeConfig.takeProfitPercent !== undefined ? regimeConfig.takeProfitPercent : '';
                }
                if (sustainedEl) {
                    sustainedEl.checked = regimeConfig.sustainedTrend === true;
                }
            });
        }

        // é‡ç½®è¡Œæƒ…è‡ªé€‚åº”é…ç½®ä¸ºé»˜è®¤å€¼
        function resetRegimeParams() {
            const defaults = {
                strong_uptrend: { allowDirection: 'long_only', stopLossPercent: null, takeProfitPercent: null, sustainedTrend: true },
                weak_uptrend: { allowDirection: 'long_only', stopLossPercent: null, takeProfitPercent: null, sustainedTrend: false },
                ranging: { allowDirection: 'none', stopLossPercent: null, takeProfitPercent: null, sustainedTrend: false },
                weak_downtrend: { allowDirection: 'short_only', stopLossPercent: null, takeProfitPercent: null, sustainedTrend: false },
                strong_downtrend: { allowDirection: 'short_only', stopLossPercent: null, takeProfitPercent: null, sustainedTrend: true }
            };
            setRegimeParams(defaults);
        }

        // ç»‘å®šæ™ºèƒ½å‡ºåœºå¤é€‰æ¡†äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const emaDiffTakeProfitCheckbox = document.getElementById('emaDiffTakeProfitEnabled');
            if (emaDiffTakeProfitCheckbox) emaDiffTakeProfitCheckbox.addEventListener('change', toggleEmaDiffTakeProfitParams);

            // æ™ºèƒ½æ­¢æŸå¤é€‰æ¡†äº‹ä»¶ç»‘å®š
            const atrStopLossCheckbox = document.getElementById('atrStopLossEnabled');
            if (atrStopLossCheckbox) atrStopLossCheckbox.addEventListener('change', toggleAtrStopLossParams);

            const trailingStopLossCheckbox = document.getElementById('trailingStopLossEnabled');
            if (trailingStopLossCheckbox) trailingStopLossCheckbox.addEventListener('change', toggleTrailingStopLossParams);

            const timeDecayStopLossCheckbox = document.getElementById('timeDecayStopLossEnabled');
            if (timeDecayStopLossCheckbox) timeDecayStopLossCheckbox.addEventListener('change', toggleTimeDecayStopLossParams);

            const emaSupportStopLossCheckbox = document.getElementById('emaSupportStopLossEnabled');
            if (emaSupportStopLossCheckbox) emaSupportStopLossCheckbox.addEventListener('change', toggleEmaSupportStopLossParams);

        });

        // åŠ è½½å¯ç”¨å¸ç§ï¼ˆä»é…ç½®æ–‡ä»¶/APIè·å–ï¼‰
        async function loadAvailableSymbols() {
            try {
                // ä¼˜å…ˆä» /api/config è·å–äº¤æ˜“å¯¹æ¸…å•ï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰
                const configResponse = await fetch('/api/config');
                if (configResponse.ok) {
                    const configData = await configResponse.json();
                    if (configData.symbols && Array.isArray(configData.symbols) && configData.symbols.length > 0) {
                        availableSymbols = configData.symbols;
                    }
                }
                
                // å¦‚æœ /api/config æ²¡æœ‰æ•°æ®ï¼Œå°è¯•ä» /api/futures/symbols è·å–
                if (availableSymbols.length === 0) {
                    const futuresResponse = await fetch('/api/futures/symbols');
                    if (futuresResponse.ok) {
                        const futuresData = await futuresResponse.json();
                        if (futuresData.success && futuresData.symbols && futuresData.symbols.length > 0) {
                            availableSymbols = futuresData.symbols;
                        }
                    }
                }
                
                // å¦‚æœä»ç„¶æ²¡æœ‰æ•°æ®ï¼Œå°è¯•ä»æŠ€æœ¯ä¿¡å·APIè·å–
                if (availableSymbols.length === 0) {
                    const techResponse = await fetch('/api/technical-signals');
                    if (techResponse.ok) {
                        const techData = await techResponse.json();
                        if (techData.success && techData.data && techData.data.length > 0) {
                            availableSymbols = techData.data.map(item => item.symbol);
                        }
                    }
                }
                
                // å¦‚æœä»ç„¶æ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨é»˜è®¤åˆ—è¡¨
                if (availableSymbols.length === 0) {
                    console.warn('æ— æ³•ä»APIè·å–å¸ç§åˆ—è¡¨ï¼Œä½¿ç”¨é»˜è®¤åˆ—è¡¨');
                    availableSymbols = ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'DOGE/USDT', 'XRP/USDT', 'ADA/USDT', 'AVAX/USDT', 'DOT/USDT', 'MATIC/USDT'];
                }
                
                const symbolCheckboxGroup = document.getElementById('symbolCheckboxGroup');
                symbolCheckboxGroup.innerHTML = '';
                
                // å»é‡å¹¶æ’åº
                availableSymbols = [...new Set(availableSymbols)].sort();
                
                availableSymbols.forEach(symbol => {
                    const checkboxOption = document.createElement('div');
                    checkboxOption.className = 'checkbox-option';
                    checkboxOption.innerHTML = `
                        <input type="checkbox" id="symbol_${symbol.replace('/', '_')}" name="symbols" value="${symbol}">
                        <label for="symbol_${symbol.replace('/', '_')}" class="checkbox-label">${symbol}</label>
                    `;
                    symbolCheckboxGroup.appendChild(checkboxOption);
                });
            } catch (error) {
                console.error('åŠ è½½å¸ç§åˆ—è¡¨å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤åˆ—è¡¨ä½œä¸ºå¤‡ç”¨
                if (availableSymbols.length === 0) {
                    availableSymbols = ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT', 'DOGE/USDT', 'XRP/USDT', 'ADA/USDT', 'AVAX/USDT', 'DOT/USDT', 'MATIC/USDT'];
                    const symbolCheckboxGroup = document.getElementById('symbolCheckboxGroup');
                    symbolCheckboxGroup.innerHTML = '';
                    availableSymbols.forEach(symbol => {
                        const checkboxOption = document.createElement('div');
                        checkboxOption.className = 'checkbox-option';
                        checkboxOption.innerHTML = `
                            <input type="checkbox" id="symbol_${symbol.replace('/', '_')}" name="symbols" value="${symbol}">
                            <label for="symbol_${symbol.replace('/', '_')}" class="checkbox-label">${symbol}</label>
                        `;
                        symbolCheckboxGroup.appendChild(checkboxOption);
                    });
                }
            }
        }

        // ä¿å­˜ç­–ç•¥åˆ°æœåŠ¡å™¨
        async function saveStrategiesToServer() {
            try {
                const response = await fetch('/api/futures/strategies', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(strategies)
                });
                
                const result = await response.json();
                if (!result.success) {
                    throw new Error(result.message || 'ä¿å­˜å¤±è´¥');
                }
                return true;
            } catch (error) {
                console.error('ä¿å­˜ç­–ç•¥åˆ°æœåŠ¡å™¨å¤±è´¥:', error);
                showToast('ä¿å­˜ç­–ç•¥å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // ä¿å­˜ç­–ç•¥
        async function saveStrategy(event) {
            event.preventDefault();

            const sellSignalRadio = document.querySelector('input[name="sellSignals"]:checked');
            const longPriceRadio = document.querySelector('input[name="longPrice"]:checked');
            const shortPriceRadio = document.querySelector('input[name="shortPrice"]:checked');

            const buyDirections = Array.from(document.querySelectorAll('input[name="buyDirection"]:checked')).map(cb => cb.value);
            const leverageRadio = document.querySelector('input[name="leverage"]:checked');

            const strategyTypeRadio = document.querySelector('input[name="strategyType"]:checked');
            const strategyType = strategyTypeRadio ? strategyTypeRadio.value : 'v2';

            const formData = {
                name: document.getElementById('strategyName').value,
                strategyType: strategyType, // V2 æˆ– V3 ç­–ç•¥
                useV2Strategy: true, // V2ç­–ç•¥å§‹ç»ˆå¯ç”¨ï¼ˆå‘åå…¼å®¹ï¼‰
                buyDirection: buyDirections, // æ”¹ä¸ºæ•°ç»„ï¼Œæ”¯æŒå¤šé€‰
                leverage: leverageRadio ? parseInt(leverageRadio.value) : 5, // äº¤æ˜“å€æ•°ï¼Œé»˜è®¤5
                buySignals: 'ema_15m', // V2ç­–ç•¥å›ºå®šä½¿ç”¨ EMA 15åˆ†é’Ÿä¿¡å·
                // æˆäº¤é‡æ¡ä»¶å­—æ®µå·²ç§»é™¤
                sellSignals: sellSignalRadio ? sellSignalRadio.value : null, // æ”¹ä¸ºå•é€‰
                // å¹³ä»“æˆäº¤é‡å·²ç§»é™¤ï¼Œä¸å†é™åˆ¶
                symbols: Array.from(document.querySelectorAll('input[name="symbols"]:checked')).map(cb => cb.value),
                positionSize: parseFloat(document.getElementById('positionSize').value),
                maxPositions: document.getElementById('maxPositions').value ? parseInt(document.getElementById('maxPositions').value) : null,
                maxLongPositions: document.getElementById('maxLongPositions').value ? parseInt(document.getElementById('maxLongPositions').value) : null,
                maxShortPositions: document.getElementById('maxShortPositions').value ? parseInt(document.getElementById('maxShortPositions').value) : null,
                enableLimitOrder: document.getElementById('enableLimitOrder') ? document.getElementById('enableLimitOrder').checked : false,
                longPrice: longPriceRadio ? longPriceRadio.value : null,
                shortPrice: shortPriceRadio ? shortPriceRadio.value : null,
                limitOrderTimeoutMinutes: document.getElementById('limitOrderTimeoutMinutes') && document.getElementById('limitOrderTimeoutMinutes').value ? parseInt(document.getElementById('limitOrderTimeoutMinutes').value) : 15,
                limitOrderMaxDeviation: document.getElementById('limitOrderMaxDeviation') && document.getElementById('limitOrderMaxDeviation').value ? parseFloat(document.getElementById('limitOrderMaxDeviation').value) : 1.5,
                crossSignalForceMarket: document.getElementById('crossSignalForceMarket') ? document.getElementById('crossSignalForceMarket').checked : true,
                stopLoss: document.getElementById('stopLoss').value ? parseFloat(document.getElementById('stopLoss').value) : null,
                maxHoldingHours: document.getElementById('maxHoldingHours').value ? parseInt(document.getElementById('maxHoldingHours').value) : 0,
                takeProfit: document.getElementById('takeProfit').value ? parseFloat(document.getElementById('takeProfit').value) : null,
                trailingActivate: document.getElementById('trailingActivate').value ? parseFloat(document.getElementById('trailingActivate').value) : 1.5,
                trailingCallback: document.getElementById('trailingCallback').value ? parseFloat(document.getElementById('trailingCallback').value) : 0.5,
                trailingCooldownMinutes: document.getElementById('trailingCooldownMinutes').value ? parseInt(document.getElementById('trailingCooldownMinutes').value) : 15,
                closeOppositeOnEntry: document.getElementById('closeOppositeOnEntry') ? document.getElementById('closeOppositeOnEntry').checked : false,
                // V2ç­–ç•¥å›ºå®šå‚æ•°
                ma10Ema10TrendFilter: true,
                minSignalStrength: { ema9_26: 0.15, ma10_ema10: 0 },
                trendConfirmBars: 0,
                trendConfirmEMAThreshold: 0.1,
                exitOnMAFlip: false,
                exitOnMAFlipThreshold: 0.1,
                exitOnMAFlipConfirmBars: 1,
                exitOnEMAWeak: false,
                exitOnEMAWeakThreshold: 0.05,
                earlyStopLossPct: null,
                preventDuplicateEntry: false,
                minHoldingTimeHours: 0,
                // å¼€ä»“å†·å´é…ç½®
                entryCooldown: {
                    enabled: document.getElementById('entryCooldownEnabled') ? document.getElementById('entryCooldownEnabled').checked : true,
                    minutes: document.getElementById('entryCooldownMinutes') ? parseInt(document.getElementById('entryCooldownMinutes').value) : 30,
                    maxPositionsPerDirection: document.getElementById('entryCooldownMaxPositionsPerDirection') ? parseInt(document.getElementById('entryCooldownMaxPositionsPerDirection').value) : 1
                },
                rsiFilter: {
                    enabled: document.getElementById('rsiFilterEnabled') ? document.getElementById('rsiFilterEnabled').checked : false,
                    longMax: document.getElementById('rsiLongMax') ? parseFloat(document.getElementById('rsiLongMax').value) : 70,
                    shortMin: document.getElementById('rsiShortMin') ? parseFloat(document.getElementById('rsiShortMin').value) : 30
                },
                rsiSignal: {
                    enabled: document.getElementById('rsiSignalEnabled') ? document.getElementById('rsiSignalEnabled').checked : false,
                    longThreshold: document.getElementById('rsiSignalLongThreshold') ? parseFloat(document.getElementById('rsiSignalLongThreshold').value) : 30,
                    shortThreshold: document.getElementById('rsiSignalShortThreshold') ? parseFloat(document.getElementById('rsiSignalShortThreshold').value) : 75,
                    minEmaStrengthLong: document.getElementById('rsiSignalMinEmaStrengthLong') ? parseFloat(document.getElementById('rsiSignalMinEmaStrengthLong').value) : 0.15,
                    maxEmaStrengthShort: document.getElementById('rsiSignalMaxEmaStrengthShort') ? parseFloat(document.getElementById('rsiSignalMaxEmaStrengthShort').value) : 1.0,
                    emaStrengthTrendBars: document.getElementById('rsiSignalEmaStrengthTrendBars') ? parseInt(document.getElementById('rsiSignalEmaStrengthTrendBars').value) : 2
                },
                macdFilter: {
                    enabled: document.getElementById('macdFilterEnabled') ? document.getElementById('macdFilterEnabled').checked : false,
                    longRequirePositive: document.getElementById('macdLongRequirePositive') ? document.getElementById('macdLongRequirePositive').checked : true,
                    shortRequireNegative: document.getElementById('macdShortRequireNegative') ? document.getElementById('macdShortRequireNegative').checked : true
                },
                kdjFilter: {
                    enabled: document.getElementById('kdjFilterEnabled') ? document.getElementById('kdjFilterEnabled').checked : false,
                    longMaxK: document.getElementById('kdjLongMaxK') ? parseFloat(document.getElementById('kdjLongMaxK').value) : 80,
                    shortMinK: document.getElementById('kdjShortMinK') ? parseFloat(document.getElementById('kdjShortMinK').value) : 20
                },
                sustainedTrend: {
                    enabled: document.getElementById('sustainedTrendEnabled') ? document.getElementById('sustainedTrendEnabled').checked : false,
                    minStrength: document.getElementById('sustainedTrendMinStrength') ? parseFloat(document.getElementById('sustainedTrendMinStrength').value) : 0.15,
                    maxStrength: document.getElementById('sustainedTrendMaxStrength') ? parseFloat(document.getElementById('sustainedTrendMaxStrength').value) : 1.0,
                    requireMA10Confirm: document.getElementById('sustainedTrendRequireMA10Confirm') ? document.getElementById('sustainedTrendRequireMA10Confirm').checked : true,
                    requirePriceConfirm: document.getElementById('sustainedTrendRequirePriceConfirm') ? document.getElementById('sustainedTrendRequirePriceConfirm').checked : true,
                    minBars: document.getElementById('sustainedTrendMinBars') ? parseInt(document.getElementById('sustainedTrendMinBars').value) : 2,
                    cooldownMinutes: document.getElementById('sustainedTrendCooldownMinutes') ? parseInt(document.getElementById('sustainedTrendCooldownMinutes').value) : 60
                },
                priceDistanceLimit: {
                    enabled: document.getElementById('priceDistanceLimitEnabled') ? document.getElementById('priceDistanceLimitEnabled').checked : false,
                    maxAboveEMA: document.getElementById('priceDistanceMaxAboveEMA') ? parseFloat(document.getElementById('priceDistanceMaxAboveEMA').value) : 1.0,
                    maxBelowEMA: document.getElementById('priceDistanceMaxBelowEMA') ? parseFloat(document.getElementById('priceDistanceMaxBelowEMA').value) : 1.0
                },
                // æ™ºèƒ½å‡ºåœºé…ç½®
                // EMAå·®å€¼æ­¢ç›ˆ
                emaDiffTakeProfit: {
                    enabled: document.getElementById('emaDiffTakeProfitEnabled') ? document.getElementById('emaDiffTakeProfitEnabled').checked : false,
                    threshold: document.getElementById('emaDiffTakeProfitThreshold') ? parseFloat(document.getElementById('emaDiffTakeProfitThreshold').value) : 0.5,
                    minProfitPct: document.getElementById('emaDiffTakeProfitMinProfit') ? parseFloat(document.getElementById('emaDiffTakeProfitMinProfit').value) : 0.3
                },
                // æ™ºèƒ½æ­¢æŸé…ç½®
                smartStopLoss: {
                    atrStopLoss: {
                        enabled: document.getElementById('atrStopLossEnabled') ? document.getElementById('atrStopLossEnabled').checked : false,
                        multiplier: document.getElementById('atrStopLossMultiplier') ? parseFloat(document.getElementById('atrStopLossMultiplier').value) : 2.0,
                        minPct: document.getElementById('atrStopLossMinPct') ? parseFloat(document.getElementById('atrStopLossMinPct').value) : 0.5,
                        maxPct: document.getElementById('atrStopLossMaxPct') ? parseFloat(document.getElementById('atrStopLossMaxPct').value) : 5.0
                    },
                    trailingStopLoss: {
                        enabled: document.getElementById('trailingStopLossEnabled') ? document.getElementById('trailingStopLossEnabled').checked : false,
                        activatePct: document.getElementById('trailingStopLossActivatePct') ? parseFloat(document.getElementById('trailingStopLossActivatePct').value) : 0.5,
                        distancePct: document.getElementById('trailingStopLossDistancePct') ? parseFloat(document.getElementById('trailingStopLossDistancePct').value) : 1.0
                    },
                    timeDecayStopLoss: {
                        enabled: document.getElementById('timeDecayStopLossEnabled') ? document.getElementById('timeDecayStopLossEnabled').checked : false,
                        initialPct: document.getElementById('timeDecayInitialPct') ? parseFloat(document.getElementById('timeDecayInitialPct').value) : 3.0,
                        finalPct: document.getElementById('timeDecayFinalPct') ? parseFloat(document.getElementById('timeDecayFinalPct').value) : 1.0,
                        decayHours: document.getElementById('timeDecayHours') ? parseInt(document.getElementById('timeDecayHours').value) : 24
                    },
                    emaSupportStopLoss: {
                        enabled: document.getElementById('emaSupportStopLossEnabled') ? document.getElementById('emaSupportStopLossEnabled').checked : false,
                        bufferPct: document.getElementById('emaSupportBufferPct') ? parseFloat(document.getElementById('emaSupportBufferPct').value) : 0.3,
                        minProfitPct: document.getElementById('emaSupportMinProfitPct') ? parseFloat(document.getElementById('emaSupportMinProfitPct').value) : 0.0
                    },
                    signalStopLoss: {
                        enabled: document.getElementById('signalStopLossEnabled') ? document.getElementById('signalStopLossEnabled').checked : true,
                        minEmaDiffPct: document.getElementById('signalStopLossMinDiff') ? parseFloat(document.getElementById('signalStopLossMinDiff').value) : 0.15
                    }
                },
                // è¶‹åŠ¿å‡å¼±å¹³ä»“é…ç½®
                trendWeakeningExit: {
                    enabled: document.getElementById('trendWeakeningExitEnabled') ? document.getElementById('trendWeakeningExitEnabled').checked : true,
                    emaDiffThreshold: document.getElementById('trendWeakeningEmaDiffThreshold') ? parseFloat(document.getElementById('trendWeakeningEmaDiffThreshold').value) : 0.5,
                    minProfitPct: document.getElementById('trendWeakeningMinProfitPct') ? parseFloat(document.getElementById('trendWeakeningMinProfitPct').value) : 1.0
                },
                // è¡Œæƒ…è‡ªé€‚åº”å¼€å…³
                adaptiveRegime: document.getElementById('adaptiveRegimeEnabled') ? document.getElementById('adaptiveRegimeEnabled').checked : false,
                // è¡Œæƒ…è‡ªé€‚åº”å‚æ•°é…ç½®
                regimeParams: document.getElementById('adaptiveRegimeEnabled') && document.getElementById('adaptiveRegimeEnabled').checked ? getRegimeParams() : null,
                // åè½¬é¢„è­¦é…ç½®
                reversalWarning: {
                    enabled: document.getElementById('reversalWarningEnabled') ? document.getElementById('reversalWarningEnabled').checked : true,
                    slopeChangeThreshold: document.getElementById('reversalSlopeThreshold') ? parseFloat(document.getElementById('reversalSlopeThreshold').value) : 0.05,
                    diffShrinkThreshold: document.getElementById('reversalShrinkThreshold') ? parseFloat(document.getElementById('reversalShrinkThreshold').value) : 30,
                    cooldownMinutes: document.getElementById('reversalCooldownMinutes') ? parseInt(document.getElementById('reversalCooldownMinutes').value) : 30
                },
                // å¾…å¼€ä»“è‡ªæ£€é…ç½®
                // æ³¨ï¼šå·²ç§»é™¤ require_ema_confirm, require_ma_confirm, check_ranging
                // é™ä»·å•æ˜¯å›è°ƒå…¥åœºç­–ç•¥ï¼ŒçŸ­æš‚åå‘æ˜¯æ­£å¸¸çš„å¸‚åœºæ³¢åŠ¨
                pendingValidation: {
                    enabled: document.getElementById('pendingValidationEnabled') ? document.getElementById('pendingValidationEnabled').checked : true,
                    expire_seconds: document.getElementById('pendingExpireSeconds') ? parseInt(document.getElementById('pendingExpireSeconds').value) : 300,
                    check_interval: document.getElementById('pendingCheckInterval') ? parseInt(document.getElementById('pendingCheckInterval').value) : 10,
                    max_price_diff: document.getElementById('pendingMaxPriceDiff') ? parseFloat(document.getElementById('pendingMaxPriceDiff').value) : 0.5,
                    check_trend_end: document.getElementById('pendingCheckTrendEnd') ? document.getElementById('pendingCheckTrendEnd').checked : true,
                    trend_end_shrink_threshold: document.getElementById('pendingTrendEndThreshold') ? parseFloat(document.getElementById('pendingTrendEndThreshold').value) : 0.5,
                    check_ema_converging: document.getElementById('pendingCheckEmaConverging') ? document.getElementById('pendingCheckEmaConverging').checked : true,
                    min_ema_diff_pct: document.getElementById('pendingMinEmaDiffPct') ? parseFloat(document.getElementById('pendingMinEmaDiffPct').value) : 0.05
                },
                // å¹³ä»“å†·å´é…ç½®
                closeReopenCooldownMinutes: document.getElementById('closeReopenCooldownMinutes') ? parseInt(document.getElementById('closeReopenCooldownMinutes').value) : 15,
                closeReopenSameDirectionOnly: document.getElementById('closeReopenSameDirectionOnly') ? document.getElementById('closeReopenSameDirectionOnly').checked : false,
                // åå‘æ“ä½œç­–ç•¥é…ç½® âš¡ æ–°å¢
                contrarianEnabled: document.getElementById('contrarianEnabled') ?
                    document.getElementById('contrarianEnabled').checked : false,
                marketRegime: document.querySelector('input[name="marketRegime"]:checked') ?
                    document.querySelector('input[name="marketRegime"]:checked').value : 'auto_detect',
                
                // å¸‚åœºæ£€æµ‹å‚æ•°
                marketDetection: {
                    lookbackHours: document.getElementById('lookbackHours') ?
                        parseInt(document.getElementById('lookbackHours').value) : 24,
                    minTrades: document.getElementById('minTrades') ?
                        parseInt(document.getElementById('minTrades').value) : 10
                },
                
                // åå‘æ“ä½œé£é™©å‚æ•°
                contrarianRisk: {
                    stopLoss: document.getElementById('contrarianStopLoss') ?
                        parseFloat(document.getElementById('contrarianStopLoss').value) : 1.5,
                    takeProfit: document.getElementById('contrarianTakeProfit') ?
                        parseFloat(document.getElementById('contrarianTakeProfit').value) : 1.0,
                    limitOrderOffset: document.getElementById('contrarianLimitOffset') ?
                        parseFloat(document.getElementById('contrarianLimitOffset').value) : 0.5
                }
            };

            // éªŒè¯
            if (buyDirections.length === 0) {
                showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªäº¤æ˜“æ–¹å‘ï¼ˆåšå¤šæˆ–åšç©ºï¼‰', 'warning');
                return;
            }
            
            if (!leverageRadio) {
                showToast('è¯·é€‰æ‹©äº¤æ˜“å€æ•°', 'warning');
                return;
            }

            // V2ç­–ç•¥ä¹°å…¥ä¿¡å·å›ºå®šä¸º EMA 15åˆ†é’Ÿï¼Œæ— éœ€éªŒè¯
            // æˆäº¤é‡æ¡ä»¶éªŒè¯å·²ç§»é™¤ï¼ˆV2ç­–ç•¥ä¸ä½¿ç”¨ï¼‰

            if (!sellSignalRadio) {
                showToast('è¯·é€‰æ‹©ä¸€ä¸ªå–å‡ºä¿¡å·', 'warning');
                return;
            }

            // éªŒè¯ä»·æ ¼é€‰é¡¹
            if (buyDirections.includes('long') && !longPriceRadio) {
                showToast('è¯·é€‰æ‹©åšå¤šä»·æ ¼', 'warning');
                return;
            }
            
            if (buyDirections.includes('short') && !shortPriceRadio) {
                showToast('è¯·é€‰æ‹©åšç©ºä»·æ ¼', 'warning');
                return;
            }
            
            if (formData.symbols.length === 0) {
                showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªäº¤æ˜“å¸ç§', 'warning');
                return;
            }
            
            // æ›´æ–°æˆ–æ·»åŠ ç­–ç•¥
            if (editingStrategyId !== null && editingStrategyId !== undefined) {
                // ç¼–è¾‘æ¨¡å¼ï¼šæ›´æ–°ç°æœ‰ç­–ç•¥
                // ç¡®ä¿ ID ç±»å‹ä¸€è‡´è¿›è¡Œæ¯”è¾ƒ
                const index = strategies.findIndex(s => {
                    const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                    const editId = typeof editingStrategyId === 'string' ? parseInt(editingStrategyId) : editingStrategyId;
                    return sId === editId;
                });
                
                if (index !== -1) {
                    formData.id = strategies[index].id; // ä¿æŒåŸå§‹ID
                    formData.enabled = strategies[index].enabled; // ä¿æŒåŸæœ‰å¯ç”¨çŠ¶æ€
                    formData.syncLive = strategies[index].syncLive; // ä¿æŒåŸæœ‰å®ç›˜åŒæ­¥çŠ¶æ€
                    formData.liveQuantityPct = strategies[index].liveQuantityPct; // ä¿æŒåŸæœ‰å®ç›˜ä»“ä½æ¯”ä¾‹
                    strategies[index] = formData;
                    console.log('æ›´æ–°ç­–ç•¥:', formData.name, 'ID:', formData.id);
                } else {
                    console.error('ç¼–è¾‘æ¨¡å¼ä½†æœªæ‰¾åˆ°ç­–ç•¥ï¼ŒID:', editingStrategyId);
                    showToast('æœªæ‰¾åˆ°è¦ç¼–è¾‘çš„ç­–ç•¥', 'error');
                    return;
                }
            } else {
                // æ–°å»ºæ¨¡å¼ï¼šæ·»åŠ æ–°ç­–ç•¥
                formData.id = Date.now(); // ä¸´æ—¶ID
                formData.enabled = false;
                strategies.push(formData);
            }
            
            // ä¿å­˜åˆ°æœåŠ¡å™¨
            const saved = await saveStrategiesToServer();
            if (saved) {
                // åˆ·æ–°æ˜¾ç¤º
                loadStrategies();
                closeStrategyModal(); // closeStrategyModal å·²ç»ä¼šé‡ç½®è¡¨å•çŠ¶æ€
                showToast('ç­–ç•¥ä¿å­˜æˆåŠŸï¼', 'success');
            }
        }

        // åŠ è½½ç­–ç•¥åˆ—è¡¨
        async function loadStrategies() {
            try {
                // ä»æœåŠ¡å™¨åŠ è½½ç­–ç•¥é…ç½®
                const response = await fetch('/api/futures/strategies');
                const result = await response.json();
                
                if (result.success) {
                    strategies = result.data || [];
                } else {
                    strategies = [];
                    console.error('åŠ è½½ç­–ç•¥å¤±è´¥:', result.message);
                }
            } catch (error) {
                console.error('åŠ è½½ç­–ç•¥æ—¶å‡ºé”™:', error);
                strategies = [];
                // å¦‚æœAPIå¤±è´¥ï¼Œå°è¯•ä»localStorageåŠ è½½ï¼ˆå‘åå…¼å®¹ï¼‰
                const saved = localStorage.getItem('futuresStrategies');
                if (saved) {
                    try {
                        strategies = JSON.parse(saved);
                        // å¦‚æœlocalStorageæœ‰æ•°æ®ï¼Œå°è¯•è¿ç§»åˆ°æœåŠ¡å™¨
                        saveStrategiesToServer();
                    } catch (e) {
                        strategies = [];
                    }
                }
            }
            
            const strategyList = document.getElementById('futuresStrategyList');
            const emptyState = document.getElementById('emptyState');
            
            if (strategies.length === 0) {
                strategyList.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                strategyList.innerHTML = strategies.map(strategy => `
                    <div class="strategy-item">
                        <div class="strategy-item-header">
                            <div class="strategy-item-title">
                                ${strategy.name}
                                ${strategy.strategyType === 'v3'
                                    ? '<span style="display: inline-block; margin-left: 8px; padding: 2px 8px; background: linear-gradient(135deg, #8B5CF6, #EC4899); color: white; font-size: 11px; font-weight: 600; border-radius: 4px;">V3</span>'
                                    : '<span style="display: inline-block; margin-left: 8px; padding: 2px 8px; background: var(--success-green); color: white; font-size: 11px; font-weight: 600; border-radius: 4px;">V2</span>'}
                            </div>
                            <div class="strategy-item-actions">
                                <button class="btn btn-sm btn-info" onclick="testStrategy(${strategy.id})" title="æµ‹è¯•24å°æ—¶äº¤æ˜“">
                                    <i class="bi bi-graph-up"></i> æµ‹è¯•
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="viewTestHistory(${strategy.id})" title="æŸ¥çœ‹æµ‹è¯•å†å²">
                                    <i class="bi bi-clock-history"></i> å†å²
                                </button>
                                <button class="btn btn-sm ${strategy.enabled ? 'btn-success' : 'btn-secondary'}" onclick="toggleStrategy(${strategy.id})">
                                    ${strategy.enabled ? '<i class="bi bi-pause-circle"></i> æš‚åœ' : '<i class="bi bi-play-circle"></i> å¯ç”¨'}
                                </button>
                                <button class="btn btn-sm ${strategy.syncLive ? 'btn-danger' : 'btn-outline-secondary'}" onclick="toggleSyncLive(${strategy.id})" title="${strategy.syncLive ? 'ç‚¹å‡»å…³é—­å®ç›˜åŒæ­¥' : 'ç‚¹å‡»å¯ç”¨å®ç›˜åŒæ­¥'}">
                                    <i class="bi bi-lightning-charge"></i> ${strategy.syncLive ? 'å…³é—­å®ç›˜' : 'å¯ç”¨å®ç›˜'}
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="editStrategy(${strategy.id})">
                                    <i class="bi bi-pencil"></i> ç¼–è¾‘
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteStrategy(${strategy.id})">
                                    <i class="bi bi-trash"></i> åˆ é™¤
                                </button>
                            </div>
                        </div>
                        <div class="strategy-item-body">
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">äº¤æ˜“æ–¹å‘</div>
                                <div class="strategy-item-field-value">
                                    ${Array.isArray(strategy.buyDirection) 
                                        ? strategy.buyDirection.map(dir => 
                                            `<span style="color: ${dir === 'long' ? 'var(--success-green)' : 'var(--danger-red)'}; margin-right: 8px;">
                                                ${dir === 'long' ? 'åšå¤š' : 'åšç©º'}
                                            </span>`
                                        ).join('')
                                        : (strategy.buyDirection === 'long' 
                                            ? '<span style="color: var(--success-green);">åšå¤š</span>' 
                                            : '<span style="color: var(--danger-red);">åšç©º</span>')}
                                </div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">äº¤æ˜“å€æ•°</div>
                                <div class="strategy-item-field-value">X${strategy.leverage || 5}</div>
                            </div>
                            <div class="strategy-item-field" style="grid-column: span 2; background: rgba(16, 185, 129, 0.1); padding: 8px 12px; border-radius: 6px; border-left: 3px solid #10b981;">
                                <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                    ä¿¡å·: EMA(9,26)é‡‘å‰/æ­»å‰ + MAæ–¹å‘è¿‡æ»¤ |
                                    æ­¢æŸ: ${strategy.stopLoss || 2.5}% |
                                    æ­¢ç›ˆ: ${strategy.takeProfit || 8}%ï¼ˆç§»åŠ¨æ­¢ç›ˆï¼‰
                                </div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">äº¤æ˜“å¸ç§</div>
                                <div class="strategy-item-field-value">${strategy.symbols.join(', ')}</div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">ä»“ä½å¤§å°</div>
                                <div class="strategy-item-field-value">${strategy.positionSize}%</div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æœ€å¤§æŒä»“æ•°</div>
                                <div class="strategy-item-field-value">${strategy.maxPositions || 'æœªè®¾ç½®'}</div>
                            </div>
                            ${strategy.maxLongPositions || strategy.maxShortPositions ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">åŒæ–¹å‘æŒä»“é™åˆ¶</div>
                                    <div class="strategy-item-field-value">
                                        ${strategy.maxLongPositions ? `åšå¤š: ${strategy.maxLongPositions}` : ''}
                                        ${strategy.maxLongPositions && strategy.maxShortPositions ? ', ' : ''}
                                        ${strategy.maxShortPositions ? `åšç©º: ${strategy.maxShortPositions}` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ­¢æŸ</div>
                                <div class="strategy-item-field-value">${strategy.stopLoss ? strategy.stopLoss + '%' : 'æœªè®¾ç½®'}</div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ­¢ç›ˆ</div>
                                <div class="strategy-item-field-value">${strategy.takeProfit ? strategy.takeProfit + '%' : 'æœªè®¾ç½®'}</div>
                            </div>
                            ${strategy.closeOppositeOnEntry ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">å¼€ä»“å‰å…ˆå¹³ç›¸åæ–¹å‘</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨</div>
                                </div>
                            ` : ''}
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">MA10/EMA10åŒå‘è¿‡æ»¤</div>
                                <div class="strategy-item-field-value">${strategy.ma10Ema10TrendFilter ? 'âœ… å·²å¯ç”¨' : 'âŒ æœªå¯ç”¨'}</div>
                            </div>
                            ${strategy.rsiFilter && strategy.rsiFilter.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">RSIè¿‡æ»¤</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨ (åšå¤šâ‰¤${strategy.rsiFilter.longMax || 70}, åšç©ºâ‰¥${strategy.rsiFilter.shortMin || 30})</div>
                                </div>
                            ` : ''}
                            ${strategy.rsiSignal && strategy.rsiSignal.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">ğŸ¯ RSIä¿¡å·å¼€ä»“</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨ (åšå¤šRSI<${strategy.rsiSignal.longThreshold || 30}, åšç©ºRSI>${strategy.rsiSignal.shortThreshold || 75})<br><small style="color: #9c27b0; font-size: 10px;">ğŸ’¡ ç‹¬ç«‹æœºåˆ¶ï¼ŒEMAå¼ºåº¦è¶‹åŠ¿${strategy.rsiSignal.emaStrengthTrendBars || 2}æ ¹Kçº¿</small></div>
                                </div>
                            ` : ''}
                            ${strategy.macdFilter && strategy.macdFilter.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">MACDè¿‡æ»¤</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨</div>
                                </div>
                            ` : ''}
                            ${strategy.kdjFilter && strategy.kdjFilter.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">KDJè¿‡æ»¤</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨ (åšå¤šKâ‰¤${strategy.kdjFilter.longMaxK || 80}, åšç©ºKâ‰¥${strategy.kdjFilter.shortMinK || 20})</div>
                                </div>
                            ` : ''}
                            ${strategy.sustainedTrend && strategy.sustainedTrend.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">ğŸ“‰ æŒç»­è¶‹åŠ¿ä¿¡å·</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨ (å¼ºåº¦${strategy.sustainedTrend.minStrength || 0.15}%~${strategy.sustainedTrend.maxStrength || 1.0}%, å†·å´${strategy.sustainedTrend.cooldownMinutes || 60}åˆ†é’Ÿ)<br><small style="color: #4caf50; font-size: 10px;">ğŸ’¡ é”™è¿‡ç©¿è¶Šåä»å¯åœ¨è¶‹åŠ¿ä¸­å¼€ä»“</small></div>
                                </div>
                            ` : ''}
                            ${strategy.priceDistanceLimit && strategy.priceDistanceLimit.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">ğŸ“ ä»·æ ¼è·ç¦»EMAé™åˆ¶</div>
                                    <div class="strategy-item-field-value">âœ… å·²å¯ç”¨ (åšå¤šâ‰¤+${strategy.priceDistanceLimit.maxAboveEMA || 1.0}%, åšç©ºâ‰¤-${strategy.priceDistanceLimit.maxBelowEMA || 1.0}%)<br><small style="color: #2196f3; font-size: 10px;">ğŸ’¡ é™ä»·å•ç”¨é™ä»·åˆ¤æ–­ï¼Œå¸‚ä»·å•ç”¨å®æ—¶ä»·æ ¼</small></div>
                                </div>
                            ` : ''}
                            ${strategy.minSignalStrength ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">ä¿¡å·å¼ºåº¦è¿‡æ»¤ï¼ˆæŒä»“æ—¶ï¼‰</div>
                                    <div class="strategy-item-field-value">EMA9/26: ${strategy.minSignalStrength.ema9_26 || 0}%, MA10/EMA10: ${strategy.minSignalStrength.ma10_ema10 || 0}%</div>
                                </div>
                            ` : ''}
                            ${strategy.trendConfirmBars ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">è¶‹åŠ¿ç¡®è®¤Kçº¿æ•°</div>
                                    <div class="strategy-item-field-value">${strategy.trendConfirmBars} æ ¹</div>
                                </div>
                            ` : ''}
                            ${strategy.maxPositions ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">æœ€å¤§æŒä»“æ•°</div>
                                    <div class="strategy-item-field-value">${strategy.maxPositions} ä¸ª</div>
                                </div>
                            ` : ''}
                            ${strategy.exitOnMAFlip || strategy.exitOnEMAWeak ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">è¶‹åŠ¿åè½¬é€€å‡º</div>
                                    <div class="strategy-item-field-value">
                                        ${strategy.exitOnMAFlip ? 'âœ… MA10/EMA10åè½¬' : ''}
                                        ${strategy.exitOnMAFlip && strategy.exitOnEMAWeak ? ', ' : ''}
                                        ${strategy.exitOnEMAWeak ? 'âœ… EMAä¿¡å·è¿‡å¼±' : ''}
                                    </div>
                                </div>
                            ` : ''}
                            ${strategy.preventDuplicateEntry || strategy.minHoldingTimeHours ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">é£é™©æ§åˆ¶</div>
                                    <div class="strategy-item-field-value">
                                        ${strategy.preventDuplicateEntry ? 'âœ… é˜²æ­¢é‡å¤å¼€ä»“' : ''}
                                        ${strategy.preventDuplicateEntry && strategy.minHoldingTimeHours ? ', ' : ''}
                                        ${strategy.minHoldingTimeHours ? `æœ€å°æŒä»“${strategy.minHoldingTimeHours}å°æ—¶` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            ${strategy.entryCooldown && strategy.entryCooldown.enabled ? `
                                <div class="strategy-item-field">
                                    <div class="strategy-item-field-label">å¼€ä»“å†·å´</div>
                                    <div class="strategy-item-field-value">
                                        ${strategy.entryCooldown.minutes}åˆ†é’Ÿ
                                        ${strategy.entryCooldown.perDirection ? '(æŒ‰æ–¹å‘)' : '(å…¨å±€)'}
                                    </div>
                                </div>
                            ` : ''}
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">é™ä»·å•</div>
                                <div class="strategy-item-field-value">
                                    <span style="color: ${strategy.enableLimitOrder !== false && (strategy.longPrice !== 'market' || strategy.shortPrice !== 'market') ? 'var(--success-color)' : 'var(--text-secondary)'}">
                                        ${strategy.enableLimitOrder !== false && (strategy.longPrice !== 'market' || strategy.shortPrice !== 'market') ? 'âœ“ å¯ç”¨' : 'âœ— ç¦ç”¨'}
                                    </span>
                                </div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">åšå¤šä»·æ ¼</div>
                                <div class="strategy-item-field-value">${strategy.longPrice ? getBuyPriceTypeText(strategy.longPrice) : 'æœªè®¾ç½®'}</div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">åšç©ºä»·æ ¼</div>
                                <div class="strategy-item-field-value">${strategy.shortPrice ? getBuyPriceTypeText(strategy.shortPrice) : 'æœªè®¾ç½®'}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // è·å–äº¤æ˜“æ–¹å¼æ–‡æœ¬
        function getBuyPriceTypeText(type) {
            const types = {
                'market': 'å¸‚ä»·',
                'market_minus_0_2': '-0.2%å¸‚ä»·',
                'market_minus_0_4': '-0.4%å¸‚ä»·',
                'market_minus_0_6': '-0.6%å¸‚ä»·',
                'market_minus_0_8': '-0.8%å¸‚ä»·',
                'market_minus_1': '-1%å¸‚ä»·',
                'market_minus_1_2': '-1.2%å¸‚ä»·',
                'market_minus_1_4': '-1.4%å¸‚ä»·',
                'market_plus_0_2': '+0.2%å¸‚ä»·',
                'market_plus_0_4': '+0.4%å¸‚ä»·',
                'market_plus_0_6': '+0.6%å¸‚ä»·',
                'market_plus_0_8': '+0.8%å¸‚ä»·',
                'market_plus_1': '+1%å¸‚ä»·',
                'market_plus_1_2': '+1.2%å¸‚ä»·',
                'market_plus_1_4': '+1.4%å¸‚ä»·',
                'limit': 'é™ä»·'
            };
            return types[type] || type || 'æœªè®¾ç½®';
        }

        // åˆ‡æ¢ç­–ç•¥å¯ç”¨çŠ¶æ€
        async function toggleStrategy(id) {
            // ç¡®ä¿ ID ç±»å‹ä¸€è‡´
            const strategyId = typeof id === 'string' ? parseInt(id) : id;
            const strategy = strategies.find(s => {
                const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                return sId === strategyId;
            });
            
            if (strategy) {
                strategy.enabled = !strategy.enabled;
                const saved = await saveStrategiesToServer();
                if (saved) {
                    loadStrategies();
                    
                    // å¦‚æœå¯ç”¨ç­–ç•¥ï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡
                    if (strategy.enabled) {
                        executeStrategy(strategy);
                    }
                }
            } else {
                showToast('ç­–ç•¥æœªæ‰¾åˆ°', 'error');
            }
        }

        // åˆ‡æ¢å®ç›˜åŒæ­¥çŠ¶æ€
        async function toggleSyncLive(id) {
            const strategyId = typeof id === 'string' ? parseInt(id) : id;
            const strategy = strategies.find(s => {
                const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                return sId === strategyId;
            });

            if (!strategy) {
                showToast('ç­–ç•¥æœªæ‰¾åˆ°', 'error');
                return;
            }

            const newSyncLive = !strategy.syncLive;
            const actionText = newSyncLive ? 'å¯ç”¨å®ç›˜åŒæ­¥' : 'å…³é—­å®ç›˜åŒæ­¥';

            // å¯ç”¨æ—¶æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
            if (newSyncLive) {
                const confirmed = await showConfirmDialog(
                    'ç¡®è®¤å¯ç”¨å®ç›˜åŒæ­¥',
                    `ç¡®å®šè¦ä¸ºç­–ç•¥ "${strategy.name}" ${actionText}å—ï¼Ÿ<br><br><span style="color: var(--danger-red); font-weight: bold;">âš ï¸ è­¦å‘Šï¼šå¯ç”¨åï¼Œæ¨¡æ‹Ÿäº¤æ˜“ä¿¡å·å°†åŒæ—¶åœ¨å¸å®‰å®ç›˜ä¸‹å•ï¼</span>`,
                    'danger'
                );
                if (!confirmed) return;
            }

            try {
                const response = await fetch(`/api/futures/strategies/${strategyId}/sync-live`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sync_live: newSyncLive })
                });

                const data = await response.json();
                if (data.success) {
                    strategy.syncLive = newSyncLive;
                    await loadStrategies();  // ç­‰å¾…é‡æ–°åŠ è½½ç­–ç•¥åˆ—è¡¨å®Œæˆ
                    showToast(data.message || `å·²${actionText}`, 'success');
                } else {
                    showToast(data.detail || `${actionText}å¤±è´¥`, 'error');
                }
            } catch (error) {
                console.error('åˆ‡æ¢å®ç›˜åŒæ­¥å¤±è´¥:', error);
                showToast(`${actionText}å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ‰§è¡Œç­–ç•¥
        async function executeStrategy(strategy) {
            try {
                const response = await fetch('/api/strategy/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ...strategy,
                        account_id: 2  // é»˜è®¤è´¦æˆ·ID
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log('ç­–ç•¥æ‰§è¡ŒæˆåŠŸ:', result);
                    if (result.results && result.results.length > 0) {
                        showToast(`ç­–ç•¥æ‰§è¡ŒæˆåŠŸï¼\næ‰§è¡Œäº† ${result.results.length} ä¸ªæ“ä½œ`, 'success');
                    }
                } else {
                    console.error('ç­–ç•¥æ‰§è¡Œå¤±è´¥:', result.message);
                }
            } catch (error) {
                console.error('æ‰§è¡Œç­–ç•¥æ—¶å‡ºé”™:', error);
            }
        }

        // ç¼–è¾‘ç­–ç•¥
        function editStrategy(id) {
            // ç¡®ä¿ ID ç±»å‹ä¸€è‡´ï¼ˆè½¬æ¢ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒï¼‰
            const strategyId = typeof id === 'string' ? parseInt(id) : id;
            const strategy = strategies.find(s => {
                const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                return sId === strategyId;
            });
            
            if (!strategy) {
                console.error('ç­–ç•¥æœªæ‰¾åˆ°ï¼ŒID:', id, 'ç­–ç•¥åˆ—è¡¨:', strategies);
                showToast('ç­–ç•¥æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            editingStrategyId = strategy.id; // ä½¿ç”¨ç­–ç•¥ä¸­çš„åŸå§‹ID
            console.log('ç¼–è¾‘ç­–ç•¥:', strategy.name, 'ID:', editingStrategyId);

            // å¡«å……è¡¨å•
            document.getElementById('strategyName').value = strategy.name;

            // ç­–ç•¥ç‰ˆæœ¬
            const strategyType = strategy.strategyType || 'v2';
            const strategyTypeRadio = document.querySelector(`input[name="strategyType"][value="${strategyType}"]`);
            if (strategyTypeRadio) {
                strategyTypeRadio.checked = true;
                updateStrategyTypeDescription();
            }

            // V2ç­–ç•¥å§‹ç»ˆå¯ç”¨
            toggleV2Mode();
                
            // ä¹°å…¥æ–¹å‘ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
            const buyDirections = Array.isArray(strategy.buyDirection) ? strategy.buyDirection : (strategy.buyDirection ? [strategy.buyDirection] : (strategy.direction ? [strategy.direction] : ['long']));
            buyDirections.forEach(dir => {
                const checkbox = document.querySelector(`input[name="buyDirection"][value="${dir}"]`);
                if (checkbox) checkbox.checked = true;
            });
            
            // äº¤æ˜“å€æ•°
            const leverage = strategy.leverage || 5;
            const leverageRadio = document.querySelector(`input[name="leverage"][value="${leverage}"]`);
            if (leverageRadio) leverageRadio.checked = true;
            
            // æ›´æ–°ä»·æ ¼é€‰é¡¹ï¼ˆæ ¹æ®äº¤æ˜“æ–¹å‘ï¼‰
            updatePriceOptions();
            
            // ä¹°å…¥EMAä¿¡å·ï¼ˆå•é€‰ï¼‰
            const buySignal = strategy.buySignals || (Array.isArray(strategy.signals) ? strategy.signals[0] : strategy.signals) || 'ema_15m';
            const buySignalRadio = document.querySelector(`input[name="buySignals"][value="${buySignal}"]`);
            if (buySignalRadio) buySignalRadio.checked = true;


            // æˆäº¤é‡ç›¸å…³ä»£ç å·²ç§»é™¤ï¼ˆV2ç­–ç•¥ä¸ä½¿ç”¨ï¼‰

            // å–å‡ºEMAä¿¡å·ï¼ˆå•é€‰ï¼‰
            const sellSignal = strategy.sellSignals || 'ema_5m';
            const sellSignalRadio = document.querySelector(`input[name="sellSignals"][value="${sellSignal}"]`);
            if (sellSignalRadio) sellSignalRadio.checked = true;

            // å¹³ä»“æˆäº¤é‡å·²ç§»é™¤ï¼Œä¸å†éœ€è¦å›å¡«

            document.getElementById('positionSize').value = strategy.positionSize;
            document.getElementById('maxPositions').value = strategy.maxPositions || '';
            document.getElementById('maxLongPositions').value = strategy.maxLongPositions || '';
            document.getElementById('maxShortPositions').value = strategy.maxShortPositions || '';
            
            // æ­¢æŸæ­¢ç›ˆ
            document.getElementById('stopLoss').value = strategy.stopLoss || '';
            document.getElementById('maxHoldingHours').value = strategy.maxHoldingHours || '';
            document.getElementById('takeProfit').value = strategy.takeProfit || '';

            // ç§»åŠ¨æ­¢ç›ˆ
            document.getElementById('trailingActivate').value = strategy.trailingActivate || 1.5;
            document.getElementById('trailingCallback').value = strategy.trailingCallback || 0.5;
            document.getElementById('trailingCooldownMinutes').value = strategy.trailingCooldownMinutes || 15;

            // V2ç­–ç•¥ä½¿ç”¨å›ºå®šå‚æ•°ï¼ŒMA10/EMA10è¿‡æ»¤ã€ä¿¡å·å¼ºåº¦è¿‡æ»¤ã€è¶‹åŠ¿ç¡®è®¤ã€é€€å‡ºæœºåˆ¶ç­‰å·²ç§»é™¤

            // å¼€ä»“å†·å´é…ç½®
            if (strategy.entryCooldown) {
                if (document.getElementById('entryCooldownEnabled')) {
                    document.getElementById('entryCooldownEnabled').checked = strategy.entryCooldown.enabled !== false;
                }
                if (document.getElementById('entryCooldownMinutes')) {
                    document.getElementById('entryCooldownMinutes').value = strategy.entryCooldown.minutes || 30;
                }
                if (document.getElementById('entryCooldownMaxPositionsPerDirection')) {
                    document.getElementById('entryCooldownMaxPositionsPerDirection').value = strategy.entryCooldown.maxPositionsPerDirection || 1;
                }
            }

            // é£é™©æ§åˆ¶ - å¼€ä»“å‰å¹³åå‘æŒä»“
            if (document.getElementById('closeOppositeOnEntry')) {
                document.getElementById('closeOppositeOnEntry').checked = strategy.closeOppositeOnEntry === true;
            }

            // åè½¬é¢„è­¦é…ç½®
            if (strategy.reversalWarning) {
                const rw = strategy.reversalWarning;
                if (document.getElementById('reversalWarningEnabled')) {
                    document.getElementById('reversalWarningEnabled').checked = rw.enabled !== false;
                }
                if (document.getElementById('reversalSlopeThreshold')) {
                    document.getElementById('reversalSlopeThreshold').value = rw.slopeChangeThreshold || 0.05;
                }
                if (document.getElementById('reversalShrinkThreshold')) {
                    document.getElementById('reversalShrinkThreshold').value = rw.diffShrinkThreshold || 30;
                }
                if (document.getElementById('reversalCooldownMinutes')) {
                    document.getElementById('reversalCooldownMinutes').value = rw.cooldownMinutes || 30;
                }
            }

            // å¾…å¼€ä»“è‡ªæ£€é…ç½®
            if (strategy.pendingValidation) {
                const pv = strategy.pendingValidation;
                if (document.getElementById('pendingValidationEnabled')) {
                    document.getElementById('pendingValidationEnabled').checked = pv.enabled !== false;
                }
                if (document.getElementById('pendingExpireSeconds')) {
                    document.getElementById('pendingExpireSeconds').value = pv.expire_seconds || 300;
                }
                if (document.getElementById('pendingCheckInterval')) {
                    document.getElementById('pendingCheckInterval').value = pv.check_interval || 10;
                }
                if (document.getElementById('pendingMaxPriceDiff')) {
                    document.getElementById('pendingMaxPriceDiff').value = pv.max_price_diff || 0.5;
                }
                // å·²ç§»é™¤ require_ema_confirm, require_ma_confirm, check_ranging çš„åŠ è½½
                // è¿™äº›æ£€æŸ¥å·²è¢«ç§»é™¤ï¼Œé™ä»·å•æ˜¯å›è°ƒå…¥åœºç­–ç•¥
                if (document.getElementById('pendingCheckTrendEnd')) {
                    document.getElementById('pendingCheckTrendEnd').checked = pv.check_trend_end !== false;
                }
                if (document.getElementById('pendingTrendEndThreshold')) {
                    document.getElementById('pendingTrendEndThreshold').value = pv.trend_end_shrink_threshold || 0.5;
                }
                if (document.getElementById('pendingCheckEmaConverging')) {
                    document.getElementById('pendingCheckEmaConverging').checked = pv.check_ema_converging !== false;
                }
                if (document.getElementById('pendingMinEmaDiffPct')) {
                    document.getElementById('pendingMinEmaDiffPct').value = pv.min_ema_diff_pct || 0.05;
                }
            }

            // å¹³ä»“å†·å´é…ç½®
            if (strategy.closeReopenCooldownMinutes !== undefined && document.getElementById('closeReopenCooldownMinutes')) {
                document.getElementById('closeReopenCooldownMinutes').value = strategy.closeReopenCooldownMinutes || 15;
            }
            if (strategy.closeReopenSameDirectionOnly !== undefined && document.getElementById('closeReopenSameDirectionOnly')) {
                document.getElementById('closeReopenSameDirectionOnly').checked = strategy.closeReopenSameDirectionOnly === true;
            }

            // æŠ€æœ¯æŒ‡æ ‡è¿‡æ»¤å™¨
            if (strategy.rsiFilter) {
                if (document.getElementById('rsiFilterEnabled')) {
                    document.getElementById('rsiFilterEnabled').checked = strategy.rsiFilter.enabled === true;
                    document.getElementById('rsiLongMax').value = strategy.rsiFilter.longMax || 70;
                    document.getElementById('rsiShortMin').value = strategy.rsiFilter.shortMin || 30;
                }
            }
            if (strategy.rsiSignal) {
                if (document.getElementById('rsiSignalEnabled')) {
                    document.getElementById('rsiSignalEnabled').checked = strategy.rsiSignal.enabled === true;
                    document.getElementById('rsiSignalLongThreshold').value = strategy.rsiSignal.longThreshold || 30;
                    document.getElementById('rsiSignalShortThreshold').value = strategy.rsiSignal.shortThreshold || 75;
                    document.getElementById('rsiSignalMinEmaStrengthLong').value = strategy.rsiSignal.minEmaStrengthLong || 0.15;
                    document.getElementById('rsiSignalMaxEmaStrengthShort').value = strategy.rsiSignal.maxEmaStrengthShort || 1.0;
                    document.getElementById('rsiSignalEmaStrengthTrendBars').value = strategy.rsiSignal.emaStrengthTrendBars || 2;
                }
            }
            if (strategy.macdFilter) {
                if (document.getElementById('macdFilterEnabled')) {
                    document.getElementById('macdFilterEnabled').checked = strategy.macdFilter.enabled === true;
                    document.getElementById('macdLongRequirePositive').checked = strategy.macdFilter.longRequirePositive !== false;
                    document.getElementById('macdShortRequireNegative').checked = strategy.macdFilter.shortRequireNegative !== false;
                }
            }
            if (strategy.kdjFilter) {
                if (document.getElementById('kdjFilterEnabled')) {
                    document.getElementById('kdjFilterEnabled').checked = strategy.kdjFilter.enabled === true;
                    document.getElementById('kdjLongMaxK').value = strategy.kdjFilter.longMaxK || 80;
                    document.getElementById('kdjShortMinK').value = strategy.kdjFilter.shortMinK || 20;
                }
            }
            // æŒç»­è¶‹åŠ¿ä¿¡å·é…ç½®
            if (strategy.sustainedTrend) {
                if (document.getElementById('sustainedTrendEnabled')) {
                    document.getElementById('sustainedTrendEnabled').checked = strategy.sustainedTrend.enabled === true;
                    document.getElementById('sustainedTrendMinStrength').value = strategy.sustainedTrend.minStrength || 0.15;
                    document.getElementById('sustainedTrendMaxStrength').value = strategy.sustainedTrend.maxStrength || 1.0;
                    document.getElementById('sustainedTrendMinBars').value = strategy.sustainedTrend.minBars || 2;
                    document.getElementById('sustainedTrendCooldownMinutes').value = strategy.sustainedTrend.cooldownMinutes || 60;
                    document.getElementById('sustainedTrendRequireMA10Confirm').checked = strategy.sustainedTrend.requireMA10Confirm !== false;
                    document.getElementById('sustainedTrendRequirePriceConfirm').checked = strategy.sustainedTrend.requirePriceConfirm !== false;
                }
            }
            // ä»·æ ¼è·ç¦»EMAé™åˆ¶é…ç½®
            if (strategy.priceDistanceLimit) {
                if (document.getElementById('priceDistanceLimitEnabled')) {
                    document.getElementById('priceDistanceLimitEnabled').checked = strategy.priceDistanceLimit.enabled === true;
                    document.getElementById('priceDistanceMaxAboveEMA').value = strategy.priceDistanceLimit.maxAboveEMA || 1.0;
                    document.getElementById('priceDistanceMaxBelowEMA').value = strategy.priceDistanceLimit.maxBelowEMA || 1.0;
                }
            }

            // æ™ºèƒ½å‡ºåœºé…ç½®
            // EMAå·®å€¼æ­¢ç›ˆ
            if (strategy.emaDiffTakeProfit) {
                if (document.getElementById('emaDiffTakeProfitEnabled')) {
                    document.getElementById('emaDiffTakeProfitEnabled').checked = strategy.emaDiffTakeProfit.enabled === true;
                    document.getElementById('emaDiffTakeProfitThreshold').value = strategy.emaDiffTakeProfit.threshold || 0.5;
                    document.getElementById('emaDiffTakeProfitMinProfit').value = strategy.emaDiffTakeProfit.minProfitPct || 0.3;
                    toggleEmaDiffTakeProfitParams();
                }
            }

            // æ™ºèƒ½æ­¢æŸé…ç½®
            if (strategy.smartStopLoss) {
                // ATRåŠ¨æ€æ­¢æŸ
                if (strategy.smartStopLoss.atrStopLoss && document.getElementById('atrStopLossEnabled')) {
                    document.getElementById('atrStopLossEnabled').checked = strategy.smartStopLoss.atrStopLoss.enabled === true;
                    document.getElementById('atrStopLossMultiplier').value = strategy.smartStopLoss.atrStopLoss.multiplier || 2.0;
                    document.getElementById('atrStopLossMinPct').value = strategy.smartStopLoss.atrStopLoss.minPct || 0.5;
                    document.getElementById('atrStopLossMaxPct').value = strategy.smartStopLoss.atrStopLoss.maxPct || 5.0;
                    toggleAtrStopLossParams();
                }
                // ç§»åŠ¨æ­¢æŸï¼ˆè¿½è¸ªæ­¢æŸï¼‰
                if (strategy.smartStopLoss.trailingStopLoss && document.getElementById('trailingStopLossEnabled')) {
                    document.getElementById('trailingStopLossEnabled').checked = strategy.smartStopLoss.trailingStopLoss.enabled === true;
                    document.getElementById('trailingStopLossActivatePct').value = strategy.smartStopLoss.trailingStopLoss.activatePct || 0.5;
                    document.getElementById('trailingStopLossDistancePct').value = strategy.smartStopLoss.trailingStopLoss.distancePct || 1.0;
                    toggleTrailingStopLossParams();
                }
                // æ—¶é—´è¡°å‡æ­¢æŸ
                if (strategy.smartStopLoss.timeDecayStopLoss && document.getElementById('timeDecayStopLossEnabled')) {
                    document.getElementById('timeDecayStopLossEnabled').checked = strategy.smartStopLoss.timeDecayStopLoss.enabled === true;
                    document.getElementById('timeDecayInitialPct').value = strategy.smartStopLoss.timeDecayStopLoss.initialPct || 3.0;
                    document.getElementById('timeDecayFinalPct').value = strategy.smartStopLoss.timeDecayStopLoss.finalPct || 1.0;
                    document.getElementById('timeDecayHours').value = strategy.smartStopLoss.timeDecayStopLoss.decayHours || 24;
                    toggleTimeDecayStopLossParams();
                }
                // EMAæ”¯æ’‘æ­¢æŸ
                if (strategy.smartStopLoss.emaSupportStopLoss && document.getElementById('emaSupportStopLossEnabled')) {
                    document.getElementById('emaSupportStopLossEnabled').checked = strategy.smartStopLoss.emaSupportStopLoss.enabled === true;
                    document.getElementById('emaSupportBufferPct').value = strategy.smartStopLoss.emaSupportStopLoss.bufferPct || 0.3;
                    document.getElementById('emaSupportMinProfitPct').value = strategy.smartStopLoss.emaSupportStopLoss.minProfitPct || 0.0;
                    toggleEmaSupportStopLossParams();
                }
                // 5Mä¿¡å·æ­¢æŸ
                if (document.getElementById('signalStopLossEnabled')) {
                    const signalConfig = strategy.smartStopLoss.signalStopLoss || {};
                    document.getElementById('signalStopLossEnabled').checked = signalConfig.enabled !== false; // é»˜è®¤å¯ç”¨
                    document.getElementById('signalStopLossMinDiff').value = signalConfig.minEmaDiffPct || 0.15;
                    toggleSignalStopLossParams();
                }
            }

            // è¶‹åŠ¿å‡å¼±å¹³ä»“é…ç½®
            if (strategy.trendWeakeningExit && document.getElementById('trendWeakeningExitEnabled')) {
                document.getElementById('trendWeakeningExitEnabled').checked = strategy.trendWeakeningExit.enabled !== false; // é»˜è®¤å¯ç”¨
                document.getElementById('trendWeakeningEmaDiffThreshold').value = strategy.trendWeakeningExit.emaDiffThreshold || 0.5;
                document.getElementById('trendWeakeningMinProfitPct').value = strategy.trendWeakeningExit.minProfitPct || 1.0;
                toggleTrendWeakeningParams();
            }

            // è¡Œæƒ…è‡ªé€‚åº”é…ç½®
            if (document.getElementById('adaptiveRegimeEnabled')) {
                document.getElementById('adaptiveRegimeEnabled').checked = strategy.adaptiveRegime === true;
                toggleAdaptiveRegimeConfig();

                // åŠ è½½è¡Œæƒ…å‚æ•°
                if (strategy.regimeParams) {
                    setRegimeParams(strategy.regimeParams);
                } else {
                    // å¦‚æœæ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼
                    resetRegimeParams();
                }
            }

            // é™ä»·å•å¼€å…³
            const enableLimitOrderCheckbox = document.getElementById('enableLimitOrder');
            if (enableLimitOrderCheckbox) {
                // åˆ¤æ–­æ˜¯å¦å¯ç”¨é™ä»·å•ï¼šå¦‚æœä»·æ ¼ä¸æ˜¯marketï¼Œåˆ™å¯ç”¨
                const hasLimitPrice = (strategy.longPrice && strategy.longPrice !== 'market') ||
                                     (strategy.shortPrice && strategy.shortPrice !== 'market');
                enableLimitOrderCheckbox.checked = strategy.enableLimitOrder !== undefined ? strategy.enableLimitOrder : hasLimitPrice;
                toggleLimitOrderOptions();
            }

            // åšå¤šä»·æ ¼
            if (strategy.longPrice) {
                const longPriceRadio = document.querySelector(`input[name="longPrice"][value="${strategy.longPrice}"]`);
                if (longPriceRadio) longPriceRadio.checked = true;
            }

            // åšç©ºä»·æ ¼
            if (strategy.shortPrice) {
                const shortPriceRadio = document.querySelector(`input[name="shortPrice"][value="${strategy.shortPrice}"]`);
                if (shortPriceRadio) shortPriceRadio.checked = true;
            }

            // é™ä»·å•è¶…æ—¶
            if (document.getElementById('limitOrderTimeoutMinutes')) {
                document.getElementById('limitOrderTimeoutMinutes').value = strategy.limitOrderTimeoutMinutes || '';
            }

            // é™ä»·å•æœ€å¤§åç¦»
            if (document.getElementById('limitOrderMaxDeviation')) {
                document.getElementById('limitOrderMaxDeviation').value = strategy.limitOrderMaxDeviation || '';
            }

            // é‡‘å‰/æ­»å‰å¼ºåˆ¶å¸‚ä»·å•
            if (document.getElementById('crossSignalForceMarket')) {
                document.getElementById('crossSignalForceMarket').checked = strategy.crossSignalForceMarket !== false;
            }


            // åå‘æ“ä½œç­–ç•¥é…ç½® âš¡ æ–°å¢
            if (strategy.contrarianEnabled) {
                const contrarianEnabled = document.getElementById('contrarianEnabled');
                if (contrarianEnabled) {
                    contrarianEnabled.checked = true;
                    toggleContrarianConfig();
                }
            }

            // å¸‚åœºç¯å¢ƒæ¨¡å¼
            if (strategy.marketRegime) {
                const marketRegimeRadio = document.querySelector(
                    `input[name="marketRegime"][value="${strategy.marketRegime}"]`
                );
                if (marketRegimeRadio) {
                    marketRegimeRadio.checked = true;
                    toggleMarketDetectionConfig();
                }
            }

            // å¸‚åœºæ£€æµ‹å‚æ•°
            if (strategy.marketDetection) {
                const lookbackHours = document.getElementById('lookbackHours');
                const minTrades = document.getElementById('minTrades');
                if (lookbackHours) lookbackHours.value = strategy.marketDetection.lookbackHours || 24;
                if (minTrades) minTrades.value = strategy.marketDetection.minTrades || 10;
            }

            // åå‘æ“ä½œé£é™©å‚æ•°
            if (strategy.contrarianRisk) {
                const stopLoss = document.getElementById('contrarianStopLoss');
                const takeProfit = document.getElementById('contrarianTakeProfit');
                const limitOffset = document.getElementById('contrarianLimitOffset');

                if (stopLoss) stopLoss.value = strategy.contrarianRisk.stopLoss || 1.5;
                if (takeProfit) takeProfit.value = strategy.contrarianRisk.takeProfit || 1.0;
                if (limitOffset) limitOffset.value = strategy.contrarianRisk.limitOrderOffset || 0.5;
            }

            // æ˜¾ç¤ºModalè¡¨å•
            showAddStrategyModal();
            
            // æ›´æ–°å¸ç§é€‰æ‹©
            loadAvailableSymbols().then(() => {
                // æ¸…é™¤æ‰€æœ‰å¸ç§é€‰æ‹©
                document.querySelectorAll('input[name="symbols"]').forEach(cb => cb.checked = false);
                // é€‰ä¸­ç­–ç•¥ä¸­çš„å¸ç§
                if (strategy.symbols && Array.isArray(strategy.symbols)) {
                    strategy.symbols.forEach(symbol => {
                        const checkbox = document.getElementById(`symbol_${symbol.replace('/', '_')}`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            });
        }

        // æ˜¾ç¤ºè‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
        function showConfirmDialog(title, message, type = 'warning') {
            return new Promise((resolve) => {
                const overlay = document.createElement('div');
                overlay.className = 'confirm-modal-overlay';
                
                const iconConfig = {
                    'warning': { icon: 'exclamation-triangle-fill', color: 'var(--warning-yellow)', bg: 'rgba(245, 158, 11, 0.2)', border: 'rgba(245, 158, 11, 0.3)' },
                    'danger': { icon: 'x-circle-fill', color: 'var(--danger-red)', bg: 'rgba(239, 68, 68, 0.2)', border: 'rgba(239, 68, 68, 0.3)' },
                    'info': { icon: 'info-circle-fill', color: 'var(--info-blue)', bg: 'rgba(59, 130, 246, 0.2)', border: 'rgba(59, 130, 246, 0.3)' }
                };
                const config = iconConfig[type] || iconConfig['warning'];
                
                overlay.innerHTML = `
                    <div class="confirm-modal-dialog">
                        <div class="confirm-modal-header">
                            <div class="confirm-modal-title">
                                <div class="confirm-modal-icon" style="background: linear-gradient(135deg, ${config.bg} 0%, ${config.bg.replace('0.2', '0.1')} 100%); border: 2px solid ${config.border};">
                                    <i class="bi bi-${config.icon}" style="font-size: 24px; color: ${config.color};"></i>
                                </div>
                                <span>${title}</span>
                            </div>
                        </div>
                        <div class="confirm-modal-body">
                            ${message}
                        </div>
                        <div class="confirm-modal-footer">
                            <button class="btn btn-secondary" id="modal-cancel-btn" style="min-width: 100px;">
                                <i class="bi bi-x-circle"></i> å–æ¶ˆ
                            </button>
                            <button class="btn btn-danger" id="modal-confirm-btn" style="min-width: 100px;">
                                <i class="bi bi-check-circle"></i> ç¡®å®š
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                const cancelBtn = overlay.querySelector('#modal-cancel-btn');
                const confirmBtn = overlay.querySelector('#modal-confirm-btn');
                const dialog = overlay.querySelector('.confirm-modal-dialog');
                
                const closeModal = (result) => {
                    dialog.style.animation = 'slideUpModal 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) reverse';
                    overlay.style.animation = 'fadeIn 0.2s ease-out reverse';
                    setTimeout(() => {
                        overlay.remove();
                        resolve(result);
                    }, 300);
                };
                
                cancelBtn.addEventListener('click', () => closeModal(false));
                confirmBtn.addEventListener('click', () => closeModal(true));
                
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        closeModal(false);
                    }
                });
                
                // ESCé”®å…³é—­
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        closeModal(false);
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);
            });
        }

        // åˆ é™¤ç­–ç•¥
        async function deleteStrategy(id) {
            // ç¡®ä¿ ID ç±»å‹ä¸€è‡´
            const strategyId = typeof id === 'string' ? parseInt(id) : id;
            const strategy = strategies.find(s => {
                const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                return sId === strategyId;
            });
            
            if (!strategy) {
                showToast('ç­–ç•¥æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
            const confirmed = await showConfirmDialog(
                'åˆ é™¤ç­–ç•¥',
                `ç¡®å®šè¦åˆ é™¤ç­–ç•¥ <strong style="color: var(--text-primary);">"${strategy.name}"</strong> å—ï¼Ÿ<br><br>æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œã€‚`,
                'danger'
            );
            
            if (!confirmed) {
                return;
            }
            
            try {
                // ç›´æ¥è°ƒç”¨ DELETE API åˆ é™¤ç­–ç•¥
                const response = await fetch(`/api/futures/strategies/${strategyId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ä»å‰ç«¯æ•°ç»„ä¸­ç§»é™¤
                    strategies = strategies.filter(s => {
                        const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                        return sId !== strategyId;
                    });
                    
                    // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æ­£åœ¨ç¼–è¾‘çš„ç­–ç•¥ï¼Œé‡ç½®ç¼–è¾‘çŠ¶æ€
                    if (editingStrategyId === strategyId) {
                        editingStrategyId = null;
                    }
                    
                    // é‡æ–°åŠ è½½ç­–ç•¥åˆ—è¡¨
                    loadStrategies();
                    showToast(`ç­–ç•¥ "${strategy.name}" å·²åˆ é™¤`, 'success');
                } else {
                    showToast(result.message || 'åˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                console.error('åˆ é™¤ç­–ç•¥å¤±è´¥:', error);
                showToast('åˆ é™¤ç­–ç•¥å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'), 'error');
            }
        }

        // æµ‹è¯•ç­–ç•¥ï¼ˆ24å°æ—¶å›æµ‹ï¼‰
        async function testStrategy(id) {
            // ç¡®ä¿ ID ç±»å‹ä¸€è‡´
            const strategyId = typeof id === 'string' ? parseInt(id) : id;
            const strategy = strategies.find(s => {
                const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                return sId === strategyId;
            });
            
            if (!strategy) {
                showToast('ç­–ç•¥ä¸å­˜åœ¨', 'error');
                return;
            }
            
            if (!strategy.symbols || strategy.symbols.length === 0) {
                showToast('ç­–ç•¥æœªé…ç½®äº¤æ˜“å¸ç§ï¼Œæ— æ³•æµ‹è¯•', 'warning');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½æç¤ºï¼ˆä¼˜åŒ–ç‰ˆï¼‰
            const loadingModal = document.createElement('div');
            loadingModal.id = 'testLoadingModal';
            loadingModal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(13, 17, 23, 0.85); backdrop-filter: blur(4px); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            loadingModal.innerHTML = `
                <div style="background: var(--bg-card, #1C2128); border: 1px solid var(--border-default, #30363D); border-radius: 16px; padding: 40px 50px; text-align: center; max-width: 500px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); animation: fadeIn 0.3s ease-out;">
                    <div style="margin-bottom: 24px; position: relative; display: inline-block;">
                        <div id="testSpinner" style="width: 48px; height: 48px; border: 4px solid rgba(43, 111, 237, 0.2); border-top-color: var(--primary-blue, #2B6FED); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto;">
                        </div>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 32px; height: 32px; border: 3px solid rgba(43, 111, 237, 0.1); border-top-color: var(--primary-blue, #2B6FED); border-radius: 50%; animation: spin 0.6s linear infinite reverse;">
                        </div>
                    </div>
                    <h3 style="color: var(--text-primary, #E6EDF3); font-size: 18px; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="bi bi-graph-up-arrow" style="color: var(--primary-blue, #2B6FED);"></i>
                        æ­£åœ¨æµ‹è¯•ç­–ç•¥
                    </h3>
                    <p style="color: var(--text-secondary, #8B949E); font-size: 14px; margin-bottom: 20px; font-weight: 500;">${strategy.name || 'ç­–ç•¥æµ‹è¯•'}</p>
                    <div style="background: var(--bg-tertiary, #21262D); border-radius: 8px; padding: 14px; margin-top: 20px; border: 1px solid var(--border-default, #30363D);">
                        <div style="color: var(--text-secondary, #8B949E); font-size: 12px; margin-bottom: 6px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                            <i class="bi bi-calendar-range" style="font-size: 14px;"></i>
                            æµ‹è¯•æ—¶é—´èŒƒå›´
                        </div>
                        <div style="color: var(--text-primary, #E6EDF3); font-size: 14px; font-weight: 600;">æœ€è¿‘24å°æ—¶æ•°æ®</div>
                    </div>
                    <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-default, #30363D);">
                        <div style="color: var(--text-tertiary, #6E7681); font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                            <i class="bi bi-hourglass-split" style="font-size: 14px; animation: pulse 2s ease-in-out infinite;"></i>
                            <span>æ­£åœ¨è®¡ç®—æŠ€æœ¯æŒ‡æ ‡å’Œæ¨¡æ‹Ÿäº¤æ˜“...</span>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                    @keyframes fadeIn {
                        from { opacity: 0; transform: scale(0.95); }
                        to { opacity: 1; transform: scale(1); }
                    }
                    @keyframes pulse {
                        0%, 100% { opacity: 0.6; }
                        50% { opacity: 1; }
                    }
            
        /* å¼€å…³æŒ‰é’®æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: .4s;
            border: 1px solid var(--border-default);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .slider.round {
            border-radius: 24px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
        
    </style>
            `;
            document.body.appendChild(loadingModal);
            
            try {
                const response = await fetch('/api/strategy/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(strategy)
                });
                
                const result = await response.json();
                
                // ç§»é™¤åŠ è½½æ¨¡æ€æ¡†
                if (document.body.contains(loadingModal)) {
                    document.body.removeChild(loadingModal);
                }
                
                if (!result.success) {
                    showToast('æµ‹è¯•å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                    return;
                }
                
                // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
                showTestResults(strategy.name, result.data);
                
            } catch (error) {
                // ç§»é™¤åŠ è½½æ¨¡æ€æ¡†
                if (document.body.contains(loadingModal)) {
                    document.body.removeChild(loadingModal);
                }
                console.error('æµ‹è¯•ç­–ç•¥å¤±è´¥:', error);
                showToast('æµ‹è¯•å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResults(strategyName, results) {
            // å¦‚æœå·²å­˜åœ¨æ¨¡æ€æ¡†ï¼Œå…ˆç§»é™¤
            const existingModal = document.getElementById('testResultsModal');
            if (existingModal) {
                document.body.removeChild(existingModal);
            }
            
            const modal = document.createElement('div');
            modal.id = 'testResultsModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: flex-start; justify-content: center; padding: 20px; overflow-y: auto;';
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.onclick = function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            let resultsHtml = results.map(result => {
                if (result.error) {
                    return `
                        <div style="margin-bottom: 24px; padding: 20px; background: #fff3cd; border-radius: 10px; border-left: 5px solid #ffc107; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h5 style="color: #856404; margin: 0 0 12px 0; font-size: 18px; font-weight: 600;">${result.symbol}</h5>
                            <p style="color: #856404; margin: 0; font-size: 15px; line-height: 1.6;">${result.error}</p>
                        </div>
                    `;
                }
                
                const pnlClass = result.total_pnl >= 0 ? 'text-success' : 'text-danger';
                const pnlIcon = result.total_pnl >= 0 ? 'â–²' : 'â–¼';
                
                // ç»Ÿè®¡æ•°æ®
                const buyCount = result.trades ? result.trades.filter(t => t.type === 'BUY').length : 0;
                const sellCount = result.trades ? result.trades.filter(t => t.type === 'SELL').length : 0;
                // ç»Ÿè®¡ç›ˆäºï¼šåªç»Ÿè®¡å¹³ä»“äº¤æ˜“ï¼ˆSELLç±»å‹ï¼‰
                const sellTrades = result.trades ? result.trades.filter(t => t.type === 'SELL') : [];
                const winTrades = sellTrades.filter(t => t.pnl > 0).length;
                const lossTrades = sellTrades.filter(t => t.pnl < 0).length;
                const breakEvenTrades = sellTrades.filter(t => t.pnl === 0 || (t.pnl !== undefined && Math.abs(t.pnl) < 0.01)).length;
                const winRate = (winTrades + lossTrades) > 0 ? ((winTrades / (winTrades + lossTrades)) * 100).toFixed(1) : '0.0';
                
                // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥æ˜¯å¦æœ‰pnlä¸º0æˆ–æœªå®šä¹‰çš„æƒ…å†µ
                if (sellTrades.length > 0) {
                    const pnlValues = sellTrades.map(t => t.pnl).filter(p => p !== undefined);
                    const hasZeroPnl = sellTrades.some(t => t.pnl === 0 || (t.pnl !== undefined && Math.abs(t.pnl) < 0.01));
                    const hasUndefinedPnl = sellTrades.some(t => t.pnl === undefined || t.pnl === null);
                    console.log('å¹³ä»“äº¤æ˜“ç»Ÿè®¡:', {
                        total: sellTrades.length,
                        win: winTrades,
                        loss: lossTrades,
                        breakEven: breakEvenTrades,
                        hasZeroPnl: hasZeroPnl,
                        hasUndefinedPnl: hasUndefinedPnl,
                        pnlValues: pnlValues.slice(0, 5) // åªæ˜¾ç¤ºå‰5ä¸ª
                    });
                }
                
                let tradesHtml = '';
                if (result.trades && result.trades.length > 0) {
                    tradesHtml = `
                        <div style="margin-top: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 2px solid #dee2e6;">
                                <h6 style="margin: 0; font-size: 16px; font-weight: 600; color: #212529;">äº¤æ˜“è®°å½• (å…± ${result.trades.length} ç¬”)</h6>
                                <div style="font-size: 14px; font-weight: 500;">
                                    <span style="color: #28a745; margin-right: 12px; font-weight: 600;">ä¹°å…¥: ${buyCount}</span>
                                    <span style="color: #dc3545; margin-right: 12px; font-weight: 600;">å¹³ä»“: ${sellCount}</span>
                                    <span style="color: ${parseFloat(winRate) >= 50 ? '#28a745' : '#dc3545'}; font-weight: 600;">èƒœç‡: ${winRate}%</span>
                                </div>
                            </div>
                            <div style="max-height: 500px; overflow-y: auto; overflow-x: auto; border: 1px solid #dee2e6; border-radius: 8px; background: white; box-shadow: inset 0 2px 4px rgba(0,0,0,0.06);">
                                <table class="table table-sm table-hover" style="font-size: 13px; margin: 0; min-width: 100%; background: transparent;">
                                    <thead style="position: sticky; top: 0; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); z-index: 10; border-bottom: 2px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                        <tr>
                                            <th style="padding: 14px 12px; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">æ—¶é—´</th>
                                            <th style="padding: 14px 12px; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">ç±»å‹</th>
                                            <th style="padding: 14px 12px; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">æ–¹å‘</th>
                                            <th style="padding: 14px 12px; text-align: right; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">ä»·æ ¼</th>
                                            <th style="padding: 14px 12px; text-align: right; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">æ•°é‡</th>
                                            <th style="padding: 14px 12px; text-align: right; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">ç›ˆäº</th>
                                            <th style="padding: 14px 12px; text-align: right; font-weight: 600; color: #212529; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;">ä½™é¢</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${result.trades.map((trade, idx) => `
                                            <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.15s ease; background: ${idx % 2 === 0 ? 'white' : '#f8f9fa'};" onmouseover="this.style.backgroundColor='#e9ecef'" onmouseout="this.style.backgroundColor='${idx % 2 === 0 ? 'white' : '#f8f9fa'}'">
                                                <td style="padding: 14px 12px; white-space: nowrap; color: #212529; font-size: 13px; font-weight: 500;">${(() => {
                                                    // å¤„ç†æ—¶é—´æ˜¾ç¤ºï¼šå¦‚æœå·²ç»æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼ˆYYYY-MM-DD HH:MM:SSï¼‰ï¼Œç›´æ¥æ˜¾ç¤º
                                                    // å¦‚æœæ˜¯ISOæ ¼å¼æˆ–å…¶ä»–æ ¼å¼ï¼Œè½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´æ˜¾ç¤º
                                                    if (typeof trade.time === 'string') {
                                                        // å¦‚æœæ˜¯ 'YYYY-MM-DD HH:MM:SS' æ ¼å¼ï¼Œç›´æ¥æ˜¾ç¤º
                                                        if (/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(trade.time)) {
                                                            return trade.time;
                                                        }
                                                        // å¦‚æœæ˜¯ISOæ ¼å¼ï¼Œè½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´
                                                        const date = new Date(trade.time);
                                                        if (!isNaN(date.getTime())) {
                                                            return date.toLocaleString('zh-CN', {
                                                                year: 'numeric',
                                                                month: '2-digit',
                                                                day: '2-digit',
                                                                hour: '2-digit',
                                                                minute: '2-digit',
                                                                second: '2-digit',
                                                                timeZone: 'Asia/Shanghai'
                                                            });
                                                        }
                                                        return trade.time;
                                                    }
                                                    // å¦‚æœæ˜¯Dateå¯¹è±¡æˆ–å…¶ä»–æ ¼å¼
                                                    const date = new Date(trade.time);
                                                    if (!isNaN(date.getTime())) {
                                                        return date.toLocaleString('zh-CN', {
                                                            year: 'numeric',
                                                            month: '2-digit',
                                                            day: '2-digit',
                                                            hour: '2-digit',
                                                            minute: '2-digit',
                                                            second: '2-digit',
                                                            timeZone: 'Asia/Shanghai'
                                                        });
                                                    }
                                                    return trade.time || '-';
                                                })()}</td>
                                                <td style="padding: 14px 12px;">
                                                    <span class="badge ${trade.type === 'BUY' ? 'bg-success' : 'bg-danger'}" style="font-size: 11px; padding: 5px 10px; font-weight: 600; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; background: ${trade.type === 'BUY' ? '#28a745' : '#dc3545'}; color: white; border: none;">
                                                        ${trade.type === 'BUY' ? 'ä¹°å…¥' : 'å¹³ä»“'}
                                                    </span>
                                                </td>
                                                <td style="padding: 14px 12px;">
                                                    <span style="color: ${trade.direction === 'long' ? '#28a745' : '#dc3545'}; font-weight: 600; font-size: 13px; padding: 4px 8px; background: ${trade.direction === 'long' ? '#d4edda' : '#f8d7da'}; border-radius: 4px; border: 1px solid ${trade.direction === 'long' ? '#c3e6cb' : '#f5c6cb'};">
                                                        ${trade.direction === 'long' ? 'åšå¤š' : 'åšç©º'}
                                                    </span>
                                                </td>
                                                <td style="padding: 14px 12px; text-align: right; font-family: 'Courier New', 'Consolas', monospace; color: #212529; font-size: 13px; font-weight: 600;">${trade.price.toFixed(4)}</td>
                                                <td style="padding: 14px 12px; text-align: right; font-family: 'Courier New', 'Consolas', monospace; color: #212529; font-size: 13px; font-weight: 600;">${trade.quantity.toFixed(4)}</td>
                                                <td style="padding: 14px 12px; text-align: right; font-family: 'Courier New', 'Consolas', monospace; font-weight: 700; font-size: 13px;">
                                                    ${trade.pnl !== undefined && trade.pnl !== null ? `
                                                        <div style="line-height: 1.4;">
                                                            <div style="font-size: 14px; color: ${trade.pnl >= 0 ? '#28a745' : '#dc3545'};">
                                                                ${trade.pnl >= 0 ? '+' : ''}${trade.pnl.toFixed(2)}
                                                            </div>
                                                            <div style="font-size: 11px; color: ${trade.pnl >= 0 ? '#155724' : '#721c24'}; font-weight: 500;">
                                                                ${trade.pnl_pct !== undefined ? `(${trade.pnl_pct >= 0 ? '+' : ''}${trade.pnl_pct.toFixed(2)}%)` : ''}
                                                            </div>
                                                        </div>
                                                    ` : '<span style="color: #6c757d;">-</span>'}
                                                </td>
                                                <td style="padding: 14px 12px; text-align: right; font-family: 'Courier New', 'Consolas', monospace; color: #212529; font-size: 13px; font-weight: 600;">${trade.balance.toFixed(2)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            ${result.debug_info && result.debug_info.length > 0 ? `
                                <details style="margin-top: 20px; text-align: left;" open>
                                    <summary style="cursor: pointer; color: #0066cc; font-weight: 600; font-size: 15px; padding: 14px 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 1px solid #dee2e6; margin-bottom: 12px; user-select: none; transition: all 0.2s; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.background='linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)'; this.style.borderColor='#adb5bd';" onmouseout="this.style.background='linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)'; this.style.borderColor='#dee2e6';">
                                        <span>ğŸ“‹</span>
                                        <span>æŸ¥çœ‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯ (${result.debug_info.length}æ¡)</span>
                                    </summary>
                                    <div style="max-height: 500px; overflow-y: auto; overflow-x: auto; background: #1e1e1e; padding: 16px; border-radius: 8px; font-size: 12px; font-family: 'Courier New', 'Consolas', 'Monaco', monospace; border: 1px solid #333; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);">
                                        ${result.debug_info.map((info, idx) => {
                                            let bgColor = '#1e1e1e';
                                            let textColor = '#d4d4d4';
                                            let borderColor = '#333';
                                            
                                            if (info.includes('âœ…âœ…âœ…')) {
                                                bgColor = '#1e3a1e';
                                                textColor = '#4ade80';
                                                borderColor = '#22c55e';
                                            } else if (info.includes('âŒâŒâŒ')) {
                                                bgColor = '#3a1e1e';
                                                textColor = '#f87171';
                                                borderColor = '#ef4444';
                                            } else if (info.includes('âœ…')) {
                                                bgColor = '#1e2a3a';
                                                textColor = '#60a5fa';
                                                borderColor = '#3b82f6';
                                            } else if (info.includes('âš ï¸')) {
                                                bgColor = '#3a3a1e';
                                                textColor = '#fbbf24';
                                                borderColor = '#f59e0b';
                                            } else if (info.includes('ğŸ“Š')) {
                                                bgColor = '#1e2a3a';
                                                textColor = '#93c5fd';
                                                borderColor = '#60a5fa';
                                            } else if (info.includes('â–â–â–')) {
                                                bgColor = '#2a1e1e';
                                                textColor = '#fca5a5';
                                                borderColor = '#f87171';
                                            } else if (info.includes('â•â•â•')) {
                                                bgColor = '#1e2a1e';
                                                textColor = '#86efac';
                                                borderColor = '#4ade80';
                                            }
                                            
                                            return `<div style="padding: 10px 14px; margin-bottom: 6px; border-left: 4px solid ${borderColor}; background: ${bgColor}; border-radius: 4px; line-height: 1.7; color: ${textColor}; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='${bgColor === '#1e1e1e' ? '#2a2a2a' : bgColor.replace('1e', '2a')}'" onmouseout="this.style.backgroundColor='${bgColor}'">${info}</div>`;
                                        }).join('')}
                                    </div>
                                </details>
                            ` : ''}
                        </div>
                    `;
                } else {
                    // åˆ†ææœªäº¤æ˜“çš„åŸå› 
                    let reasonHtml = '';
                    if (result.golden_cross_count === 0 && result.death_cross_count === 0) {
                        reasonHtml = `
                            <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-radius: 10px; border-left: 5px solid #ffc107; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <strong style="color: #856404; font-size: 16px; display: block; margin-bottom: 12px;">âš ï¸ æœªæ£€æµ‹åˆ°EMAé‡‘å‰æˆ–æ­»å‰ä¿¡å·</strong>
                                <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.7;">
                                    åœ¨24å°æ—¶çš„æµ‹è¯•æœŸé—´ï¼Œæ²¡æœ‰å‡ºç°EMAçŸ­æœŸå‡çº¿ä¸Šç©¿æˆ–ä¸‹ç©¿é•¿æœŸå‡çº¿çš„æƒ…å†µã€‚
                                    è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š
                                </p>
                                <ul style="margin: 12px 0 0 24px; color: #856404; font-size: 14px; line-height: 1.8;">
                                    <li>å¸‚åœºå¤„äºæ¨ªç›˜éœ‡è¡çŠ¶æ€</li>
                                    <li>EMAçŸ­æœŸå’Œé•¿æœŸå‡çº¿ä¸€ç›´ä¿æŒåŒä¸€æ–¹å‘æ’åˆ—</li>
                                    <li>éœ€è¦è°ƒæ•´EMAå‚æ•°æˆ–é€‰æ‹©å…¶ä»–æ—¶é—´å‘¨æœŸ</li>
                                </ul>
                            </div>
                        `;
                    } else if (result.golden_cross_count > 0 && result.trades_count === 0) {
                        reasonHtml = `
                            <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); border-radius: 10px; border-left: 5px solid #0c5460; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <strong style="color: #0c5460; font-size: 16px; display: block; margin-bottom: 12px;">â„¹ï¸ æ£€æµ‹åˆ° ${result.golden_cross_count} ä¸ªEMAé‡‘å‰ï¼Œä½†æœªæ‰§è¡Œäº¤æ˜“</strong>
                                <p style="margin: 0; color: #0c5460; font-size: 14px; line-height: 1.7;">
                                    å¯èƒ½çš„åŸå› ï¼š
                                </p>
                                <ul style="margin: 12px 0 0 24px; color: #0c5460; font-size: 14px; line-height: 1.8;">
                                    ${result.buy_volume_enabled ? `<li>æˆäº¤é‡æ¡ä»¶æœªæ»¡è¶³ï¼ˆ${result.buy_volume_long_enabled !== false ? `åšå¤šéœ€è¦: â‰¥${result.buy_volume_long || result.buy_volume || 'N/A'}å€` : 'åšå¤šæœªå¯ç”¨'}ï¼Œ${result.buy_volume_short_enabled !== false ? `åšç©ºéœ€è¦: ${result.buy_volume_short || 'N/A'}` : 'åšç©ºæœªå¯ç”¨'}ï¼Œå®é™…å¯èƒ½ä¸è¶³ï¼‰</li>` : ''}
                                    ${!result.buy_directions || result.buy_directions.length === 0 ? '<li>æœªé…ç½®äº¤æ˜“æ–¹å‘ï¼ˆåšå¤šæˆ–åšç©ºï¼‰</li>' : ''}
                                    <li>æŸ¥çœ‹ä¸‹æ–¹è°ƒè¯•ä¿¡æ¯äº†è§£è¯¦æƒ…</li>
                                </ul>
                            </div>
                        `;
                    }
                    
                    tradesHtml = `
                        <div style="margin-top: 24px; padding: 24px; text-align: center; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 2px dashed #adb5bd; box-shadow: 0 2px 4px rgba(0,0,0,0.08);">
                            <div style="margin-bottom: 16px;">
                                <i class="bi bi-info-circle" style="font-size: 32px; color: #6c757d; display: block; margin-bottom: 12px;"></i>
                                <p style="color: #495057; margin: 0; font-size: 16px; font-weight: 600;">æœªæ£€æµ‹åˆ°ä»»ä½•äº¤æ˜“ä¿¡å·</p>
                            </div>
                            ${reasonHtml}
                            <div style="margin-top: 20px; font-size: 14px; color: #495057; text-align: left; background: white; padding: 18px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 12px;">
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">Kçº¿æ•°æ®:</strong> <span style="color: #212529; font-weight: 600; font-size: 14px;">${result.klines_count || 0} æ¡</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">æŠ€æœ¯æŒ‡æ ‡:</strong> <span style="color: #212529; font-weight: 600; font-size: 14px;">${result.indicators_count || 0} æ¡</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">åŒ¹é…æ•°æ®:</strong> <span style="color: #212529; font-weight: 600; font-size: 14px;">${result.matched_pairs_count || 0} æ¡</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">EMAé‡‘å‰:</strong> <span style="color: #28a745; font-weight: 600; font-size: 14px;">${result.golden_cross_count || 0} æ¬¡</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">EMAæ­»å‰:</strong> <span style="color: #dc3545; font-weight: 600; font-size: 14px;">${result.death_cross_count || 0} æ¬¡</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">äº¤æ˜“æ–¹å‘:</strong> <span style="color: #212529; font-weight: 600; font-size: 14px;">${result.buy_directions ? result.buy_directions.map(d => d === 'long' ? 'åšå¤š' : 'åšç©º').join(', ') : 'æœªé…ç½®'}</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">ä¹°å…¥æˆäº¤é‡:</strong> <span style="color: #212529; font-weight: 600; font-size: 14px;">${result.buy_volume_enabled ? 
                                        (() => {
                                            const longText = (result.buy_volume_long_enabled !== false && (result.buy_volume_long || result.buy_volume)) ? 
                                                `åšå¤š: â‰¥${result.buy_volume_long || result.buy_volume}å€` : 
                                                (result.buy_volume_long_enabled === false ? 'åšå¤š: æœªå¯ç”¨' : 'åšå¤š: æœªè®¾ç½®');
                                            const shortText = (result.buy_volume_short_enabled !== false && result.buy_volume_short) ? 
                                                `åšç©º: ${(() => {
                                                    if (result.buy_volume_short === '>1') return '>1å€';
                                                    if (result.buy_volume_short === '0.8-1') return '0.8-1å€';
                                                    if (result.buy_volume_short === '0.6-0.8') return '0.6-0.8å€';
                                                    if (result.buy_volume_short === '<0.6') return '<0.6å€';
                                                    return result.buy_volume_short + 'å€';
                                                })()}` : 
                                                (result.buy_volume_short_enabled === false ? 'åšç©º: æœªå¯ç”¨' : 'åšç©º: æœªè®¾ç½®');
                                            return `${longText}, ${shortText}`;
                                        })() : 'æœªå¯ç”¨'}</span></div>
                                    <div style="padding: 10px; background: #f8f9fa; border-radius: 6px;"><strong style="color: #495057; font-size: 13px;">å–å‡ºæˆäº¤é‡:</strong> <span style="color: #212529; font-weight: 600; font-size: 14px;">${result.sell_volume_enabled ? (() => {
                                        if (result.sell_volume === '>1') return '>1å€';
                                        if (result.sell_volume === '0.8-1') return '0.8-1å€';
                                        if (result.sell_volume === '0.6-0.8') return '0.6-0.8å€';
                                        if (result.sell_volume === '<0.6') return '<0.6å€';
                                        return result.sell_volume ? (result.sell_volume.startsWith('<') ? result.sell_volume + 'å€' : 'â‰¤' + result.sell_volume + 'å€') : 'å·²å¯ç”¨';
                                    })() : 'æœªå¯ç”¨'}</span></div>
                                </div>
                            </div>
                            ${result.debug_info && result.debug_info.length > 0 ? `
                                <details style="margin-top: 20px; text-align: left;" open>
                                    <summary style="cursor: pointer; color: #0066cc; font-weight: 600; font-size: 15px; padding: 14px 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border: 1px solid #dee2e6; margin-bottom: 12px; user-select: none; transition: all 0.2s; display: flex; align-items: center; gap: 8px;" onmouseover="this.style.background='linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%)'; this.style.borderColor='#adb5bd';" onmouseout="this.style.background='linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)'; this.style.borderColor='#dee2e6';">
                                        <span>ğŸ“‹</span>
                                        <span>æŸ¥çœ‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯ (${result.debug_info.length}æ¡)</span>
                                    </summary>
                                    <div style="max-height: 400px; overflow-y: auto; overflow-x: auto; background: #1e1e1e; padding: 16px; border-radius: 8px; font-size: 12px; font-family: 'Courier New', 'Consolas', 'Monaco', monospace; border: 1px solid #333; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);">
                                        ${result.debug_info.map((info, idx) => {
                                            let bgColor = '#1e1e1e';
                                            let textColor = '#d4d4d4';
                                            let borderColor = '#333';
                                            
                                            if (info.includes('âœ…âœ…âœ…')) {
                                                bgColor = '#1e3a1e';
                                                textColor = '#4ade80';
                                                borderColor = '#22c55e';
                                            } else if (info.includes('âŒâŒâŒ')) {
                                                bgColor = '#3a1e1e';
                                                textColor = '#f87171';
                                                borderColor = '#ef4444';
                                            } else if (info.includes('âœ…')) {
                                                bgColor = '#1e2a3a';
                                                textColor = '#60a5fa';
                                                borderColor = '#3b82f6';
                                            } else if (info.includes('âš ï¸')) {
                                                bgColor = '#3a3a1e';
                                                textColor = '#fbbf24';
                                                borderColor = '#f59e0b';
                                            } else if (info.includes('ğŸ“Š')) {
                                                bgColor = '#1e2a3a';
                                                textColor = '#93c5fd';
                                                borderColor = '#60a5fa';
                                            }
                                            
                                            return `<div style="padding: 10px 14px; margin-bottom: 6px; border-left: 4px solid ${borderColor}; background: ${bgColor}; border-radius: 4px; line-height: 1.7; color: ${textColor}; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='${bgColor === '#1e1e1e' ? '#2a2a2a' : bgColor.replace('1e', '2a')}'" onmouseout="this.style.backgroundColor='${bgColor}'">${info}</div>`;
                                        }).join('')}
                                    </div>
                                </details>
                            ` : ''}
                        </div>
                    `;
                }
                
                return `
                    <div style="margin-bottom: 28px; padding: 24px; background: white; border-radius: 10px; border-left: 5px solid ${result.total_pnl >= 0 ? '#28a745' : '#dc3545'}; box-shadow: 0 3px 6px rgba(0,0,0,0.12);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e9ecef;">
                            <h5 style="margin: 0; color: #212529; font-size: 20px; font-weight: 600;">${result.symbol}</h5>
                            <span class="badge ${result.total_pnl >= 0 ? 'bg-success' : 'bg-danger'}" style="font-size: 16px; padding: 8px 16px; font-weight: 600;">
                                ${pnlIcon} ${result.total_pnl >= 0 ? '+' : ''}${result.total_pnl_pct.toFixed(2)}%
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px;">
                            <div style="padding: 18px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)'">
                                <div style="color: #6c757d; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">åˆå§‹èµ„é‡‘</div>
                                <div style="font-size: 24px; font-weight: 700; color: #212529; margin-bottom: 4px; font-family: 'Courier New', monospace;">${result.initial_balance.toFixed(2)}</div>
                                <div style="color: #6c757d; font-size: 11px; font-weight: 500;">USDT</div>
                            </div>
                            <div style="padding: 18px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)'">
                                <div style="color: #6c757d; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">æœ€ç»ˆèµ„é‡‘</div>
                                <div style="font-size: 24px; font-weight: 700; color: #212529; margin-bottom: 4px; font-family: 'Courier New', monospace;">${result.final_balance.toFixed(2)}</div>
                                <div style="color: #6c757d; font-size: 11px; font-weight: 500;">USDT</div>
                            </div>
                            <div style="padding: 18px; background: linear-gradient(135deg, ${result.total_pnl >= 0 ? '#d4edda' : '#f8d7da'} 0%, ${result.total_pnl >= 0 ? '#c3e6cb' : '#f5c6cb'} 100%); border-radius: 10px; border: 2px solid ${result.total_pnl >= 0 ? '#28a745' : '#dc3545'}; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'">
                                <div style="color: ${result.total_pnl >= 0 ? '#155724' : '#721c24'}; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">æ€»ç›ˆäº</div>
                                <div style="font-size: 26px; font-weight: 700; font-family: 'Courier New', monospace;" class="${pnlClass}">
                                    ${pnlIcon} ${result.total_pnl >= 0 ? '+' : ''}${result.total_pnl.toFixed(2)}
                                </div>
                                <div style="color: ${result.total_pnl >= 0 ? '#155724' : '#721c24'}; font-size: 11px; font-weight: 500;">${result.total_pnl_pct >= 0 ? '+' : ''}${result.total_pnl_pct.toFixed(2)}%</div>
                            </div>
                            <div style="padding: 18px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)'">
                                <div style="color: #6c757d; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">äº¤æ˜“æ¬¡æ•°</div>
                                <div style="font-size: 24px; font-weight: 700; color: #212529; margin-bottom: 4px; font-family: 'Courier New', monospace;">${result.trades_count}</div>
                                <div style="color: #6c757d; font-size: 11px; font-weight: 500;">${buyCount}ä¹°/${sellCount}å–</div>
                            </div>
                            <div style="padding: 18px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)'">
                                <div style="color: #6c757d; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">æœªå¹³ä»“</div>
                                <div style="font-size: 24px; font-weight: 700; color: ${result.open_positions > 0 ? '#ffc107' : '#6c757d'}; margin-bottom: 4px; font-family: 'Courier New', monospace;">${result.open_positions}</div>
                                <div style="color: #6c757d; font-size: 11px; font-weight: 500;">ä¸ªæŒä»“</div>
                            </div>
                            <div style="padding: 18px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.05)'">
                                <div style="color: #6c757d; font-size: 12px; font-weight: 600; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">èƒœç‡</div>
                                <div style="font-size: 24px; font-weight: 700; color: ${parseFloat(winRate) >= 50 ? '#28a745' : '#dc3545'}; margin-bottom: 4px; font-family: 'Courier New', monospace;">${winRate}%</div>
                                <div style="color: #6c757d; font-size: 11px; font-weight: 500;">${winTrades}èƒœ/${lossTrades}è´Ÿ</div>
                            </div>
                        </div>
                        ${tradesHtml}
                    </div>
                `;
            }).join('');
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 0; max-width: 1400px; max-height: 95vh; overflow: hidden; width: 100%; box-shadow: 0 12px 24px rgba(0,0,0,0.2); display: flex; flex-direction: column;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 24px 32px; border-bottom: 2px solid #e9ecef; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                        <div>
                            <h4 style="margin: 0 0 6px 0; color: #212529; font-size: 26px; font-weight: 700; display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 28px;">ğŸ“Š</span>
                                <span>ç­–ç•¥æµ‹è¯•ç»“æœ</span>
                            </h4>
                            <div style="color: #6c757d; font-size: 15px; font-weight: 500; margin-left: 40px;">${strategyName}</div>
                        </div>
                        <button onclick="document.body.removeChild(document.getElementById('testResultsModal'))" style="background: #f8f9fa; border: 1px solid #dee2e6; font-size: 28px; cursor: pointer; color: #495057; line-height: 1; padding: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; transition: all 0.2s; font-weight: 300;" onmouseover="this.style.background='#dc3545'; this.style.color='white'; this.style.borderColor='#dc3545';" onmouseout="this.style.background='#f8f9fa'; this.style.color='#495057'; this.style.borderColor='#dee2e6';">&times;</button>
                    </div>
                    <div style="flex: 1; overflow-y: auto; padding: 24px 32px;">
                        <div style="margin-bottom: 24px; padding: 18px 20px; background: linear-gradient(135deg, #e7f3ff 0%, #d0e7ff 100%); border-radius: 10px; border-left: 5px solid #0066cc; box-shadow: 0 2px 4px rgba(0,0,0,0.08);">
                            <strong style="color: #004085; font-size: 15px; display: block; margin-bottom: 8px;">ğŸ“Š æµ‹è¯•è¯´æ˜</strong>
                            <p style="margin: 0; color: #004085; font-size: 14px; line-height: 1.7;">
                                åŸºäºè¿‡å»24å°æ—¶çš„å†å²æ•°æ®ï¼Œæ¨¡æ‹Ÿç­–ç•¥äº¤æ˜“å¹¶è®¡ç®—ç›ˆäºã€‚åˆå§‹èµ„é‡‘ä¸º 10,000 USDTã€‚æµ‹è¯•ä¼šæ ¹æ®EMAé‡‘å‰/æ­»å‰ä¿¡å·å’Œæˆäº¤é‡æ¡ä»¶è‡ªåŠ¨æ‰§è¡Œä¹°å…¥/å–å‡ºæ“ä½œã€‚
                            </p>
                        </div>
                        ${resultsHtml || '<p style="text-align: center; color: #6c757d; padding: 50px; font-size: 16px;">æš‚æ— æµ‹è¯•ç»“æœ</p>'}
                    </div>
                    <div style="padding: 20px 32px; border-top: 2px solid #e9ecef; background: #f8f9fa; text-align: center;">
                        <button onclick="document.body.removeChild(document.getElementById('testResultsModal'))" class="btn btn-primary" style="padding: 12px 48px; font-size: 15px; font-weight: 600; border-radius: 8px; background: #0066cc; border: none; color: white; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#0052a3'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'" onmouseout="this.style.background='#0066cc'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">å…³é—­</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // æ·»åŠ ESCé”®å…³é—­åŠŸèƒ½
            const escHandler = function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('testResultsModal');
                    if (modal) {
                        document.body.removeChild(modal);
                        document.removeEventListener('keydown', escHandler);
                    }
                }
            };
            document.addEventListener('keydown', escHandler);
        }

        // æŸ¥çœ‹æµ‹è¯•å†å²
        async function viewTestHistory(id) {
            // ç¡®ä¿ ID ç±»å‹ä¸€è‡´
            const strategyId = typeof id === 'string' ? parseInt(id) : id;
            const strategy = strategies.find(s => {
                const sId = typeof s.id === 'string' ? parseInt(s.id) : s.id;
                return sId === strategyId;
            });
            
            if (!strategy) {
                showToast('ç­–ç•¥æœªæ‰¾åˆ°', 'error');
                return;
            }
            
            const strategyName = strategy.name;
            try {
                const response = await fetch(`/api/strategy/test/history?strategy_id=${strategyId}&page=1&page_size=20`);
                const result = await response.json();
                
                if (!result.success) {
                    showToast('è·å–æµ‹è¯•å†å²å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                    return;
                }
                
                showTestHistoryModal(result.data, result.pagination, strategyId);
            } catch (error) {
                console.error('è·å–æµ‹è¯•å†å²å¤±è´¥:', error);
                showToast('è·å–æµ‹è¯•å†å²å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•å†å²æ¨¡æ€æ¡†
        function showTestHistoryModal(historyList, pagination, strategyId) {
            const existingModal = document.getElementById('testHistoryModal');
            if (existingModal) {
                document.body.removeChild(existingModal);
            }
            
            const modal = document.createElement('div');
            modal.id = 'testHistoryModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: flex-start; justify-content: center; padding: 20px; overflow-y: auto;';
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            const historyHtml = historyList.length > 0 ? historyList.map(item => {
                const pnlClass = (item.total_pnl_percent || 0) >= 0 ? 'text-success' : 'text-danger';
                const pnlIcon = (item.total_pnl_percent || 0) >= 0 ? 'â–²' : 'â–¼';
                
                return `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid #dee2e6; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;" 
                         onmouseover="this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)'; this.style.transform='translateY(-2px)'" 
                         onmouseout="this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)'; this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div style="flex: 1;">
                                <h5 style="margin: 0 0 8px 0; color: #212529; font-size: 18px; font-weight: 600;">${item.strategy_name || 'æœªå‘½åç­–ç•¥'}</h5>
                                <div style="color: #6c757d; font-size: 13px; margin-bottom: 4px;">
                                    <i class="bi bi-calendar"></i> ${item.test_start_time} è‡³ ${item.test_end_time}
                                </div>
                                <div style="color: #6c757d; font-size: 13px;">
                                    <i class="bi bi-clock"></i> æµ‹è¯•æ—¶é•¿: ${item.test_duration_hours ? item.test_duration_hours.toFixed(2) : 'N/A'} å°æ—¶
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 24px; font-weight: 700; color: ${pnlClass === 'text-success' ? '#28a745' : '#dc3545'}; margin-bottom: 4px;">
                                    ${pnlIcon} ${item.total_pnl_percent ? item.total_pnl_percent.toFixed(2) : '0.00'}%
                                </div>
                                <div style="color: #6c757d; font-size: 12px;">
                                    ${item.total_pnl ? (item.total_pnl >= 0 ? '+' : '') + item.total_pnl.toFixed(2) : '0.00'} USDT
                                </div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e9ecef;">
                            <div style="text-align: center;">
                                <div style="color: #6c757d; font-size: 11px; margin-bottom: 4px;">äº¤æ˜“å¯¹</div>
                                <div style="font-size: 16px; font-weight: 600; color: #212529;">${item.total_symbols || 0}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #6c757d; font-size: 11px; margin-bottom: 4px;">æ€»äº¤æ˜“</div>
                                <div style="font-size: 16px; font-weight: 600; color: #212529;">${item.total_trades || 0}</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #6c757d; font-size: 11px; margin-bottom: 4px;">èƒœç‡</div>
                                <div style="font-size: 16px; font-weight: 600; color: ${(item.win_rate || 0) >= 50 ? '#28a745' : '#dc3545'};">${item.win_rate ? item.win_rate.toFixed(1) : '0.0'}%</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="color: #6c757d; font-size: 11px; margin-bottom: 4px;">æœ€ç»ˆä½™é¢</div>
                                <div style="font-size: 16px; font-weight: 600; color: #212529;">${item.final_balance ? item.final_balance.toFixed(2) : '0.00'}</div>
                            </div>
                        </div>
                        <div style="margin-top: 16px; display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: #6c757d; font-size: 12px;">
                                <i class="bi bi-info-circle"></i> æµ‹è¯•æ—¶é—´: ${item.created_at || 'N/A'}
                            </div>
                            <button onclick="viewTestDetail(${item.id})" class="btn btn-sm btn-primary" style="padding: 6px 16px; font-size: 13px; border-radius: 6px; background: #0066cc; border: none; color: white; cursor: pointer;">
                                <i class="bi bi-eye"></i> æŸ¥çœ‹è¯¦æƒ…
                            </button>
                        </div>
                    </div>
                `;
            }).join('') : '<div style="text-align: center; padding: 50px; color: #6c757d; font-size: 16px;">æš‚æ— æµ‹è¯•å†å²è®°å½•</div>';
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 0; max-width: 1000px; max-height: 90vh; overflow: hidden; width: 100%; box-shadow: 0 12px 24px rgba(0,0,0,0.2); display: flex; flex-direction: column;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 24px 32px; border-bottom: 2px solid #e9ecef; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                        <h4 style="margin: 0; color: #212529; font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px;">
                            <i class="bi bi-clock-history"></i>
                            <span>æµ‹è¯•å†å²è®°å½•</span>
                        </h4>
                        <button onclick="document.body.removeChild(document.getElementById('testHistoryModal'))" style="background: #f8f9fa; border: 1px solid #dee2e6; font-size: 28px; cursor: pointer; color: #495057; line-height: 1; padding: 0; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; transition: all 0.2s; font-weight: 300;" onmouseover="this.style.background='#dc3545'; this.style.color='white'; this.style.borderColor='#dc3545';" onmouseout="this.style.background='#f8f9fa'; this.style.color='#495057'; this.style.borderColor='#dee2e6';">&times;</button>
                    </div>
                    <div style="flex: 1; overflow-y: auto; padding: 24px 32px;">
                        ${historyHtml}
                    </div>
                    ${pagination && pagination.total_pages > 1 ? `
                        <div style="padding: 20px 32px; border-top: 2px solid #e9ecef; background: #f8f9fa; display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: #6c757d; font-size: 14px;">
                                å…± ${pagination.total} æ¡è®°å½•ï¼Œç¬¬ ${pagination.page} / ${pagination.total_pages} é¡µ
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="loadTestHistoryPage(${strategyId}, ${pagination.page - 1})" 
                                        ${pagination.page <= 1 ? 'disabled' : ''} 
                                        class="btn btn-sm btn-secondary" 
                                        style="padding: 6px 16px; font-size: 13px; border-radius: 6px; ${pagination.page <= 1 ? 'opacity: 0.5; cursor: not-allowed;' : 'cursor: pointer;'}">
                                    ä¸Šä¸€é¡µ
                                </button>
                                <button onclick="loadTestHistoryPage(${strategyId}, ${pagination.page + 1})" 
                                        ${pagination.page >= pagination.total_pages ? 'disabled' : ''} 
                                        class="btn btn-sm btn-secondary" 
                                        style="padding: 6px 16px; font-size: 13px; border-radius: 6px; ${pagination.page >= pagination.total_pages ? 'opacity: 0.5; cursor: not-allowed;' : 'cursor: pointer;'}">
                                    ä¸‹ä¸€é¡µ
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // åŠ è½½æµ‹è¯•å†å²åˆ†é¡µ
        async function loadTestHistoryPage(strategyId, page) {
            try {
                const response = await fetch(`/api/strategy/test/history?strategy_id=${strategyId}&page=${page}&page_size=20`);
                const result = await response.json();
                
                if (!result.success) {
                    showToast('è·å–æµ‹è¯•å†å²å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                    return;
                }
                
                showTestHistoryModal(result.data, result.pagination, strategyId);
            } catch (error) {
                console.error('è·å–æµ‹è¯•å†å²å¤±è´¥:', error);
                showToast('è·å–æµ‹è¯•å†å²å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æŸ¥çœ‹æµ‹è¯•è¯¦æƒ…
        async function viewTestDetail(testResultId) {
            try {
                const response = await fetch(`/api/strategy/test/history/${testResultId}`);
                const result = await response.json();
                
                if (!result.success) {
                    showToast('è·å–æµ‹è¯•è¯¦æƒ…å¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                    return;
                }
                
                // å…³é—­å†å²æ¨¡æ€æ¡†
                const historyModal = document.getElementById('testHistoryModal');
                if (historyModal) {
                    document.body.removeChild(historyModal);
                }
                
                // æ˜¾ç¤ºæµ‹è¯•ç»“æœï¼ˆä½¿ç”¨å·²æœ‰çš„showTestResultså‡½æ•°ï¼‰
                const details = result.data.details || [];
                const testData = details.map(d => {
                    // ä¼˜å…ˆä½¿ç”¨ test_result_dataï¼Œå¦‚æœæ²¡æœ‰åˆ™ä» debug_info é‡å»º
                    if (d.test_result_data) {
                        // å¦‚æœ test_result_data ä¸­æ²¡æœ‰ debug_infoï¼Œä½†æ•°æ®åº“ä¸­æœ‰ï¼Œåˆ™åˆå¹¶
                        if (d.debug_info && (!d.test_result_data.debug_info || d.test_result_data.debug_info.length === 0)) {
                            d.test_result_data.debug_info = Array.isArray(d.debug_info) ? d.debug_info : JSON.parse(d.debug_info || '[]');
                        }
                        return d.test_result_data;
                    } else if (d.debug_info) {
                        // å¦‚æœæ²¡æœ‰ test_result_dataï¼Œä½†æœ‰ debug_infoï¼Œåˆ›å»ºä¸€ä¸ªåŸºæœ¬ç»“æ„
                        const debugInfo = Array.isArray(d.debug_info) ? d.debug_info : JSON.parse(d.debug_info || '[]');
                        return {
                            symbol: d.symbol,
                            error: d.error_message,
                            debug_info: debugInfo,
                            trades: [],
                            trades_count: d.trades_count || 0
                        };
                    }
                    return null;
                }).filter(d => d);
                
                if (testData.length > 0) {
                    showTestResults(result.data.main.strategy_name, testData);
                } else {
                    showToast('è¯¥æµ‹è¯•è®°å½•æ²¡æœ‰è¯¦ç»†æ•°æ®', 'warning');
                }
            } catch (error) {
                console.error('è·å–æµ‹è¯•è¯¦æƒ…å¤±è´¥:', error);
                showToast('è·å–æµ‹è¯•è¯¦æƒ…å¤±è´¥ï¼š' + error.message, 'error');
            }
        }

        // æ›´æ–°ç©ºçŠ¶æ€æ˜¾ç¤º
        function updateEmptyState() {
            const emptyState = document.getElementById('emptyState');
            const strategyList = document.getElementById('futuresStrategyList');
            if (strategies.length === 0 && document.getElementById('addStrategyForm').style.display === 'none') {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }

        // æ‰§è¡Œæ¸…å•åˆ†é¡µç›¸å…³å˜é‡
        let executionCurrentPage = 1;
        let executionTotalPages = 1;
        let executionAllData = [];  // å­˜å‚¨æ‰€æœ‰æ‰§è¡Œè®°å½•

        // åˆ‡æ¢æ‰§è¡Œæ¸…å•é¡µç 
        function changeExecutionPage(delta) {
            const newPage = executionCurrentPage + delta;
            if (newPage >= 1 && newPage <= executionTotalPages) {
                executionCurrentPage = newPage;
                renderExecutionList();
            }
        }

        // æ¸²æŸ“æ‰§è¡Œæ¸…å•ï¼ˆå½“å‰é¡µï¼‰
        function renderExecutionList() {
            const container = document.getElementById('executionListContainer');
            if (!container || executionAllData.length === 0) return;

            const pageSize = parseInt(document.getElementById('executionPageSize')?.value || 50);
            const startIndex = (executionCurrentPage - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, executionAllData.length);
            const pageData = executionAllData.slice(startIndex, endIndex);

            // æ¸²æŸ“å½“å‰é¡µæ•°æ®
            container.innerHTML = pageData.map(item => {
                const actionIcon = item.action === 'buy' || item.action === 'BUY' || item.action === 'OPEN' || item.action === 'LONG' || item.action === 'SHORT'
                    ? '<i class="bi bi-arrow-down-circle" style="color: var(--success-green);"></i>'
                    : '<i class="bi bi-arrow-up-circle" style="color: var(--danger-red);"></i>';
                const actionText = item.action === 'buy' || item.action === 'BUY' || item.action === 'OPEN' || item.action === 'LONG'
                    ? 'ä¹°å…¥/å¼€ä»“'
                    : item.action === 'SHORT' ? 'åšç©º' : 'å–å‡º/å¹³ä»“';
                const statusColor = item.status === 'FILLED' ? 'var(--success-green)' : item.status === 'PENDING' ? 'var(--warning-yellow)' : 'var(--text-secondary)';
                const marketTypeText = item.market_type === 'test' ? 'æµ‹è¯•' : item.market_type === 'futures' ? 'åˆçº¦' : 'ç°è´§';

                return `
                    <div class="strategy-item" style="margin-bottom: var(--spacing-md);">
                        <div class="strategy-item-header">
                            <div class="strategy-item-title">
                                ${actionIcon} ${actionText} - ${item.symbol || 'N/A'}
                            </div>
                            <div style="display: flex; gap: var(--spacing-sm); align-items: center;">
                                <span style="padding: 4px 12px; background: ${statusColor}20; color: ${statusColor}; border-radius: var(--radius-sm); font-size: 12px; font-weight: 600;">
                                    ${item.status || 'N/A'}
                                </span>
                            </div>
                        </div>
                        <div class="strategy-item-body">
                            ${item.strategy_name ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">ç­–ç•¥åç§°</div>
                                <div class="strategy-item-field-value">${item.strategy_name}</div>
                            </div>
                            ` : ''}
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">ç±»å‹</div>
                                <div class="strategy-item-field-value">${marketTypeText}</div>
                            </div>
                            ${item.direction ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ–¹å‘</div>
                                <div class="strategy-item-field-value">${item.direction === 'long' ? 'åšå¤š' : 'åšç©º'}</div>
                            </div>
                            ` : ''}
                            ${item.action === 'sell' && item.entry_price ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">å¼€ä»“ä»·</div>
                                <div class="strategy-item-field-value">${parseFloat(item.entry_price).toFixed(4)}</div>
                            </div>
                            ` : ''}
                            ${item.action === 'sell' && item.exit_price ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">å¹³ä»“ä»·</div>
                                <div class="strategy-item-field-value">${parseFloat(item.exit_price).toFixed(4)}</div>
                            </div>
                            ` : ''}
                            ${item.action === 'buy' ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">ä»·æ ¼</div>
                                <div class="strategy-item-field-value">${item.price ? parseFloat(item.price).toFixed(4) : 'N/A'}</div>
                            </div>
                            ` : ''}
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ•°é‡</div>
                                <div class="strategy-item-field-value">${item.quantity ? parseFloat(item.quantity).toFixed(4) : 'N/A'}</div>
                            </div>
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">é‡‘é¢</div>
                                <div class="strategy-item-field-value">${item.amount ? parseFloat(item.amount).toFixed(2) : 'N/A'} USDT</div>
                            </div>
                            ${item.leverage ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ æ†</div>
                                <div class="strategy-item-field-value">${item.leverage}x</div>
                            </div>
                            ` : ''}
                            ${item.pnl !== undefined && item.pnl !== null ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">ç›ˆäº</div>
                                <div class="strategy-item-field-value" style="color: ${parseFloat(item.pnl) >= 0 ? 'var(--success-green)' : 'var(--danger-red)'};">
                                    ${parseFloat(item.pnl) >= 0 ? '+' : ''}${parseFloat(item.pnl).toFixed(2)} USDT
                                </div>
                            </div>
                            ` : ''}
                            ${item.fee ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ‰‹ç»­è´¹</div>
                                <div class="strategy-item-field-value">${parseFloat(item.fee).toFixed(4)} USDT</div>
                            </div>
                            ` : ''}
                            ${item.reason ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">äº¤æ˜“åŸå› </div>
                                <div class="strategy-item-field-value">${item.reason}</div>
                            </div>
                            ` : ''}
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ—¶é—´</div>
                                <div class="strategy-item-field-value">${item.created_at || 'N/A'}</div>
                            </div>
                            ${item.order_source ? `
                            <div class="strategy-item-field">
                                <div class="strategy-item-field-label">æ¥æº</div>
                                <div class="strategy-item-field-value">${item.order_source}</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // æ»šåŠ¨åˆ°é¡¶éƒ¨
            container.scrollTop = 0;

            // æ›´æ–°åˆ†é¡µæ§ä»¶
            updateExecutionPagination();
        }

        // æ›´æ–°åˆ†é¡µæ§ä»¶çŠ¶æ€
        function updateExecutionPagination() {
            const pageSize = parseInt(document.getElementById('executionPageSize')?.value || 50);
            executionTotalPages = Math.ceil(executionAllData.length / pageSize) || 1;

            document.getElementById('executionTotalCount').textContent = executionAllData.length;
            document.getElementById('executionCurrentPage').textContent = executionCurrentPage;
            document.getElementById('executionTotalPages').textContent = executionTotalPages;

            document.getElementById('executionPrevPage').disabled = executionCurrentPage <= 1;
            document.getElementById('executionNextPage').disabled = executionCurrentPage >= executionTotalPages;
        }

        // åŠ è½½ç­–ç•¥æ‰§è¡Œæ¸…å•
        async function loadExecutionList() {
            const container = document.getElementById('executionListContainer');
            if (!container) return;

            // é‡ç½®åˆ†é¡µ
            executionCurrentPage = 1;
            executionAllData = [];

            container.innerHTML = '<div class="placeholder-content"><div class="placeholder-icon"><i class="bi bi-hourglass-split"></i></div><div class="placeholder-text">æ­£åœ¨åŠ è½½æ‰§è¡Œè®°å½•...</div></div>';

            try {
                const marketType = document.getElementById('executionMarketType')?.value || 'all';
                const actionType = document.getElementById('executionActionType')?.value || 'all';
                const status = document.getElementById('executionStatus')?.value || 'all';
                const symbol = document.getElementById('executionSymbol')?.value || '';
                const timeRange = document.getElementById('executionTimeRange')?.value || '30d';

                // æ„å»ºæŸ¥è¯¢å‚æ•°ï¼Œè·å–è¾ƒå¤šæ•°æ®ç”¨äºå‰ç«¯åˆ†é¡µ
                const params = new URLSearchParams();
                if (marketType !== 'all') params.append('market_type', marketType);
                if (actionType !== 'all') params.append('action_type', actionType);
                if (status !== 'all') params.append('status', status);
                if (symbol) params.append('symbol', symbol);
                if (timeRange) params.append('time_range', timeRange);
                params.append('limit', '1000');  // è·å–è¾ƒå¤šæ•°æ®ç”¨äºå‰ç«¯åˆ†é¡µ

                const response = await fetch(`/api/strategy/execution/list?${params.toString()}`);
                const result = await response.json();

                if (!result.success) {
                    container.innerHTML = `<div class="placeholder-content"><div class="placeholder-icon" style="color: var(--danger-red);"><i class="bi bi-exclamation-triangle"></i></div><div class="placeholder-text">åŠ è½½å¤±è´¥</div><div class="placeholder-subtext">${result.error || 'æœªçŸ¥é”™è¯¯'}</div></div>`;
                    updateExecutionPagination();
                    return;
                }

                executionAllData = result.data || [];

                if (executionAllData.length === 0) {
                    container.innerHTML = '<div class="placeholder-content"><div class="placeholder-icon"><i class="bi bi-inbox"></i></div><div class="placeholder-text">æš‚æ— æ‰§è¡Œè®°å½•</div><div class="placeholder-subtext">ç­–ç•¥æ‰§è¡Œè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div></div>';
                    updateExecutionPagination();
                    return;
                }

                // æ¸²æŸ“ç¬¬ä¸€é¡µæ•°æ®
                renderExecutionList();

            } catch (error) {
                console.error('åŠ è½½æ‰§è¡Œæ¸…å•å¤±è´¥:', error);
                container.innerHTML = `<div class="placeholder-content"><div class="placeholder-icon" style="color: var(--danger-red);"><i class="bi bi-exclamation-triangle"></i></div><div class="placeholder-text">åŠ è½½å¤±è´¥</div><div class="placeholder-subtext">${error.message}</div></div>`;
                updateExecutionPagination();
            }
        }
        
        // åˆ·æ–°æ‰§è¡Œæ¸…å•
        function refreshExecutionList() {
            loadExecutionList();
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('äº¤æ˜“ç­–ç•¥é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>

