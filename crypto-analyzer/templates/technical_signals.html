<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€æœ¯ä¿¡å· - AlphaFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* AlphaFlow - Multi-Dimensional Crypto Intelligence Platform */
        :root {
            --primary-blue: #2B6FED; --primary-blue-hover: #1E5DD6; --primary-blue-light: #EBF3FF; --primary-blue-dark: #1A4BA8;
            --secondary-purple: #7C3AED; --secondary-orange: #F97316;
            --success-green: #10B981; --success-green-bg: #D1FAE5; --danger-red: #EF4444; --danger-red-bg: #FEE2E2;
            --warning-yellow: #F59E0B; --warning-yellow-bg: #FEF3C7; --info-blue: #3B82F6;
            --bg-primary: #0D1117; --bg-secondary: #161B22; --bg-tertiary: #21262D; --bg-card: #1C2128; --bg-hover: #2A3038;
            --text-primary: #E6EDF3; --text-secondary: #8B949E; --text-tertiary: #6E7681; --text-disabled: #484F58;
            --border-default: #30363D; --border-muted: #21262D; --border-subtle: #1C2128;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.15); --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.25); --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.3);
            --radius-sm: 4px; --radius-md: 8px; --radius-lg: 12px; --radius-xl: 16px; --radius-full: 9999px;
            --spacing-xs: 4px; --spacing-sm: 8px; --spacing-md: 12px; --spacing-lg: 16px; --spacing-xl: 24px; --spacing-2xl: 32px;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1); --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-family); background-color: var(--bg-primary); color: var(--text-primary); line-height: 1.6; font-size: 14px; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .container { max-width: 1600px; margin: 0 auto; padding: var(--spacing-xl); }
        .header { background: var(--bg-secondary); border-bottom: 1px solid var(--border-default); padding: var(--spacing-lg) var(--spacing-xl); margin-bottom: var(--spacing-xl); border-radius: var(--radius-lg); }
        .header-title { font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-sm); display: flex; align-items: center; gap: var(--spacing-md); }
        .header-subtitle { color: var(--text-secondary); font-size: 13px; }
        .nav-container { background: rgba(44, 68, 100, 0.85); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-xl); border: 1px solid var(--border-default); }
        .nav-links { display: flex; gap: var(--spacing-sm); flex-wrap: wrap; font-size: 16px; }
        .nav-link { padding: 0.75rem 1.5rem; background: transparent; color: var(--text-secondary); text-decoration: none; border-radius: var(--radius-md); transition: all var(--transition-base); font-weight: 600; font-size: 16px; border: 1px solid transparent; }
        .nav-link:hover { background: var(--bg-hover); color: var(--text-primary); border-color: var(--border-default); }
        .nav-link.active { background: var(--primary-blue); color: white; border-color: var(--primary-blue); }
        .card { background: var(--bg-card); border: 1px solid var(--border-default); border-radius: var(--radius-lg); padding: var(--spacing-xl); margin-bottom: var(--spacing-xl); transition: all var(--transition-base); }
        .card:hover { border-color: var(--border-muted); box-shadow: var(--shadow-md); }
        .card-header { padding-bottom: var(--spacing-lg); margin-bottom: var(--spacing-lg); border-bottom: 1px solid var(--border-default); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 18px; font-weight: 600; color: var(--text-primary); display: flex; align-items: center; gap: var(--spacing-sm); }
        .card-body { padding: 0; }
        .filters { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); flex-wrap: wrap; }
        .select-input { padding: var(--spacing-md) var(--spacing-lg); border-radius: var(--radius-md); border: 1px solid var(--border-default); background: var(--bg-tertiary); color: var(--text-primary); font-size: 14px; }
        .tabs { display: flex; gap: var(--spacing-sm); border-bottom: 2px solid var(--border-default); margin-bottom: var(--spacing-lg); }
        .tab { padding: var(--spacing-md) var(--spacing-xl); background: transparent; color: var(--text-secondary); border: none; border-bottom: 2px solid transparent; cursor: pointer; font-size: 14px; font-weight: 600; transition: all var(--transition-base); position: relative; top: 2px; }
        .tab:hover { color: var(--text-primary); background: var(--bg-hover); }
        .tab.active { color: var(--primary-blue); border-bottom-color: var(--primary-blue); background: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .table-container { overflow-x: auto; border-radius: var(--radius-md); border: 1px solid var(--border-default); }
        table { width: 100%; border-collapse: collapse; background: var(--bg-card); }
        thead { background: var(--bg-tertiary); border-bottom: 2px solid var(--border-default); }
        th { padding: var(--spacing-md) var(--spacing-lg); text-align: left; font-weight: 600; color: #E6EDF3; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: var(--spacing-lg); border-bottom: 1px solid var(--border-default); color: #E6EDF3; font-size: 13px; }
        tbody tr:hover { background: var(--bg-hover); }
        .badge { display: inline-flex; align-items: center; padding: var(--spacing-xs) var(--spacing-md); border-radius: var(--radius-full); font-size: 11px; font-weight: 600; letter-spacing: 0.3px; text-transform: uppercase; }
        .badge-success { background: var(--success-green-bg); color: var(--success-green); }
        .badge-danger { background: var(--danger-red-bg); color: var(--danger-red); }
        .badge-info { background: var(--primary-blue-light); color: var(--primary-blue); }
        .badge-neutral { background: var(--bg-tertiary); color: var(--text-secondary); }
        .badge-warning { background: var(--warning-yellow-bg); color: var(--warning-yellow); }
        .indicator-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-lg); }
        .indicator-card { background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--spacing-lg); }
        .indicator-name { font-size: 14px; color: var(--text-secondary); margin-bottom: var(--spacing-sm); }
        .indicator-value { font-size: 24px; font-weight: 700; color: var(--text-primary); font-family: var(--font-mono); }
        .loading { text-align: center; padding: var(--spacing-2xl); color: var(--text-secondary); }
        .empty-state { text-align: center; padding: var(--spacing-2xl); color: var(--text-secondary); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-sm); padding: var(--spacing-md) var(--spacing-xl); font-size: 14px; font-weight: 500; border: 1px solid transparent; border-radius: var(--radius-md); cursor: pointer; transition: all var(--transition-base); }
        .btn-primary { background: var(--primary-blue); color: white; }
        .btn-primary:hover { background: var(--primary-blue-hover); }
        .btn-info-beautiful { background: var(--primary-blue); color: white; border: none; }
        .btn-info-beautiful:hover { background: var(--primary-blue-hover); transform: translateY(-1px); box-shadow: var(--shadow-md); }
        .btn-detail {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            padding: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            transition: all var(--transition-base);
        }
        .btn-detail:hover {
            background: var(--primary-blue);
            border-color: var(--primary-blue);
            color: white;
        }
        .signal-strong-buy { color: var(--success-green); }
        .signal-buy { color: #4ADE80; }
        .signal-hold { color: var(--text-secondary); }
        .signal-sell { color: #FB7185; }
        .signal-strong-sell { color: var(--danger-red); }
        
        /* è¶‹åŠ¿æ ·å¼ */
        .trend-strong-up { background: #065F46; color: #10B981; }
        .trend-up { background: #047857; color: #34D399; }
        .trend-neutral { background: var(--bg-tertiary); color: var(--text-secondary); }
        .trend-down { background: #7F1D1D; color: #FB7185; }
        .trend-strong-down { background: #991B1B; color: var(--danger-red); }
        
        /* å®æ—¶ä»·æ ¼æ ·å¼ - ä¼˜åŒ–æ˜¾ç¤ºï¼Œæ— è¾¹æ¡† */
        .realtime-price {
            margin-top: 6px;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .realtime-price strong {
            font-family: var(--font-mono);
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.3px;
        }
        .realtime-price small {
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .realtime-price.price-updated {
            animation: priceFlash 0.6s ease;
        }
        @keyframes priceFlash {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 9999;
            animation: fadeIn var(--transition-base) ease-in;
            padding: var(--spacing-xl);
            align-items: center;
            justify-content: center;
            overflow-y: auto;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal-container {
            background: var(--bg-card);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-lg);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp var(--transition-slow) ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-default);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        .modal-body {
            padding: var(--spacing-xl);
        }
        .modal-close {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
        }
        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }
        .analysis-section {
            margin-bottom: var(--spacing-xl);
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--border-default);
        }
        .score-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }
        .score-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
        }
        .score-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }
        .score-value {
            font-size: 28px;
            font-weight: 700;
            font-family: var(--font-mono);
            color: var(--text-primary);
        }
        .price-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }
        .price-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }
        .price-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }
        .price-value {
            font-size: 18px;
            font-weight: 600;
            font-family: var(--font-mono);
            color: var(--text-primary);
        }
        .reasons-list, .risks-list {
            list-style: none;
            padding: 0;
        }
        .reasons-list li, .risks-list li {
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            background: var(--bg-tertiary);
            border-left: 3px solid var(--primary-blue);
            border-radius: var(--radius-sm);
        }
        .risks-list li {
            border-left-color: var(--warning-yellow);
        }
        .indicator-detail {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }
        .indicator-detail-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-default);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
        }
        .indicator-detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xs);
        }
        .indicator-detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
            flex-wrap: wrap;
        }
        /* å·²ç§»é™¤ï¼šæ—§çš„å¸¦è“è‰²è¾¹æ¡†çš„realtime-priceæ ·å¼ï¼ˆç”¨äºæ¨¡æ€æ¡†ä¸­çš„ä»·æ ¼æ˜¾ç¤ºï¼Œå·²ä¸å†ä½¿ç”¨ï¼‰ */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="header-title">
                <i class="bi bi-graph-up-arrow"></i>
                æŠ€æœ¯ä¿¡å·åˆ†æ
            </h1>
            <p class="header-subtitle">å®æ—¶ç›‘æ§æŠ€æœ¯æŒ‡æ ‡ï¼Œæ•æ‰äº¤æ˜“ä¿¡å·</p>
        </div>

        <div class="nav-container">
            <nav class="nav-links">
                <a href="/" class="nav-link">
                    <i class="bi bi-house"></i> é¦–é¡µ
                </a>
                <a href="/dashboard" class="nav-link">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
                <a href="/technical-signals" class="nav-link active">
                    <i class="bi bi-graph-up-arrow"></i> æŠ€æœ¯ä¿¡å·
                </a>
                <a href="/paper_trading" class="nav-link">
                    <i class="bi bi-journals"></i> ç°è´§äº¤æ˜“
                </a>
                <a href="/futures_trading" class="nav-link">
                    <i class="bi bi-graph-up-arrow"></i> åˆçº¦äº¤æ˜“
                </a>
                <a href="/futures_review" class="nav-link">
                    <i class="bi bi-journal-check"></i> å¤ç›˜(24H)
                </a>
<a href="/etf_data" class="nav-link">
                    <i class="bi bi-pie-chart"></i> ETF æ•°æ®
                </a>
                <a href="/corporate_treasury" class="nav-link">
                    <i class="bi bi-building"></i> ä¼ä¸šé‡‘åº“
                </a>
                <a href="/blockchain_gas" class="nav-link">
                    <i class="bi bi-lightning-charge"></i> Gasç»Ÿè®¡
                </a>
                <a href="/data_management" class="nav-link">
                    <i class="bi bi-database"></i> æ•°æ®ç®¡ç†
                </a>
            </nav>
        </div>

        <!-- æŠ€æœ¯æŒ‡æ ‡æ¦‚è§ˆ -->
        <div class="card" id="indicatorsCard" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="bi bi-bar-chart"></i>
                    <span id="selectedSymbol">æŠ€æœ¯æŒ‡æ ‡è¯¦æƒ…</span>
                </h2>
            </div>
            <div class="card-body">
                <div class="indicator-grid" id="indicatorsGrid"></div>
            </div>
        </div>

        <!-- äº¤æ˜“ä¿¡å·åˆ—è¡¨å’Œè¶…å–è¶…ä¹°ä¿¡å· -->
        <div class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h2 class="card-title">
                    <i class="bi bi-bell"></i>
                    äº¤æ˜“ä¿¡å·
                </h2>
                <button class="btn btn-info-beautiful" onclick="showTabExplanation()" id="tabExplanationBtn" style="padding: 6px 12px; font-size: 13px;">
                    <i class="bi bi-info-circle"></i> è¯¦æƒ…è¯´æ˜
                </button>
            </div>
            <div class="card-body">
                <!-- æ ‡ç­¾é¡µ -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('trend')" id="tabTrend">
                        <i class="bi bi-graph-up-arrow"></i> è¶‹åŠ¿åˆ¤æ–­
                    </button>
                    <button class="tab" onclick="switchTab('technical')" id="tabTechnical">
                        <i class="bi bi-bar-chart"></i> æŠ€æœ¯ä¿¡å·
                    </button>
                    <button class="tab" onclick="switchTab('futures')" id="tabFutures">
                        <i class="bi bi-currency-exchange"></i> åˆçº¦ä¿¡å·
                        </button>
                    </div>
                
                <!-- è¶‹åŠ¿åˆ¤æ–­æ ‡ç­¾é¡µå†…å®¹ -->
                <div id="tabContentTrend" class="tab-content active">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>äº¤æ˜“å¯¹</th>
                                    <th>5åˆ†é’Ÿ</th>
                                    <th>15åˆ†é’Ÿ</th>
                                    <th>1å°æ—¶</th>
                                    <th>1å¤©</th>
                                    <th>ç»¼åˆè¯„ä¼°</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="trendAnalysisTableBody">
                                <tr>
                                    <td colspan="7" class="loading">åŠ è½½ä¸­...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- æŠ€æœ¯ä¿¡å·æ ‡ç­¾é¡µå†…å®¹ -->
                <div id="tabContentTechnical" class="tab-content">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>äº¤æ˜“å¯¹</th>
                                    <th>ä»·æ ¼</th>
                                    <th>15åˆ†é’Ÿ</th>
                                    <th>1å°æ—¶</th>
                                    <th>1å¤©</th>
                                    <th>ç»¼åˆè¯„åˆ†</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="technicalSignalsTableBody">
                                <tr>
                                    <td colspan="7" class="loading">åŠ è½½ä¸­...</td>
                                </tr>
                            </tbody>
                        </table>
            </div>
        </div>

                <!-- åˆçº¦ä¿¡å·æ ‡ç­¾é¡µå†…å®¹ -->
                <div id="tabContentFutures" class="tab-content">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>äº¤æ˜“å¯¹</th>
                                <th>ä»·æ ¼</th>
                                <th>ä¿¡å·</th>
                                <th>ä¿¡å·è¯„åˆ†</th>
                                <th>èµ„é‡‘è´¹ç‡</th>
                                <th>å¤šç©ºæ¯”</th>
                                <th>æŒä»“é‡å˜åŒ–</th>
                                <th>5åˆ†é’ŸæŠ€æœ¯æŒ‡æ ‡</th>
                                <th>15åˆ†é’ŸæŠ€æœ¯æŒ‡æ ‡</th>
                                <th>1å°æ—¶æŠ€æœ¯æŒ‡æ ‡</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="futuresSignalsTableBody">
                            <tr>
                                <td colspan="11" class="loading">åŠ è½½ä¸­...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è¯¦ç»†åˆ†ææ¨¡æ€æ¡† -->
    <div id="detailedAnalysisModal" class="modal-overlay" onclick="if(event.target === this) closeDetailedAnalysis()">
        <div class="modal-container" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="bi bi-graph-up-arrow"></i>
                    <span id="modalSymbolTitle">è¯¦ç»†åˆ†æ</span>
                </h2>
                <button class="modal-close" onclick="closeDetailedAnalysis()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="detailedAnalysisContent">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- æ ‡ç­¾é¡µè¯¦æƒ…è¯´æ˜æ¨¡æ€æ¡† -->
    <div id="tabExplanationModal" class="modal-overlay" onclick="if(event.target === this) closeTabExplanation()">
        <div class="modal-container" onclick="event.stopPropagation()" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="bi bi-info-circle"></i>
                    <span id="tabExplanationTitle">è¯¦æƒ…è¯´æ˜</span>
                </h2>
                <button class="modal-close" onclick="closeTabExplanation()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="tabExplanationContent" style="padding: var(--spacing-xl);">
                <!-- å†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€å¡«å…… -->
            </div>
        </div>
    </div>

    <script>
        let currentSymbol = '';
        let currentTimeframe = '1h';
        
        // å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µ
        let currentActiveTab = 'trend';
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            currentActiveTab = tabName;
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeçŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å®¹
            if (tabName === 'trend') {
                document.getElementById('tabContentTrend').classList.add('active');
                document.getElementById('tabTrend').classList.add('active');
                // åˆ‡æ¢åˆ°è¶‹åŠ¿åˆ¤æ–­æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
                loadTrendAnalysis();
            } else if (tabName === 'technical') {
                document.getElementById('tabContentTechnical').classList.add('active');
                document.getElementById('tabTechnical').classList.add('active');
                // åˆ‡æ¢åˆ°æŠ€æœ¯ä¿¡å·æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
                console.log('åˆ‡æ¢åˆ°æŠ€æœ¯ä¿¡å·TABï¼Œå¼€å§‹åŠ è½½æ•°æ®...');
                loadTechnicalSignals().catch(error => {
                    console.error('åŠ è½½æŠ€æœ¯ä¿¡å·æ•°æ®å¤±è´¥:', error);
                });
            } else if (tabName === 'futures') {
                document.getElementById('tabContentFutures').classList.add('active');
                document.getElementById('tabFutures').classList.add('active');
                // åˆ‡æ¢åˆ°åˆçº¦ä¿¡å·æ—¶è‡ªåŠ¨åŠ è½½æ•°æ®
                loadFuturesSignals();
            }
        }

        // æ˜¾ç¤ºæ ‡ç­¾é¡µè¯¦æƒ…è¯´æ˜
        function showTabExplanation() {
            const modal = document.getElementById('tabExplanationModal');
            const title = document.getElementById('tabExplanationTitle');
            const content = document.getElementById('tabExplanationContent');
            
            let explanationHtml = '';
            
            if (currentActiveTab === 'trend') {
                title.textContent = 'è¶‹åŠ¿åˆ¤æ–­ - è¯¦æƒ…è¯´æ˜';
                explanationHtml = `
                    <div style="line-height: 1.8; color: var(--text-primary);">
                        <h3 style="color: var(--primary-blue); margin-bottom: var(--spacing-lg); font-size: 20px;">
                            <i class="bi bi-graph-up-arrow"></i> è¶‹åŠ¿åˆ¤æ–­åˆ†æè¯´æ˜
                        </h3>
                        
                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“Š åŠŸèƒ½æ¦‚è¿°</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                è¶‹åŠ¿åˆ¤æ–­é¡µé¢ç»¼åˆåˆ†æå¤šä¸ªæ—¶é—´å‘¨æœŸï¼ˆ5åˆ†é’Ÿã€15åˆ†é’Ÿã€1å°æ—¶ã€1å¤©ï¼‰çš„æŠ€æœ¯æŒ‡æ ‡ã€ä»·æ ¼å˜åŒ–å’Œæˆäº¤é‡å˜åŒ–ï¼Œä¸ºæ¯ä¸ªäº¤æ˜“å¯¹æä¾›è¶‹åŠ¿è¯„ä¼°ã€‚
                            </p>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">â±ï¸ æ—¶é—´å‘¨æœŸè¯´æ˜</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>5åˆ†é’Ÿï¼š</strong>åŸºäº2å°æ—¶å†…çš„ä»·æ ¼å’Œæˆäº¤é‡æ•°æ®ï¼Œé€‚åˆçŸ­æœŸäº¤æ˜“ä¿¡å·</li>
                                <li><strong>15åˆ†é’Ÿï¼š</strong>åŸºäº2å°æ—¶å†…çš„ä»·æ ¼å’Œæˆäº¤é‡æ•°æ®ï¼Œé€‚åˆçŸ­æœŸè¶‹åŠ¿åˆ¤æ–­</li>
                                <li><strong>1å°æ—¶ï¼š</strong>åŸºäº24å°æ—¶å†…çš„ä»·æ ¼å’Œæˆäº¤é‡å˜åŒ–ï¼Œé€‚åˆä¸­æœŸè¶‹åŠ¿åˆ†æ</li>
                                <li><strong>1å¤©ï¼š</strong>åŸºäº30å¤©çš„ä»·æ ¼å’Œæˆäº¤é‡æ•°æ®ï¼Œé€‚åˆé•¿æœŸè¶‹åŠ¿åˆ¤æ–­</li>
                            </ul>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“ˆ è¶‹åŠ¿åˆ¤æ–­æ ‡å‡†</h4>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--success-green); font-weight: 600; margin-bottom: 4px;">å¼ºçƒˆä¸Šæ¶¨ (STRONG_UPTREND)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">è¶‹åŠ¿è¯„åˆ† â‰¥ 60ï¼Œå¤šä¸ªæŠ€æœ¯æŒ‡æ ‡å¼ºçƒˆçœ‹å¤šï¼Œä»·æ ¼å’Œæˆäº¤é‡åŒæ­¥ä¸Šæ¶¨</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--success-green); font-weight: 600; margin-bottom: 4px;">ä¸Šæ¶¨ (UPTREND)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">è¶‹åŠ¿è¯„åˆ† â‰¥ 45ï¼ŒæŠ€æœ¯æŒ‡æ ‡æ•´ä½“çœ‹å¤šï¼Œä»·æ ¼å‘ˆä¸Šå‡è¶‹åŠ¿</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-secondary); font-weight: 600; margin-bottom: 4px;">éœ‡è¡ (SIDEWAYS)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">è¶‹åŠ¿è¯„åˆ† 30-45ï¼Œå¤šç©ºåŠ›é‡å¹³è¡¡ï¼Œä»·æ ¼åœ¨åŒºé—´å†…æ³¢åŠ¨</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--danger-red); font-weight: 600; margin-bottom: 4px;">ä¸‹è·Œ (DOWNTREND)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">è¶‹åŠ¿è¯„åˆ† 15-30ï¼ŒæŠ€æœ¯æŒ‡æ ‡æ•´ä½“çœ‹ç©ºï¼Œä»·æ ¼å‘ˆä¸‹é™è¶‹åŠ¿</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md);">
                                <p style="color: var(--danger-red); font-weight: 600; margin-bottom: 4px;">å¼ºçƒˆä¸‹è·Œ (STRONG_DOWNTREND)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">è¶‹åŠ¿è¯„åˆ† < 15ï¼Œå¤šä¸ªæŠ€æœ¯æŒ‡æ ‡å¼ºçƒˆçœ‹ç©ºï¼Œä»·æ ¼å’Œæˆäº¤é‡åŒæ­¥ä¸‹è·Œ</p>
                            </div>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ” è¯„ä¼°ç»´åº¦</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>æŠ€æœ¯æŒ‡æ ‡ï¼š</strong>RSIã€MACDã€EMAã€å¸ƒæ—å¸¦ç­‰æŒ‡æ ‡çš„ç»¼åˆè¯„åˆ†</li>
                                <li><strong>ä»·æ ¼å˜åŒ–ï¼š</strong>åŸºäºæ—¶é—´å‘¨æœŸå†…çš„ä»·æ ¼æ¶¨è·Œå¹…</li>
                                <li><strong>æˆäº¤é‡å˜åŒ–ï¼š</strong>æˆäº¤é‡çš„å¢å‡è¶‹åŠ¿ï¼Œé…åˆä»·æ ¼åˆ¤æ–­è¶‹åŠ¿å¼ºåº¦</li>
                                <li><strong>çº¿æ€§å›å½’ï¼š</strong>ä»·æ ¼å’Œæˆäº¤é‡çš„æ–œç‡åˆ†æï¼Œåˆ¤æ–­è¶‹åŠ¿æ–¹å‘</li>
                            </ul>
                        </div>

                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); border-left: 4px solid var(--primary-blue);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm); font-size: 16px;">ğŸ’¡ ä½¿ç”¨å»ºè®®</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2; margin: 0;">
                                <li>ç»“åˆå¤šä¸ªæ—¶é—´å‘¨æœŸç»¼åˆåˆ¤æ–­ï¼Œé¿å…å•ä¸€å‘¨æœŸè¯¯å¯¼</li>
                                <li>é•¿æœŸè¶‹åŠ¿ï¼ˆ1å¤©ï¼‰é€‚åˆåˆ¤æ–­å¤§æ–¹å‘ï¼ŒçŸ­æœŸè¶‹åŠ¿ï¼ˆ5åˆ†é’Ÿã€15åˆ†é’Ÿï¼‰é€‚åˆå¯»æ‰¾å…¥åœºæ—¶æœº</li>
                                <li>å½“å¤šä¸ªæ—¶é—´å‘¨æœŸè¶‹åŠ¿ä¸€è‡´æ—¶ï¼Œä¿¡å·æ›´å¯é </li>
                                <li>æ³¨æ„ä»·æ ¼å’Œæˆäº¤é‡çš„é…åˆï¼Œé‡ä»·é½å‡/é½è·Œçš„ä¿¡å·æ›´å¼ºçƒˆ</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else if (currentActiveTab === 'technical') {
                title.textContent = 'æŠ€æœ¯ä¿¡å· - è¯¦æƒ…è¯´æ˜';
                explanationHtml = `
                    <div style="line-height: 1.8; color: var(--text-primary);">
                        <h3 style="color: var(--primary-blue); margin-bottom: var(--spacing-lg); font-size: 20px;">
                            <i class="bi bi-bar-chart"></i> æŠ€æœ¯ä¿¡å·åˆ†æè¯´æ˜
                        </h3>
                        
                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“Š åŠŸèƒ½æ¦‚è¿°</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                æŠ€æœ¯ä¿¡å·é¡µé¢ç»¼åˆè¯„ä¼°15åˆ†é’Ÿã€1å°æ—¶ã€1å¤©ä¸‰ä¸ªæ—¶é—´å‘¨æœŸçš„æŠ€æœ¯æŒ‡æ ‡ï¼ˆEMAã€MACDã€RSIã€BOLLç­‰ï¼‰ï¼Œä¸ºæ¯ä¸ªäº¤æ˜“å¯¹ç”ŸæˆæŠ€æœ¯è¯„åˆ†å’Œäº¤æ˜“ä¿¡å·ã€‚
                            </p>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">â±ï¸ æ—¶é—´å‘¨æœŸè¯´æ˜</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>15åˆ†é’Ÿï¼š</strong>çŸ­æœŸæŠ€æœ¯æŒ‡æ ‡ï¼Œé€‚åˆæ•æ‰çŸ­æœŸäº¤æ˜“æœºä¼š</li>
                                <li><strong>1å°æ—¶ï¼š</strong>ä¸­æœŸæŠ€æœ¯æŒ‡æ ‡ï¼Œé€‚åˆåˆ¤æ–­ä¸­æœŸè¶‹åŠ¿</li>
                                <li><strong>1å¤©ï¼š</strong>é•¿æœŸæŠ€æœ¯æŒ‡æ ‡ï¼Œé€‚åˆåˆ¤æ–­é•¿æœŸè¶‹åŠ¿æ–¹å‘</li>
                            </ul>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡è¯´æ˜</h4>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">EMA (æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">çŸ­æœŸEMAä¸Šç©¿é•¿æœŸEMAä¸ºçœ‹æ¶¨ä¿¡å·ï¼Œä¸‹ç©¿ä¸ºçœ‹è·Œä¿¡å·</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">MACD (æŒ‡æ•°å¹³æ»‘ç§»åŠ¨å¹³å‡çº¿)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">MACDçº¿ä¸Šç©¿ä¿¡å·çº¿ä¸ºé‡‘å‰ï¼ˆçœ‹æ¶¨ï¼‰ï¼Œä¸‹ç©¿ä¸ºæ­»å‰ï¼ˆçœ‹è·Œï¼‰</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">RSI (ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">RSI < 30ä¸ºè¶…å–ï¼ˆçœ‹æ¶¨ï¼‰ï¼ŒRSI > 70ä¸ºè¶…ä¹°ï¼ˆçœ‹è·Œï¼‰</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">BOLL (å¸ƒæ—å¸¦)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">ä»·æ ¼è§¦åŠä¸‹è½¨å¯èƒ½åå¼¹ï¼Œè§¦åŠä¸Šè½¨å¯èƒ½å›è°ƒ</p>
                            </div>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ¯ ç»¼åˆè¯„åˆ†è¯´æ˜</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>0-40åˆ†ï¼š</strong>æŠ€æœ¯é¢åå¼±ï¼Œå»ºè®®è§‚æœ›æˆ–åšç©º</li>
                                <li><strong>40-60åˆ†ï¼š</strong>æŠ€æœ¯é¢ä¸­æ€§ï¼Œå¤šç©ºå¹³è¡¡</li>
                                <li><strong>60-100åˆ†ï¼š</strong>æŠ€æœ¯é¢åå¼ºï¼Œå»ºè®®åšå¤š</li>
                                <li>ç»¼åˆè¯„åˆ† = (15åˆ†é’Ÿè¯„åˆ† + 1å°æ—¶è¯„åˆ† + 1å¤©è¯„åˆ†) / 3</li>
                            </ul>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“Š ä¿¡å·ç±»å‹</h4>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--success-green); font-weight: 600; margin-bottom: 4px;">å¼ºçƒˆä¹°å…¥ (STRONG_BUY)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">å¤šä¸ªæ—¶é—´å‘¨æœŸæŠ€æœ¯æŒ‡æ ‡å¼ºçƒˆçœ‹å¤šï¼Œç»¼åˆè¯„åˆ†é«˜</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--success-green); font-weight: 600; margin-bottom: 4px;">ä¹°å…¥ (BUY)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">æŠ€æœ¯æŒ‡æ ‡æ•´ä½“çœ‹å¤šï¼Œé€‚åˆåšå¤š</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-secondary); font-weight: 600; margin-bottom: 4px;">æŒæœ‰ (HOLD)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">æŠ€æœ¯æŒ‡æ ‡ä¸­æ€§ï¼Œå»ºè®®è§‚æœ›</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--danger-red); font-weight: 600; margin-bottom: 4px;">å–å‡º (SELL)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">æŠ€æœ¯æŒ‡æ ‡æ•´ä½“çœ‹ç©ºï¼Œé€‚åˆåšç©º</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md);">
                                <p style="color: var(--danger-red); font-weight: 600; margin-bottom: 4px;">å¼ºçƒˆå–å‡º (STRONG_SELL)</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">å¤šä¸ªæ—¶é—´å‘¨æœŸæŠ€æœ¯æŒ‡æ ‡å¼ºçƒˆçœ‹ç©ºï¼Œç»¼åˆè¯„åˆ†ä½</p>
                            </div>
                        </div>

                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); border-left: 4px solid var(--primary-blue);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm); font-size: 16px;">ğŸ’¡ ä½¿ç”¨å»ºè®®</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2; margin: 0;">
                                <li>ç»“åˆå¤šä¸ªæ—¶é—´å‘¨æœŸçš„æŠ€æœ¯æŒ‡æ ‡ï¼Œé¿å…å•ä¸€å‘¨æœŸè¯¯å¯¼</li>
                                <li>å½“å¤šä¸ªæŒ‡æ ‡ï¼ˆEMAã€MACDã€RSIã€BOLLï¼‰æ–¹å‘ä¸€è‡´æ—¶ï¼Œä¿¡å·æ›´å¯é </li>
                                <li>æ³¨æ„RSIçš„è¶…ä¹°è¶…å–åŒºåŸŸï¼Œç»“åˆå…¶ä»–æŒ‡æ ‡ç»¼åˆåˆ¤æ–­</li>
                                <li>é•¿æœŸè¶‹åŠ¿ï¼ˆ1å¤©ï¼‰å†³å®šå¤§æ–¹å‘ï¼ŒçŸ­æœŸè¶‹åŠ¿ï¼ˆ15åˆ†é’Ÿï¼‰å¯»æ‰¾å…¥åœºæ—¶æœº</li>
                            </ul>
                        </div>
                    </div>
                `;
            } else if (currentActiveTab === 'futures') {
                title.textContent = 'åˆçº¦ä¿¡å· - è¯¦æƒ…è¯´æ˜';
                explanationHtml = `
                    <div style="line-height: 1.8; color: var(--text-primary);">
                        <h3 style="color: var(--primary-blue); margin-bottom: var(--spacing-lg); font-size: 20px;">
                            <i class="bi bi-currency-exchange"></i> åˆçº¦ä¿¡å·åˆ†æè¯´æ˜
                        </h3>
                        
                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“Š åŠŸèƒ½æ¦‚è¿°</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                åˆçº¦ä¿¡å·é¡µé¢ç»¼åˆåˆ†æèµ„é‡‘è´¹ç‡ã€æŒä»“é‡å˜åŒ–ã€å¤šæ—¶é—´å‘¨æœŸæŠ€æœ¯æŒ‡æ ‡ï¼ˆ5åˆ†é’Ÿã€15åˆ†é’Ÿã€1å°æ—¶ï¼‰å’Œä»·æ ¼è¶‹åŠ¿ï¼Œä¸ºåˆçº¦äº¤æ˜“æä¾›åšå¤š/åšç©ºä¿¡å·å’Œå‡¯åˆ©å…¬å¼ä»“ä½å»ºè®®ã€‚
                            </p>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“ˆ è¯„ä¼°ç»´åº¦ï¼ˆ4ä¸ªç»´åº¦ï¼‰</h4>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">1. èµ„é‡‘è´¹ç‡ï¼ˆæƒé‡35%ï¼‰</p>
                                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 4px;">åæ˜ å¸‚åœºæƒ…ç»ªï¼Œè´¹ç‡æé«˜ï¼ˆ>0.1%ï¼‰è¯´æ˜å¤šå¤´è¿‡åº¦æ‹¥æŒ¤ï¼Œåšç©ºæœºä¼šï¼›è´¹ç‡æä½ï¼ˆ<-0.1%ï¼‰è¯´æ˜ç©ºå¤´è¿‡åº¦æ‹¥æŒ¤ï¼Œåšå¤šæœºä¼š</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">2. æŒä»“é‡å˜åŒ–ï¼ˆæƒé‡20%ï¼‰</p>
                                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 4px;">æŒä»“é‡å¢åŠ +ä»·æ ¼ä¸Šæ¶¨=è¶‹åŠ¿å»¶ç»­ï¼ˆçœ‹å¤šï¼‰ï¼›æŒä»“é‡å¢åŠ +ä»·æ ¼ä¸‹è·Œ=è¶‹åŠ¿å»¶ç»­ï¼ˆçœ‹ç©ºï¼‰ï¼›æŒä»“é‡å‡å°‘=å¯èƒ½åè½¬</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md); margin-bottom: var(--spacing-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">3. æŠ€æœ¯æŒ‡æ ‡ï¼ˆæƒé‡35%ï¼‰</p>
                                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 4px;">ç»¼åˆåˆ†æ5åˆ†é’Ÿã€15åˆ†é’Ÿã€1å°æ—¶ä¸‰ä¸ªæ—¶é—´å‘¨æœŸçš„RSIã€EMAã€MACDã€BOLLç­‰æŠ€æœ¯æŒ‡æ ‡</p>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: var(--spacing-md); border-radius: var(--radius-md);">
                                <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">4. ä»·æ ¼è¶‹åŠ¿ï¼ˆæƒé‡10%ï¼‰</p>
                                <p style="color: var(--text-secondary); font-size: 13px;">24å°æ—¶æ¶¨è·Œå¹…ä½œä¸ºç¡®è®¤ä¿¡å·ï¼Œæ¶¨å¹…>3%çœ‹å¤šï¼Œè·Œå¹…>3%çœ‹ç©º</p>
                            </div>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ¯ ä¿¡å·è¯„åˆ†ä¸æ–¹å‘</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                ä¿¡å·è¯„åˆ†èŒƒå›´ï¼š-100 åˆ° +100ï¼ˆæ­£æ•°=åšå¤šï¼Œè´Ÿæ•°=åšç©ºï¼‰
                            </p>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>â‰¥ 60åˆ†ï¼š</strong>å¼ºçƒˆåšå¤š</li>
                                <li><strong>30-60åˆ†ï¼š</strong>åšå¤š</li>
                                <li><strong>-30 åˆ° 30åˆ†ï¼š</strong>è§‚æœ›</li>
                                <li><strong>-60 åˆ° -30åˆ†ï¼š</strong>åšç©º</li>
                                <li><strong>â‰¤ -60åˆ†ï¼š</strong>å¼ºçƒˆåšç©º</li>
                            </ul>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ’° å‡¯åˆ©å…¬å¼ä»“ä½å»ºè®®</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                åŸºäºä¿¡å·å¼ºåº¦ã€RSIã€ä»·æ ¼è¶‹åŠ¿ç­‰å› ç´ ï¼Œä½¿ç”¨å‡¯åˆ©å…¬å¼è®¡ç®—å»ºè®®ä»“ä½æ¯”ä¾‹ã€å…¥åœºä»·ã€æ­¢æŸä»·å’Œæ­¢ç›ˆä»·ã€‚
                            </p>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>å»ºè®®ä»“ä½ï¼š</strong>åŸºäºèƒœç‡å’Œç›ˆäºæ¯”è®¡ç®—çš„æœ€ä¼˜ä»“ä½æ¯”ä¾‹</li>
                                <li><strong>å…¥åœºä»·ï¼š</strong>å»ºè®®çš„å»ºä»“ä»·æ ¼</li>
                                <li><strong>æ­¢æŸä»·ï¼š</strong>é£é™©æ§åˆ¶ï¼Œè·Œç ´æ­¤ä»·æ ¼åº”æ­¢æŸç¦»åœº</li>
                                <li><strong>æ­¢ç›ˆä»·ï¼š</strong>ç›®æ ‡æ”¶ç›Šï¼Œè¾¾åˆ°æ­¤ä»·æ ¼å¯è€ƒè™‘æ­¢ç›ˆ</li>
                            </ul>
                        </div>

                        <div style="margin-bottom: var(--spacing-lg);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 16px;">ğŸ“Š æŠ€æœ¯æŒ‡æ ‡æ–¹å‘è¯´æ˜</h4>
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                æ¯ä¸ªæ—¶é—´å‘¨æœŸï¼ˆ5åˆ†é’Ÿã€15åˆ†é’Ÿã€1å°æ—¶ï¼‰æ˜¾ç¤ºï¼š
                            </p>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2;">
                                <li><strong>RSIï¼š</strong>æ˜¾ç¤ºæ•°å€¼å’Œæ–¹å‘ï¼ˆâ†‘çœ‹æ¶¨ã€â†“çœ‹è·Œã€â†’ä¸­æ€§ï¼‰</li>
                                <li><strong>EMAï¼š</strong>æ˜¾ç¤ºæ–¹å‘ï¼ˆâ†‘çœ‹æ¶¨ã€â†“çœ‹è·Œã€â†’ä¸­æ€§ï¼‰</li>
                                <li><strong>MACDï¼š</strong>æ˜¾ç¤ºæ–¹å‘ï¼ˆâ†‘é‡‘å‰çœ‹æ¶¨ã€â†“æ­»å‰çœ‹è·Œã€â†’ä¸­æ€§ï¼‰</li>
                                <li><strong>BOLLï¼š</strong>æ˜¾ç¤ºæ–¹å‘ï¼ˆâ†‘ä»·æ ¼åœ¨ä¸‹è½¨çœ‹æ¶¨ã€â†“ä»·æ ¼åœ¨ä¸Šè½¨çœ‹è·Œã€â†’ä¸­æ€§ï¼‰</li>
                                <li><strong>ç»¼åˆè¯„ä¼°ï¼š</strong>åŸºäºå¤šæ•°æŒ‡æ ‡æ–¹å‘åˆ¤æ–­æ•´ä½“è¶‹åŠ¿</li>
                            </ul>
                        </div>

                        <div style="background: var(--bg-tertiary); padding: var(--spacing-lg); border-radius: var(--radius-md); border-left: 4px solid var(--primary-blue);">
                            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm); font-size: 16px;">ğŸ’¡ ä½¿ç”¨å»ºè®®</h4>
                            <ul style="color: var(--text-secondary); padding-left: 20px; line-height: 2; margin: 0;">
                                <li>èµ„é‡‘è´¹ç‡æ˜¯é‡è¦çš„åå‘æŒ‡æ ‡ï¼Œè´¹ç‡æé«˜æ—¶å¾€å¾€æ˜¯åšç©ºæœºä¼š</li>
                                <li>æŒä»“é‡å˜åŒ–é…åˆä»·æ ¼è¶‹åŠ¿ï¼Œå¯ä»¥åˆ¤æ–­è¶‹åŠ¿çš„å»¶ç»­æ€§</li>
                                <li>å¤šä¸ªæ—¶é—´å‘¨æœŸçš„æŠ€æœ¯æŒ‡æ ‡æ–¹å‘ä¸€è‡´æ—¶ï¼Œä¿¡å·æ›´å¯é </li>
                                <li>ä¸¥æ ¼æŒ‰ç…§å‡¯åˆ©å…¬å¼å»ºè®®çš„æ­¢æŸä»·è®¾ç½®æ­¢æŸï¼Œæ§åˆ¶é£é™©</li>
                                <li>ä¿¡å·è¯„åˆ†åœ¨-30åˆ°30ä¹‹é—´æ—¶ï¼Œå»ºè®®è§‚æœ›ï¼Œç­‰å¾…æ›´æ˜ç¡®çš„ä¿¡å·</li>
                                <li>å¤šç©ºæ¯”ä»…ä¾›å‚è€ƒï¼ˆç”¨æˆ·æ•°å¤šç©ºæ¯”ï¼‰ï¼Œä¸å‚ä¸è¯„åˆ†è®¡ç®—</li>
                            </ul>
                        </div>

                        <div style="background: var(--warning-yellow-bg); padding: var(--spacing-md); border-radius: var(--radius-md); margin-top: var(--spacing-lg); border-left: 4px solid var(--warning-yellow);">
                            <p style="color: var(--text-primary); font-weight: 600; margin-bottom: 4px;">âš ï¸ é£é™©æç¤º</p>
                            <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">
                                åˆçº¦äº¤æ˜“é£é™©è¾ƒé«˜ï¼Œè¯·åŠ¡å¿…è®¾ç½®æ­¢æŸï¼Œæ§åˆ¶ä»“ä½ï¼Œä¸è¦è¿‡åº¦æ æ†ã€‚æ‰€æœ‰ä¿¡å·ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚
                            </p>
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = explanationHtml;
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.classList.add('active');
            }, 10);
        }

        // å…³é—­æ ‡ç­¾é¡µè¯¦æƒ…è¯´æ˜
        function closeTabExplanation() {
            const modal = document.getElementById('tabExplanationModal');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num, decimals = 2) {
            if (num === null || num === undefined) return '-';
            return Number(num).toFixed(decimals);
        }
        
        // æ ¼å¼åŒ–ä»·æ ¼ï¼ˆé’ˆå¯¹ä¸åŒäº¤æ˜“å¯¹ä½¿ç”¨ä¸åŒå°æ•°ä½æ•°ï¼‰
        function formatPrice(price, symbol) {
            if (price === null || price === undefined) return '-';
            if (symbol) {
                const symbolUpper = symbol.toUpperCase();
                // PUMPä¿ç•™5ä½å°æ•°ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼šPUMP/USDT, PUMPUSDT, PUMPç­‰ï¼‰
                if (symbolUpper.includes('PUMP')) {
                    return Number(price).toFixed(5);
                }
                // DOGEä¿ç•™4ä½å°æ•°ï¼ˆæ”¯æŒå¤šç§æ ¼å¼ï¼šDOGE/USDT, DOGEUSDT, DOGEç­‰ï¼‰
                if (symbolUpper.includes('DOGE')) {
                    return Number(price).toFixed(4);
                }
            }
            // å…¶ä»–å¸ç§é»˜è®¤2ä½å°æ•°
            return Number(price).toFixed(2);
        }

        // æ ¼å¼åŒ–ä¿¡å·
        function formatSignal(signal) {
            const signals = {
                'STRONG_BUY': { text: 'å¼ºçƒˆä¹°å…¥', class: 'signal-strong-buy' },
                'BUY': { text: 'ä¹°å…¥', class: 'signal-buy' },
                'HOLD': { text: 'æŒæœ‰', class: 'signal-hold' },
                'SELL': { text: 'å–å‡º', class: 'signal-sell' },
                'STRONG_SELL': { text: 'å¼ºçƒˆå–å‡º', class: 'signal-strong-sell' }
            };
            const s = signals[signal] || { text: signal, class: 'signal-hold' };
            return `<span class="${s.class}">${s.text}</span>`;
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeStr) {
            if (!timeStr) return '-';
            const date = new Date(timeStr);
            return date.toLocaleString('zh-CN');
        }
        
        // æ ¼å¼åŒ–å¤§æ•°å­—
        function formatLargeNumber(num) {
            if (num === null || num === undefined) return '-';
            if (num >= 1e9) {
                return (num / 1e9).toFixed(2) + 'B';
            } else if (num >= 1e6) {
                return (num / 1e6).toFixed(2) + 'M';
            } else if (num >= 1e3) {
                return (num / 1e3).toFixed(2) + 'K';
            }
            return formatNumber(num, 2);
        }

        // åŠ è½½æŠ€æœ¯æŒ‡æ ‡æ•°æ®
        // æ˜¾ç¤ºæŠ€æœ¯æŒ‡æ ‡è¯¦æƒ…
        function displayIndicatorDetails(data) {
            document.getElementById('selectedSymbol').textContent = `${data.symbol} - æŠ€æœ¯æŒ‡æ ‡è¯¦æƒ…`;
            document.getElementById('indicatorsCard').style.display = 'block';
            
            const grid = document.getElementById('indicatorsGrid');
            grid.innerHTML = `
                <div class="indicator-card">
                    <div class="indicator-name">æŠ€æœ¯è¯„åˆ†</div>
                    <div class="indicator-value">${formatNumber(data.technical_score)}</div>
                    <div>${formatSignal(data.technical_signal)}</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">RSI</div>
                    <div class="indicator-value">${formatNumber(data.rsi?.value)}</div>
                    <div>${data.rsi?.signal || '-'}</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">MACD</div>
                    <div class="indicator-value">${formatNumber(data.macd?.value)}</div>
                    <div>${data.macd?.trend || '-'}</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">å¸ƒæ—å¸¦ä½ç½®</div>
                    <div class="indicator-value">${data.bollinger_bands?.position || '-'}</div>
                    <div>å®½åº¦: ${formatNumber(data.bollinger_bands?.width)}%</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">EMAè¶‹åŠ¿</div>
                    <div class="indicator-value">${data.ema?.trend || '-'}</div>
                    <div>çŸ­æœŸ: ${formatNumber(data.ema?.short)} | é•¿æœŸ: ${formatNumber(data.ema?.long)}</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">KDJ</div>
                    <div class="indicator-value">K:${formatNumber(data.kdj?.k)} D:${formatNumber(data.kdj?.d)} J:${formatNumber(data.kdj?.j)}</div>
                    <div>${data.kdj?.signal || '-'}</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">æˆäº¤é‡</div>
                    <div class="indicator-value">${formatNumber(data.volume?.volume_ratio, 2)}x</div>
                    <div>${data.volume?.signal || '-'}</div>
                </div>
                <div class="indicator-card">
                    <div class="indicator-name">æ›´æ–°æ—¶é—´</div>
                    <div class="indicator-value" style="font-size: 14px;">${formatTime(data.updated_at)}</div>
                </div>
            `;
        }

        // åŠ è½½å•ä¸ªäº¤æ˜“å¯¹çš„æŒ‡æ ‡è¯¦æƒ…
        async function loadIndicatorDetails(symbol) {
            // ä½¿ç”¨é»˜è®¤timeframeï¼ˆ1hï¼‰ï¼Œå› ä¸ºä¿¡å·åˆ—è¡¨TABå·²åˆ é™¤
            const timeframe = '1h';
            currentSymbol = symbol;
            
            try {
                // åŒæ—¶è·å–æŠ€æœ¯æŒ‡æ ‡å’Œç»¼åˆäº¤æ˜“ä¿¡å·
                // å¯¹symbolè¿›è¡ŒURLç¼–ç ï¼Œå¤„ç†æ–œæ 
                const encodedSymbol = encodeURIComponent(symbol);
                const [indicatorsResponse, signalResponse] = await Promise.all([
                    fetch(`/api/technical-indicators?symbol=${encodeURIComponent(symbol)}&timeframe=${timeframe}`),
                    fetch(`/api/signals/${encodedSymbol}?timeframe=${timeframe}`).catch(() => null)
                ]);
                
                const indicatorsData = await indicatorsResponse.json();
                let signalData = null;
                if (signalResponse) {
                    try {
                        signalData = await signalResponse.json();
                    } catch (e) {
                        console.warn('è·å–ç»¼åˆä¿¡å·å¤±è´¥:', e);
                    }
                }
                
                displayIndicatorDetails(indicatorsData, signalData);
            } catch (error) {
                console.error('åŠ è½½æŒ‡æ ‡è¯¦æƒ…å¤±è´¥:', error);
                alert('åŠ è½½è¯¦æƒ…å¤±è´¥: ' + error.message);
            }
        }
        
        // æ˜¾ç¤ºè¯¦ç»†åˆ†ææ¨¡æ€æ¡†
        function showDetailedAnalysis(symbol, indicatorsData, signalData, priceData) {
            const modal = document.getElementById('detailedAnalysisModal');
            const modalContent = document.getElementById('detailedAnalysisContent');
            
            // è·å–å®æ—¶ä»·æ ¼
            let currentPrice = null;
            let maxPrice = null;
            let minPrice = null;
            let spreadPct = null;
            let totalVolume = null;
            let exchangesCount = null;
            let change24h = null;
            let change24hAbs = null;
            let high24h = null;
            let low24h = null;
            let volume24h = null;
            
            if (priceData && priceData.price) {
                currentPrice = parseFloat(priceData.price);
                maxPrice = priceData.max_price ? parseFloat(priceData.max_price) : null;
                minPrice = priceData.min_price ? parseFloat(priceData.min_price) : null;
                spreadPct = priceData.spread_pct ? parseFloat(priceData.spread_pct) : null;
                totalVolume = priceData.total_volume ? parseFloat(priceData.total_volume) : null;
                exchangesCount = priceData.exchanges || null;
                
                // ä»detailsä¸­è·å–24å°æ—¶æ•°æ®
                if (priceData.details && priceData.details.length > 0) {
                    const firstDetail = priceData.details[0];
                    change24h = firstDetail.change_24h !== undefined ? parseFloat(firstDetail.change_24h) : null;
                    high24h = firstDetail.high_24h !== undefined ? parseFloat(firstDetail.high_24h) : null;
                    low24h = firstDetail.low_24h !== undefined ? parseFloat(firstDetail.low_24h) : null;
                    volume24h = firstDetail.volume_24h !== undefined ? parseFloat(firstDetail.volume_24h) : null;
                }
                
                // å¦‚æœæ²¡æœ‰detailsï¼Œå°è¯•ç›´æ¥ä»priceDataè·å–
                if (change24h === null && priceData.change_24h !== undefined) {
                    change24h = parseFloat(priceData.change_24h);
                }
                if (high24h === null && priceData.high_24h !== undefined) {
                    high24h = parseFloat(priceData.high_24h);
                }
                if (low24h === null && priceData.low_24h !== undefined) {
                    low24h = parseFloat(priceData.low_24h);
                }
                if (volume24h === null && priceData.volume_24h !== undefined) {
                    volume24h = parseFloat(priceData.volume_24h);
                }
                
                // è®¡ç®—24å°æ—¶æ¶¨è·Œç»å¯¹å€¼
                if (change24h !== null && currentPrice !== null) {
                    change24hAbs = (currentPrice * change24h / 100);
                }
            } else if (signalData && signalData.price && signalData.price.current) {
                currentPrice = parseFloat(signalData.price.current);
            }
            
            let html = `
                <div class="analysis-section">
                    <h3 class="section-title">
                        <i class="bi bi-currency-dollar"></i>
                        å®æ—¶ä»·æ ¼
                    </h3>
                    <div class="realtime-price">
                        <div class="realtime-price-label">
                            <i class="bi bi-circle-fill price-update-indicator"></i>
                            å®æ—¶ä»·æ ¼ï¼ˆæ¯5ç§’æ›´æ–°ï¼‰
                        </div>
                        <div class="realtime-price-value" id="realtime-price-value" data-old-price="${currentPrice || 0}" data-symbol="${symbol || ''}">
                            ${currentPrice ? formatPrice(currentPrice, symbol || '') + ' USDT' : 'åŠ è½½ä¸­...'}
                        </div>
                        <div class="realtime-price-change" id="realtime-price-change" style="margin-top: var(--spacing-sm);">
                            <span style="color: var(--text-secondary); font-size: 12px;">
                                ä»·æ ¼å˜åŠ¨: <span id="price-change-text">-</span>
                            </span>
                        </div>
                        <div style="margin-top: var(--spacing-md); padding-top: var(--spacing-md); border-top: 1px solid var(--border-default);">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--spacing-md); font-size: 12px;">
                                ${change24h !== null ? `
                                <div>
                                    <div style="color: var(--text-secondary); margin-bottom: 4px;">24å°æ—¶æ¶¨è·Œ</div>
                                    <div style="color: ${change24h >= 0 ? 'var(--success-green)' : 'var(--danger-red)'}; font-weight: 600; font-size: 14px;">
                                        ${change24h >= 0 ? '+' : ''}${formatNumber(change24h)}%
                                    </div>
                                    ${change24hAbs !== null ? `
                                    <div style="color: var(--text-secondary); font-size: 11px; margin-top: 2px;">
                                        ${change24hAbs >= 0 ? '+' : ''}${formatNumber(change24hAbs)} USDT
                                    </div>
                                    ` : ''}
                                </div>
                                ` : ''}
                                ${high24h !== null ? `
                                <div>
                                    <div style="color: var(--text-secondary); margin-bottom: 4px;">24å°æ—¶æœ€é«˜</div>
                                    <div style="color: var(--success-green); font-weight: 600;">${formatNumber(high24h)}</div>
                                </div>
                                ` : ''}
                                ${low24h !== null ? `
                                <div>
                                    <div style="color: var(--text-secondary); margin-bottom: 4px;">24å°æ—¶æœ€ä½</div>
                                    <div style="color: var(--danger-red); font-weight: 600;">${formatNumber(low24h)}</div>
                                </div>
                                ` : ''}
                                ${volume24h !== null ? `
                                <div>
                                    <div style="color: var(--text-secondary); margin-bottom: 4px;">24å°æ—¶æˆäº¤é‡</div>
                                    <div style="color: var(--text-primary); font-weight: 600;">${formatLargeNumber(volume24h)}</div>
                                </div>
                                ` : ''}
                                ${maxPrice && minPrice ? `
                                <div>
                                    <div style="color: var(--text-secondary); margin-bottom: 4px;">è·¨äº¤æ˜“æ‰€ä»·å·®</div>
                                    <div style="color: var(--text-primary); font-weight: 600;">${spreadPct ? formatNumber(spreadPct, 3) + '%' : '-'}</div>
                                </div>
                                ` : ''}
                            </div>
                            ${exchangesCount ? `
                                <div style="margin-top: var(--spacing-sm); color: var(--text-secondary); font-size: 11px;">
                                    æ•°æ®æ¥æº: ${exchangesCount} ä¸ªäº¤æ˜“æ‰€
                                    ${totalVolume ? ` | æ€»æˆäº¤é‡: ${formatLargeNumber(totalVolume)}` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h3 class="section-title">
                        <i class="bi bi-graph-up"></i>
                        ç»¼åˆè¯„åˆ†
                    </h3>
                    <div class="score-grid">
            `;
            
            if (signalData && signalData.score) {
                html += `
                    <div class="score-item">
                        <div class="score-label">ç»¼åˆè¯„åˆ†</div>
                        <div class="score-value" style="color: ${signalData.score.total >= 0 ? 'var(--success-green)' : 'var(--danger-red)'}">
                            ${signalData.score.total >= 0 ? '+' : ''}${formatNumber(signalData.score.total)}
                        </div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">æŠ€æœ¯æŒ‡æ ‡è¯„åˆ†</div>
                        <div class="score-value">${formatNumber(signalData.score.technical)}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">æ–°é—»æƒ…ç»ªè¯„åˆ†</div>
                        <div class="score-value">${formatNumber(signalData.score.news)}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">ç½®ä¿¡åº¦</div>
                        <div class="score-value" style="color: ${signalData.confidence >= 70 ? 'var(--success-green)' : signalData.confidence >= 50 ? 'var(--warning-yellow)' : 'var(--text-secondary)'}">
                            ${formatNumber(signalData.confidence)}%
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="score-item">
                        <div class="score-label">æŠ€æœ¯è¯„åˆ†</div>
                        <div class="score-value">${formatNumber(indicatorsData.technical_score)}</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">ä¿¡å·</div>
                        <div class="score-value">${formatSignal(indicatorsData.technical_signal)}</div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h3 class="section-title">
                        <i class="bi bi-currency-dollar"></i>
                        ä»·æ ¼å»ºè®®
                    </h3>
                    <div class="price-info">
            `;
            
            // è·å–ä¿¡å·æ–¹å‘ï¼ˆåšå¤š/åšç©ºï¼‰
            let directionText = '';
            let directionClass = '';
            if (signalData && signalData.signal_direction) {
                const direction = signalData.signal_direction;
                if (direction === 'STRONG_LONG' || direction === 'LONG') {
                    directionText = 'åšå¤š';
                    directionClass = 'signal-buy';
                } else if (direction === 'STRONG_SHORT' || direction === 'SHORT') {
                    directionText = 'åšç©º';
                    directionClass = 'signal-sell';
                } else {
                    directionText = 'è§‚æœ›';
                    directionClass = 'signal-hold';
                }
            } else if (signalData && signalData.signal_text) {
                // ä»signal_textä¸­æå–æ–¹å‘
                const text = signalData.signal_text;
                if (text.includes('åšå¤š') || text.includes('ä¹°å…¥')) {
                    directionText = 'åšå¤š';
                    directionClass = 'signal-buy';
                } else if (text.includes('åšç©º') || text.includes('å–å‡º')) {
                    directionText = 'åšç©º';
                    directionClass = 'signal-sell';
                } else {
                    directionText = 'è§‚æœ›';
                    directionClass = 'signal-hold';
                }
            }
            
            // ä¼˜å…ˆä½¿ç”¨å‡¯åˆ©å…¬å¼å»ºè®®ï¼ˆå¦‚æœåˆçº¦ä¿¡å·æ•°æ®ä¸­æœ‰ï¼‰
            const kellyAdvice = signalData?.kelly_advice || (indicatorsData?.kelly_advice ? indicatorsData.kelly_advice : null);
            
            // å¦‚æœæœ‰å‡¯åˆ©å…¬å¼å»ºè®®ï¼Œä¼˜å…ˆä½¿ç”¨ï¼ˆå³ä½¿ä»“ä½ä¸º0ä¹Ÿæ˜¾ç¤ºï¼Œå› ä¸ºåŒ…å«äº†æ­¢æŸæ­¢ç›ˆä»·æ ¼ï¼‰
            if (kellyAdvice && kellyAdvice.entry_price && kellyAdvice.stop_loss && kellyAdvice.take_profit) {
                // ä½¿ç”¨å‡¯åˆ©å…¬å¼å»ºè®®
                const displayPrice = currentPrice || kellyAdvice.entry_price;
                html += `
                    ${directionText ? `
                    <div class="price-item">
                        <div class="price-label">äº¤æ˜“æ–¹å‘</div>
                        <div class="price-value ${directionClass}" style="font-size: 18px; font-weight: 700;">
                            ${directionText === 'åšå¤š' ? 'ğŸ“ˆ åšå¤š' : directionText === 'åšç©º' ? 'ğŸ“‰ åšç©º' : 'â¸ï¸ è§‚æœ›'}
                        </div>
                    </div>
                    ` : ''}
                    <div class="price-item">
                        <div class="price-label">å½“å‰ä»·æ ¼</div>
                        <div class="price-value">${formatPrice(displayPrice, symbol)} USDT</div>
                    </div>
                    ${kellyAdvice.position_pct > 0 ? `
                    <div class="price-item">
                        <div class="price-label">å»ºè®®ä»“ä½ï¼ˆå‡¯åˆ©å…¬å¼ï¼‰</div>
                        <div class="price-value" style="color: var(--primary-blue); font-size: 20px;">${formatNumber(kellyAdvice.position_pct)}%</div>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                            èƒœç‡: ${formatNumber(kellyAdvice.win_rate)}% | ç›ˆäºæ¯”: ${formatNumber(kellyAdvice.profit_loss_ratio)}:1
                        </div>
                    </div>
                    ` : `
                    <div class="price-item">
                        <div class="price-label">å‡¯åˆ©å…¬å¼è¯„ä¼°</div>
                        <div class="price-value" style="color: var(--text-secondary); font-size: 14px;">${kellyAdvice.recommendation || 'ä¸å»ºè®®å¼€ä»“'}</div>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                            èƒœç‡: ${formatNumber(kellyAdvice.win_rate)}% | ç›ˆäºæ¯”: ${formatNumber(kellyAdvice.profit_loss_ratio)}:1
                        </div>
                    </div>
                    `}
                    <div class="price-item">
                        <div class="price-label">å»ºè®®å…¥åœºä»·</div>
                        <div class="price-value" style="color: var(--primary-blue)">${formatPrice(kellyAdvice.entry_price, symbol)} USDT</div>
                    </div>
                    <div class="price-item">
                        <div class="price-label">æ­¢æŸä»·</div>
                        <div class="price-value" style="color: var(--danger-red)">${formatPrice(kellyAdvice.stop_loss, symbol)} USDT</div>
                        ${displayPrice && kellyAdvice.stop_loss ? `
                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                                è·ç¦»: ${formatNumber(Math.abs((displayPrice - kellyAdvice.stop_loss) / displayPrice * 100))}%
                            </div>
                        ` : ''}
                    </div>
                    <div class="price-item">
                        <div class="price-label">æ­¢ç›ˆä»·</div>
                        <div class="price-value" style="color: var(--success-green)">${formatPrice(kellyAdvice.take_profit, symbol)} USDT</div>
                        ${displayPrice && kellyAdvice.take_profit ? `
                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                                è·ç¦»: ${formatNumber(Math.abs((kellyAdvice.take_profit - displayPrice) / displayPrice * 100))}%
                            </div>
                        ` : ''}
                    </div>
                `;
            } else if (signalData && signalData.price) {
                // ä½¿ç”¨å®æ—¶ä»·æ ¼æˆ–ä¿¡å·ä¸­çš„ä»·æ ¼
                const displayPrice = currentPrice || signalData.price.current;
                // è·å–ä¿¡å·æ–¹å‘ï¼ˆå¦‚æœè¿˜æ²¡æœ‰è·å–ï¼‰
                if (!directionText && signalData.signal_direction) {
                    const direction = signalData.signal_direction;
                    if (direction === 'STRONG_LONG' || direction === 'LONG') {
                        directionText = 'åšå¤š';
                        directionClass = 'signal-buy';
                    } else if (direction === 'STRONG_SHORT' || direction === 'SHORT') {
                        directionText = 'åšç©º';
                        directionClass = 'signal-sell';
                    } else {
                        directionText = 'è§‚æœ›';
                        directionClass = 'signal-hold';
                    }
                } else if (!directionText && signalData.signal_text) {
                    const text = signalData.signal_text;
                    if (text.includes('åšå¤š') || text.includes('ä¹°å…¥')) {
                        directionText = 'åšå¤š';
                        directionClass = 'signal-buy';
                    } else if (text.includes('åšç©º') || text.includes('å–å‡º')) {
                        directionText = 'åšç©º';
                        directionClass = 'signal-sell';
                    } else {
                        directionText = 'è§‚æœ›';
                        directionClass = 'signal-hold';
                    }
                }
                html += `
                    ${directionText ? `
                    <div class="price-item">
                        <div class="price-label">äº¤æ˜“æ–¹å‘</div>
                        <div class="price-value ${directionClass}" style="font-size: 18px; font-weight: 700;">
                            ${directionText === 'åšå¤š' ? 'ğŸ“ˆ åšå¤š' : directionText === 'åšç©º' ? 'ğŸ“‰ åšç©º' : 'â¸ï¸ è§‚æœ›'}
                        </div>
                    </div>
                    ` : ''}
                    <div class="price-item">
                        <div class="price-label">å½“å‰ä»·æ ¼</div>
                        <div class="price-value">${formatPrice(displayPrice, symbol)} USDT</div>
                    </div>
                    <div class="price-item">
                        <div class="price-label">å»ºè®®å…¥åœºä»·</div>
                        <div class="price-value" style="color: var(--primary-blue)">${formatPrice(signalData.price.entry, symbol)} USDT</div>
                    </div>
                    <div class="price-item">
                        <div class="price-label">æ­¢æŸä»·</div>
                        <div class="price-value" style="color: var(--danger-red)">${formatPrice(signalData.price.stop_loss, symbol)} USDT</div>
                        ${displayPrice && signalData.price.stop_loss ? `
                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                                è·ç¦»: ${formatNumber(Math.abs((displayPrice - signalData.price.stop_loss) / displayPrice * 100))}%
                            </div>
                        ` : ''}
                    </div>
                    <div class="price-item">
                        <div class="price-label">æ­¢ç›ˆä»·</div>
                        <div class="price-value" style="color: var(--success-green)">${formatPrice(signalData.price.take_profit, symbol)} USDT</div>
                        ${displayPrice && signalData.price.take_profit ? `
                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                                è·ç¦»: ${formatNumber(Math.abs((signalData.price.take_profit - displayPrice) / displayPrice * 100))}%
                            </div>
                        ` : ''}
                    </div>
                `;
            } else if (currentPrice) {
                html += `
                    <div class="price-item">
                        <div class="price-label">å½“å‰ä»·æ ¼</div>
                        <div class="price-value">${formatPrice(currentPrice, symbol)} USDT</div>
                    </div>
                `;
            } else {
                html += `
                    <div class="price-item">
                        <div class="price-label">å½“å‰ä»·æ ¼</div>
                        <div class="price-value">-</div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h3 class="section-title">
                        <i class="bi bi-bar-chart"></i>
                        æŠ€æœ¯æŒ‡æ ‡è¯¦ç»†åˆ†æ
                    </h3>
                    <div class="indicator-detail">
                        <div class="indicator-detail-item">
                            <div class="indicator-detail-label">RSI (ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡)</div>
                            <div class="indicator-detail-value">${formatNumber(indicatorsData.rsi?.value)}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                ${indicatorsData.rsi?.signal === 'oversold' ? 'è¶…å–ï¼Œå¯èƒ½åå¼¹' : 
                                  indicatorsData.rsi?.signal === 'overbought' ? 'è¶…ä¹°ï¼Œå¯èƒ½å›è°ƒ' : 
                                  'ä¸­æ€§åŒºåŸŸ'}
                            </div>
                        </div>
                        <div class="indicator-detail-item">
                            <div class="indicator-detail-label">MACD</div>
                            <div class="indicator-detail-value">${indicatorsData.macd?.trend || '-'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                ${indicatorsData.macd?.trend === 'bullish_cross' ? 'é‡‘å‰ï¼Œçœ‹æ¶¨ä¿¡å·' : 
                                  indicatorsData.macd?.trend === 'bearish_cross' ? 'æ­»å‰ï¼Œçœ‹è·Œä¿¡å·' : 
                                  'ä¸­æ€§'}
                            </div>
                        </div>
                        <div class="indicator-detail-item">
                            <div class="indicator-detail-label">å¸ƒæ—å¸¦ä½ç½®</div>
                            <div class="indicator-detail-value">${indicatorsData.bollinger_bands?.position || '-'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                ä¸Šè½¨: ${formatNumber(indicatorsData.bollinger_bands?.upper)} | 
                                ä¸‹è½¨: ${formatNumber(indicatorsData.bollinger_bands?.lower)}
                            </div>
                        </div>
                        <div class="indicator-detail-item">
                            <div class="indicator-detail-label">EMAè¶‹åŠ¿</div>
                            <div class="indicator-detail-value">${indicatorsData.ema?.trend || '-'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                çŸ­æœŸ: ${formatNumber(indicatorsData.ema?.short)} | 
                                é•¿æœŸ: ${formatNumber(indicatorsData.ema?.long)}
                            </div>
                        </div>
                        <div class="indicator-detail-item">
                            <div class="indicator-detail-label">KDJæŒ‡æ ‡</div>
                            <div class="indicator-detail-value">
                                K:${formatNumber(indicatorsData.kdj?.k)} 
                                D:${formatNumber(indicatorsData.kdj?.d)} 
                                J:${formatNumber(indicatorsData.kdj?.j)}
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                ${indicatorsData.kdj?.signal || '-'}
                            </div>
                        </div>
                        <div class="indicator-detail-item">
                            <div class="indicator-detail-label">æˆäº¤é‡</div>
                            <div class="indicator-detail-value">${formatNumber(indicatorsData.volume?.volume_ratio, 2)}x</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                ${indicatorsData.volume?.signal === 'high' ? 'æˆäº¤é‡æ”¾å¤§' : 'æ­£å¸¸'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if (signalData && signalData.reasons && signalData.reasons.length > 0) {
                html += `
                    <div class="analysis-section">
                        <h3 class="section-title">
                            <i class="bi bi-lightbulb"></i>
                            æ¨èç†ç”±
                        </h3>
                        <ul class="reasons-list">
                `;
                signalData.reasons.forEach(reason => {
                    html += `<li>${reason}</li>`;
                });
                html += `
                        </ul>
                    </div>
                `;
            }
            
            if (signalData && signalData.risks && signalData.risks.length > 0) {
                html += `
                    <div class="analysis-section">
                        <h3 class="section-title">
                            <i class="bi bi-exclamation-triangle"></i>
                            é£é™©æç¤º
                        </h3>
                        <ul class="risks-list">
                `;
                signalData.risks.forEach(risk => {
                    html += `<li>${risk}</li>`;
                });
                html += `
                        </ul>
                    </div>
                `;
            }
            
            if (signalData && signalData.action) {
                html += `
                    <div class="analysis-section">
                        <h3 class="section-title">
                            <i class="bi bi-arrow-right-circle"></i>
                            æ“ä½œå»ºè®®
                        </h3>
                        <div style="background: var(--bg-tertiary); border: 1px solid var(--border-default); border-radius: var(--radius-md); padding: var(--spacing-lg);">
                            <div style="font-size: 24px; font-weight: 700; margin-bottom: var(--spacing-md);">
                                ${formatSignal(signalData.action)}
                            </div>
                            <div style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                                ç½®ä¿¡åº¦: ${formatNumber(signalData.confidence)}%
                            </div>
                            ${signalData.position ? `
                                <div style="color: var(--text-secondary); font-size: 13px;">
                                    <div>å»ºè®®ä»“ä½: ${formatNumber(signalData.position.recommended_size * 100)}%</div>
                                    <div>æœ€å¤§äºæŸ: ${formatNumber(signalData.position.max_loss_pct)}%</div>
                                    <div>ç›®æ ‡æ”¶ç›Š: ${formatNumber(signalData.position.max_profit_pct)}%</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            modalContent.innerHTML = html;
            modal.classList.add('active');
        }
        

        // åŠ è½½EMAä¿¡å·
        // åŠ è½½è¶…å–è¶…ä¹°ä¿¡å·
        // åŠ è½½æŠ€æœ¯ä¿¡å·
        async function loadTechnicalSignals() {
            try {
                const tbody = document.getElementById('technicalSignalsTableBody');
                if (!tbody) {
                    console.error('æ‰¾ä¸åˆ° technicalSignalsTableBody å…ƒç´ ');
                    return;
                }
                
                // æ¯æ¬¡åˆ·æ–°éƒ½æ›´æ–°è¡¨æ ¼å†…å®¹ï¼Œç¡®ä¿ä»·æ ¼ç­‰æ•°æ®èƒ½åŠæ—¶æ›´æ–°
                // ä¸æ˜¾ç¤º"åŠ è½½ä¸­"æç¤ºï¼Œç›´æ¥æ›´æ–°æ•°æ®ï¼Œé¿å…é—ªçƒ
                console.log('å¼€å§‹åŠ è½½æŠ€æœ¯ä¿¡å·æ•°æ®...');
                
                const response = await fetch('/api/technical-signals');
                
                // æ£€æŸ¥ HTTP å“åº”çŠ¶æ€
                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.detail || errorData.message || errorMessage;
                    } catch (e) {
                        // å¦‚æœæ— æ³•è§£æ JSONï¼Œä½¿ç”¨é»˜è®¤é”™è¯¯ä¿¡æ¯
                    }
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                console.log('APIè¿”å›æ•°æ®:', data); // è°ƒè¯•æ—¥å¿—
                
                // æ£€æŸ¥æ•°æ®æ ¼å¼
                if (!data || typeof data !== 'object') {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯ï¼šä¸æ˜¯æœ‰æ•ˆçš„JSONå¯¹è±¡');
                }
                
                // æ›´å®½æ¾çš„æ•°æ®æ£€æŸ¥ï¼šsuccess å¯ä»¥æ˜¯ true æˆ– "true"ï¼Œdata å¿…é¡»æ˜¯æ•°ç»„
                const isSuccess = data.success === true || data.success === 'true' || data.success === 1;
                const hasData = data.data && Array.isArray(data.data);
                const hasItems = hasData && data.data.length > 0;
                
                console.log('æ•°æ®æ ¼å¼æ£€æŸ¥:', {
                    success: data.success,
                    successType: typeof data.success,
                    isSuccess: isSuccess,
                    hasData: hasData,
                    dataType: typeof data.data,
                    isArray: Array.isArray(data.data),
                    dataLength: hasData ? data.data.length : 0,
                    hasItems: hasItems
                });
                
                if (isSuccess && hasItems) {
                    console.log(`å¼€å§‹å¤„ç† ${data.data.length} æ¡æ•°æ®...`);

                    try {
                        // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨DocumentFragmentæ‰¹é‡æ’å…¥DOM
                        const fragment = document.createDocumentFragment();

                        data.data.forEach((item, index) => {
                            try {
                        const indicators15m = item['15m'];
                        const indicators1h = item['1h'];
                        const indicators1d = item['1d'];

                        // è®¡ç®—ç»¼åˆè¯„åˆ†ï¼ˆ15mã€1hå’Œ1dçš„å¹³å‡å€¼ï¼‰
                        let overallScore = 0;
                        let count = 0;
                        if (indicators15m && indicators15m.technical_score !== null) {
                            overallScore += indicators15m.technical_score;
                            count++;
                        }
                        if (indicators1h && indicators1h.technical_score !== null) {
                            overallScore += indicators1h.technical_score;
                            count++;
                        }
                        if (indicators1d && indicators1d.technical_score !== null) {
                            overallScore += indicators1d.technical_score;
                            count++;
                        }
                        const avgScore = count > 0 ? overallScore / count : 0;
                        
                        // æ ¼å¼åŒ–ä»·æ ¼æ˜¾ç¤º
                        let priceHtml = '<span class="text-muted" style="font-size: 13px;">-</span>';
                        if (item.current_price !== null && item.current_price !== undefined) {
                            const priceClass = item.change_24h >= 0 ? 'signal-buy' : 'signal-sell';
                            const changeIcon = item.change_24h >= 0 ? 'â–²' : 'â–¼';
                            priceHtml = `
                                <strong>${formatPrice(item.current_price, item.symbol)}</strong>
                                ${item.change_24h !== null && item.change_24h !== undefined 
                                    ? `<small class="${priceClass}">${changeIcon} ${item.change_24h >= 0 ? '+' : ''}${formatNumber(item.change_24h, 2)}%</small>`
                                    : ''}
                            `;
                        }
                        
                        // æ ¼å¼åŒ–15åˆ†é’ŸæŒ‡æ ‡
                        const formatIndicators = (ind) => {
                            if (!ind) return '<span class="text-muted">-</span>';
                            
                            let html = '<div style="font-size: 12px; line-height: 1.6;">';
                            
                            // RSI
                            if (ind.rsi_value !== null) {
                                const rsiClass = ind.rsi_value > 70 ? 'signal-sell' : ind.rsi_value < 30 ? 'signal-buy' : '';
                                html += `<div>RSI: <span class="${rsiClass}">${formatNumber(ind.rsi_value, 1)}</span></div>`;
                            }
                            
                            // MACD
                            if (ind.macd_trend) {
                                const macdClass = ind.macd_trend === 'bullish_cross' ? 'signal-buy' : ind.macd_trend === 'bearish_cross' ? 'signal-sell' : '';
                                const macdText = ind.macd_trend === 'bullish_cross' ? 'é‡‘å‰' : ind.macd_trend === 'bearish_cross' ? 'æ­»å‰' : 'ä¸­æ€§';
                                html += `<div>MACD: <span class="${macdClass}">${macdText}</span></div>`;
                            }
                            
                            // EMA
                            if (ind.ema_trend) {
                                const emaClass = ind.ema_trend === 'bullish' ? 'signal-buy' : ind.ema_trend === 'bearish' ? 'signal-sell' : '';
                                const emaText = ind.ema_trend === 'bullish' ? 'çœ‹æ¶¨' : ind.ema_trend === 'bearish' ? 'çœ‹è·Œ' : 'ä¸­æ€§';
                                html += `<div>EMA: <span class="${emaClass}">${emaText}</span></div>`;
                            }
                            
                            // BOLL
                            if (ind.bb_position) {
                                const bbText = {
                                    'above_upper': 'ä¸Šè½¨',
                                    'middle': 'ä¸­è½¨',
                                    'below_lower': 'ä¸‹è½¨'
                                }[ind.bb_position] || ind.bb_position;
                                const bbClass = ind.bb_position === 'below_lower' ? 'signal-buy' : ind.bb_position === 'above_upper' ? 'signal-sell' : '';
                                html += `<div>BOLL: <span class="${bbClass}">${bbText}</span></div>`;
                            }
                            
                            // æŠ€æœ¯è¯„åˆ†
                            if (ind.technical_score !== null) {
                                const scoreClass = ind.technical_score >= 60 ? 'signal-buy' : ind.technical_score <= 40 ? 'signal-sell' : '';
                                html += `<div style="margin-top: 4px; font-weight: 600;">è¯„åˆ†: <span class="${scoreClass}">${formatNumber(ind.technical_score, 1)}</span></div>`;
                            }
                            
                            html += '</div>';
                            return html;
                        };
                        
                        // ç»¼åˆè¯„åˆ†æ ·å¼
                        let scoreClass = '';
                        let scoreText = '';
                        if (avgScore >= 75) {
                            scoreClass = 'signal-strong-buy';
                            scoreText = 'å¼ºçƒˆä¹°å…¥';
                        } else if (avgScore >= 60) {
                            scoreClass = 'signal-buy';
                            scoreText = 'ä¹°å…¥';
                        } else if (avgScore >= 40) {
                            scoreClass = 'signal-hold';
                            scoreText = 'æŒæœ‰';
                        } else if (avgScore >= 25) {
                            scoreClass = 'signal-sell';
                            scoreText = 'å–å‡º';
                        } else {
                            scoreClass = 'signal-strong-sell';
                            scoreText = 'å¼ºçƒˆå–å‡º';
                        }
                        
                        // æ€§èƒ½ä¼˜åŒ–ï¼šåˆ›å»ºtrå…ƒç´ è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td><strong>${item.symbol}</strong></td>
                            <td>
                                <div class="realtime-price">
                                    ${priceHtml}
                                </div>
                            </td>
                            <td>${formatIndicators(indicators15m)}</td>
                            <td>${formatIndicators(indicators1h)}</td>
                            <td>${formatIndicators(indicators1d)}</td>
                            <td>
                                <div style="text-align: center;">
                                    <div class="${scoreClass}" style="font-weight: 600; font-size: 13px; margin-bottom: 4px;">${scoreText}</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">${formatNumber(avgScore, 1)}</div>
                                </div>
                            </td>
                            <td>
                                <button class="btn-detail" onclick="event.stopPropagation(); showDetailedAnalysisModal('${item.symbol}')" title="æŸ¥çœ‹è¯¦æƒ…">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        `;
                        fragment.appendChild(tr);
                            } catch (itemError) {
                                console.error(`å¤„ç†ç¬¬ ${index + 1} æ¡æ•°æ®æ—¶å‡ºé”™:`, itemError, item);
                                // è·³è¿‡è¿™æ¡æ•°æ®ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€æ¡
                            }
                        });

                        console.log(`æˆåŠŸåŠ è½½ ${data.data.length} æ¡æŠ€æœ¯ä¿¡å·æ•°æ®`);
                        // æ€§èƒ½ä¼˜åŒ–ï¼šä¸€æ¬¡æ€§æ’å…¥æ‰€æœ‰DOMèŠ‚ç‚¹
                        tbody.innerHTML = '';
                        tbody.appendChild(fragment);
                    } catch (processError) {
                        console.error('å¤„ç†æ•°æ®æ—¶å‡ºé”™:', processError);
                        throw processError;
                    }
                } else {
                    // æ˜¾ç¤ºæ›´è¯¦ç»†çš„æç¤ºä¿¡æ¯
                    let emptyMessage = 'æš‚æ— æŠ€æœ¯ä¿¡å·æ•°æ®';
                    console.log('APIè¿”å›æ•°æ®ï¼ˆè¿›å…¥elseåˆ†æ”¯ï¼‰:', data); // è°ƒè¯•æ—¥å¿—
                    console.log('æ•°æ®æ£€æŸ¥:', {
                        success: data?.success,
                        hasData: !!data?.data,
                        isArray: Array.isArray(data?.data),
                        dataLength: data?.data?.length,
                        dataType: typeof data?.data
                    });
                    
                    // æ£€æŸ¥æ•°æ®æ ¼å¼
                    if (data === null || data === undefined) {
                        emptyMessage = 'åŠ è½½å¤±è´¥: APIè¿”å›æ•°æ®ä¸ºç©º';
                    } else if (data.success === false || (data.success !== true && data.detail)) {
                        // APIæ˜ç¡®è¿”å›å¤±è´¥ï¼Œæˆ–è€…æœ‰é”™è¯¯è¯¦æƒ…
                        emptyMessage = `åŠ è½½å¤±è´¥: ${data.detail || data.message || 'æœªçŸ¥é”™è¯¯'}`;
                    } else if ((data.success === true || data.success === 'true' || data.success === 1) && data.data && Array.isArray(data.data) && data.data.length === 0) {
                        // æˆåŠŸä½†æ•°æ®ä¸ºç©º
                        emptyMessage = 'æš‚æ— æŠ€æœ¯ä¿¡å·æ•°æ®ï¼ˆå¯èƒ½15mã€1hæˆ–1dæ—¶é—´å‘¨æœŸçš„æ•°æ®å°šæœªç”Ÿæˆï¼Œè¯·ç­‰å¾…ç¼“å­˜æ›´æ–°ï¼‰';
                        console.log('æ•°æ®ä¸ºç©ºï¼Œä½†APIè¿”å›æˆåŠŸ');
                    } else if (data.success !== true && (!data.data || !Array.isArray(data.data))) {
                        // å¦‚æœè¿”å›çš„æ•°æ®æ ¼å¼ä¸å¯¹ï¼Œå¯èƒ½æ˜¯APIè¿”å›æ ¼å¼æ”¹å˜äº†
                        emptyMessage = `åŠ è½½å¤±è´¥: APIè¿”å›æ ¼å¼å¼‚å¸¸ï¼ˆæœŸæœ›åŒ…å«success:trueå’Œdataæ•°ç»„å­—æ®µï¼Œå®é™…è¿”å›: ${JSON.stringify(data).substring(0, 200)}ï¼‰`;
                        console.error('APIè¿”å›æ ¼å¼å¼‚å¸¸:', data);
                    } else {
                        // å…¶ä»–æƒ…å†µ
                        emptyMessage = `æš‚æ— æŠ€æœ¯ä¿¡å·æ•°æ®ï¼ˆsuccess=${data?.success}, dataç±»å‹=${typeof data?.data}, æ˜¯å¦ä¸ºæ•°ç»„=${Array.isArray(data?.data)}, é•¿åº¦=${data?.data?.length || 0}ï¼‰`;
                        console.warn('æœªåŒ¹é…åˆ°ä»»ä½•æ¡ä»¶ï¼Œä½¿ç”¨é»˜è®¤æç¤º:', data);
                    }
                    tbody.innerHTML = `<tr><td colspan="7" class="empty-state">${emptyMessage}</td></tr>`;
                }
            } catch (error) {
                console.error('åŠ è½½æŠ€æœ¯ä¿¡å·å¤±è´¥:', error);
                console.error('é”™è¯¯è¯¦æƒ…:', error.stack);
                const errorMessage = error.message || 'è¯·ç¨åé‡è¯•';
                document.getElementById('technicalSignalsTableBody').innerHTML = 
                    `<tr><td colspan="7" class="empty-state">åŠ è½½å¤±è´¥: ${errorMessage}</td></tr>`;
            }
        }

        // å·²ç§»é™¤ï¼šloadOversoldOverboughtSignals å‡½æ•°ï¼ˆè¶…ä¹°è¶…å–ä¿¡å·åŠŸèƒ½å·²ç§»é™¤ï¼‰

        // åŠ è½½è¶‹åŠ¿åˆ†ææ•°æ®
        async function loadTrendAnalysis() {
            try {
                const tbody = document.getElementById('trendAnalysisTableBody');
                if (!tbody) return;

                const response = await fetchWithTimeout('/api/trend-analysis', 10000);
                const data = await response.json();

                if (data.success && data.data && data.data.length > 0) {
                    // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨DocumentFragment
                    const fragment = document.createDocumentFragment();

                    data.data.forEach(item => {
                        const trend5m = item['5m'];
                        const trend15m = item['15m'];
                        const trend1h = item['1h'];
                        const trend1d = item['1d'];
                        
                        // è®¡ç®—ç»¼åˆè¯„ä¼°ï¼ˆåŒ…å«5mï¼‰
                        let overallScore = 0;
                        let count = 0;
                        if (trend5m) { overallScore += trend5m.trend_score; count++; }
                        if (trend15m) { overallScore += trend15m.trend_score; count++; }
                        if (trend1h) { overallScore += trend1h.trend_score; count++; }
                        if (trend1d) { overallScore += trend1d.trend_score; count++; }
                        const avgScore = count > 0 ? overallScore / count : 50;
                        
                        let overallTrend = 'SIDEWAYS';
                        let overallText = 'éœ‡è¡';
                        let overallClass = 'trend-neutral';
                        if (avgScore >= 75) {
                            overallTrend = 'STRONG_UPTREND';
                            overallText = 'å¼ºçƒˆä¸Šæ¶¨';
                            overallClass = 'trend-strong-up';
                        } else if (avgScore >= 60) {
                            overallTrend = 'UPTREND';
                            overallText = 'ä¸Šæ¶¨';
                            overallClass = 'trend-up';
                        } else if (avgScore >= 45) {
                            overallTrend = 'SIDEWAYS';
                            overallText = 'éœ‡è¡';
                            overallClass = 'trend-neutral';
                        } else if (avgScore >= 30) {
                            overallTrend = 'DOWNTREND';
                            overallText = 'ä¸‹è·Œ';
                            overallClass = 'trend-down';
                        } else {
                            overallTrend = 'STRONG_DOWNTREND';
                            overallText = 'å¼ºçƒˆä¸‹è·Œ';
                            overallClass = 'trend-strong-down';
                        }
                        
                        // æ ¼å¼åŒ–ä»·æ ¼æ˜¾ç¤ºï¼ˆä¼˜åŒ–æ ·å¼ï¼Œæ— è¾¹æ¡†ï¼‰
                        let priceHtml = '<span class="text-muted" style="font-size: 13px;">-</span>';
                        if (item.current_price !== null && item.current_price !== undefined) {
                            const priceClass = item.change_24h >= 0 ? 'signal-buy' : 'signal-sell';
                            const changeIcon = item.change_24h >= 0 ? 'â–²' : 'â–¼';
                            priceHtml = `
                                <strong>${formatPrice(item.current_price, item.symbol)}</strong>
                                ${item.change_24h !== null && item.change_24h !== undefined 
                                    ? `<small class="${priceClass}">${changeIcon} ${item.change_24h >= 0 ? '+' : ''}${formatNumber(item.change_24h, 2)}%</small>`
                                    : ''}
                            `;
                        }
                        
                        // æ€§èƒ½ä¼˜åŒ–ï¼šåˆ›å»ºtrå…ƒç´ 
                        const tr = document.createElement('tr');
                        tr.dataset.symbol = item.symbol;
                        tr.innerHTML = `
                            <td>
                                <strong>${item.symbol}</strong>
                                <div id="price-${item.symbol.replace('/', '-')}" class="realtime-price">
                                    ${priceHtml}
                                </div>
                            </td>
                            <td>${formatTrendCell(trend5m)}</td>
                            <td>${formatTrendCell(trend15m)}</td>
                            <td>${formatTrendCell(trend1h)}</td>
                            <td>${formatTrendCell(trend1d)}</td>
                            <td>
                                <span class="badge ${overallClass}">${overallText}</span>
                                <br><small style="color: #666;">è¯„åˆ†: ${avgScore.toFixed(1)}</small>
                            </td>
                            <td>
                                <button class="btn-detail" onclick="event.stopPropagation(); showDetailedAnalysisModal('${item.symbol}')" title="æŸ¥çœ‹è¯¦æƒ…">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        `;
                        fragment.appendChild(tr);
                    });

                    // æ€§èƒ½ä¼˜åŒ–ï¼šä¸€æ¬¡æ€§æ’å…¥DOM
                    tbody.innerHTML = '';
                    tbody.appendChild(fragment);
                        } else {
                    tbody.innerHTML = '<tr><td colspan="7" class="empty-state">æš‚æ— æ•°æ®</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½è¶‹åŠ¿åˆ†æå¤±è´¥:', error);
                document.getElementById('trendAnalysisTableBody').innerHTML = 
                    '<tr><td colspan="7" class="empty-state">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</td></tr>';
            }
        }
        
        // æ ¼å¼åŒ–è¶‹åŠ¿å•å…ƒæ ¼
        function formatTrendCell(trend) {
            if (!trend) {
                return '<span class="text-muted">-</span>';
            }
            
            let priceInfo = '';
            if (trend.price_change_pct !== undefined && trend.price_change_pct !== null) {
                const priceClass = trend.price_change_pct >= 0 ? 'signal-buy' : 'signal-sell';
                priceInfo = `<br><small style="color: #666;">ä»·æ ¼å˜åŒ–: <span class="${priceClass}">${trend.price_change_pct >= 0 ? '+' : ''}${formatNumber(trend.price_change_pct, 2)}%</span>`;
                if (trend.volume_change_pct !== undefined && trend.volume_change_pct !== null) {
                    const volumeClass = trend.volume_change_pct >= 0 ? 'signal-buy' : 'signal-sell';
                    priceInfo += ` | æˆäº¤é‡å˜åŒ–: <span class="${volumeClass}">${trend.volume_change_pct >= 0 ? '+' : ''}${formatNumber(trend.volume_change_pct, 2)}%</span>`;
                }
                priceInfo += '</small>';
            }
            
            // EMAé‡‘å‰/æ­»å‰ä¿¡æ¯ï¼ˆä»…å¯¹5mã€15mã€1hæ˜¾ç¤ºï¼‰
            let emaCrossInfo = '';
            // æ£€æŸ¥ ema_cross å­—æ®µæ˜¯å¦å­˜åœ¨ä¸”ä¸ä¸º null
            if (trend.ema_cross && typeof trend.ema_cross === 'object') {
                if (trend.ema_cross.is_golden_cross) {
                    emaCrossInfo = '<br><small style="color: var(--success-green); font-weight: 600;">âœ¨ EMAé‡‘å‰</small>';
                } else if (trend.ema_cross.is_death_cross) {
                    emaCrossInfo = '<br><small style="color: var(--danger-red); font-weight: 600;">âš ï¸ EMAæ­»å‰</small>';
                } else if (trend.ema_cross.is_bullish) {
                    // å½“å‰å¤šå¤´æ’åˆ—ï¼ˆçŸ­æœŸåœ¨é•¿æœŸä¹‹ä¸Šï¼‰ï¼Œä½†æ²¡æœ‰åˆšåˆšå‘ç”Ÿé‡‘å‰
                    emaCrossInfo = '<br><small style="color: var(--success-green);">â†‘ EMAå¤šå¤´</small>';
                } else if (trend.ema_cross.is_bearish) {
                    // å½“å‰ç©ºå¤´æ’åˆ—ï¼ˆçŸ­æœŸåœ¨é•¿æœŸä¹‹ä¸‹ï¼‰ï¼Œä½†æ²¡æœ‰åˆšåˆšå‘ç”Ÿæ­»å‰
                    emaCrossInfo = '<br><small style="color: var(--danger-red);">â†“ EMAç©ºå¤´</small>';
                }
            }
            // å¦‚æœ ema_cross ä¸å­˜åœ¨æˆ–ä¸º nullï¼Œä¸æ˜¾ç¤ºä»»ä½•ä¿¡æ¯ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œç‰¹åˆ«æ˜¯å¯¹äº1dæ—¶é—´å‘¨æœŸï¼‰
            
            return `
                <div>
                    <span class="badge ${trend.trend_class}">${trend.trend_text}</span>
                    ${emaCrossInfo}
                    <br><small style="color: #666;">
                        è¯„åˆ†: ${trend.trend_score} | 
                        RSI: ${formatNumber(trend.rsi_value, 1)} | 
                        ç½®ä¿¡åº¦: ${trend.confidence}%
                    </small>
                    ${priceInfo}
                </div>
            `;
        }

        // æ ¼å¼åŒ–æŠ€æœ¯æŒ‡æ ‡æ˜¾ç¤ºï¼ˆå¸¦æ–¹å‘ç®­å¤´ï¼‰
        function formatIndicatorCell(indicators) {
            if (!indicators || !indicators.directions) {
                return '<span class="text-muted">-</span>';
            }
            
            const dirs = indicators.directions;
            const vals = indicators.values;
            
            // æ–¹å‘ç®­å¤´
            const getDirectionIcon = (direction) => {
                if (direction === 'up') return '<span class="signal-buy">â†‘</span>';
                if (direction === 'down') return '<span class="signal-sell">â†“</span>';
                if (direction === 'neutral') return '<span class="text-muted">â†’</span>';
                return '<span class="text-muted">-</span>';
            };
            
            // ç»¼åˆè¯„ä¼°
            const overall = dirs.overall || 'neutral';
            const overallText = overall === 'up' ? 'çœ‹æ¶¨' : overall === 'down' ? 'çœ‹è·Œ' : 'ä¸­æ€§';
            const overallClass = overall === 'up' ? 'signal-buy' : overall === 'down' ? 'signal-sell' : 'text-muted';
            
            let html = '<div style="font-size: 12px; line-height: 1.6;">';
            let hasAnyIndicator = false;
            
            // RSI
            if (dirs.rsi && dirs.rsi.direction) {
                const rsiValue = (vals && vals.rsi_value !== null && vals.rsi_value !== undefined) 
                    ? formatNumber(vals.rsi_value, 1) 
                    : '-';
                html += `<div>RSI: ${rsiValue} ${getDirectionIcon(dirs.rsi.direction)}</div>`;
                hasAnyIndicator = true;
            }
            
            // EMA
            if (dirs.ema && dirs.ema.direction) {
                html += `<div>EMA: ${getDirectionIcon(dirs.ema.direction)}</div>`;
                hasAnyIndicator = true;
            }
            
            // MACD
            if (dirs.macd && dirs.macd.direction) {
                html += `<div>MACD: ${getDirectionIcon(dirs.macd.direction)}</div>`;
                hasAnyIndicator = true;
            }
            
            // BOLL
            if (dirs.boll && dirs.boll.direction) {
                html += `<div>BOLL: ${getDirectionIcon(dirs.boll.direction)}</div>`;
                hasAnyIndicator = true;
            }
            
            // å¦‚æœæ²¡æœ‰æ˜¾ç¤ºä»»ä½•æŒ‡æ ‡ï¼Œè¿”å›é»˜è®¤å€¼
            if (!hasAnyIndicator) {
                return '<span class="text-muted">-</span>';
            }
            
            // ç»¼åˆè¯„ä¼°
            html += `<div style="margin-top: 4px; font-weight: 600; border-top: 1px solid #eee; padding-top: 4px;">
                <span class="${overallClass}">${overallText}</span>
            </div>`;
            
            html += '</div>';
            return html;
        }
        
        // åŠ è½½åˆçº¦ä¿¡å·
        async function loadFuturesSignals() {
            try {
                const tbody = document.getElementById('futuresSignalsTableBody');
                if (!tbody) return;

                const response = await fetchWithTimeout('/api/futures-signals', 10000);
                const data = await response.json();

                if (data.success && data.data && data.data.length > 0) {
                    // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨DocumentFragment
                    const fragment = document.createDocumentFragment();

                    data.data.forEach(signal => {
                        // æ ¼å¼åŒ–ä»·æ ¼æ˜¾ç¤º
                        let priceHtml = '<span class="text-muted">-</span>';
                        if (signal.current_price !== null && signal.current_price !== undefined) {
                            const priceClass = signal.price_change_24h >= 0 ? 'signal-buy' : 'signal-sell';
                            priceHtml = `
                                <div class="realtime-price" id="price-${signal.symbol.replace('/', '-')}">
                                    <strong style="font-size: 16px;">${formatPrice(signal.current_price, signal.symbol)}</strong>
                                    ${signal.price_change_24h !== null && signal.price_change_24h !== undefined 
                                        ? `<br><small class="${priceClass}">${signal.price_change_24h >= 0 ? '+' : ''}${formatNumber(signal.price_change_24h, 2)}%</small>`
                                        : ''}
                                </div>
                            `;
                        }
                            
                        // æ€§èƒ½ä¼˜åŒ–ï¼šåˆ›å»ºtrå…ƒç´ 
                        const tr = document.createElement('tr');
                        tr.dataset.symbol = signal.symbol;
                        tr.innerHTML = `
                            <td><strong>${signal.symbol}</strong></td>
                            <td>${priceHtml}</td>
                            <td>
                                <span class="badge ${signal.signal_class}">${signal.signal_text}</span>
                                </td>
                            <td class="${signal.signal_score >= 0 ? 'signal-buy' : 'signal-sell'}" style="font-weight: 600;">
                                ${signal.signal_score >= 0 ? '+' : ''}${formatNumber(signal.signal_score, 1)}
                            </td>
                            <td>
                                ${signal.funding_rate !== null && signal.funding_rate !== undefined
                                    ? `<span class="${signal.funding_rate > 0 ? 'signal-buy' : signal.funding_rate < 0 ? 'signal-sell' : ''}">${formatNumber(signal.funding_rate, 4)}%</span>`
                                    : '<span class="text-muted">-</span>'}
                            </td>
                            <td>
                                ${signal.long_short_ratio !== null && signal.long_short_ratio !== undefined
                                    ? `${formatNumber(signal.long_short_ratio, 2)}`
                                    : '<span class="text-muted">-</span>'}
                            </td>
                            <td>
                                ${signal.oi_change_pct !== null && signal.oi_change_pct !== undefined
                                    ? `<span class="${signal.oi_change_pct >= 0 ? 'signal-buy' : 'signal-sell'}">${signal.oi_change_pct >= 0 ? '+' : ''}${formatNumber(signal.oi_change_pct, 2)}%</span>`
                                    : '<span class="text-muted">-</span>'}
                            </td>
                            <td style="min-width: 120px;">${formatIndicatorCell(signal.indicators_5m)}</td>
                            <td style="min-width: 120px;">${formatIndicatorCell(signal.indicators_15m)}</td>
                            <td style="min-width: 120px;">${formatIndicatorCell(signal.indicators_1h)}</td>
                            <td>
                                <button class="btn-detail" onclick="event.stopPropagation(); showDetailedAnalysisModal('${signal.symbol}')" title="æŸ¥çœ‹è¯¦æƒ…">
                                    <i class="bi bi-eye"></i>
                                    </button>
                                </td>
                        `;
                        fragment.appendChild(tr);
                    });

                    // æ€§èƒ½ä¼˜åŒ–ï¼šä¸€æ¬¡æ€§æ’å…¥DOM
                    tbody.innerHTML = '';
                    tbody.appendChild(fragment);
                    } else {
                    tbody.innerHTML = '<tr><td colspan="12" class="empty-state">æš‚æ— åˆçº¦ä¿¡å·æ•°æ®</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½åˆçº¦ä¿¡å·å¤±è´¥:', error);
                document.getElementById('futuresSignalsTableBody').innerHTML = 
                    '<tr><td colspan="12" class="empty-state">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</td></tr>';
            }
        }
        
        // æ›´æ–°åˆçº¦ä¿¡å·çš„å®æ—¶ä»·æ ¼
        async function updateFuturesPrices() {
            try {
                const tbody = document.getElementById('futuresSignalsTableBody');
                const rows = tbody.querySelectorAll('tr[data-symbol]');
                
                if (rows.length === 0) return;
                
                // æ”¶é›†æ‰€æœ‰äº¤æ˜“å¯¹
                const symbols = Array.from(rows).map(row => row.getAttribute('data-symbol'));
                
                // æ‰¹é‡è·å–ä»·æ ¼
                const response = await fetch(`/api/realtime-prices?symbols=${symbols.join(',')}`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    // æ›´æ–°æ¯ä¸ªäº¤æ˜“å¯¹çš„ä»·æ ¼
                    rows.forEach(row => {
                        const symbol = row.getAttribute('data-symbol');
                        const priceInfo = data.data[symbol];
                        const priceCell = row.querySelector(`#price-${symbol.replace('/', '-')}`);
                        
                        if (priceInfo && priceCell) {
                            const oldPrice = parseFloat(priceCell.querySelector('strong')?.textContent.replace(/,/g, '') || '0');
                            const newPrice = priceInfo.price;
                            
                            if (oldPrice > 0 && newPrice !== oldPrice) {
                                // ä»·æ ¼å˜åŒ–ï¼Œæ·»åŠ åŠ¨ç”»æ•ˆæœ
                                priceCell.classList.add('price-updated');
                                setTimeout(() => priceCell.classList.remove('price-updated'), 500);
                            }
                            
                            const priceClass = priceInfo.change_24h >= 0 ? 'signal-buy' : 'signal-sell';
                            // ä»rowä¸­è·å–symbol
                            const symbol = row.getAttribute('data-symbol');
                            priceCell.innerHTML = `
                                <strong style="font-size: 16px;">${formatPrice(newPrice, symbol)}</strong>
                                ${priceInfo.change_24h !== null && priceInfo.change_24h !== undefined 
                                    ? `<br><small class="${priceClass}">${priceInfo.change_24h >= 0 ? '+' : ''}${formatNumber(priceInfo.change_24h, 2)}%</small>`
                                    : ''}
                            `;
                        }
                    });
                }
            } catch (error) {
                // é™é»˜å¤±è´¥ï¼Œä¸å½±å“ä¸»åŠŸèƒ½
            }
        }

        // å·²ç§»é™¤ï¼šå®æ—¶ä»·æ ¼æ›´æ–°åŠŸèƒ½ï¼ˆä¸å†éœ€è¦ï¼Œå®šæ—¶åˆ·æ–°ä¼šæ›´æ–°æ‰€æœ‰æ•°æ®åŒ…æ‹¬ä»·æ ¼ï¼‰

        // æ€§èƒ½ä¼˜åŒ–ï¼šé˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // æ€§èƒ½ä¼˜åŒ–ï¼šèŠ‚æµå‡½æ•°
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // å…¨å±€å®šæ—¶å™¨ç®¡ç†
        const timers = {
            dataRefresh: null,
            priceUpdate: null
        };

        // ç»Ÿä¸€çš„æ•°æ®åˆ·æ–°å‡½æ•°ï¼ˆæ ¹æ®å½“å‰æ¿€æ´»çš„tabåˆ·æ–°å¯¹åº”æ•°æ®ï¼‰
        async function refreshCurrentTabData() {
            const activeTab = document.querySelector('.tab-button.active');
            if (!activeTab) return;

            const tabName = activeTab.textContent.trim();

            try {
                if (tabName.includes('è¶‹åŠ¿åˆ¤æ–­')) {
                    await loadTrendAnalysis();
                } else if (tabName.includes('æŠ€æœ¯ä¿¡å·')) {
                    await loadTechnicalSignals();
                } else if (tabName.includes('åˆçº¦ä¿¡å·')) {
                    await loadFuturesSignals();
                    await updateFuturesPrices();
                }
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
            }
        }

        // åˆå§‹åŒ–
        async function init() {
            // åŠ è½½åˆå§‹æ•°æ®ï¼ˆè¶‹åŠ¿åˆ¤æ–­ä½œä¸ºé»˜è®¤TABï¼‰
            await loadTrendAnalysis();

            // æ¸…é™¤æ—§å®šæ—¶å™¨
            if (timers.dataRefresh) clearInterval(timers.dataRefresh);
            if (timers.priceUpdate) clearInterval(timers.priceUpdate);

            // ç»Ÿä¸€çš„æ•°æ®åˆ·æ–°å®šæ—¶å™¨ï¼ˆæ¯5åˆ†é’Ÿï¼Œåªåˆ·æ–°å½“å‰æ¿€æ´»çš„tabï¼‰
            timers.dataRefresh = setInterval(() => {
                refreshCurrentTabData();
            }, 300000); // 5åˆ†é’Ÿ

            // ä»·æ ¼æ›´æ–°å®šæ—¶å™¨ï¼ˆä»…åœ¨åˆçº¦ä¿¡å·tabæ—¶æ›´æ–°ï¼‰
            timers.priceUpdate = setInterval(() => {
                const activeTab = document.querySelector('.tab-button.active');
                if (activeTab && activeTab.textContent.includes('åˆçº¦ä¿¡å·')) {
                    updateFuturesPrices();
                }
            }, 10000); // æ”¹ä¸º10ç§’ï¼Œå‡å°‘è¯·æ±‚é¢‘ç‡
        }

        // å¸¦è¶…æ—¶çš„fetchè¯·æ±‚
        async function fetchWithTimeout(url, timeout = 5000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('è¯·æ±‚è¶…æ—¶');
                }
                throw error;
            }
        }

        // æ˜¾ç¤ºè¯¦ç»†åˆ†ææ¨¡æ€æ¡†
        async function showDetailedAnalysisModal(symbol) {
            const modal = document.getElementById('detailedAnalysisModal');
            const modalTitle = document.getElementById('modalSymbolTitle');
            const modalContent = document.getElementById('detailedAnalysisContent');
            // ä½¿ç”¨é»˜è®¤timeframeï¼ˆ1hï¼‰ï¼Œå› ä¸ºä¿¡å·åˆ—è¡¨TABå·²åˆ é™¤
            const timeframe = '1h';
            
            modalTitle.textContent = `${symbol} - è¯¦ç»†åˆ†æ`;
            modalContent.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            modal.classList.add('active');
            
            try {
                // å¯¹symbolè¿›è¡ŒURLç¼–ç ï¼Œå¤„ç†æ–œæ 
                const encodedSymbol = encodeURIComponent(symbol);
                
                // ç¬¬ä¸€æ­¥ï¼šå¿«é€ŸåŠ è½½æŠ€æœ¯æŒ‡æ ‡ï¼ˆä»ç¼“å­˜è¯»å–ï¼Œå¾ˆå¿«ï¼‰
                let indicatorsData = null;
                try {
                    const indicatorsResponse = await fetchWithTimeout(
                        `/api/technical-indicators?symbol=${encodeURIComponent(symbol)}&timeframe=${timeframe}`,
                        3000
                    );
                    if (indicatorsResponse.ok) {
                        indicatorsData = await indicatorsResponse.json();
                        // å…ˆæ˜¾ç¤ºæŠ€æœ¯æŒ‡æ ‡æ•°æ®ï¼Œè®©ç”¨æˆ·çœ‹åˆ°å†…å®¹
                        showDetailedAnalysis(symbol, indicatorsData, null, null);
                    }
                } catch (e) {
                    console.warn('è·å–æŠ€æœ¯æŒ‡æ ‡å¤±è´¥:', e);
                    modalContent.innerHTML = `<div class="empty-state">åŠ è½½æŠ€æœ¯æŒ‡æ ‡å¤±è´¥: ${e.message}</div>`;
                    return;
                }
                
                // ç¬¬äºŒæ­¥ï¼šå¼‚æ­¥åŠ è½½ä¿¡å·å’Œä»·æ ¼æ•°æ®ï¼ˆè¿™äº›å¯èƒ½è¾ƒæ…¢ï¼Œä½†ä¸é˜»å¡æ˜¾ç¤ºï¼‰
                let signalData = null;
                let priceData = null;
                let futuresSignalData = null;  // åˆçº¦ä¿¡å·æ•°æ®ï¼ˆåŒ…å«å‡¯åˆ©å…¬å¼å»ºè®®ï¼‰
                
                // å¹¶è¡ŒåŠ è½½ä¿¡å·å’Œä»·æ ¼ï¼Œè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
                // ä½¿ç”¨ Promise.allSettled ç¡®ä¿å³ä½¿æŸä¸ªè¯·æ±‚å¤±è´¥ä¹Ÿä¸å½±å“å…¶ä»–è¯·æ±‚
                const loadPromises = [
                    fetchWithTimeout(`/api/signals/${encodedSymbol}?timeframe=${timeframe}`, 15000)
                        .then(res => {
                            if (res.ok) {
                                return res.json();
                            }
                            return null;
                        })
                        .then(data => {
                            if (data) {
                                signalData = data;
                            }
                        })
                        .catch(e => {
                            console.warn('è·å–ç»¼åˆä¿¡å·å¤±è´¥ï¼ˆå·²è¶…æ—¶æˆ–å‡ºé”™ï¼‰:', e.message);
                            // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                        }),
                    
                    // è·å–åˆçº¦ä¿¡å·æ•°æ®ï¼ˆåŒ…å«å‡¯åˆ©å…¬å¼å»ºè®®ï¼‰
                    fetchWithTimeout(`/api/futures-signals`, 10000)
                        .then(res => {
                            if (res.ok) {
                                return res.json();
                            }
                            return null;
                        })
                        .then(data => {
                            if (data && data.success && data.data) {
                                // æ‰¾åˆ°å¯¹åº”äº¤æ˜“å¯¹çš„åˆçº¦ä¿¡å·æ•°æ®
                                const futuresSignal = data.data.find(item => item.symbol === symbol);
                                if (futuresSignal) {
                                    futuresSignalData = futuresSignal;
                                }
                            }
                        })
                        .catch(e => {
                            console.warn('è·å–åˆçº¦ä¿¡å·å¤±è´¥ï¼ˆå·²è¶…æ—¶æˆ–å‡ºé”™ï¼‰:', e.message);
                            // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                        }),
                    
                    fetchWithTimeout(`/api/price/${encodedSymbol}`, 8000)
                        .then(res => {
                            if (res.ok) {
                                return res.json();
                            }
                            return null;
                        })
                        .then(data => {
                            if (data) {
                                priceData = data;
                            }
                        })
                        .catch(e => {
                            console.warn('è·å–å®æ—¶ä»·æ ¼å¤±è´¥ï¼ˆå·²è¶…æ—¶æˆ–å‡ºé”™ï¼‰:', e.message);
                            // ä¸æŠ›å‡ºé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ
                        })
                ];
                
                // ä½¿ç”¨ allSettled ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆï¼ˆæ— è®ºæˆåŠŸæˆ–å¤±è´¥ï¼‰
                await Promise.allSettled(loadPromises);
                
                // å¦‚æœåˆçº¦ä¿¡å·æ•°æ®ä¸­æœ‰å‡¯åˆ©å…¬å¼å»ºè®®ï¼Œå°†å…¶åˆå¹¶åˆ°signalDataä¸­
                if (futuresSignalData && futuresSignalData.kelly_advice) {
                    if (!signalData) {
                        signalData = {};
                    }
                    signalData.kelly_advice = futuresSignalData.kelly_advice;
                    // å¦‚æœæœ‰ä»·æ ¼æ•°æ®ï¼Œä¹Ÿåˆå¹¶è¿›å»
                    if (futuresSignalData.current_price) {
                        if (!signalData.price) {
                            signalData.price = {};
                        }
                        signalData.price.current = futuresSignalData.current_price;
                    }
                    // åˆå¹¶ä¿¡å·æ–¹å‘ä¿¡æ¯ï¼ˆç”¨äºæ˜¾ç¤ºåšå¤š/åšç©ºï¼‰
                    if (futuresSignalData.signal_direction) {
                        signalData.signal_direction = futuresSignalData.signal_direction;
                    }
                    if (futuresSignalData.signal_text) {
                        signalData.signal_text = futuresSignalData.signal_text;
                    }
                    if (futuresSignalData.signal_class) {
                        signalData.signal_class = futuresSignalData.signal_class;
                    }
                }
                
                // æ›´æ–°æ˜¾ç¤ºï¼ŒåŒ…å«æ‰€æœ‰å·²åŠ è½½çš„æ•°æ®ï¼ˆå³ä½¿æŸäº›æ•°æ®ç¼ºå¤±ï¼‰
                showDetailedAnalysis(symbol, indicatorsData, signalData, priceData);
                
                // å¯åŠ¨å®æ—¶ä»·æ ¼æ›´æ–°ï¼ˆæ¯5ç§’æ›´æ–°ä¸€æ¬¡ï¼‰
                if (window.priceUpdateInterval) {
                    clearInterval(window.priceUpdateInterval);
                }
                window.priceUpdateInterval = setInterval(async () => {
                    try {
                        const encodedSymbol = encodeURIComponent(symbol);
                        const priceRes = await fetchWithTimeout(`/api/price/${encodedSymbol}`, 3000);
                        if (priceRes && priceRes.ok) {
                            const newPriceData = await priceRes.json();
                            updateRealTimePrice(newPriceData);
                        }
                    } catch (e) {
                        console.warn('æ›´æ–°å®æ—¶ä»·æ ¼å¤±è´¥:', e);
                    }
                }, 5000);
            } catch (error) {
                console.error('åŠ è½½è¯¦æƒ…å¤±è´¥:', error);
                modalContent.innerHTML = `<div class="empty-state">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æ›´æ–°å®æ—¶ä»·æ ¼
        function updateRealTimePrice(priceData) {
            const priceElement = document.getElementById('realtime-price-value');
            const changeElement = document.getElementById('realtime-price-change');
            if (priceElement && priceData && priceData.price) {
                const currentPrice = parseFloat(priceData.price);
                const oldPrice = parseFloat(priceElement.dataset.oldPrice || currentPrice);
                const change = currentPrice - oldPrice;
                const changePct = oldPrice > 0 ? (change / oldPrice * 100) : 0;
                
                const symbol = priceElement.dataset.symbol || '';
                priceElement.textContent = formatPrice(currentPrice, symbol) + ' USDT';
                priceElement.dataset.oldPrice = currentPrice;
                
                if (changeElement) {
                    const changeClass = change >= 0 ? 'signal-buy' : 'signal-sell';
                    changeElement.innerHTML = `
                        <span class="${changeClass}">
                            ${change >= 0 ? '+' : ''}${formatNumber(change)} 
                            (${change >= 0 ? '+' : ''}${formatNumber(changePct)}%)
                        </span>
                    `;
                }
                
                // æ·»åŠ é—ªçƒæ•ˆæœæç¤ºä»·æ ¼æ›´æ–°
                priceElement.style.animation = 'none';
                setTimeout(() => {
                    priceElement.style.animation = 'priceUpdate 0.5s ease-out';
                }, 10);
            }
        }
        
        // å…³é—­æ¨¡æ€æ¡†æ—¶æ¸…é™¤ä»·æ ¼æ›´æ–°å®šæ—¶å™¨
        function closeDetailedAnalysis() {
            const modal = document.getElementById('detailedAnalysisModal');
            modal.classList.remove('active');
            if (window.priceUpdateInterval) {
                clearInterval(window.priceUpdateInterval);
                window.priceUpdateInterval = null;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

