# 🚀 加密货币交易分析系统 - 启动说明

## ✅ 当前状态

**已启用真实API** - 从Binance和Gate.io获取实时市场数据

---

## 📋 Windows启动步骤

### 1. 清理旧进程（重要！）

```powershell
# 杀掉所有Python进程
taskkill /F /IM python.exe

# 等待5秒
Start-Sleep -Seconds 5

# 确认端口8000已释放
netstat -ano | findstr :8000
# 应该没有任何LISTENING进程
```

### 2. 拉取最新代码

```powershell
cd E:\mywork\crypto-analyzer
git pull origin master
```

### 3. 启动服务器

```powershell
python app/main.py
```

### 4. 确认启动成功

看到以下日志表示成功：
```
✅ 价格采集器初始化成功（真实API模式 - Binance + Gate.io）
✅ 新闻采集器初始化成功
✅ 技术分析器初始化成功
✅ 情绪分析器初始化成功
✅ 信号生成器初始化成功
🎉 分析模块初始化完成！
🚀 FastAPI 启动完成
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

### 5. 访问系统

- 🏥 健康检查：http://localhost:8000/health
- 📊 仪表盘API：http://localhost:8000/api/dashboard
- 🖥️ 仪表盘页面：http://localhost:8000/dashboard
- 💰 价格查询：http://localhost:8000/api/price/BTC-USDT

---

## ⚠️ 常见问题

### 问题1：端口被占用

**症状**：502 Bad Gateway 或 ERR_EMPTY_RESPONSE

**原因**：有多个Python进程在运行

**解决**：
```powershell
# 检查占用端口的进程
netstat -ano | findstr :8000

# 杀掉所有Python进程
taskkill /F /IM python.exe

# 等待清理完成
Start-Sleep -Seconds 5

# 重新启动
python app/main.py
```

### 问题2：Ctrl+C后进程没退出

**症状**：按Ctrl+C后，端口仍被占用

**原因**：Windows进程清理机制问题（已在最新版本修复）

**解决**：
```powershell
# 强制杀掉
taskkill /F /IM python.exe
```

### 问题3：显示模拟数据而非真实数据

**症状**：价格不变，显示"模拟模式"

**检查**：app/main.py 第85行
```python
USE_REAL_API = True  # 确保是True
```

如果是False，改为True后重启服务器。

---

## 🔄 切换API模式

### 使用真实API（默认）

编辑 `app/main.py` 第85行：
```python
USE_REAL_API = True
```

**数据来源**：Binance + Gate.io
**数据类型**：实时市场数据

### 使用模拟数据（测试用）

编辑 `app/main.py` 第85行：
```python
USE_REAL_API = False
```

**数据来源**：MockPriceCollector
**数据类型**：随机生成的模拟数据

修改后需要重启服务器。

---

## 🎯 系统功能

### ✅ 已启用
- 价格采集（真实API）
- 新闻采集
- 技术分析
- 情绪分析
- 信号生成
- Dashboard API

### ⚠️ 暂时禁用
- EnhancedDashboard（数据库问题）
- 价格缓存服务
- 合约交易API（部分）

---

## 📝 停止服务器

**正确方法**：按 `Ctrl+C`

服务器会自动清理所有模块并正常退出。

**强制停止**（如果Ctrl+C无效）：
```powershell
taskkill /F /IM python.exe
```

---

## 🆘 获取帮助

如果遇到问题：

1. 检查 `netstat -ano | findstr :8000` 是否有多个进程
2. 查看服务器启动日志，确认所有模块初始化成功
3. 确认访问的URL正确（localhost:8000，不是www.localhost.com）
4. 确保只在一个PowerShell窗口里启动服务器

---

**最后更新**：2025-10-29
**版本**：v1.0 - 真实API模式
