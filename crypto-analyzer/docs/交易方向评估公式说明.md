# 交易方向评估公式说明

## 概述

交易方向（做多/做空/观望）基于**信号评分（signal_score）**来判断，评分范围是 **-100 到 +100**：
- **正数** = 做多信号
- **负数** = 做空信号
- **接近0** = 观望

## 信号评分构成（4个维度）

**注意：** 多空比已从评估公式中移除，因为多空比是用户数的多空比，不是实际仓位的多空比，不能准确反映市场真实的持仓情况。

### 1. 资金费率分析（权重 35%，原30%）

**做多信号（正分）：**
- 资金费率 < -0.1%：+30分（空头过度拥挤，做多机会）
- 资金费率 < -0.05%：+15分（空头占优）

**做空信号（负分）：**
- 资金费率 > 0.1%：-30分（多头过度拥挤，做空机会）
- 资金费率 > 0.05%：-15分（多头占优）

**说明：** 资金费率反映市场情绪，费率极高说明多头过度拥挤，容易出现回调；费率极低说明空头过度拥挤，容易出现反弹。

---

### 2. 持仓量变化分析（权重 20%，原15%）

**做多信号（正分）：**
- 持仓量增加 > 5% **且** 价格上涨：+10分（趋势延续，看多）

**做空信号（负分）：**
- 持仓量增加 > 5% **且** 价格下跌：-10分（趋势延续，看空）

**中性：**
- 持仓量减少 > 5%：0分（可能反转）

**说明：** 持仓量增加配合价格同向运动，通常意味着趋势延续；持仓量减少可能意味着趋势反转。

---

### 3. 技术指标分析（权重 35%，原30%）

#### 4.1 RSI（相对强弱指标）

**做多信号（正分）：**
- RSI < 30（超卖）：+15分

**做空信号（负分）：**
- RSI > 70（超买）：-15分

#### 4.2 MACD（指数平滑移动平均线）

**做多信号（正分）：**
- MACD金叉：+10分

**做空信号（负分）：**
- MACD死叉：-10分

#### 4.3 EMA（指数移动平均线）

**做多信号（正分）：**
- EMA趋势为看涨（bullish）：+5分

**做空信号（负分）：**
- EMA趋势为看跌（bearish）：-5分

#### 4.4 技术评分

- 技术评分（technical_score）以50为中心，转换为-30到+30的分数
- 公式：`tech_score += (technical_score - 50) * 0.6`

**说明：** 技术指标综合反映价格趋势，多个指标一致时信号更可靠。

---

### 4. 价格趋势分析（权重 10%，保持不变）

**做多信号（正分）：**
- 24小时涨幅 > 3%：+5分

**做空信号（负分）：**
- 24小时跌幅 > 3%：-5分

**说明：** 价格趋势作为确认信号，权重较低，主要用于验证其他信号。

---

## 最终评分计算

```
signal_score = (资金费率评分 × 0.35) + 
               (持仓量变化评分 × 0.20) + 
               (技术指标评分 × 0.35) + 
               (价格趋势评分 × 0.10)
```

**权重总和：** 35% + 20% + 35% + 10% = 100%

**说明：** 原多空比的25%权重已重新分配给：
- 资金费率：30% → 35%（+5%）
- 持仓量变化：15% → 20%（+5%）
- 技术指标：30% → 35%（+5%）
- 价格趋势：10%（保持不变）

**归一化：** 最终评分限制在 **-100 到 +100** 之间。

---

## 方向判断阈值

| 信号评分范围 | 交易方向 | 说明 |
|------------|---------|------|
| **≥ 60** | **强烈做多** | 多个维度强烈看多 |
| **≥ 30** | **做多** | 整体看多信号 |
| **-30 ~ 30** | **观望** | 信号不明确，多空平衡 |
| **≤ -30** | **做空** | 整体看空信号 |
| **≤ -60** | **强烈做空** | 多个维度强烈看空 |

---

## 为什么全部显示"观望"？

如果所有交易对都显示"观望"，说明：

1. **信号评分在 -30 到 30 之间**，各个维度的信号相互抵消
2. **可能的原因：**
   - 资金费率在正常范围（-0.05% ~ 0.05%）
   - 持仓量变化不明显
   - 技术指标处于中性区域（RSI在30-70之间，MACD无明确信号）
   - 价格波动较小（24小时涨跌幅 < 3%）

3. **这是正常的市场状态**，说明市场处于震荡或平衡状态，没有明确的趋势信号。

---

## 如何获得明确的交易方向？

### 做多信号需要：
- ✅ 资金费率 < -0.05%（空头占优）
- ✅ RSI < 30（超卖）
- ✅ MACD金叉
- ✅ 持仓量增加且价格上涨

### 做空信号需要：
- ✅ 资金费率 > 0.05%（多头占优）
- ✅ RSI > 70（超买）
- ✅ MACD死叉
- ✅ 持仓量增加且价格下跌

---

## 注意事项

1. **权重分配：** 资金费率和技术指标各占35%，是最重要的两个维度
2. **多空比已移除：** 多空比是用户数的多空比，不是实际仓位的多空比，因此不再参与评分计算（但仍会在前端显示供参考）
3. **综合判断：** 单一指标不足以判断方向，需要多个维度综合评估
4. **市场环境：** 在震荡市场中，信号评分容易处于观望区间，这是正常的
5. **风险控制：** 即使有明确的交易方向，也要设置止损和止盈

---

## 示例计算

### 示例1：做多信号

```
资金费率：-0.08% → -15分 × 0.3 = -4.5分
多空比：0.6 → +12分 × 0.25 = +3分
持仓量：增加6%且价格上涨 → +10分 × 0.15 = +1.5分
技术指标：RSI=28, MACD金叉 → +25分 × 0.3 = +7.5分
价格趋势：+2% → 0分 × 0.1 = 0分

总评分 = -4.5 + 3 + 1.5 + 7.5 + 0 = +7.5分
结果：观望（因为 < 30分）
```

### 示例2：强烈做多信号

```
资金费率：-0.12% → +30分 × 0.3 = +9分
多空比：0.4 → +25分 × 0.25 = +6.25分
持仓量：增加8%且价格上涨 → +10分 × 0.15 = +1.5分
技术指标：RSI=25, MACD金叉, EMA看涨 → +30分 × 0.3 = +9分
价格趋势：+5% → +5分 × 0.1 = +0.5分

总评分 = 9 + 6.25 + 1.5 + 9 + 0.5 = +26.25分
结果：观望（因为 < 30分，但接近做多）
```

**注意：** 即使多个维度都看多，如果信号不够强烈，仍可能处于观望区间。需要更极端的信号才能触发明确的交易方向。

