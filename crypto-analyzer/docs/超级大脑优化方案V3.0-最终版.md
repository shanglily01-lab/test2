# è¶…çº§å¤§è„‘äº¤æ˜“ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ V3.0 - æœ€ç»ˆç‰ˆ

## ğŸ“Š å½“å‰é—®é¢˜è¯Šæ–­

### æ•°æ®è¡¨ç° (2026-02-06 ~ 2026-02-07)
```
æ—¥æœŸ       äº¤æ˜“æ¬¡æ•°  èƒœç‡    æ€»ç›ˆäº
2026-02-07  211ç¬”   34.60%  -$2,036.81
2026-02-06  337ç¬”   34.72%  -$3,369.59
2026-02-05  270ç¬”   74.81%  +$2,995.99  (å”¯ä¸€ç›ˆåˆ©æ—¥)
```

### æ ¸å¿ƒé—®é¢˜æ€»ç»“

1. **æ—¶é—´å°ºåº¦é”™é…**: Big4 (30H) åˆ¤æ–­å¯¹ï¼Œä½†4Håˆ¤æ–­å®Œå…¨å¤±æ•ˆ
2. **å…¥åœºä»·æ ¼æå·®**: åšå¤šä¹°é«˜ä½ï¼Œåšç©ºä¹°ä½ä½ï¼Œè¿½æ¶¨æ€è·Œ
3. **æŒä»“ç®¡ç†ç¼ºå¤±**: æµ®ç›ˆ860U â†’ å¹³ä»“156Uï¼Œåˆ©æ¶¦å›å82%
4. **ç›ˆäºæ¯”å¤±è¡¡**: ç›ˆåˆ©å‡ Uï¼ŒäºæŸå‡ åUï¼Œæ¯”ä¾‹1:1.78å€’æŒ‚

---

## ğŸ¯ V3.0æ ¸å¿ƒä¼˜åŒ–æ–¹æ¡ˆ

### ä¼˜åŒ–1: å¤šæ—¶é—´å‘¨æœŸæƒé‡è¯„åˆ†ç³»ç»Ÿ â­â­â­

#### æ–°è¯„åˆ†ä½“ç³»
```python
è¯„åˆ†ç»´åº¦                     æƒé‡åˆ†é…    åˆ¤æ–­ä¾æ®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Big4ä¿¡å· (30Hå®è§‚è¶‹åŠ¿)     5åˆ†        æ•´ä½“å¸‚åœºæ–¹å‘
2. 5Hè¶‹åŠ¿ (3æ ¹Kçº¿ç¡®è®¤)        8åˆ†        ä¸­æœŸè¶‹åŠ¿ç¡®è®¤
3. 2Hå†…15Mä¿¡å· (5æ ¹ä»¥ä¸Š)      10åˆ†       çŸ­æœŸè¶‹åŠ¿ä¸»å¯¼
4. é‡èƒ½ä»·æ ¼é…åˆ              7åˆ†        æˆäº¤é‡ç¡®è®¤
5. å…¶ä»–æŠ€æœ¯æŒ‡æ ‡              10åˆ†       RSI/MACD/å¸ƒæ—å¸¦ç­‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»åˆ†                         40åˆ†       (æ–°çš„æ€»åˆ†ä¸Šé™)
å¼€ä»“é˜ˆå€¼                     25åˆ†       (62.5%ä»¥ä¸Šæ‰å¼€ä»“)
```

#### è¯¦ç»†è¯„åˆ†é€»è¾‘

**1. Big4ä¿¡å· (max 5åˆ†)**
```python
big4_signal = get_big4_signal()  # BULL/BEAR
big4_strength = get_big4_strength()  # 0-100

if big4_signal == position_direction:
    if big4_strength >= 80:
        score += 5
    elif big4_strength >= 70:
        score += 4
    elif big4_strength >= 60:
        score += 3
    else:
        score += 0  # å¼ºåº¦ä¸å¤Ÿï¼Œä¸åŠ åˆ†
```

**2. 5Hè¶‹åŠ¿ (max 8åˆ†)**
```python
# è·å–æœ€è¿‘3æ ¹5H Kçº¿
klines_5h = get_klines('5h', limit=3)

bull_count = sum(1 for k in klines_5h if k['close'] > k['open'])
bear_count = sum(1 for k in klines_5h if k['close'] < k['open'])

if position_direction == 'LONG':
    if bull_count == 3:
        score += 8  # è¿ç»­3æ ¹é˜³çº¿ï¼Œå¼ºåŠ¿
    elif bull_count == 2:
        score += 5  # 2æ ¹é˜³çº¿
    else:
        score += 0  # è¶‹åŠ¿ä¸æ˜ï¼Œä¸åŠ åˆ†

if position_direction == 'SHORT':
    if bear_count == 3:
        score += 8  # è¿ç»­3æ ¹é˜´çº¿ï¼Œå¼ºåŠ¿
    elif bear_count == 2:
        score += 5  # 2æ ¹é˜´çº¿
    else:
        score += 0
```

**3. 2Hå†…15Mä¿¡å· (max 10åˆ†)**
```python
# è·å–æœ€è¿‘2å°æ—¶çš„15M Kçº¿ (8æ ¹)
klines_15m = get_klines('15m', limit=8)

bull_count = sum(1 for k in klines_15m if k['close'] > k['open'])
bear_count = sum(1 for k in klines_15m if k['close'] < k['open'])

if position_direction == 'LONG':
    if bull_count >= 6:
        score += 10  # 6æ ¹ä»¥ä¸Šé˜³çº¿ï¼Œå¼ºçƒˆçœ‹å¤š
    elif bull_count >= 5:
        score += 7   # 5æ ¹é˜³çº¿
    elif bull_count >= 4:
        score += 3   # 4æ ¹é˜³çº¿ï¼Œå‹‰å¼º
    else:
        score += 0   # ä¸è¶³4æ ¹ï¼Œä¸å¼€ä»“

if position_direction == 'SHORT':
    if bear_count >= 6:
        score += 10
    elif bear_count >= 5:
        score += 7
    elif bear_count >= 4:
        score += 3
    else:
        score += 0
```

**4. é‡èƒ½ä»·æ ¼é…åˆ (max 7åˆ†)**
```python
# è®¡ç®—æœ€è¿‘5æ ¹15M Kçº¿çš„é‡èƒ½
recent_volumes = [k['volume'] for k in klines_15m[:5]]
avg_volume = sum(recent_volumes) / len(recent_volumes)

# æœ€æ–°ä¸€æ ¹Kçº¿çš„é‡èƒ½
latest_volume = klines_15m[0]['volume']
latest_price_change = (klines_15m[0]['close'] - klines_15m[0]['open']) / klines_15m[0]['open']

if position_direction == 'LONG' and latest_price_change > 0:
    if latest_volume > avg_volume * 1.5:
        score += 7  # é‡ä»·é½å‡
    elif latest_volume > avg_volume * 1.2:
        score += 4  # é‡èƒ½æ¸©å’Œæ”¾å¤§
    else:
        score += 1  # é‡èƒ½ä¸€èˆ¬

if position_direction == 'SHORT' and latest_price_change < 0:
    if latest_volume > avg_volume * 1.5:
        score += 7  # é‡ä»·é½è·Œ
    elif latest_volume > avg_volume * 1.2:
        score += 4
    else:
        score += 1
```

**5. å…¶ä»–æŠ€æœ¯æŒ‡æ ‡ (max 10åˆ†)**
```python
# RSIæŒ‡æ ‡ (max 3åˆ†)
rsi = calculate_rsi(14)
if position_direction == 'LONG':
    if 30 <= rsi <= 50:
        score += 3  # è¶…å–åŒºå›å‡
    elif 50 < rsi <= 60:
        score += 2
    else:
        score += 0  # RSIè¿‡é«˜æˆ–è¿‡ä½

# MACDæŒ‡æ ‡ (max 4åˆ†)
macd_signal = calculate_macd()
if macd_signal == position_direction:
    score += 4

# å¸ƒæ—å¸¦ä½ç½® (max 3åˆ†)
bb_position = calculate_bollinger_position()
if position_direction == 'LONG' and bb_position == 'lower':
    score += 3  # ä»·æ ¼åœ¨å¸ƒæ—å¸¦ä¸‹è½¨é™„è¿‘
elif position_direction == 'LONG' and bb_position == 'middle':
    score += 2
```

---

### ä¼˜åŒ–2: 5Mçº§åˆ«ç²¾å‡†å…¥åœºæœºåˆ¶ â­â­â­

#### æ ¸å¿ƒé€»è¾‘
```
ä¿¡å·è§¦å‘åï¼Œä¸ç«‹å³å¼€ä»“ï¼Œç­‰å¾…5Mçº§åˆ«çš„ä»·æ ¼ç¡®è®¤
åšå¤š: ç­‰ç¬¬ä¸€æ ¹5Mé˜³çº¿åæ‰ä¹°å…¥
åšç©º: ç­‰ç¬¬ä¸€æ ¹5Mé˜´çº¿åæ‰å–å‡º
```

#### è¯¦ç»†å®ç°

**åˆ†æ‰¹å…¥åœºç­–ç•¥**
```python
class SmartEntryExecutor:
    def __init__(self):
        self.entry_timeout = 60  # 1å°æ—¶å»ºä»“æ—¶é™
        self.batch_config = [
            {'ratio': 0.30, 'name': 'ç¬¬1æ‰¹'},
            {'ratio': 0.30, 'name': 'ç¬¬2æ‰¹'},
            {'ratio': 0.40, 'name': 'ç¬¬3æ‰¹'}
        ]

    async def execute_entry(self, signal, symbol, position_side):
        """æ‰§è¡Œåˆ†æ‰¹å…¥åœº"""
        start_time = datetime.now()
        batches_filled = []

        print(f"[å…¥åœºæ‰§è¡Œ] {symbol} {position_side} ä¿¡å·è§¦å‘ï¼Œå¼€å§‹ç­‰å¾…5Mç¡®è®¤...")

        # ç¬¬1æ‰¹å…¥åœº
        batch1_price = await self.wait_for_5m_confirmation(
            symbol, position_side, batch_num=1
        )
        if batch1_price and self._is_within_timeout(start_time):
            await self.place_order(symbol, position_side, self.batch_config[0]['ratio'], batch1_price)
            batches_filled.append({'batch': 1, 'price': batch1_price})
            print(f"âœ… ç¬¬1æ‰¹å…¥åœºå®Œæˆ: ${batch1_price:.2f}")
        else:
            print(f"âŒ ç¬¬1æ‰¹è¶…æ—¶æˆ–æ¡ä»¶ä¸æ»¡è¶³ï¼Œæ”¾å¼ƒæ•´ä¸ªä¿¡å·")
            return None

        # ç­‰å¾…15åˆ†é’Ÿåå°è¯•ç¬¬2æ‰¹
        await asyncio.sleep(15 * 60)

        if not self._is_within_timeout(start_time):
            print(f"â° å»ºä»“è¶…æ—¶ï¼Œä»…æŒæœ‰ç¬¬1æ‰¹ (30%)")
            return batches_filled

        batch2_price = await self.wait_for_5m_confirmation(
            symbol, position_side, batch_num=2, first_entry_price=batch1_price
        )
        if batch2_price:
            await self.place_order(symbol, position_side, self.batch_config[1]['ratio'], batch2_price)
            batches_filled.append({'batch': 2, 'price': batch2_price})
            print(f"âœ… ç¬¬2æ‰¹å…¥åœºå®Œæˆ: ${batch2_price:.2f}")

        # å†ç­‰å¾…15åˆ†é’Ÿåå°è¯•ç¬¬3æ‰¹
        await asyncio.sleep(15 * 60)

        if not self._is_within_timeout(start_time):
            print(f"â° å»ºä»“è¶…æ—¶ï¼ŒæŒæœ‰å‰2æ‰¹ (60%)")
            return batches_filled

        batch3_price = await self.wait_for_5m_confirmation(
            symbol, position_side, batch_num=3, first_entry_price=batch1_price
        )
        if batch3_price:
            await self.place_order(symbol, position_side, self.batch_config[2]['ratio'], batch3_price)
            batches_filled.append({'batch': 3, 'price': batch3_price})
            print(f"âœ… ç¬¬3æ‰¹å…¥åœºå®Œæˆ: ${batch3_price:.2f}")

        return batches_filled

    async def wait_for_5m_confirmation(
        self, symbol, position_side, batch_num, first_entry_price=None
    ):
        """ç­‰å¾…5M Kçº¿ç¡®è®¤"""
        max_wait = 15  # æœ€å¤šç­‰å¾…15åˆ†é’Ÿ (3æ ¹5M Kçº¿)
        wait_count = 0

        while wait_count < max_wait:
            # è·å–æœ€æ–°5M Kçº¿
            latest_5m = await self.get_latest_5m_kline(symbol)

            current_price = latest_5m['close']
            is_bullish = latest_5m['close'] > latest_5m['open']
            is_bearish = latest_5m['close'] < latest_5m['open']

            # åšå¤šåœºæ™¯
            if position_side == 'LONG':
                # ç¬¬1æ‰¹: ç­‰å¾…ç¬¬ä¸€æ ¹é˜³çº¿
                if batch_num == 1 and is_bullish:
                    return current_price

                # ç¬¬2æ‰¹: ä»·æ ¼é«˜äºç¬¬1æ‰¹ OR å‡ºç°é˜³çº¿
                if batch_num == 2:
                    if current_price > first_entry_price:
                        return current_price  # ä»·æ ¼çªç ´ï¼Œç«‹å³ä¹°å…¥
                    elif is_bullish:
                        return current_price  # å›è°ƒååå¼¹

                # ç¬¬3æ‰¹: è¶‹åŠ¿æŒç»­ç¡®è®¤
                if batch_num == 3 and is_bullish:
                    return current_price

            # åšç©ºåœºæ™¯
            if position_side == 'SHORT':
                if batch_num == 1 and is_bearish:
                    return current_price

                if batch_num == 2:
                    if current_price < first_entry_price:
                        return current_price
                    elif is_bearish:
                        return current_price

                if batch_num == 3 and is_bearish:
                    return current_price

            # ç­‰å¾…ä¸‹ä¸€æ ¹5M Kçº¿
            await asyncio.sleep(5 * 60)
            wait_count += 5

        print(f"â° ç¬¬{batch_num}æ‰¹ç­‰å¾…è¶…æ—¶ï¼Œæ”¾å¼ƒ")
        return None

    def _is_within_timeout(self, start_time):
        """æ£€æŸ¥æ˜¯å¦è¶…è¿‡1å°æ—¶å»ºä»“æ—¶é™"""
        elapsed = (datetime.now() - start_time).total_seconds() / 60
        return elapsed < self.entry_timeout
```

---

### ä¼˜åŒ–3: å®ç”¨ç§»åŠ¨æ­¢ç›ˆæœºåˆ¶ â­â­â­

#### æ ¸å¿ƒé€»è¾‘
```
ç›ˆåˆ©é—¨æ§›: 40U
ç§»åŠ¨è§„åˆ™: æ¯å‘ä¸Šç›ˆåˆ©10Uï¼Œæ­¢æŸå‘ä¸Šç§»åŠ¨10U
å›ºå®šæ­¢ç›ˆ: 6%
å›ºå®šæ­¢æŸ: 3%
```

#### è¯¦ç»†å®ç°

```python
class PositionManager:
    def __init__(self):
        self.trailing_threshold = 40  # 40Uå¼€å¯ç§»åŠ¨æ­¢ç›ˆ
        self.trailing_step = 10       # æ¯10Uç§»åŠ¨ä¸€æ¬¡
        self.fixed_stop_loss_pct = 0.03  # å›ºå®šæ­¢æŸ3%
        self.fixed_take_profit_pct = 0.06  # å›ºå®šæ­¢ç›ˆ6%

    async def manage_position(self, position):
        """æŒä»“ç®¡ç†ä¸»å¾ªç¯"""
        position_id = position['id']
        entry_price = position['entry_price']
        position_side = position['position_side']

        # åˆå§‹åŒ–æ­¢æŸæ­¢ç›ˆ
        if position_side == 'LONG':
            stop_loss_price = entry_price * (1 - self.fixed_stop_loss_pct)
            take_profit_price = entry_price * (1 + self.fixed_take_profit_pct)
        else:
            stop_loss_price = entry_price * (1 + self.fixed_stop_loss_pct)
            take_profit_price = entry_price * (1 - self.fixed_take_profit_pct)

        max_unrealized_pnl = 0  # è®°å½•æœ€é«˜æµ®ç›ˆ
        trailing_active = False  # ç§»åŠ¨æ­¢ç›ˆæ˜¯å¦æ¿€æ´»

        while True:
            # è·å–å½“å‰ä»·æ ¼å’Œæµ®ç›ˆ
            current_price = await self.get_current_price(position['symbol'])
            unrealized_pnl = self.calculate_unrealized_pnl(
                position, current_price
            )

            # æ›´æ–°æœ€é«˜æµ®ç›ˆ
            if unrealized_pnl > max_unrealized_pnl:
                max_unrealized_pnl = unrealized_pnl

            # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç§»åŠ¨æ­¢ç›ˆé—¨æ§›
            if not trailing_active and unrealized_pnl >= self.trailing_threshold:
                trailing_active = True
                print(f"[ç§»åŠ¨æ­¢ç›ˆ] {position['symbol']} æµ®ç›ˆ{unrealized_pnl:.2f}Uï¼Œæ¿€æ´»ç§»åŠ¨æ­¢ç›ˆ")

            # æ‰§è¡Œç§»åŠ¨æ­¢ç›ˆ
            if trailing_active:
                # è®¡ç®—åº”è¯¥ä¿æŠ¤çš„åˆ©æ¶¦
                profit_to_protect = (max_unrealized_pnl // self.trailing_step) * self.trailing_step

                if position_side == 'LONG':
                    # åšå¤š: æ­¢æŸä»· = å…¥åœºä»· + ä¿æŠ¤åˆ©æ¶¦
                    new_stop_loss = entry_price + profit_to_protect
                    if new_stop_loss > stop_loss_price:
                        stop_loss_price = new_stop_loss
                        print(f"[ç§»åŠ¨æ­¢ç›ˆ] æ­¢æŸä¸Šç§»è‡³ ${stop_loss_price:.2f}ï¼Œä¿æŠ¤{profit_to_protect:.2f}Uåˆ©æ¶¦")
                else:
                    # åšç©º: æ­¢æŸä»· = å…¥åœºä»· - ä¿æŠ¤åˆ©æ¶¦
                    new_stop_loss = entry_price - profit_to_protect
                    if new_stop_loss < stop_loss_price:
                        stop_loss_price = new_stop_loss
                        print(f"[ç§»åŠ¨æ­¢ç›ˆ] æ­¢æŸä¸‹ç§»è‡³ ${stop_loss_price:.2f}ï¼Œä¿æŠ¤{profit_to_protect:.2f}Uåˆ©æ¶¦")

            # æ£€æŸ¥æ­¢æŸè§¦å‘
            if position_side == 'LONG' and current_price <= stop_loss_price:
                await self.close_position(position_id, current_price, 'è§¦å‘æ­¢æŸ')
                break
            if position_side == 'SHORT' and current_price >= stop_loss_price:
                await self.close_position(position_id, current_price, 'è§¦å‘æ­¢æŸ')
                break

            # æ£€æŸ¥æ­¢ç›ˆè§¦å‘
            if position_side == 'LONG' and current_price >= take_profit_price:
                await self.close_position(position_id, current_price, 'è§¦å‘æ­¢ç›ˆ')
                break
            if position_side == 'SHORT' and current_price <= take_profit_price:
                await self.close_position(position_id, current_price, 'è§¦å‘æ­¢ç›ˆ')
                break

            # æ£€æŸ¥è¶…æ—¶
            holding_minutes = self.get_holding_minutes(position)
            if holding_minutes >= 240:  # 4å°æ—¶
                await self.close_position(position_id, current_price, 'è¶…æ—¶å¹³ä»“')
                break

            # ç­‰å¾…ä¸‹ä¸€æ¬¡æ£€æŸ¥ (æ¯30ç§’)
            await asyncio.sleep(30)

    def calculate_unrealized_pnl(self, position, current_price):
        """è®¡ç®—æœªå®ç°ç›ˆäº (USD)"""
        entry_price = position['entry_price']
        quantity = position['quantity']
        position_side = position['position_side']

        if position_side == 'LONG':
            pnl = (current_price - entry_price) * quantity
        else:
            pnl = (entry_price - current_price) * quantity

        return pnl
```

---

### ä¼˜åŒ–4: åŠ¨æ€æ­¢æŸç›‘æ§æœºåˆ¶ â­â­

#### æ ¸å¿ƒé€»è¾‘
```
äºæŸ > 1%: è¿›å…¥ç›‘æ§çŠ¶æ€ï¼Œè§‚å¯Ÿ5Mé‡ä»·
äºæŸ < 1%: æ­£å¸¸æŒæœ‰ï¼Œè§‚å¯Ÿè¶‹åŠ¿
```

#### è¯¦ç»†å®ç°

```python
class DynamicStopLoss:
    def __init__(self):
        self.warning_threshold = 0.01  # 1%è­¦æˆ’çº¿

    async def monitor_losing_positions(self, position):
        """ç›‘æ§äºæŸæŒä»“"""
        position_id = position['id']
        symbol = position['symbol']
        position_side = position['position_side']

        while True:
            current_price = await self.get_current_price(symbol)
            unrealized_pnl_pct = self.calculate_pnl_pct(position, current_price)

            # äºæŸè¶…è¿‡1%ï¼Œè¿›å…¥é«˜åº¦è­¦æˆ’
            if unrealized_pnl_pct < -self.warning_threshold:
                print(f"[æ­¢æŸç›‘æ§] {symbol} äºæŸ{unrealized_pnl_pct*100:.2f}%ï¼Œè¿›å…¥ç›‘æ§")

                # è§‚å¯Ÿä¸‹ä¸€æ ¹5M Kçº¿
                await asyncio.sleep(5 * 60)

                next_5m = await self.get_latest_5m_kline(symbol)
                is_reverse = self._check_reverse_signal(next_5m, position_side)
                has_volume = self._check_volume_support(next_5m, symbol)

                # åå‘ä¿¡å· + é‡èƒ½æ”¯æŒ = ç«‹å³æ­¢æŸ
                if is_reverse and has_volume:
                    print(f"[æ­¢æŸç›‘æ§] {symbol} ç¡®è®¤åå‘ï¼Œæ‰§è¡Œæ­¢æŸ")
                    await self.close_position(position_id, current_price, 'åŠ¨æ€æ­¢æŸ')
                    break

            # äºæŸå°äº1%ï¼Œç»§ç»­è§‚å¯Ÿ
            await asyncio.sleep(30)

    def _check_reverse_signal(self, kline, position_side):
        """æ£€æŸ¥åå‘ä¿¡å·"""
        if position_side == 'LONG':
            # åšå¤šä½†å‡ºç°é˜´çº¿
            return kline['close'] < kline['open']
        else:
            # åšç©ºä½†å‡ºç°é˜³çº¿
            return kline['close'] > kline['open']

    def _check_volume_support(self, kline, symbol):
        """æ£€æŸ¥é‡èƒ½æ˜¯å¦æ”¯æŒåå‘"""
        # è·å–æœ€è¿‘10æ ¹5M Kçº¿çš„å¹³å‡é‡
        recent_klines = self.get_klines(symbol, '5m', limit=10)
        avg_volume = sum(k['volume'] for k in recent_klines) / 10

        # å½“å‰Kçº¿é‡èƒ½æ˜¯å¦å¤§äºå¹³å‡é‡çš„1.2å€
        return kline['volume'] > avg_volume * 1.2
```

---

### ä¼˜åŒ–5: ä¿è¯é‡‘åˆ†çº§ç®¡ç† â­

#### åˆ†çº§ç­–ç•¥

```python
class MarginManager:
    def __init__(self):
        self.margin_config = {
            'whitelist': 600,      # ç™½åå•
            'blacklist_level_1': 600,  # é»‘åå•1çº§
            'blacklist_level_2': 300,  # é»‘åå•2çº§
            'blacklist_level_3': 0,    # é»‘åå•3çº§(ç¦æ­¢äº¤æ˜“)
            'default': 400         # é»˜è®¤
        }

    def get_margin_amount(self, symbol):
        """è·å–è¯¥äº¤æ˜“å¯¹çš„ä¿è¯é‡‘é¢åº¦"""
        rating = self.get_symbol_rating(symbol)

        if rating == 0:  # ç™½åå•
            return self.margin_config['whitelist']
        elif rating == 1:  # é»‘åå•1çº§
            return self.margin_config['blacklist_level_1']
        elif rating == 2:  # é»‘åå•2çº§
            return self.margin_config['blacklist_level_2']
        elif rating == 3:  # é»‘åå•3çº§
            return 0  # ç¦æ­¢äº¤æ˜“
        else:
            return self.margin_config['default']

    def get_symbol_rating(self, symbol):
        """ä»æ•°æ®åº“è·å–äº¤æ˜“å¯¹è¯„çº§"""
        cursor.execute("""
            SELECT rating_level
            FROM trading_symbol_rating
            WHERE symbol = %s
        """, (symbol,))
        result = cursor.fetchone()
        return result['rating_level'] if result else None
```

---

## ğŸ“‹ å¼€å‘å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µ: æ ¸å¿ƒåŠŸèƒ½å¼€å‘ (2-3å¤©)

#### ä»»åŠ¡1: 5Mç²¾å‡†å…¥åœºæœºåˆ¶
**æ–‡ä»¶**: `app/services/smart_entry_executor_v3.py` (æ–°å»º)

**åŠŸèƒ½**:
- ç­‰å¾…5M Kçº¿ç¡®è®¤
- åˆ†æ‰¹å…¥åœº (30/30/40)
- 1å°æ—¶å»ºä»“æ—¶é™
- æ”¯æŒéƒ¨åˆ†å»ºä»“

**å¼€å‘è¦ç‚¹**:
```python
# æ ¸å¿ƒå‡½æ•°
1. wait_for_5m_confirmation()  - ç­‰å¾…5Mç¡®è®¤
2. execute_entry()             - æ‰§è¡Œåˆ†æ‰¹å…¥åœº
3. place_order()               - ä¸‹å•
4. _is_within_timeout()        - æ£€æŸ¥è¶…æ—¶
```

---

#### ä»»åŠ¡2: ç§»åŠ¨æ­¢ç›ˆæœºåˆ¶
**æ–‡ä»¶**: `app/services/position_manager_v3.py` (æ–°å»º)

**åŠŸèƒ½**:
- 40Ué—¨æ§›
- æ¯10Uç§»åŠ¨ä¸€æ¬¡
- å›ºå®šæ­¢ç›ˆ6%ã€æ­¢æŸ3%

**å¼€å‘è¦ç‚¹**:
```python
# æ ¸å¿ƒå‡½æ•°
1. manage_position()           - æŒä»“ç®¡ç†ä¸»å¾ªç¯
2. calculate_unrealized_pnl()  - è®¡ç®—æµ®ç›ˆ
3. update_trailing_stop()      - æ›´æ–°ç§»åŠ¨æ­¢æŸ
4. check_stop_triggers()       - æ£€æŸ¥æ­¢æŸæ­¢ç›ˆè§¦å‘
```

---

#### ä»»åŠ¡3: å¤šæ—¶é—´å‘¨æœŸè¯„åˆ†ç³»ç»Ÿ
**æ–‡ä»¶**: `app/strategies/signal_scorer_v3.py` (æ–°å»º)

**åŠŸèƒ½**:
- Big4: 5åˆ†
- 5Hè¶‹åŠ¿: 8åˆ†
- 15Mä¿¡å·: 10åˆ†
- é‡ä»·é…åˆ: 7åˆ†
- æŠ€æœ¯æŒ‡æ ‡: 10åˆ†

**å¼€å‘è¦ç‚¹**:
```python
# æ ¸å¿ƒå‡½æ•°
1. calculate_total_score()     - è®¡ç®—æ€»åˆ†
2. score_big4()                - Big4è¯„åˆ†
3. score_5h_trend()            - 5Hè¶‹åŠ¿è¯„åˆ†
4. score_15m_signal()          - 15Mä¿¡å·è¯„åˆ†
5. score_volume_price()        - é‡ä»·è¯„åˆ†
```

---

### ç¬¬äºŒé˜¶æ®µ: é›†æˆæµ‹è¯• (1å¤©)

#### é›†æˆæ­¥éª¤
1. ä¿®æ”¹ `smart_trader_service.py`ï¼Œæ¥å…¥æ–°æ¨¡å—
2. é…ç½®å‚æ•°å’Œå¼€å…³
3. å°è§„æ¨¡æµ‹è¯• (5-10ä¸ªäº¤æ˜“å¯¹)
4. è§‚å¯Ÿæ—¥å¿—å’Œæ•°æ®

---

### ç¬¬ä¸‰é˜¶æ®µ: ä¸Šçº¿ä¼˜åŒ– (æŒç»­)

#### ç›‘æ§æŒ‡æ ‡
```
1. æ—¥äº¤æ˜“æ¬¡æ•°: ç›®æ ‡100ç¬”ä»¥å†…
2. èƒœç‡: ç›®æ ‡45%+
3. ç›ˆäºæ¯”: ç›®æ ‡1.5:1
4. æ—¥ç›ˆäº: ç›®æ ‡$Â±200
```

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### çŸ­æœŸ (ç¬¬ä¸€å‘¨)
- âœ… äº¤æ˜“æ¬¡æ•°: ä»300ç¬” â†’ é™è‡³100ç¬”
- âœ… èƒœç‡: ä»34% â†’ æå‡è‡³40-45%
- âœ… æ—¥äºæŸ: ä»$2000 â†’ å‡å°‘è‡³$500ä»¥å†…

### ä¸­æœŸ (ç¬¬äºŒå‘¨)
- âœ… èƒœç‡: ä»40% â†’ æå‡è‡³45-50%
- âœ… ç›ˆäºæ¯”: ä»1:1.78 â†’ æ”¹å–„è‡³1.5:1
- âœ… æ—¥ç›ˆäº: ä»-$2000 â†’ å¹³è¡¡$Â±200

### é•¿æœŸ (ç¬¬ä¸‰å‘¨+)
- âœ… èƒœç‡: ç¨³å®šåœ¨50-55%
- âœ… ç›ˆäºæ¯”: æ”¹å–„è‡³2:1
- âœ… æ—¥ç›ˆåˆ©: ç¨³å®š$300-500+
- âœ… æœˆå›æŠ¥: 10%+

---

## ğŸ”§ å…³é”®ä»£ç æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶
1. `app/services/smart_entry_executor_v3.py` - 5Mç²¾å‡†å…¥åœº
2. `app/services/position_manager_v3.py` - ç§»åŠ¨æ­¢ç›ˆç®¡ç†
3. `app/strategies/signal_scorer_v3.py` - å¤šå‘¨æœŸè¯„åˆ†
4. `app/services/dynamic_stop_loss.py` - åŠ¨æ€æ­¢æŸç›‘æ§
5. `app/services/margin_manager.py` - ä¿è¯é‡‘åˆ†çº§

### éœ€ä¿®æ”¹æ–‡ä»¶
1. `smart_trader_service.py` - ä¸»æœåŠ¡å…¥å£
2. `smart_decision_brain_enhanced.py` - å†³ç­–å¤§è„‘
3. `advanced_signal_detector.py` - ä¿¡å·æ£€æµ‹å™¨

---

## ğŸ’¡ æ ¸å¿ƒæ”¹è¿›æ€»ç»“

### æ”¹è¿›1: æ—¶é—´å°ºåº¦é—®é¢˜ â†’ å¤šå‘¨æœŸæƒé‡ç³»ç»Ÿ
- Big4åªå 5åˆ† (12.5%)
- 5Hå 8åˆ† (20%)
- 15Må 10åˆ† (25%) â† æœ€é«˜æƒé‡
- è§£å†³äº†"Big4å¯¹ä½†4Hé”™"çš„çŸ›ç›¾

### æ”¹è¿›2: å…¥åœºä»·æ ¼é—®é¢˜ â†’ 5Mç²¾å‡†ç­‰å¾…
- ä¸åœ¨ä¸‹è·Œä¸­ä¹°å…¥
- ç­‰ç¬¬ä¸€æ ¹5Måè½¬åæ‰å…¥åœº
- å®Œç¾è§£å†³è¿½é«˜é—®é¢˜

### æ”¹è¿›3: æŒä»“ç®¡ç†é—®é¢˜ â†’ å®ç”¨ç§»åŠ¨æ­¢ç›ˆ
- 40Ué—¨æ§› + 10Uæ­¥è¿›
- ç®€å•é«˜æ•ˆï¼Œæ˜“äºå®ç°
- ä¿æŠ¤860U â†’ 156Uè¿™ç§æƒ¨å‰§ä¸å†å‘ç”Ÿ

### æ”¹è¿›4: ç›ˆäºæ¯”é—®é¢˜ â†’ å›ºå®šæ¯”ä¾‹ + ç§»åŠ¨æ­¢ç›ˆ
- å›ºå®šæ­¢ç›ˆ6% vs æ­¢æŸ3% = 2:1
- ç§»åŠ¨æ­¢ç›ˆé”å®šå¤§éƒ¨åˆ†åˆ©æ¶¦
- åŠ¨æ€æ­¢æŸå‡å°‘æ— è°“äºæŸ

---

## âš ï¸ é£é™©æç¤º

1. **æ–°ç­–ç•¥éœ€è¦æ—¶é—´éªŒè¯**: è‡³å°‘1-2å‘¨æ•°æ®
2. **å¸‚åœºç¯å¢ƒå¯èƒ½å˜åŒ–**: ç­–ç•¥éœ€è¦æŒç»­ä¼˜åŒ–
3. **è¿‡åº¦ä¼˜åŒ–é£é™©**: é¿å…é’ˆå¯¹å†å²æ•°æ®è¿‡æ‹Ÿåˆ
4. **æŠ€æœ¯å®ç°é£é™©**: ä»£ç bugå¯èƒ½å¯¼è‡´æ„å¤–æŸå¤±

## ğŸ”’ ç†”æ–­æœºåˆ¶

```python
# å•æ—¥äºæŸç†”æ–­
if ä»Šæ—¥äºæŸ > $800:
    åœæ­¢å¼€æ–°ä»“

# è¿ç»­äºæŸç†”æ–­
if è¿ç»­3å¤©äºæŸ > $2000:
    æš‚åœäº¤æ˜“ï¼Œäººå·¥å®¡æ ¸

# èƒœç‡ç†”æ–­
if æœ€è¿‘50ç¬”èƒœç‡ < 35%:
    é™ä½ä»“ä½è‡³50%
```

---

**V3.0æ ¸å¿ƒç†å¿µ**: ä»"è¿½æ¶¨æ€è·Œ"è½¬å˜ä¸º"ç­‰å¾…ç¡®è®¤"ï¼Œä»"è¢«åŠ¨æ­¢æŸ"è½¬å˜ä¸º"ä¸»åŠ¨ç®¡ç†"

**é¢„æœŸç»“æœ**: 2å‘¨å†…å®ç°ç›ˆäºå¹³è¡¡ï¼Œ1ä¸ªæœˆå†…å®ç°ç¨³å®šç›ˆåˆ©
