# Paper Trading 使用指南

## 📊 概述

Paper Trading（模拟现货交易）是一个功能完整的模拟交易系统，允许您在无风险的环境中练习交易策略，测试投资想法，学习交易技巧。

## 🎯 核心功能

### 1. 账户管理

#### 账户信息
- **初始余额**：创建账户时的初始资金（默认 10,000 USDT）
- **当前余额**：可用于交易的资金
- **冻结余额**：待成交订单占用的资金
- **总资产**：当前余额 + 持仓市值
- **总盈亏**：累计盈亏金额和百分比

#### 账户统计
- **总交易次数**：历史交易总数
- **胜率**：盈利交易占比
- **盈利交易**：盈利次数
- **亏损交易**：亏损次数
- **已实现盈亏**：已平仓的盈亏
- **未实现盈亏**：持仓中的盈亏

### 2. 交易功能

#### 买入订单
- **市价买入**：按当前市场价格立即买入
- **限价买入**：设置买入价格，价格达到时自动买入
- **数量输入**：支持小数数量（如 0.1 BTC）
- **金额计算**：自动计算所需金额（含手续费）

#### 卖出订单
- **市价卖出**：按当前市场价格立即卖出
- **限价卖出**：设置卖出价格，价格达到时自动卖出
- **数量选择**：可选择全部或部分持仓
- **盈亏预览**：卖出前显示预估盈亏

#### 手续费
- **费率**：0.1%（买入和卖出都收取）
- **自动计算**：系统自动计算并扣除手续费
- **透明显示**：交易明细中显示手续费

### 3. 持仓管理

#### 持仓信息
- **交易对**：持有的币种（如 BTC/USDT）
- **持仓数量**：持有的币数量
- **可用数量**：可用于卖出的数量（扣除冻结）
- **平均成本**：平均买入价格
- **当前价格**：实时市场价格
- **市值**：持仓当前价值
- **盈亏**：未实现盈亏（金额和百分比）

#### 持仓操作
- **查看详情**：点击查看持仓详细信息
- **快速卖出**：一键卖出全部持仓
- **部分卖出**：自定义卖出数量

### 4. 待成交订单（条件单）

#### 创建待成交订单
- **触发价格**：设置触发执行的价格
- **订单类型**：
  - **买入订单**：当前价格 ≤ 触发价格时执行
  - **卖出订单**：当前价格 ≥ 触发价格时执行
- **自动执行**：价格达到触发条件时自动执行
- **资金冻结**：创建订单时冻结相应资金

#### 订单管理
- **查看列表**：查看所有待成交订单
- **撤单**：取消未执行的订单
- **订单状态**：
  - **PENDING**：等待触发
  - **EXECUTED**：已执行
  - **DELETED**：已取消

#### 自动监控
- **后端监控**：服务器每 5 秒自动检查订单
- **无需页面**：即使页面关闭也会自动执行
- **精确匹配**：通过订单 ID 精确匹配执行

### 5. 自动交易功能

#### 自动买入
- **启用开关**：勾选启用自动买入
- **触发价格**：设置买入触发价格
- **工作逻辑**：
  - 当前价格 ≥ 触发价格：创建待买入订单
  - 当前价格 < 触发价格：立即执行买入
- **自动关闭**：订单执行后自动关闭功能

#### 自动卖出
- **启用开关**：勾选启用自动卖出
- **触发价格**：设置卖出触发价格
- **工作逻辑**：
  - 当前价格 < 触发价格：创建待卖出订单
  - 当前价格 ≥ 触发价格：立即执行卖出
- **自动关闭**：订单执行后自动关闭功能

### 6. 交易历史

#### 历史记录
- **订单列表**：所有历史订单
- **交易列表**：所有历史交易
- **筛选功能**：按时间、币种、类型筛选
- **详细信息**：查看每笔交易的详细信息

#### 交易明细
- **订单 ID**：唯一订单标识
- **交易对**：交易的币种
- **方向**：买入/卖出
- **数量**：交易数量
- **价格**：成交价格
- **金额**：交易金额
- **手续费**：收取的手续费
- **盈亏**：已实现盈亏
- **时间**：交易时间

### 7. EMA 信号集成

#### 信号显示
- **信号按钮**：右上角显示信号数量
- **信号列表**：点击查看所有 EMA 信号
- **信号详情**：显示币种、方向、强度、价格、时间

#### 快速交易
- **一键买入**：根据信号快速买入
- **一键卖出**：根据信号快速卖出
- **信号筛选**：按币种、方向筛选信号

## 🎨 界面特性

### 现代化设计
- **深色主题**：专业的交易界面
- **实时更新**：价格和持仓实时刷新
- **响应式布局**：适配不同屏幕
- **直观图标**：清晰的视觉反馈

### 交互功能
- **实时价格**：自动刷新当前价格
- **价格输入**：支持手动输入或点击选择
- **数量计算**：自动计算交易金额
- **盈亏预览**：交易前显示预估盈亏
- **提示消息**：操作结果提示（右下角）

## 📱 页面布局

### 顶部区域
- **账户信息卡片**：显示账户余额和统计
- **交易对选择**：选择要交易的币种
- **当前价格**：实时显示当前价格
- **EMA 信号按钮**：查看交易信号

### 交易区域
- **买入/卖出表单**：输入交易参数
- **自动交易设置**：配置自动买入/卖出
- **快速操作按钮**：买入/卖出按钮

### 持仓区域
- **当前持仓列表**：显示所有持仓
- **持仓详情卡片**：每个持仓的详细信息
- **操作按钮**：卖出、查看详情

### 订单区域
- **待成交订单**：条件单列表
- **历史订单**：已执行的订单
- **交易历史**：所有交易记录

## 🔄 工作流程

### 买入流程
1. 选择交易对（如 BTC/USDT）
2. 输入买入数量
3. 选择立即买入或设置触发价格
4. 点击"买入"按钮
5. 系统检查余额并执行交易
6. 更新持仓和账户信息

### 卖出流程
1. 选择有持仓的交易对
2. 输入卖出数量（或选择全部）
3. 选择立即卖出或设置触发价格
4. 点击"卖出"按钮
5. 系统检查持仓并执行交易
6. 更新持仓和账户信息

### 条件单流程
1. 创建待成交订单（设置触发价格）
2. 系统冻结相应资金/持仓
3. 后端监控服务每 5 秒检查价格
4. 价格达到触发条件时自动执行
5. 解冻资金并更新订单状态

## 💡 使用技巧

### 1. 风险管理
- **分散投资**：不要把所有资金投入一个币种
- **设置止损**：使用条件单设置止损价格
- **控制仓位**：合理控制单笔交易金额
- **关注盈亏**：及时关注持仓盈亏情况

### 2. 交易策略
- **趋势跟踪**：跟随市场趋势交易
- **均值回归**：在价格偏离均值时交易
- **信号交易**：根据 EMA 信号交易
- **组合策略**：结合多个策略

### 3. 条件单技巧
- **买入条件单**：设置低于当前价格的触发价
- **卖出条件单**：设置高于当前价格的触发价
- **分批建仓**：使用多个条件单分批买入
- **止盈止损**：设置止盈和止损价格

### 4. 自动交易技巧
- **合理设置触发价**：不要设置过于激进的价格
- **及时调整**：根据市场变化调整触发价
- **监控执行**：关注订单执行情况
- **手动干预**：必要时手动取消或修改

## 🔧 技术实现

### 后端架构
- **交易引擎**：`PaperTradingEngine` 处理所有交易逻辑
- **数据库存储**：MySQL 存储账户、订单、交易数据
- **价格服务**：`PriceCacheService` 提供实时价格
- **自动执行**：`PendingOrderExecutor` 后台监控执行

### API 接口
- **账户管理**：`GET /api/paper-trading/account`
- **下单**：`POST /api/paper-trading/order`
- **持仓查询**：`GET /api/paper-trading/positions`
- **待成交订单**：
  - `POST /api/paper-trading/pending-order` - 创建
  - `GET /api/paper-trading/pending-orders` - 查询
  - `DELETE /api/paper-trading/pending-order` - 撤销
- **交易历史**：`GET /api/paper-trading/trades`

### 数据库表
- `paper_trading_accounts`：账户信息
- `paper_trading_positions`：持仓信息
- `paper_trading_orders`：订单记录
- `paper_trading_trades`：交易记录
- `paper_trading_pending_orders`：待成交订单

## 📝 注意事项

### 1. 数据准确性
- **价格来源**：使用真实交易所价格
- **手续费**：模拟真实交易手续费
- **滑点**：市价单按当前价格执行

### 2. 系统限制
- **单账户**：默认使用账户 ID 1
- **余额检查**：买入时检查余额，卖出时检查持仓
- **订单状态**：订单执行后无法撤销

### 3. 性能优化
- **价格缓存**：使用缓存服务提升性能
- **异步处理**：后台异步执行订单
- **数据库优化**：使用索引提升查询速度

## 🚀 快速开始

### 1. 初始化账户
首次使用需要初始化账户：
- 系统会自动创建默认账户
- 初始余额：10,000 USDT
- 账户 ID：1

### 2. 开始交易
1. 选择交易对（如 BTC/USDT）
2. 输入交易数量
3. 点击"买入"或"卖出"
4. 查看交易结果

### 3. 设置条件单
1. 输入触发价格
2. 输入交易数量
3. 点击"买入"或"卖出"
4. 系统创建待成交订单
5. 价格达到时自动执行

### 4. 启用自动交易
1. 勾选"自动买入"或"自动卖出"
2. 设置触发价格
3. 点击"买入"或"卖出"按钮
4. 系统根据价格自动创建订单或执行交易

## 🎓 学习建议

1. **从小额开始**：先用小额资金练习
2. **记录交易**：记录每笔交易的原因和结果
3. **分析盈亏**：定期分析交易盈亏
4. **学习策略**：尝试不同的交易策略
5. **风险管理**：学习风险管理技巧

## 📊 功能对比

| 功能 | 模拟交易 | 真实交易 |
|------|---------|---------|
| 资金 | 虚拟资金 | 真实资金 |
| 风险 | 无风险 | 有风险 |
| 价格 | 真实价格 | 真实价格 |
| 手续费 | 模拟手续费 | 真实手续费 |
| 执行速度 | 即时执行 | 可能有延迟 |
| 滑点 | 无滑点 | 可能有滑点 |

---

**最后更新**：2025-11-09  
**版本**：v1.0

