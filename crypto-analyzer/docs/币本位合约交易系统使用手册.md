# å¸æœ¬ä½åˆçº¦äº¤æ˜“ç³»ç»Ÿä½¿ç”¨æ‰‹å†Œ

## ğŸ“š ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
4. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
5. [å‰ç«¯ç•Œé¢](#å‰ç«¯ç•Œé¢)
6. [APIæ¥å£](#apiæ¥å£)
7. [æ•°æ®åº“ç»“æ„](#æ•°æ®åº“ç»“æ„)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
9. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

### ä»€ä¹ˆæ˜¯å¸æœ¬ä½åˆçº¦?

å¸æœ¬ä½åˆçº¦(Coin-Margined Futures)æ˜¯ä»¥åŠ å¯†è´§å¸(å¦‚BTCã€ETH)ä½œä¸ºä¿è¯é‡‘å’Œç»“ç®—è´§å¸çš„æ°¸ç»­åˆçº¦ã€‚ä¸Uæœ¬ä½åˆçº¦(ä»¥USDTä½œä¸ºä¿è¯é‡‘)ç›¸æ¯”:

| ç‰¹æ€§ | å¸æœ¬ä½åˆçº¦ | Uæœ¬ä½åˆçº¦ |
|------|----------|----------|
| ä¿è¯é‡‘è´§å¸ | BTC, ETHç­‰ | USDT |
| ç»“ç®—è´§å¸ | BTC, ETHç­‰ | USDT |
| äº¤æ˜“å¯¹æ ¼å¼ | BTC/USD, ETH/USD | BTC/USDT, ETH/USDT |
| APIç«¯ç‚¹ | dapi.binance.com | fapi.binance.com |
| WebSocket | dstream.binance.com | fstream.binance.com |
| Account ID | 3 | 2 |

### ç³»ç»Ÿæ¶æ„

```
å¸æœ¬ä½åˆçº¦äº¤æ˜“ç³»ç»Ÿ
â”‚
â”œâ”€â”€ å¸æœ¬ä½äº¤æ˜“å¼•æ“ (CoinFuturesTradingEngine)
â”‚   â”œâ”€â”€ å¼€ä»“/å¹³ä»“æ‰§è¡Œ
â”‚   â”œâ”€â”€ æŒä»“ç®¡ç†
â”‚   â””â”€â”€ é£é™©æ§åˆ¶
â”‚
â”œâ”€â”€ è‡ªåŠ¨äº¤æ˜“æœåŠ¡ (CoinFuturesTraderService)
â”‚   â”œâ”€â”€ æ™ºèƒ½ä¿¡å·è¯„åˆ†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ é˜²è¿½é«˜/é˜²æ€è·Œè¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ åˆ†æ‰¹å»ºä»“æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ æ™ºèƒ½å¹³ä»“ä¼˜åŒ–å™¨
â”‚   â”œâ”€â”€ Big4è¶‹åŠ¿æ£€æµ‹
â”‚   â””â”€â”€ 3çº§é»‘åå•è¯„çº§åˆ¶åº¦
â”‚
â”œâ”€â”€ WebSocketä»·æ ¼æœåŠ¡ (å¸æœ¬ä½ä¸“ç”¨)
â”‚   â”œâ”€â”€ å®æ—¶ä»·æ ¼æ¨é€ (1ç§’æ›´æ–°)
â”‚   â”œâ”€â”€ å¤šçº§é™çº§ç­–ç•¥
â”‚   â””â”€â”€ ä»·æ ¼ç¼“å­˜æœºåˆ¶
â”‚
â””â”€â”€ å‰ç«¯ç•Œé¢
    â”œâ”€â”€ å¸æœ¬ä½åˆçº¦äº¤æ˜“é¡µé¢
    â”œâ”€â”€ è´¦æˆ·ä¿¡æ¯å±•ç¤º
    â”œâ”€â”€ æŒä»“ç®¡ç†
    â”œâ”€â”€ äº¤æ˜“å†å²
    â””â”€â”€ å¤ç›˜åˆ†æ (24H)
```

---

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- MySQL 5.7+
- å¸å®‰API Key (å¦‚éœ€å®ç›˜äº¤æ˜“)

### 2. é…ç½®æ–‡ä»¶

åœ¨ `config.yaml` ä¸­é…ç½®å¸æœ¬ä½äº¤æ˜“å¯¹:

```yaml
coin_futures_symbols:
  - BTCUSD_PERP    # BTC/USD æ°¸ç»­åˆçº¦
  - ETHUSD_PERP    # ETH/USD æ°¸ç»­åˆçº¦
  - BNBUSD_PERP    # BNB/USD æ°¸ç»­åˆçº¦
  - SOLUSD_PERP    # SOL/USD æ°¸ç»­åˆçº¦
  - XRPUSD_PERP    # XRP/USD æ°¸ç»­åˆçº¦
  - ADAUSD_PERP    # ADA/USD æ°¸ç»­åˆçº¦
  - DOTUSD_PERP    # DOT/USD æ°¸ç»­åˆçº¦
  - LINKUSD_PERP   # LINK/USD æ°¸ç»­åˆçº¦
  - BCHUSD_PERP    # BCH/USD æ°¸ç»­åˆçº¦
  - LTCUSD_PERP    # LTC/USD æ°¸ç»­åˆçº¦
  - ETCUSD_PERP    # ETC/USD æ°¸ç»­åˆçº¦
  - XLMUSD_PERP    # XLM/USD æ°¸ç»­åˆçº¦
  - XMRUSD_PERP    # XMR/USD æ°¸ç»­åˆçº¦
  - DASHUSD_PERP   # DASH/USD æ°¸ç»­åˆçº¦
  - ZECUSD_PERP    # ZEC/USD æ°¸ç»­åˆçº¦
  - XTZUSD_PERP    # XTZ/USD æ°¸ç»­åˆçº¦
  - ATOMUSD_PERP   # ATOM/USD æ°¸ç»­åˆçº¦
  - ZRXUSD_PERP    # ZRX/USD æ°¸ç»­åˆçº¦
  - COMPUSD_PERP   # COMP/USD æ°¸ç»­åˆçº¦
  - ALGOUSD_PERP   # ALGO/USD æ°¸ç»­åˆçº¦
  - DOGEUSD_PERP   # DOGE/USD æ°¸ç»­åˆçº¦
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

åˆ›å»ºå¸æœ¬ä½åˆçº¦è´¦æˆ·:

```sql
-- æ’å…¥å¸æœ¬ä½åˆçº¦è´¦æˆ·
INSERT INTO futures_trading_accounts (
    id,
    user_id,
    account_name,
    account_type,
    initial_balance,
    current_balance,
    available_balance,
    frozen_margin,
    unrealized_pnl,
    realized_pnl,
    total_trades,
    winning_trades,
    losing_trades,
    created_at,
    updated_at
) VALUES (
    3,                      -- account_id = 3 (å¸æœ¬ä½ä¸“ç”¨)
    1000,                   -- user_id
    'å¸æœ¬ä½åˆçº¦è´¦æˆ·',
    'coin_futures',         -- è´¦æˆ·ç±»å‹
    100000.00,              -- åˆå§‹èµ„é‡‘ $100,000
    100000.00,
    100000.00,
    0.00,
    0.00,
    0.00,
    0,
    0,
    0,
    NOW(),
    NOW()
);
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# 1. å¯åŠ¨APIæœåŠ¡å™¨
python app/main.py

# 2. å¯åŠ¨å¸æœ¬ä½åˆçº¦è‡ªåŠ¨äº¤æ˜“æœåŠ¡
python coin_futures_trader_service.py
```

### 5. è®¿é—®å‰ç«¯

æ‰“å¼€æµè§ˆå™¨è®¿é—®:
- å¸æœ¬ä½åˆçº¦äº¤æ˜“: http://localhost:9020/coin_futures_trading
- å¤ç›˜åˆ†æ(24H): http://localhost:9020/futures_review (åˆ‡æ¢åˆ°"å¸æœ¬ä½åˆçº¦"æ ‡ç­¾)

---

## æ ¸å¿ƒç‰¹æ€§

### 1. æ™ºèƒ½ä¿¡å·è¯„åˆ†ç³»ç»Ÿ (35åˆ†å¼€ä»“é˜ˆå€¼)

å¤šç»´åº¦ä¿¡å·åˆ†æ,ç¡®ä¿åªäº¤æ˜“é«˜è´¨é‡ä¿¡å·:

```python
ä¿¡å·è¯„åˆ† = ä½ç½®è¯„åˆ† + è¶‹åŠ¿è¯„åˆ† + åŠ¨é‡è¯„åˆ† + é‡èƒ½è¯„åˆ†

# å„ç»´åº¦æƒé‡(ä»æ•°æ®åº“åŠ è½½)
- ä½ç½®æƒé‡: 30%
- è¶‹åŠ¿æƒé‡: 25%
- åŠ¨é‡æƒé‡: 25%
- é‡èƒ½æƒé‡: 20%

# å¼€ä»“æ¡ä»¶
if æ€»è¯„åˆ† >= 35åˆ†:
    æ‰§è¡Œå¼€ä»“
```

**è¯„åˆ†æ ‡å‡†**:
- **ä½ç½®è¯„åˆ†** (0-30åˆ†): åŸºäº24Hä»·æ ¼åŒºé—´ä½ç½®
  - åšå¤š: åœ¨20%ä»¥ä¸‹ä½ç½®å¾—åˆ†é«˜
  - åšç©º: åœ¨80%ä»¥ä¸Šä½ç½®å¾—åˆ†é«˜

- **è¶‹åŠ¿è¯„åˆ†** (0-25åˆ†): åŸºäºEMAè¶‹åŠ¿æ–¹å‘å’Œå¼ºåº¦
  - å¤šå¤´è¶‹åŠ¿: EMA9 > EMA21, ä¸”å·®è·å¤§
  - ç©ºå¤´è¶‹åŠ¿: EMA9 < EMA21, ä¸”å·®è·å¤§

- **åŠ¨é‡è¯„åˆ†** (0-25åˆ†): åŸºäºä»·æ ¼å˜åŒ–å¹…åº¦
  - 3%ä»¥ä¸Šå˜åŒ–: æ»¡åˆ†
  - 2-3%å˜åŒ–: ä¸­ç­‰åˆ†
  - <2%å˜åŒ–: ä½åˆ†

- **é‡èƒ½è¯„åˆ†** (0-20åˆ†): åŸºäºæˆäº¤é‡æ”¾å¤§å€æ•°
  - æ”¾é‡3å€ä»¥ä¸Š: æ»¡åˆ†
  - æ”¾é‡2-3å€: ä¸­ç­‰åˆ†
  - æ”¾é‡<2å€: ä½åˆ†

### 2. é˜²è¿½é«˜/é˜²æ€è·Œè¿‡æ»¤å™¨

è‡ªåŠ¨è¿‡æ»¤é«˜é£é™©ä½ç½®:

```python
# åšå¤šè¿‡æ»¤
if position_side == 'LONG':
    if price_position_24h > 80%:
        æ‹’ç»å¼€ä»“  # é˜²æ­¢è¿½é«˜

# åšç©ºè¿‡æ»¤
if position_side == 'SHORT':
    if price_position_24h < 20%:
        æ‹’ç»å¼€ä»“  # é˜²æ­¢æ€è·Œ
```

### 3. åˆ†æ‰¹å»ºä»“æ‰§è¡Œå™¨ (SmartEntryExecutor)

æ™ºèƒ½åˆ†3æ‰¹å»ºä»“,å¹³æ»‘æˆæœ¬ä»·æ ¼:

```python
æ‰¹æ¬¡é…ç½®:
- ç¬¬1æ‰¹: 30% ä¿è¯é‡‘ (5åˆ†é’Ÿé‡‡æ ·çª—å£)
- ç¬¬2æ‰¹: 30% ä¿è¯é‡‘ (5åˆ†é’Ÿé‡‡æ ·çª—å£)
- ç¬¬3æ‰¹: 40% ä¿è¯é‡‘ (5åˆ†é’Ÿé‡‡æ ·çª—å£)

ä»·æ ¼é‡‡æ ·ç­–ç•¥:
- æ¯10ç§’é‡‡æ ·1æ¬¡ä»·æ ¼
- 5åˆ†é’Ÿå†…æ‰¾æœ€ä¼˜ä»·æ ¼
- åšå¤š: é€‰æ‹©æœ€ä½ä»·
- åšç©º: é€‰æ‹©æœ€é«˜ä»·
```

### 4. æ™ºèƒ½å¹³ä»“ä¼˜åŒ–å™¨ (SmartExitOptimizer)

åŸºäºç›ˆäºåŠ¨æ€è°ƒæ•´å¹³ä»“ç­–ç•¥:

| ç›ˆäºåŒºé—´ | ç­–ç•¥ | è¯´æ˜ |
|---------|------|------|
| ç›ˆåˆ© â‰¥ 3% | å›æ’¤50%è§¦å‘å¹³ä»“ | ä¿æŠ¤é«˜ç›ˆåˆ© |
| ç›ˆåˆ© 1-3% | å›æ’¤40%è§¦å‘å¹³ä»“ | é”å®šä¸­ç­‰ç›ˆåˆ© |
| ç›ˆåˆ© 0-1% | å»¶é•¿30åˆ†é’ŸæŒä»“ | ç»™äºˆæ›´å¤šæ—¶é—´ |
| äºæŸ 0-0.5% | å¿«é€Ÿæ­¢æŸ | å°é¢äºæŸåŠæ—¶ç¦»åœº |
| äºæŸ > æ­¢æŸä»· | å¼ºåˆ¶æ­¢æŸ | ä¸¥æ ¼æ‰§è¡Œæ­¢æŸ |

### 5. Big4è¶‹åŠ¿æ£€æµ‹

ç›‘æ§BTC/ETH/BNB/SOLå››å¤§å¸ç§,åˆ¤æ–­æ•´ä½“å¸‚åœºè¶‹åŠ¿:

```python
Big4 = ['BTC/USD', 'ETH/USD', 'BNB/USD', 'SOL/USD']

è¶‹åŠ¿åˆ¤æ–­:
- 3ä¸ªæˆ–ä»¥ä¸Šå¸ç§ä¸Šæ¶¨ â†’ å¤šå¤´å¸‚åœº
- 3ä¸ªæˆ–ä»¥ä¸Šå¸ç§ä¸‹è·Œ â†’ ç©ºå¤´å¸‚åœº
- å¦åˆ™ â†’ éœ‡è¡å¸‚åœº

åº”ç”¨:
- å¤šå¤´å¸‚åœº: ä¼˜å…ˆåšå¤šä¿¡å·
- ç©ºå¤´å¸‚åœº: ä¼˜å…ˆåšç©ºä¿¡å·
- éœ‡è¡å¸‚åœº: åŒå‘äº¤æ˜“,æé«˜é˜ˆå€¼
```

### 6. 3çº§é»‘åå•è¯„çº§åˆ¶åº¦

è‡ªåŠ¨è¯„ä¼°äº¤æ˜“å¯¹è¡¨ç°,è°ƒæ•´ä»“ä½æˆ–ç¦æ­¢äº¤æ˜“:

| çº§åˆ« | æ¡ä»¶ | æ“ä½œ |
|-----|------|------|
| Level 1 | è¿‘æœŸèƒœç‡ä½ | é™ä½ä»“ä½åˆ°50% |
| Level 2 | ä¸­æœŸæŒç»­äºæŸ | é™ä½ä»“ä½åˆ°25% |
| Level 3 | é•¿æœŸè¡¨ç°ä¸ä½³ | å®Œå…¨ç¦æ­¢äº¤æ˜“ |

è‡ªåŠ¨è¯„çº§æ›´æ–°:
- æ¯æ—¥å‡Œæ™¨æ›´æ–°è¯„çº§
- æ ¹æ®æœ€è¿‘30å¤©äº¤æ˜“æ•°æ®
- è‡ªåŠ¨æ·»åŠ /ç§»é™¤é»‘åå•

---

## é…ç½®è¯´æ˜

### é£é™©æ§åˆ¶é…ç½®

```yaml
signals:
  risk:
    live_max_position_usdt: 400      # å•ç¬”æœ€å¤§ä¿è¯é‡‘
    max_position: 0.5                # æœ€å¤§æŒä»“æ¯”ä¾‹
    stop_loss_pct: 0.02              # æ­¢æŸç™¾åˆ†æ¯” 2%
    take_profit_pct: 0.06            # æ­¢ç›ˆç™¾åˆ†æ¯” 6%

  margin:
    live:
      mode: fixed                     # ä¿è¯é‡‘æ¨¡å¼: fixed/percent
      fixed_amount: 400               # å›ºå®šä¿è¯é‡‘é‡‘é¢
      percent: 1                      # æŒ‰ç™¾åˆ†æ¯”(å¦‚æœmode=percent)
```

### è‡ªé€‚åº”å‚æ•°é…ç½®

```yaml
signals:
  adaptive:
    long:
      min_holding_minutes: 60         # æœ€å°æŒä»“æ—¶é—´
      position_size_multiplier: 1.0   # ä»“ä½å€æ•°
      stop_loss_pct: 0.03             # æ­¢æŸç™¾åˆ†æ¯”
      take_profit_pct: 0.02           # æ­¢ç›ˆç™¾åˆ†æ¯”
    short:
      min_holding_minutes: 60
      position_size_multiplier: 1.0
      stop_loss_pct: 0.03
      take_profit_pct: 0.02
```

### åˆ†æ‰¹å»ºä»“é…ç½®

```yaml
signals:
  batch_entry:
    enabled: true
    batch_ratios: [0.3, 0.3, 0.4]     # åˆ†æ‰¹æ¯”ä¾‹
    sampling_interval_seconds: 10     # é‡‡æ ·é—´éš”(ç§’)
    sampling_window_seconds: 300      # é‡‡æ ·çª—å£(5åˆ†é’Ÿ)
    time_window_minutes: 30           # æ€»æ—¶é—´çª—å£
    whitelist_symbols: []             # ç™½åå•(ç©ºåˆ™å…¨éƒ¨å¯ç”¨)
```

### æ™ºèƒ½å¹³ä»“é…ç½®

```yaml
signals:
  smart_exit:
    enabled: true
    extension_minutes: 30              # å»¶é•¿æŒä»“æ—¶é—´
    high_profit_threshold: 3.0         # é«˜ç›ˆåˆ©é˜ˆå€¼(%)
    high_profit_drawback: 0.5          # é«˜ç›ˆåˆ©å›æ’¤æ¯”ä¾‹
    mid_profit_threshold: 1.0          # ä¸­ç›ˆåˆ©é˜ˆå€¼(%)
    mid_profit_drawback: 0.4           # ä¸­ç›ˆåˆ©å›æ’¤æ¯”ä¾‹
    low_profit_target: 1.0             # ä½ç›ˆåˆ©ç›®æ ‡(%)
    micro_loss_threshold: -0.5         # å°é¢äºæŸé˜ˆå€¼(%)
```

---

## å‰ç«¯ç•Œé¢

### å¸æœ¬ä½åˆçº¦äº¤æ˜“é¡µé¢

è®¿é—®: http://localhost:9020/coin_futures_trading

**åŠŸèƒ½æ¨¡å—**:

1. **è´¦æˆ·æ€»è§ˆ**
   - è´¦æˆ·ID: 3 (å¸æœ¬ä½åˆçº¦è´¦æˆ·)
   - è´¦æˆ·ä½™é¢: æ€»èµ„é‡‘
   - å†»ç»“ä¿è¯é‡‘: å½“å‰æŒä»“å ç”¨
   - æœªå®ç°ç›ˆäº: æµ®åŠ¨ç›ˆäº
   - å·²å®ç°ç›ˆäº: å†å²ç›ˆäº
   - æ”¶ç›Šç‡: æ€»æ”¶ç›Šç‡
   - èƒœç‡: ç›ˆåˆ©äº¤æ˜“å æ¯”

2. **äº¤æ˜“é¢æ¿**
   - äº¤æ˜“å¯¹é€‰æ‹©: ä¸‹æ‹‰èœå•é€‰æ‹©21ä¸ªå¸æœ¬ä½äº¤æ˜“å¯¹
   - æ–¹å‘é€‰æ‹©: LONG(åšå¤š) / SHORT(åšç©º)
   - æ•°é‡è®¾ç½®: åˆçº¦æ•°é‡
   - æ æ†è®¾ç½®: 1-125å€
   - æ­¢æŸè®¾ç½®: æ­¢æŸä»·æ ¼æˆ–ç™¾åˆ†æ¯”
   - æ­¢ç›ˆè®¾ç½®: æ­¢ç›ˆä»·æ ¼æˆ–ç™¾åˆ†æ¯”
   - å¼€ä»“æŒ‰é’®: æäº¤è®¢å•
   - å¹³ä»“æŒ‰é’®: ä¸€é”®å¹³ä»“æ‰€æœ‰æŒä»“

3. **æŒä»“åˆ—è¡¨**
   - å®æ—¶æ˜¾ç¤ºæ‰€æœ‰å¼€ä»“æŒä»“
   - å­—æ®µ: äº¤æ˜“å¯¹ã€æ–¹å‘ã€æ æ†ã€å¼€ä»“ä»·ã€å½“å‰ä»·ã€æ•°é‡ã€ä¿è¯é‡‘ã€æµ®ç›ˆã€æµ®ç›ˆ%ã€æ­¢æŸä»·ã€æ­¢ç›ˆä»·
   - æ“ä½œ: æ‰‹åŠ¨å¹³ä»“æŒ‰é’®
   - è‡ªåŠ¨åˆ·æ–°: å®æ—¶æ›´æ–°ä»·æ ¼å’Œç›ˆäº

4. **äº¤æ˜“å†å²**
   - æ˜¾ç¤ºå·²å¹³ä»“äº¤æ˜“è®°å½•
   - å­—æ®µ: äº¤æ˜“å¯¹ã€æ–¹å‘ã€å¼€ä»“ä»·ã€å¹³ä»“ä»·ã€ç›ˆäºã€ç›ˆäº%ã€å¼€ä»“æ—¶é—´ã€å¹³ä»“æ—¶é—´
   - åˆ†é¡µæ˜¾ç¤º: æ¯é¡µ10æ¡
   - ç­›é€‰åŠŸèƒ½: æŒ‰ç›ˆäº/æ—¶é—´ç­›é€‰

### å¤ç›˜åˆ†æé¡µé¢ (24H)

è®¿é—®: http://localhost:9020/futures_review

**å¸æœ¬ä½åˆçº¦æ ‡ç­¾**:

1. **æ¦‚è§ˆç»Ÿè®¡**
   - æ€»äº¤æ˜“æ¬¡æ•°
   - èƒœç‡
   - æ€»ç›ˆäº
   - å¹³å‡ç›ˆäº
   - æœ€å¤§ç›ˆåˆ©
   - æœ€å¤§äºæŸ
   - ç›ˆäºæ¯”
   - äº¤æ˜“é¢‘ç‡

2. **äº¤æ˜“æ¸…å•**
   - 24å°æ—¶å†…æ‰€æœ‰å¹³ä»“äº¤æ˜“
   - è¯¦ç»†ä¿¡æ¯: æ—¶é—´ã€äº¤æ˜“å¯¹ã€æ–¹å‘ã€å¼€ä»“ä»·ã€å¹³ä»“ä»·ã€ç›ˆäºã€ç›ˆäº%ã€æŒä»“æ—¶é•¿
   - ç­›é€‰: å…¨éƒ¨/ç›ˆåˆ©/äºæŸ
   - æ’åº: æ—¶é—´/ç›ˆäº

3. **ç­–ç•¥åˆ†æ**
   - æœ€ä½³äº¤æ˜“å¯¹
   - æœ€å·®äº¤æ˜“å¯¹
   - æœ€ä½³äº¤æ˜“æ—¶æ®µ
   - å¹³å‡æŒä»“æ—¶é—´
   - æ­¢ç›ˆæ­¢æŸæ‰§è¡Œç‡

4. **æ”¹è¿›å»ºè®®**
   - åŸºäº24Hæ•°æ®çš„æ™ºèƒ½å»ºè®®
   - é£é™©æç¤º
   - ä¼˜åŒ–æ–¹å‘

---

## APIæ¥å£

### åŸºç¡€ä¿¡æ¯

**Base URL**: `http://localhost:9020/api/coin-futures`

**è®¤è¯**: æš‚æ— (å†…éƒ¨ç³»ç»Ÿ)

### è´¦æˆ·ç›¸å…³

#### 1. è·å–è´¦æˆ·ä¿¡æ¯

```http
GET /api/coin-futures/account/{account_id}
```

**å‚æ•°**:
- `account_id`: è´¦æˆ·ID (å›ºå®šä¸º3)

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "account_id": 3,
    "account_name": "å¸æœ¬ä½åˆçº¦è´¦æˆ·",
    "account_type": "coin_futures",
    "initial_balance": 100000.0,
    "current_balance": 102345.67,
    "available_balance": 98765.43,
    "frozen_margin": 3580.24,
    "unrealized_pnl": 234.56,
    "realized_pnl": 2345.67,
    "total_equity": 102580.23,
    "total_trades": 156,
    "winning_trades": 98,
    "losing_trades": 58,
    "win_rate": 62.82,
    "roi": 2.58
  }
}
```

#### 2. è·å–äº¤æ˜“å¯¹åˆ—è¡¨

```http
GET /api/coin-futures/symbols
```

**å“åº”**:
```json
{
  "success": true,
  "symbols": [
    "BTC/USD",
    "ETH/USD",
    "BNB/USD",
    "SOL/USD",
    ...
  ],
  "total": 21
}
```

### äº¤æ˜“ç›¸å…³

#### 3. å¼€ä»“

```http
POST /api/coin-futures/open
```

**è¯·æ±‚ä½“**:
```json
{
  "account_id": 3,
  "symbol": "BTC/USD",
  "position_side": "LONG",
  "quantity": 0.1,
  "leverage": 5,
  "stop_loss_pct": 2.0,
  "take_profit_pct": 6.0,
  "source": "manual"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "position_id": 6520,
    "symbol": "BTC/USD",
    "position_side": "LONG",
    "quantity": 0.1,
    "entry_price": 87650.5,
    "leverage": 5,
    "margin": 400.0,
    "stop_loss_price": 85917.49,
    "take_profit_price": 92911.53,
    "open_time": "2026-01-29T21:30:00"
  }
}
```

#### 4. å¹³ä»“

```http
POST /api/coin-futures/close/{position_id}
```

**å‚æ•°**:
- `position_id`: æŒä»“ID

**è¯·æ±‚ä½“**:
```json
{
  "close_reason": "æ‰‹åŠ¨å¹³ä»“"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "position_id": 6520,
    "close_price": 88234.5,
    "realized_pnl": 58.4,
    "pnl_pct": 14.6,
    "close_time": "2026-01-29T22:15:00"
  }
}
```

### æŒä»“ç›¸å…³

#### 5. è·å–æŒä»“åˆ—è¡¨

```http
GET /api/coin-futures/positions?account_id=3&status=open
```

**å‚æ•°**:
- `account_id`: è´¦æˆ·ID (é»˜è®¤3)
- `status`: æŒä»“çŠ¶æ€ (open/closed/all, é»˜è®¤open)

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "position_id": 6520,
      "symbol": "BTC/USD",
      "position_side": "LONG",
      "quantity": 0.1,
      "entry_price": 87650.5,
      "current_price": 88234.5,
      "leverage": 5,
      "margin": 400.0,
      "unrealized_pnl": 58.4,
      "unrealized_pnl_pct": 14.6,
      "stop_loss_price": 85917.49,
      "take_profit_price": 92911.53,
      "open_time": "2026-01-29T21:30:00",
      "holding_hours": 0.75
    }
  ]
}
```

#### 6. è·å–äº¤æ˜“å†å²

```http
GET /api/coin-futures/trades?account_id=3&limit=50
```

**å‚æ•°**:
- `account_id`: è´¦æˆ·ID (é»˜è®¤3)
- `limit`: è¿”å›æ•°é‡ (é»˜è®¤50)

**å“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "trade_id": 12190,
      "symbol": "BTC/USD",
      "side": "CLOSE_LONG",
      "position_id": 6520,
      "entry_price": 87650.5,
      "close_price": 88234.5,
      "quantity": 0.1,
      "realized_pnl": 58.4,
      "pnl_pct": 14.6,
      "trade_time": "2026-01-29T22:15:00"
    }
  ]
}
```

### ä»·æ ¼ç›¸å…³

#### 7. è·å–å®æ—¶ä»·æ ¼

```http
GET /api/coin-futures/price/{symbol}
```

**å‚æ•°**:
- `symbol`: äº¤æ˜“å¯¹,å¦‚ BTC/USD

**å“åº”**:
```json
{
  "success": true,
  "symbol": "BTC/USD",
  "price": 88234.5,
  "timestamp": "2026-01-29T22:15:00"
}
```

---

## æ•°æ®åº“ç»“æ„

### æ ¸å¿ƒè¡¨

#### 1. futures_trading_accounts (è´¦æˆ·è¡¨)

```sql
CREATE TABLE futures_trading_accounts (
    id INT PRIMARY KEY,                    -- è´¦æˆ·ID (å¸æœ¬ä½å›ºå®šä¸º3)
    user_id INT,                           -- ç”¨æˆ·ID
    account_name VARCHAR(100),             -- è´¦æˆ·åç§°
    account_type VARCHAR(50),              -- è´¦æˆ·ç±»å‹: coin_futures
    initial_balance DECIMAL(20,2),         -- åˆå§‹èµ„é‡‘
    current_balance DECIMAL(20,2),         -- å½“å‰èµ„é‡‘
    available_balance DECIMAL(20,2),       -- å¯ç”¨èµ„é‡‘
    frozen_margin DECIMAL(20,2),           -- å†»ç»“ä¿è¯é‡‘
    unrealized_pnl DECIMAL(20,2),          -- æœªå®ç°ç›ˆäº
    realized_pnl DECIMAL(20,2),            -- å·²å®ç°ç›ˆäº
    total_trades INT,                      -- æ€»äº¤æ˜“æ¬¡æ•°
    winning_trades INT,                    -- ç›ˆåˆ©æ¬¡æ•°
    losing_trades INT,                     -- äºæŸæ¬¡æ•°
    created_at DATETIME,
    updated_at DATETIME
);
```

#### 2. futures_positions (æŒä»“è¡¨)

```sql
CREATE TABLE futures_positions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    account_id INT,                        -- è´¦æˆ·ID (å¸æœ¬ä½=3)
    user_id INT,
    symbol VARCHAR(20),                    -- äº¤æ˜“å¯¹: BTC/USD, ETH/USDç­‰
    position_side VARCHAR(20),             -- æ–¹å‘: LONG/SHORT
    leverage INT,                          -- æ æ†
    quantity DECIMAL(18,8),                -- æ•°é‡
    entry_price DECIMAL(18,8),             -- å¼€ä»“ä»·
    mark_price DECIMAL(18,8),              -- æ ‡è®°ä»·æ ¼
    margin DECIMAL(20,2),                  -- ä¿è¯é‡‘
    unrealized_pnl DECIMAL(20,2),          -- æœªå®ç°ç›ˆäº
    unrealized_pnl_pct DECIMAL(10,4),      -- ç›ˆäºç™¾åˆ†æ¯”
    realized_pnl DECIMAL(20,2),            -- å·²å®ç°ç›ˆäº
    stop_loss_price DECIMAL(18,8),         -- æ­¢æŸä»·
    take_profit_price DECIMAL(18,8),       -- æ­¢ç›ˆä»·
    stop_loss_pct DECIMAL(10,4),           -- æ­¢æŸç™¾åˆ†æ¯”
    take_profit_pct DECIMAL(10,4),         -- æ­¢ç›ˆç™¾åˆ†æ¯”
    status VARCHAR(20),                    -- çŠ¶æ€: open/closed
    open_time DATETIME,                    -- å¼€ä»“æ—¶é—´
    close_time DATETIME,                   -- å¹³ä»“æ—¶é—´
    source VARCHAR(50),                    -- æ¥æº: manual/auto/signal
    signal_id INT,                         -- ä¿¡å·ID
    entry_signal_type TEXT,                -- å…¥åœºä¿¡å·ç±»å‹
    entry_score INT,                       -- ä¿¡å·è¯„åˆ†
    notes TEXT,                            -- å¤‡æ³¨(å¹³ä»“åŸå› ç­‰)
    coin_margin TINYINT(1) DEFAULT 0,      -- æ˜¯å¦å¸æœ¬ä½(0=Uæœ¬ä½,1=å¸æœ¬ä½)
    created_at DATETIME,
    updated_at DATETIME,
    INDEX idx_account_status (account_id, status),
    INDEX idx_symbol (symbol),
    INDEX idx_coin_margin (coin_margin)
);
```

**é‡è¦å­—æ®µè¯´æ˜**:
- `coin_margin`: æ ‡è®°æ˜¯å¦ä¸ºå¸æœ¬ä½åˆçº¦
  - 0: Uæœ¬ä½åˆçº¦ (account_id=2)
  - 1: å¸æœ¬ä½åˆçº¦ (account_id=3)
- è™½ç„¶æœ‰`coin_margin`å­—æ®µ,ä½†ä¸»è¦é€šè¿‡`account_id`åŒºåˆ†

#### 3. futures_trades (äº¤æ˜“è®°å½•è¡¨)

```sql
CREATE TABLE futures_trades (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    account_id INT,                        -- è´¦æˆ·ID
    position_id INT,                       -- æŒä»“ID
    symbol VARCHAR(20),                    -- äº¤æ˜“å¯¹
    side VARCHAR(20),                      -- æ–¹å‘: OPEN_LONG/OPEN_SHORT/CLOSE_LONG/CLOSE_SHORT
    price DECIMAL(18,8),                   -- æˆäº¤ä»·æ ¼
    quantity DECIMAL(18,8),                -- æ•°é‡
    leverage INT,                          -- æ æ†
    margin DECIMAL(20,2),                  -- ä¿è¯é‡‘
    realized_pnl DECIMAL(20,2),            -- å®ç°ç›ˆäº
    pnl_pct DECIMAL(10,4),                 -- ç›ˆäºç™¾åˆ†æ¯”
    trade_time DATETIME,                   -- äº¤æ˜“æ—¶é—´
    created_at DATETIME,
    INDEX idx_account_side (account_id, side),
    INDEX idx_position (position_id)
);
```

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. ä»·æ ¼è·å–å¤±è´¥

**ç—‡çŠ¶**:
```
ERROR | è·å–ä»·æ ¼å¤±è´¥: æ— æ³•è·å–BTC/USDçš„ä»·æ ¼
WARNING | æ›´æ–°æŒä»“ BTC/USD ä»·æ ¼å’Œç›ˆäºå¤±è´¥: æ— æ³•è·å–BTC/USDçš„ä»·æ ¼
```

**åŸå› **:
- WebSocketæœªå¯åŠ¨æˆ–æœªè®¢é˜…è¯¥äº¤æ˜“å¯¹
- REST APIé™çº§å¤±è´¥(ä½¿ç”¨äº†é”™è¯¯çš„API)
- ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥WebSocketæ˜¯å¦å¯åŠ¨:
```python
# åœ¨coin_futures_trader_service.pyä¸­
if self.ws_service.is_running():
    logger.info("âœ… WebSocket ä»·æ ¼æœåŠ¡å·²å¯åŠ¨")
```

2. ç¡®è®¤ä½¿ç”¨å¸æœ¬ä½API:
```python
# æ­£ç¡®: dapi.binance.com
# é”™è¯¯: fapi.binance.com
```

3. é‡å¯WebSocketæœåŠ¡:
```bash
# é‡å¯å¸æœ¬ä½äº¤æ˜“æœåŠ¡ä¼šè‡ªåŠ¨é‡å¯WebSocket
pkill -f coin_futures_trader_service
python coin_futures_trader_service.py
```

#### 2. æŒä»“ç«‹å³è¢«å¹³ä»“

**ç—‡çŠ¶**:
```
æŒä»“åˆšå¼€ä»“å°±ç«‹å³å¹³ä»“
å¹³ä»“åŸå› : æ­¢ç›ˆ(ä»·æ ¼0.00000000 <= æ­¢ç›ˆä»·...)
```

**åŸå› **:
- ä»·æ ¼è·å–è¿”å›0æˆ–None
- `SmartExitOptimizer`è¯¯åˆ¤ä¸ºè§¦å‘æ­¢ç›ˆ

**è§£å†³æ–¹æ¡ˆ**:

å·²åœ¨æœ€æ–°ä»£ç ä¸­ä¿®å¤:
- ä»·æ ¼è·å–å¤±è´¥è¿”å›Noneè€Œé0
- æ·»åŠ Noneæ£€æŸ¥,è·³è¿‡æ— æ•ˆä»·æ ¼çš„å¹³ä»“åˆ¤æ–­

ç¡®ä¿ä»£ç å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬:
```bash
git pull origin master
```

#### 3. å‰ç«¯æ˜¾ç¤º"äº¤æ˜“æ¸…å•æ²¡æœ‰æ•°æ®"

**åŸå› **:
- å¸æœ¬ä½åˆçº¦åˆšå¯åŠ¨,è¿˜æ²¡æœ‰äº¤æ˜“è®°å½•
- é€‰æ‹©äº†é”™è¯¯çš„åˆçº¦ç±»å‹

**è§£å†³æ–¹æ¡ˆ**:

1. æ£€æŸ¥æ˜¯å¦æœ‰å·²å¹³ä»“äº¤æ˜“:
```sql
SELECT COUNT(*) FROM futures_positions
WHERE account_id = 3 AND status = 'closed';
```

2. åˆ‡æ¢åˆ°Uæœ¬ä½åˆçº¦æ ‡ç­¾æŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®
3. ç­‰å¾…è‡ªåŠ¨äº¤æ˜“æœåŠ¡è¿è¡Œäº§ç”Ÿäº¤æ˜“è®°å½•

#### 4. JavaScripté”™è¯¯: currentTradingMode is not defined

**åŸå› **:
- å‰ç«¯ä»£ç æœªæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆ**:

æ‹‰å–æœ€æ–°ä»£ç å¹¶æ¸…é™¤æµè§ˆå™¨ç¼“å­˜:
```bash
git pull origin master
# æµè§ˆå™¨ä¸­æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°
```

#### 5. Uæœ¬ä½è´¦æˆ·ä¸­å‡ºç°å¸æœ¬ä½ç¬¦å·æŒä»“

**ç—‡çŠ¶**:
```
account_id=2 ä¸­æœ‰ BTC/USD, ETH/USD ç­‰æŒä»“
```

**åŸå› **:
- æ—§ä»£ç é”™è¯¯åˆ›å»ºçš„æŒä»“

**è§£å†³æ–¹æ¡ˆ**:

æ¸…ç†é”™è¯¯æ•°æ®:
```sql
DELETE FROM futures_positions
WHERE account_id = 2
AND symbol LIKE '%/USD'
AND symbol NOT LIKE '%/USDT';
```

---

## æœ€ä½³å®è·µ

### 1. è´¦æˆ·ç®¡ç†

âœ… **æ­£ç¡®åšæ³•**:
- å¸æœ¬ä½åˆçº¦å›ºå®šä½¿ç”¨ account_id=3
- Uæœ¬ä½åˆçº¦å›ºå®šä½¿ç”¨ account_id=2
- ä¸è¦æ··ç”¨è´¦æˆ·ID

âŒ **é”™è¯¯åšæ³•**:
- åœ¨account_id=2ä¸­åˆ›å»ºBTC/USDæŒä»“
- åœ¨account_id=3ä¸­åˆ›å»ºBTC/USDTæŒä»“

### 2. é£é™©æ§åˆ¶

âœ… **å»ºè®®é…ç½®**:
```yaml
å•ç¬”æœ€å¤§ä¿è¯é‡‘: $400
æ€»æŒä»“æ¯”ä¾‹: â‰¤50%
æ­¢æŸ: 2-3%
æ­¢ç›ˆ: 4-6%
æœ€å¤§æŒä»“æ—¶é—´: 2-4å°æ—¶
```

âŒ **å±é™©é…ç½®**:
```yaml
å•ç¬”ä¿è¯é‡‘: >$1000
æ€»æŒä»“æ¯”ä¾‹: >80%
æ­¢æŸ: >5%
æ­¢ç›ˆ: <2%
æ— æœ€å¤§æŒä»“æ—¶é—´é™åˆ¶
```

### 3. äº¤æ˜“å¯¹é€‰æ‹©

âœ… **æ¨è**:
- ä¼˜å…ˆé€‰æ‹©æµåŠ¨æ€§å¥½çš„ä¸»æµå¸ç§
- BTC/USD, ETH/USD, BNB/USD, SOL/USD
- 24Hæˆäº¤é‡ > 1äº¿ç¾å…ƒ

âŒ **ä¸æ¨è**:
- æµåŠ¨æ€§å·®çš„å°å¸ç§
- 24Hæˆäº¤é‡ < 1000ä¸‡ç¾å…ƒ
- æ³¢åŠ¨æ€§æå¤§çš„Memeå¸

### 4. ä¿¡å·è¯„åˆ†é˜ˆå€¼

âœ… **ç¨³å¥ç­–ç•¥**:
```yaml
å¼€ä»“é˜ˆå€¼: â‰¥40åˆ†
é˜²è¿½é«˜é˜²æ€è·Œ: å¯ç”¨
é»‘åå•åˆ¶åº¦: å¯ç”¨
Big4è¶‹åŠ¿æ£€æµ‹: å¯ç”¨
```

âœ… **æ¿€è¿›ç­–ç•¥**:
```yaml
å¼€ä»“é˜ˆå€¼: â‰¥35åˆ†
é˜²è¿½é«˜é˜²æ€è·Œ: éƒ¨åˆ†å¯ç”¨
é»‘åå•åˆ¶åº¦: ä»…Level 3
Big4è¶‹åŠ¿æ£€æµ‹: å‚è€ƒä½†ä¸å¼ºåˆ¶
```

âŒ **å±é™©ç­–ç•¥**:
```yaml
å¼€ä»“é˜ˆå€¼: <30åˆ†
é˜²è¿½é«˜é˜²æ€è·Œ: ç¦ç”¨
é»‘åå•åˆ¶åº¦: ç¦ç”¨
Big4è¶‹åŠ¿æ£€æµ‹: ç¦ç”¨
```

### 5. ç›‘æ§å’Œç»´æŠ¤

æ¯æ—¥æ£€æŸ¥æ¸…å•:
- [ ] æ£€æŸ¥è´¦æˆ·ä½™é¢å’Œç›ˆäº
- [ ] æŸ¥çœ‹æŒä»“æ•°é‡å’Œåˆ†å¸ƒ
- [ ] å®¡æŸ¥äº¤æ˜“å†å²å’Œèƒœç‡
- [ ] æ£€æŸ¥WebSocketè¿æ¥çŠ¶æ€
- [ ] æŸ¥çœ‹æ—¥å¿—ä¸­çš„é”™è¯¯å’Œè­¦å‘Š
- [ ] æ›´æ–°é»‘åå•è¯„çº§
- [ ] å¤‡ä»½æ•°æ®åº“

æ¯å‘¨æ£€æŸ¥æ¸…å•:
- [ ] åˆ†æ7æ—¥äº¤æ˜“è¡¨ç°
- [ ] ä¼˜åŒ–ä¿¡å·è¯„åˆ†æƒé‡
- [ ] è°ƒæ•´æ­¢ç›ˆæ­¢æŸå‚æ•°
- [ ] æ›´æ–°äº¤æ˜“å¯¹ç™½åå•
- [ ] æ£€æŸ¥èµ„é‡‘ä½¿ç”¨æ•ˆç‡
- [ ] ä»£ç ç‰ˆæœ¬æ›´æ–°

---

## å¸¸è§é—®é¢˜

### Q1: å¸æœ¬ä½å’ŒUæœ¬ä½æœ‰ä»€ä¹ˆåŒºåˆ«?

**A**:
- **ä¿è¯é‡‘è´§å¸ä¸åŒ**: å¸æœ¬ä½ç”¨BTC/ETHç­‰,Uæœ¬ä½ç”¨USDT
- **ç›ˆäºç»“ç®—**: å¸æœ¬ä½ç›ˆäºä»¥å¸è®¡ä»·,Uæœ¬ä½ä»¥USDTè®¡ä»·
- **é£é™©æš´éœ²**: å¸æœ¬ä½åŒæ—¶æ‰¿æ‹…æ ‡çš„ä»·æ ¼å’ŒBTC/ETHä»·æ ¼é£é™©
- **èµ„é‡‘æ•ˆç‡**: Uæœ¬ä½èµ„é‡‘åˆ©ç”¨ç‡æ›´é«˜,å¸æœ¬ä½æ›´é€‚åˆæŒæœ‰ç°è´§çš„ç”¨æˆ·

### Q2: ä¸ºä»€ä¹ˆæˆ‘çš„æŒä»“ä»·æ ¼æ˜¾ç¤ºä¸º0?

**A**:
è¿™æ˜¯ä»·æ ¼è·å–å¤±è´¥çš„é—®é¢˜ã€‚å¯èƒ½åŸå› :
1. WebSocketæœªå¯åŠ¨æˆ–æœªè®¢é˜…è¯¥äº¤æ˜“å¯¹
2. REST APIé™çº§ä½¿ç”¨äº†é”™è¯¯çš„APIç«¯ç‚¹
3. ç½‘ç»œè¿æ¥é—®é¢˜

è§£å†³æ–¹æ¡ˆ: é‡å¯å¸æœ¬ä½äº¤æ˜“æœåŠ¡,ç¡®ä¿WebSocketæ­£å¸¸å¯åŠ¨ã€‚

### Q3: å¦‚ä½•è°ƒæ•´ä¿¡å·è¯„åˆ†é˜ˆå€¼?

**A**:
ä¿®æ”¹æ•°æ®åº“ä¸­çš„`signal_scoring_weights`è¡¨:
```sql
-- æŸ¥çœ‹å½“å‰æƒé‡
SELECT * FROM signal_scoring_weights;

-- è°ƒæ•´æƒé‡
UPDATE signal_scoring_weights
SET weight_value = 0.35
WHERE weight_name = 'position';
```

æˆ–åœ¨æœåŠ¡å¯åŠ¨å‚æ•°ä¸­æŒ‡å®š:
```python
# åœ¨coin_futures_trader_service.pyä¸­
SCORE_THRESHOLD = 40  # æé«˜åˆ°40åˆ†
```

### Q4: ä¸ºä»€ä¹ˆäº¤æ˜“é¢‘ç‡å¾ˆä½?

**A**:
å¯èƒ½åŸå› :
1. å¼€ä»“é˜ˆå€¼è®¾ç½®è¿‡é«˜(>40åˆ†)
2. é˜²è¿½é«˜é˜²æ€è·Œè¿‡æ»¤æ‰å¤ªå¤šä¿¡å·
3. é»‘åå•ä¸­çš„äº¤æ˜“å¯¹å¤ªå¤š
4. Big4è¶‹åŠ¿æ£€æµ‹é™åˆ¶äº†å¼€ä»“

è°ƒæ•´æ–¹æ³•:
- é™ä½å¼€ä»“é˜ˆå€¼åˆ°35åˆ†
- é€‚å½“æ”¾å®½é˜²è¿½é«˜é˜²æ€è·Œçš„æ¯”ä¾‹
- æ¸…ç†é»‘åå•ä¸­è¡¨ç°æ”¹å–„çš„äº¤æ˜“å¯¹
- æ”¾å®½Big4è¶‹åŠ¿æ£€æµ‹çš„é™åˆ¶

### Q5: å¦‚ä½•å¤‡ä»½å’Œæ¢å¤æ•°æ®?

**A**:
å¤‡ä»½:
```bash
# å¤‡ä»½å¸æœ¬ä½è´¦æˆ·æ•°æ®
mysqldump -u root -p binance-data \
  futures_trading_accounts \
  futures_positions \
  futures_trades \
  --where="account_id=3" \
  > coin_futures_backup_$(date +%Y%m%d).sql
```

æ¢å¤:
```bash
mysql -u root -p binance-data < coin_futures_backup_20260129.sql
```

### Q6: å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå¸æœ¬ä½äº¤æ˜“å®ä¾‹å—?

**A**:
ä¸å»ºè®®ã€‚åŸå› :
1. ä¼šäº§ç”Ÿå†²çªçš„è®¢å•
2. è´¦æˆ·ä½™é¢ä¼šè¢«é‡å¤ä½¿ç”¨
3. å¯èƒ½å¯¼è‡´è¿‡åº¦æŒä»“

å¦‚æœéœ€è¦å¤šç­–ç•¥,å»ºè®®:
- ä½¿ç”¨ä¸åŒçš„account_id
- åœ¨åŒä¸€å®ä¾‹ä¸­å®ç°å¤šç­–ç•¥é€»è¾‘
- ä½¿ç”¨ç­–ç•¥åˆ‡æ¢è€Œä¸æ˜¯å¤šå®ä¾‹

### Q7: å¦‚ä½•æŸ¥çœ‹å®æ—¶æ—¥å¿—?

**A**:
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f logs/coin_futures_trader_$(date +%Y%m%d).log

# è¿‡æ»¤é”™è¯¯æ—¥å¿—
tail -f logs/coin_futures_trader_$(date +%Y%m%d).log | grep ERROR

# è¿‡æ»¤ç‰¹å®šäº¤æ˜“å¯¹
tail -f logs/coin_futures_trader_$(date +%Y%m%d).log | grep "BTC/USD"
```

### Q8: å¦‚ä½•æ‰‹åŠ¨è§¦å‘å¹³ä»“?

**A**:
ä¸‰ç§æ–¹å¼:

1. **å‰ç«¯ç•Œé¢**:
   - è®¿é—® http://localhost:9020/coin_futures_trading
   - åœ¨æŒä»“åˆ—è¡¨ä¸­ç‚¹å‡»"å¹³ä»“"æŒ‰é’®

2. **APIè°ƒç”¨**:
```bash
curl -X POST http://localhost:9020/api/coin-futures/close/6520 \
  -H "Content-Type: application/json" \
  -d '{"close_reason": "æ‰‹åŠ¨å¹³ä»“"}'
```

3. **æ•°æ®åº“æ“ä½œ**:
```sql
-- ä¸æ¨è,ä»…ç”¨äºç´§æ€¥æƒ…å†µ
UPDATE futures_positions
SET status = 'closed', close_time = NOW()
WHERE id = 6520 AND account_id = 3;
```

---

## æŠ€æœ¯æ”¯æŒ

### æ—¥å¿—æ–‡ä»¶ä½ç½®

```
logs/
â”œâ”€â”€ coin_futures_trader_20260129.log    # å¸æœ¬ä½äº¤æ˜“æœåŠ¡æ—¥å¿—
â”œâ”€â”€ app.log                              # APIæœåŠ¡æ—¥å¿—
â””â”€â”€ websocket.log                        # WebSocketæœåŠ¡æ—¥å¿—
```

### é‡è¦æŒ‡æ ‡ç›‘æ§

| æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | å¼‚å¸¸é˜ˆå€¼ |
|-----|---------|---------|
| èƒœç‡ | 55-70% | <50% æˆ– >80% |
| æ—¥å‡äº¤æ˜“æ¬¡æ•° | 10-30æ¬¡ | <5æ¬¡ æˆ– >50æ¬¡ |
| å¹³å‡æŒä»“æ—¶é—´ | 1-4å°æ—¶ | <30åˆ†é’Ÿ æˆ– >8å°æ—¶ |
| å•ç¬”å¹³å‡ç›ˆäº | $5-$50 | <$2 æˆ– >$100 |
| æœ€å¤§å›æ’¤ | <5% | >10% |
| èµ„é‡‘ä½¿ç”¨ç‡ | 30-60% | <20% æˆ– >80% |

### ç´§æ€¥æƒ…å†µå¤„ç†

**æŒä»“å¼‚å¸¸æ— æ³•å¹³ä»“**:
```bash
# 1. é‡å¯æœåŠ¡
pkill -f coin_futures_trader_service
python coin_futures_trader_service.py

# 2. å¼ºåˆ¶å¹³ä»“æ‰€æœ‰æŒä»“
python -c "
from app.trading.coin_futures_trading_engine import CoinFuturesTradingEngine
engine = CoinFuturesTradingEngine(db_config)
positions = engine.get_open_positions(account_id=3)
for pos in positions:
    engine.close_position(pos['id'], 'emergency_close')
"
```

**æ•°æ®åº“é”è¡¨**:
```sql
-- æŸ¥çœ‹é”è¡¨
SHOW PROCESSLIST;

-- æ€æ­»é”è¡¨è¿›ç¨‹
KILL <process_id>;
```

---

## ç‰ˆæœ¬å†å²

### v2.0.0 (2026-01-29)
- âœ¨ æ–°å¢å¸æœ¬ä½åˆçº¦äº¤æ˜“ç³»ç»Ÿ
- âœ¨ æ·»åŠ WebSocketå®æ—¶ä»·æ ¼æ”¯æŒ
- ğŸ› ä¿®å¤ä»·æ ¼ä¸º0å¯¼è‡´è¯¯è§¦å‘å¹³ä»“çš„ä¸¥é‡BUG
- ğŸ› ä¿®å¤APIå´©æºƒé—®é¢˜
- ğŸ”§ ä¼˜åŒ–åˆ†æ‰¹å»ºä»“æ‰§è¡Œé€»è¾‘
- ğŸ”§ ä¼˜åŒ–æ™ºèƒ½å¹³ä»“ä¼˜åŒ–å™¨
- ğŸ“ æ·»åŠ å¤ç›˜åˆ†æé¡µé¢å¸æœ¬ä½æ”¯æŒ

### v1.5.0 (2026-01-20)
- âœ¨ æ·»åŠ Big4è¶‹åŠ¿æ£€æµ‹
- âœ¨ æ·»åŠ 3çº§é»‘åå•è¯„çº§åˆ¶åº¦
- ğŸ› ä¿®å¤ä¿¡å·è¯„åˆ†è®¡ç®—é”™è¯¯
- ğŸ”§ ä¼˜åŒ–é˜²è¿½é«˜é˜²æ€è·Œé€»è¾‘

---

## é™„å½•

### A. æ”¯æŒçš„äº¤æ˜“å¯¹åˆ—è¡¨

| åºå· | äº¤æ˜“å¯¹ | å¸å®‰ä»£ç  | åˆçº¦å¤§å° | æœ€å°æ•°é‡ |
|-----|--------|----------|---------|---------|
| 1 | BTC/USD | BTCUSD_PERP | 100 USD | 1 |
| 2 | ETH/USD | ETHUSD_PERP | 10 USD | 1 |
| 3 | BNB/USD | BNBUSD_PERP | 10 USD | 1 |
| 4 | SOL/USD | SOLUSD_PERP | 10 USD | 1 |
| 5 | XRP/USD | XRPUSD_PERP | 10 USD | 1 |
| 6 | ADA/USD | ADAUSD_PERP | 10 USD | 1 |
| 7 | DOT/USD | DOTUSD_PERP | 10 USD | 1 |
| 8 | LINK/USD | LINKUSD_PERP | 10 USD | 1 |
| 9 | BCH/USD | BCHUSD_PERP | 10 USD | 1 |
| 10 | LTC/USD | LTCUSD_PERP | 10 USD | 1 |
| 11 | ETC/USD | ETCUSD_PERP | 10 USD | 1 |
| 12 | XLM/USD | XLMUSD_PERP | 10 USD | 1 |
| 13 | XMR/USD | XMRUSD_PERP | 10 USD | 1 |
| 14 | DASH/USD | DASHUSD_PERP | 10 USD | 1 |
| 15 | ZEC/USD | ZECUSD_PERP | 10 USD | 1 |
| 16 | XTZ/USD | XTZUSD_PERP | 10 USD | 1 |
| 17 | ATOM/USD | ATOMUSD_PERP | 10 USD | 1 |
| 18 | ZRX/USD | ZRXUSD_PERP | 10 USD | 1 |
| 19 | COMP/USD | COMPUSD_PERP | 10 USD | 1 |
| 20 | ALGO/USD | ALGOUSD_PERP | 10 USD | 1 |
| 21 | DOGE/USD | DOGEUSD_PERP | 10 USD | 1 |

### B. APIç«¯ç‚¹å¯¹æ¯”

| åŠŸèƒ½ | Uæœ¬ä½API | å¸æœ¬ä½API |
|-----|---------|----------|
| è¡Œæƒ…æ•°æ® | https://fapi.binance.com | https://dapi.binance.com |
| WebSocket | wss://fstream.binance.com | wss://dstream.binance.com |
| äº¤æ˜“å¯¹æ ¼å¼ | BTCUSDT | BTCUSD_PERP |
| ä»·æ ¼ç²¾åº¦ | å°æ•°ç‚¹å2ä½ | å°æ•°ç‚¹å1ä½ |
| æ•°é‡ç²¾åº¦ | å°æ•°ç‚¹å3ä½ | æ•´æ•° |

### C. é”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| E001 | è´¦æˆ·ä½™é¢ä¸è¶³ | å¢åŠ è´¦æˆ·èµ„é‡‘æˆ–å‡å°‘ä»“ä½ |
| E002 | æŒä»“ä¸å­˜åœ¨ | æ£€æŸ¥position_idæ˜¯å¦æ­£ç¡® |
| E003 | ä»·æ ¼è·å–å¤±è´¥ | æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIé…ç½® |
| E004 | è¶…è¿‡æœ€å¤§æŒä»“é™åˆ¶ | å¹³ä»“éƒ¨åˆ†æŒä»“æˆ–è°ƒæ•´é…ç½® |
| E005 | äº¤æ˜“å¯¹ä¸æ”¯æŒ | æ£€æŸ¥config.yamlé…ç½® |
| E006 | æ æ†è¶…å‡ºèŒƒå›´ | è°ƒæ•´æ æ†åˆ°1-125å€ |
| E007 | æ•°é‡ä¸ç¬¦åˆè¦æ±‚ | æ£€æŸ¥æœ€å°/æœ€å¤§æ•°é‡é™åˆ¶ |
| E008 | è´¦æˆ·IDé”™è¯¯ | ä½¿ç”¨account_id=3 |

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜,è¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»:
- GitHub Issues: https://github.com/your-repo/crypto-analyzer/issues
- Email: support@example.com
- æ–‡æ¡£ç‰ˆæœ¬: v2.0.0
- æœ€åæ›´æ–°: 2026-01-29

---

**Â© 2026 è¶…çº§å¤§è„‘å¸æœ¬ä½åˆçº¦äº¤æ˜“ç³»ç»Ÿ | All Rights Reserved**
