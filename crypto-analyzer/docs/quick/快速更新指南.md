# 快速更新指南 - Windows 部署

## 🚀 5 分钟快速部署（2025-10-24 修复）

---

## 步骤 1：下载核心文件 (2 分钟)

### 方法 A：使用 Git（推荐）
```powershell
cd E:\crypto-analyzer
git pull origin main
```

### 方法 B：手动下载
从云端/代码仓库下载以下文件到对应位置：

**必须替换：**
1. `app/api/enhanced_dashboard.py`
2. `app/scheduler.py` ⭐⭐⭐ **（重要！）**

**必须新建：**
3. `verify_kline_fix.py`
4. `check_hype_in_db.py`
5. `KLINE_MULTI_EXCHANGE_FIX.md`

---

## 步骤 2：重启服务 (1 分钟)

### 停止当前服务
在运行中的 PowerShell 窗口按 `Ctrl+C`

### 启动 Web 服务器
**PowerShell 窗口 1：**
```powershell
cd E:\crypto-analyzer
python app/main.py
```

等待看到：
```
✓ Web 服务器启动成功: http://0.0.0.0:8000
```

### 启动调度器（应用 K线修复）
**PowerShell 窗口 2（新开）：**
```powershell
cd E:\crypto-analyzer
python app/scheduler.py
```

等待看到：
```
✓ 调度器启动成功
```

---

## 步骤 3：验证修复 (2 分钟)

### 3.1 验证 K线修复
**PowerShell 窗口 3（新开）：**
```powershell
cd E:\crypto-analyzer
python verify_kline_fix.py
```

**预期输出：**
```
测试 BTC/USDT:
  ✅ 从 binance 获取成功
  ✓ 符合预期

测试 HYPE/USDT:
  ⊗ binance 失败: Invalid symbol
  ✅ 从 gate 获取成功
  ✓ 符合预期

✅ 所有测试通过！K线多交易所支持修复成功！
```

如果看到这个，说明 K线修复成功！✅

### 3.2 等待数据采集
等待 **1-2 分钟**，让调度器采集数据。

### 3.3 检查数据库
```powershell
python check_hype_in_db.py
```

**预期输出：**
```
✅ 找到 10 条 HYPE/USDT 实时价格记录

✅ 找到 5 条 HYPE/USDT K线记录
  1. [gate] 5m 收盘价: $40.4610 - 2025-10-24 15:25:00
  2. [gate] 5m 收盘价: $40.5270 - 2025-10-24 15:20:00
```

关键：`kline_data` 表中现在应该有 `[gate]` 的数据！

### 3.4 检查前端
访问：http://localhost:8000/dashboard

**检查清单：**
- [ ] Hyperliquid 部分显示交易数据（不再空白）
- [ ] 可以点击 "指标说明" 按钮
- [ ] HYPE 价格正常更新

---

## ✅ 快速检查清单

完成以下检查：

**文件更新：**
- [ ] 已替换 `app/api/enhanced_dashboard.py`
- [ ] 已替换 `app/scheduler.py` ⭐⭐⭐
- [ ] 已创建 `verify_kline_fix.py`
- [ ] 已创建 `check_hype_in_db.py`

**服务运行：**
- [ ] Web 服务器运行正常（窗口1）
- [ ] 调度器运行正常（窗口2）

**功能验证：**
- [ ] `verify_kline_fix.py` 显示所有测试通过
- [ ] `check_hype_in_db.py` 显示 HYPE 的 gate K线数据
- [ ] 前端仪表盘 Hyperliquid 数据显示正常
- [ ] HYPE 价格更新正常

**全部勾选，部署成功！** 🎉

---

## ⚠️ 常见问题

### Q1: `verify_kline_fix.py` 显示测试失败？
**A:** 检查 `config.yaml` 中 `gate.enabled` 是否为 `true`

### Q2: 数据库中还是没有 HYPE K线数据？
**A:**
1. 确认 `app/scheduler.py` 已替换
2. 确认调度器已重启（必须重启才能应用修复！）
3. 等待 1-2 分钟后再检查

### Q3: Hyperliquid 数据还是空白？
**A:**
1. 确认 `app/api/enhanced_dashboard.py` 已替换
2. 确认 Web 服务器已重启
3. 运行 `python diagnose_hyperliquid_dashboard.py` 诊断

### Q4: 找不到某个文件？
**A:** 确认文件路径正确，Windows 路径使用反斜杠：
```
正确: E:\crypto-analyzer\app\scheduler.py
错误: E:/crypto-analyzer/app/scheduler.py
```

---

## 📚 详细文档

需要更多信息？查看：

1. **UPDATE_FILES_CHECKLIST.md** - 完整的文件更新清单
2. **KLINE_MULTI_EXCHANGE_FIX.md** - K线修复详细说明
3. **TODAY_FIXES_SUMMARY.md** - 今日所有修复总结
4. **HYPERLIQUID_INDICATORS_GUIDE.md** - Hyperliquid 指标说明

---

## 🎯 最小修复方案

如果时间有限，只想解决核心问题：

**只需 2 个文件：**
1. `app/scheduler.py` - 解决 HYPE K线
2. `app/api/enhanced_dashboard.py` - 解决 Hyperliquid 显示

**操作：**
```powershell
# 替换这 2 个文件后

# 重启服务
python app/main.py      # 窗口1
python app/scheduler.py # 窗口2

# 验证
python verify_kline_fix.py
```

---

## 📞 需要帮助？

运行诊断工具：
```powershell
python diagnose_hyperliquid_dashboard.py  # 诊断 Hyperliquid
python verify_kline_fix.py                # 验证 K线修复
python check_hype_in_db.py                # 检查数据库
```

查看日志：
```powershell
# 实时日志
Get-Content logs\scheduler.log -Tail 50 -Wait
Get-Content logs\app.log -Tail 50 -Wait
```

---

**部署时间：** 5 分钟
**版本：** v2.0
**修复日期：** 2025-10-24
**重点修复：** HYPE K线数据 + Hyperliquid 显示
