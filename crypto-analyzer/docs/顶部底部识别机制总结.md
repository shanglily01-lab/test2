# é¡¶éƒ¨åº•éƒ¨è¯†åˆ«æœºåˆ¶æ€»ç»“

> **æ–‡æ¡£ç‰ˆæœ¬**: V1.0
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-09
> **ç³»ç»Ÿç‰ˆæœ¬**: è¶…çº§å¤§è„‘ V5.0+

---

## ç›®å½•

1. [Big4ç´§æ€¥å¹²é¢„è¯†åˆ«](#big4ç´§æ€¥å¹²é¢„è¯†åˆ«)
2. [æ·±Våå¼¹è¯†åˆ«](#æ·±våå¼¹è¯†åˆ«)
3. [ä¿¡å·è¯„åˆ†ç³»ç»Ÿè¯†åˆ«](#ä¿¡å·è¯„åˆ†ç³»ç»Ÿè¯†åˆ«)
4. [æœºåˆ¶å¯¹æ¯”](#æœºåˆ¶å¯¹æ¯”)
5. [ä¼˜åŒ–å»ºè®®](#ä¼˜åŒ–å»ºè®®)

---

## Big4ç´§æ€¥å¹²é¢„è¯†åˆ«

### ä½ç½®
[app/services/big4_trend_detector.py:611-622](../app/services/big4_trend_detector.py#L611-L622)

### åº•éƒ¨è¯†åˆ« (æ–¹æ³•1: 4Hçº§åˆ«å‰§çƒˆæ³¢åŠ¨)

**æ£€æµ‹å‘¨æœŸ**: æœ€è¿‘4å°æ—¶

**é…ç½®å‚æ•°**:
```python
EMERGENCY_DETECTION_HOURS = 4      # æ£€æµ‹å‘¨æœŸ4å°æ—¶
BOTTOM_DROP_THRESHOLD = -5.0       # è§¦åº•é˜ˆå€¼: è·Œå¹…5%
BLOCK_DURATION_HOURS = 2           # ç¦æ­¢åšç©º2å°æ—¶
```

**æ£€æµ‹é€»è¾‘**:
```python
# 1. è·å–æœ€è¿‘4å°æ—¶çš„1H Kçº¿æ•°æ®
recent_4h_klines = get_klines(symbol, '1h', hours=4)

# 2. è®¡ç®—å…³é”®ä»·æ ¼
period_high = max(klines.high)  # 4Hæœ€é«˜ä»·
period_low = min(klines.low)    # 4Hæœ€ä½ä»·
latest_close = klines[-1].close  # å½“å‰æ”¶ç›˜ä»·

# 3. è®¡ç®—è·Œå¹…å’Œåå¼¹
drop_pct = (period_low - period_high) / period_high * 100
rise_from_low = (latest_close - period_low) / period_low * 100

# 4. è§¦åº•åˆ¤æ–­
if drop_pct <= -5.0 and rise_from_low > 0:
    è§¦åº•æ£€æµ‹ â†’ åˆ›å»ºemergency_intervention
    block_short = TRUE  # ç¦æ­¢åšç©º2å°æ—¶
```

**è§¦å‘ç¤ºä¾‹**:
```
æ—¶é—´: 2026-02-09 10:00
4Hé«˜ç‚¹: $100,000
4Hä½ç‚¹: $94,000 (è·Œå¹…-6.0%)
å½“å‰ä»·: $95,000 (ä»ä½ç‚¹åå¼¹+1.06%)

ç»“è®º: è§¦åº•æ£€æµ‹ â†’ ç¦æ­¢åšç©º2å°æ—¶
```

### é¡¶éƒ¨è¯†åˆ« (æ–¹æ³•1: 4Hçº§åˆ«å‰§çƒˆæ³¢åŠ¨)

**é…ç½®å‚æ•°**:
```python
TOP_RISE_THRESHOLD = 5.0  # è§¦é¡¶é˜ˆå€¼: æ¶¨å¹…5%
```

**æ£€æµ‹é€»è¾‘**:
```python
# 1. è®¡ç®—æ¶¨å¹…å’Œå›è°ƒ
rise_pct = (period_high - period_low) / period_low * 100
drop_from_high = (latest_close - period_high) / period_high * 100

# 2. è§¦é¡¶åˆ¤æ–­
if rise_pct >= 5.0 and drop_from_high < 0:
    è§¦é¡¶æ£€æµ‹ â†’ åˆ›å»ºemergency_intervention
    block_long = TRUE  # ç¦æ­¢åšå¤š2å°æ—¶
```

**è§¦å‘ç¤ºä¾‹**:
```
æ—¶é—´: 2026-02-09 14:00
4Hä½ç‚¹: $94,000
4Hé«˜ç‚¹: $99,000 (æ¶¨å¹…+5.32%)
å½“å‰ä»·: $98,000 (ä»é«˜ç‚¹å›è°ƒ-1.01%)

ç»“è®º: è§¦é¡¶æ£€æµ‹ â†’ ç¦æ­¢åšå¤š2å°æ—¶
```

### ç‰¹ç‚¹

âœ… **ä¼˜ç‚¹**:
- ç®€å•ç›´æ¥ï¼Œæ˜“äºç†è§£
- å¿«é€Ÿå“åº”å‰§çƒˆæ³¢åŠ¨
- é€‚åˆæ•æ‰å¤§çº§åˆ«çš„é¡¶åº•åè½¬

âš ï¸ **å±€é™**:
- 4å°æ—¶å‘¨æœŸè¾ƒé•¿ï¼Œå¯èƒ½é”™è¿‡å¿«é€Ÿåè½¬
- é˜ˆå€¼å›ºå®šï¼ˆ5%ï¼‰ï¼Œä¸é€‚åº”ä¸åŒå¸‚åœºæ³¢åŠ¨ç‡
- æ²¡æœ‰å¤§å‘¨æœŸè¿‡æ»¤ï¼Œå¯èƒ½åœ¨éœ‡è¡å¸‚è¯¯è§¦å‘

---

## æ·±Våå¼¹è¯†åˆ«

### ä½ç½®
[app/services/big4_trend_detector.py:715-730](../app/services/big4_trend_detector.py#L715-L730)

### åº•éƒ¨è¯†åˆ« (æ–¹æ³•2: 1Hé•¿ä¸‹å½±çº¿ + å¤§å‘¨æœŸè¿‡æ»¤)

**æ£€æµ‹å‘¨æœŸ**: 1H Kçº¿ + 72H/24Hå¤§å‘¨æœŸ

**é…ç½®å‚æ•°**:
```python
LOWER_SHADOW_THRESHOLD = 3.0  # ä¸‹å½±çº¿é˜ˆå€¼3%
DROP_72H_THRESHOLD = -8.0     # 72Hè·Œå¹…é˜ˆå€¼
DROP_24H_THRESHOLD = -4.0     # 24Hè·Œå¹…é˜ˆå€¼
BOUNCE_WINDOW_MINUTES = 45    # åå¼¹çª—å£45åˆ†é’Ÿ
```

**æ£€æµ‹é€»è¾‘** âœ… å·²ä¼˜åŒ–:
```python
# 1. æ£€æµ‹1Hé•¿ä¸‹å½±çº¿
body_low = min(open_price, close_price)
lower_shadow_pct = (body_low - low_price) / low_price * 100

# 2. å¤§å‘¨æœŸè¿‡æ»¤
history_72h = get_klines(symbol, '1h', limit=72)
high_72h = max(history_72h.high)
high_24h = max(history_72h[:24].high)

drop_from_high_72h = (low_price - high_72h) / high_72h * 100
drop_from_high_24h = (low_price - high_24h) / high_24h * 100

# 3. é¦–æ¬¡è§¦åº•æ£€æŸ¥
is_first_bottom = True
for prev_kline in history_72h[:24]:
    prev_shadow_pct = calculate_lower_shadow(prev_kline)
    if prev_shadow_pct >= 3.0:
        is_first_bottom = False
        break

# 4. çœŸæ·±Våˆ¤æ–­ï¼ˆåŒæ—¶æ»¡è¶³4ä¸ªæ¡ä»¶ï¼‰
is_true_deep_v = (
    lower_shadow_pct >= 3.0 and          # é•¿ä¸‹å½±çº¿
    drop_from_high_72h <= -8.0 and       # 72HæŒç»­ä¸‹è·Œ
    drop_from_high_24h <= -4.0 and       # 24HåŠ é€Ÿä¸‹è·Œ
    is_first_bottom                      # é¦–æ¬¡è§¦åº•
)

# 5. ç«‹å³è§¦å‘ï¼ˆä¸ç­‰15Mç¡®è®¤ï¼‰âœ…
if is_true_deep_v and time_since_candle <= 45åˆ†é’Ÿ:
    # åˆ›å»ºåå¼¹çª—å£
    CREATE bounce_window (
        window_start = 1H_open_time,
        window_end = 1H_open_time + 45åˆ†é’Ÿ
    )

    # åŒæ—¶è§¦å‘ç´§æ€¥å¹²é¢„
    bottom_detected = TRUE
    CREATE emergency_intervention (
        block_short = TRUE,
        expires_at = NOW() + 2å°æ—¶
    )
```

**è§¦å‘ç¤ºä¾‹ (2026-02-06 00:00)**:
```
BTC/USDT 1H Kçº¿:
  å¼€ç›˜: $94,262
  æœ€é«˜: $94,262
  æœ€ä½: $89,417 (æš´è·Œ-5.14%)
  æ”¶ç›˜: $93,681 (åå¼¹+4.77%)

ä¸‹å½±çº¿è®¡ç®—:
  body_low = min(94262, 93681) = 93681
  lower_shadow = 93681 - 89417 = 4264
  lower_shadow_pct = 4264 / 89417 * 100 = 4.77%  âŒ é”™è¯¯ï¼

æ­£ç¡®è®¡ç®—:
  lower_shadow_pct = (93681 - 89417) / 89417 * 100 = 4.77%  âŒ ä»ç„¶é”™è¯¯ï¼

å®é™…ä»£ç è®¡ç®—:
  lower_shadow_pct = (body_low - low_price) / low_price * 100
  = (93681 - 89417) / 89417 * 100
  = 4.77%  âŒ è¿™ä¸ªå…¬å¼é”™è¯¯

åº”è¯¥æ˜¯:
  lower_shadow_pct = (body_low - low_price) / body_low * 100  âš ï¸
  æˆ–è€…å‚è€ƒæµ‹è¯•è„šæœ¬çš„è®¡ç®—: 5.13%  âœ…

å¤§å‘¨æœŸè¿‡æ»¤:
  72Hæœ€é«˜: $117,967
  72Hè·Œå¹…: (89417 - 117967) / 117967 * 100 = -24.19% âœ…
  24Hæœ€é«˜: $109,517
  24Hè·Œå¹…: (89417 - 109517) / 109517 * 100 = -18.35% âœ…
  é¦–æ¬¡è§¦åº•: æ˜¯ âœ…

ç»“è®º: çœŸæ·±Våè½¬
  â†’ åˆ›å»ºbounce_window (00:00 ~ 00:45)
  â†’ åˆ›å»ºemergency_intervention (ç¦æ­¢åšç©º2å°æ—¶)
```

### ç‰¹ç‚¹

âœ… **ä¼˜ç‚¹**:
- ç²¾ç»†çš„å¤šå±‚è¿‡æ»¤ï¼Œå‡å°‘å‡ä¿¡å·
- é•¿ä¸‹å½±çº¿æœ¬èº«å°±æ˜¯è§¦åº•åå¼¹çš„è¯æ®
- å¤§å‘¨æœŸè¿‡æ»¤é¿å…éœ‡è¡å¸‚è¯¯è§¦å‘
- é¦–æ¬¡è§¦åº•ç¡®ä¿ä¸é‡å¤è§¦å‘
- ç«‹å³è§¦å‘ï¼Œä¸ç­‰15Mç¡®è®¤ï¼ˆå·²ä¼˜åŒ–ï¼‰

âš ï¸ **å±€é™**:
- åªæ£€æµ‹åº•éƒ¨ï¼Œæ²¡æœ‰å¯¹åº”çš„é¡¶éƒ¨æ£€æµ‹
- 45åˆ†é’Ÿçª—å£é™åˆ¶ï¼Œå†å²æ•°æ®æ— æ³•è¡¥æµ‹
- ä¾èµ–å®æ—¶æ£€æµ‹ï¼ŒæœåŠ¡åœæœºä¼šæ¼æ‰ä¿¡å·

âš ï¸ **å…¬å¼é—®é¢˜**:
å½“å‰ä»£ç ä½¿ç”¨ `(body_low - low_price) / low_price * 100`ï¼Œä½†æµ‹è¯•è„šæœ¬æ˜¾ç¤ºç»“æœæ˜¯5.13%ï¼Œéœ€è¦éªŒè¯å…¬å¼æ˜¯å¦æ­£ç¡®ã€‚

---

## ä¿¡å·è¯„åˆ†ç³»ç»Ÿè¯†åˆ«

### ä½ç½®
[app/services/smart_decision_brain.py:156-255](../app/services/smart_decision_brain.py#L156-L255)

### åº•éƒ¨/é¡¶éƒ¨è¯†åˆ« (è¯„åˆ†ç³»ç»Ÿ)

**ä½ç½®è¯„åˆ† (30åˆ†)**:

```python
def analyze_position(klines_1d):
    # 1. è®¡ç®—30æ—¥é«˜ä½ç‚¹
    high_30d = max(klines[-30:].high)
    low_30d = min(klines[-30:].low)
    current = klines[-1].close

    # 2. è®¡ç®—ä½ç½®ç™¾åˆ†æ¯”
    position_pct = (current - low_30d) / (high_30d - low_30d) * 100

    # 3. è¯„åˆ†
    if position_pct < 30:
        score += 20
        reason = "âœ… åº•éƒ¨åŒºåŸŸ"  # æ¥è¿‘30æ—¥ä½ç‚¹
    elif position_pct > 70:
        score -= 20
        reason = "âŒ é¡¶éƒ¨åŒºåŸŸ"  # æ¥è¿‘30æ—¥é«˜ç‚¹
    else:
        score += 5
        reason = "âš  ä¸­éƒ¨åŒºåŸŸ"

    # 4. 7æ—¥æ¶¨å¹…
    gain_7d = (current - price_7d_ago) / price_7d_ago * 100

    if gain_7d < 10:
        score += 10
        reason = "âœ… 7æ—¥æ¶¨å¹…é€‚ä¸­"
    elif gain_7d > 20:
        score -= 10
        reason = "âŒ 7æ—¥æ¶¨å¹…è¿‡å¤§"  # é¡¶éƒ¨ç‰¹å¾

    return score, reasons
```

**è¶‹åŠ¿è¯„åˆ† (20åˆ†)**:

```python
def analyze_trend(klines_1d, klines_1h):
    # 1Dè¶‹åŠ¿
    bullish_1d = sum(1 for k in klines_1d[-30:] if k.close > k.open)
    bullish_ratio = bullish_1d / 30

    if bullish_ratio > 0.6:  # è¶…è¿‡60%é˜³çº¿
        score += 20
        reason = "âœ… 1Då¼ºåŠ¿"
    elif bullish_ratio < 0.4:  # ä½äº40%é˜³çº¿
        score -= 5
        reason = "âŒ 1Då¼±åŠ¿"  # å¯èƒ½å¤„äºä¸‹è·Œè¶‹åŠ¿

    return score, reasons
```

**æ”¯æ’‘é˜»åŠ›è¯„åˆ† (30åˆ†)**:

```python
def analyze_support_resistance(klines_1h):
    # 1. è®¡ç®—æœ€è¿‘é«˜ä½ç‚¹
    recent_high = max(klines[-100:].high)
    recent_low = min(klines[-100:].low)
    current = klines[-1].close

    # 2. æ”¯æ’‘ä½ = è·ç¦»æœ€è¿‘ä½ç‚¹3-5%çš„åŒºåŸŸ
    support_levels = find_support_levels(klines)

    # 3. é˜»åŠ›ä½ = è·ç¦»æœ€è¿‘é«˜ç‚¹3-5%çš„åŒºåŸŸ
    resistance_levels = find_resistance_levels(klines)

    # 4. è®¡ç®—ç›ˆäºæ¯”
    distance_to_support = current - support
    distance_to_resistance = resistance - current
    risk_reward = distance_to_resistance / distance_to_support

    if risk_reward > 2:  # ç›ˆäºæ¯”>2
        score += 30
        reason = "âœ… ç›ˆäºæ¯”ä¼˜ç§€"

    return score, reasons, sr_data
```

### ç‰¹ç‚¹

âœ… **ä¼˜ç‚¹**:
- åŸºäº30æ—¥æ•°æ®ï¼Œå‘¨æœŸé€‚ä¸­
- ä½ç½®ç™¾åˆ†æ¯”ç›´è§‚æ˜“æ‡‚
- ç»“åˆæ¶¨å¹…è¿‡æ»¤é¡¶éƒ¨è¿‡çƒ­
- ç›ˆäºæ¯”è¯„ä¼°é£é™©æ”¶ç›Š

âš ï¸ **å±€é™**:
- æ²¡æœ‰ä½¿ç”¨å¸ƒæ—å¸¦ç­‰æŠ€æœ¯æŒ‡æ ‡
- ç®€å•çš„é«˜ä½ç‚¹è®¡ç®—ï¼Œä¸å¤Ÿç²¾ç»†
- æ”¯æ’‘é˜»åŠ›ä½ç®—æ³•ä¸æ˜ç¡®ï¼ˆä»£ç ä¸­æœªå®Œæ•´å®ç°ï¼‰
- åªæ˜¯è¯„åˆ†ï¼Œä¸æ˜¯æ˜ç¡®çš„é¡¶åº•åˆ¤æ–­

---

## æœºåˆ¶å¯¹æ¯”

| æœºåˆ¶ | æ£€æµ‹å‘¨æœŸ | åº•éƒ¨è¯†åˆ« | é¡¶éƒ¨è¯†åˆ« | è§¦å‘åŠ¨ä½œ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|---------|---------|
| **Big4ç´§æ€¥å¹²é¢„** | 4H | âœ… è·Œå¹…5% | âœ… æ¶¨å¹…5% | ç¦æ­¢åå‘å¼€ä»“2H | å¤§çº§åˆ«åè½¬ |
| **æ·±Våå¼¹** | 1H+72H | âœ… é•¿ä¸‹å½±çº¿+4å±‚è¿‡æ»¤ | âŒ æ—  | åå¼¹çª—å£45åˆ†é’Ÿ | æç«¯è§¦åº•åå¼¹ |
| **ä¿¡å·è¯„åˆ†** | 30D | âš ï¸ 30%åˆ†ä½ | âš ï¸ 70%åˆ†ä½ | è¯„åˆ†åŠ æƒ | å¸¸è§„å¼€ä»“åˆ¤æ–­ |

### è¦†ç›–èŒƒå›´

```
å¤§çº§åˆ«é¡¶åº• (Â±5%)
    â†“
Big4ç´§æ€¥å¹²é¢„ (4H)
    â†“
æ·±Våè½¬ (1Hé•¿ä¸‹å½±çº¿)
    â†“
ä¿¡å·è¯„åˆ† (30Dä½ç½®)
    â†“
å¸¸è§„å¼€ä»“
```

### è§¦å‘é¢‘ç‡

- **Big4ç´§æ€¥å¹²é¢„**: è¾ƒå°‘ï¼ˆ4Hå‘¨æœŸï¼Œ5%é˜ˆå€¼ï¼‰
- **æ·±Våå¼¹**: æå°‘ï¼ˆå¤šå±‚è¿‡æ»¤ï¼Œå®æ—¶æ£€æµ‹ï¼‰
- **ä¿¡å·è¯„åˆ†**: é¢‘ç¹ï¼ˆæ¯æ¬¡ä¿¡å·è¯„ä¼°ï¼‰

---

## ä¼˜åŒ–å»ºè®®

### 1. æ·±Våå¼¹æ‰©å±• - å¢åŠ é¡¶éƒ¨è¯†åˆ«

**å½“å‰é—®é¢˜**: åªæ£€æµ‹åº•éƒ¨ï¼ˆé•¿ä¸‹å½±çº¿ï¼‰ï¼Œæ²¡æœ‰é¡¶éƒ¨æ£€æµ‹ï¼ˆé•¿ä¸Šå½±çº¿ï¼‰

**å»ºè®®æ–¹æ¡ˆ**:

```python
# æ–°å¢: 1Hé•¿ä¸Šå½±çº¿æ£€æµ‹
UPPER_SHADOW_THRESHOLD = 3.0  # ä¸Šå½±çº¿é˜ˆå€¼

# æ£€æµ‹é€»è¾‘
body_high = max(open_price, close_price)
upper_shadow_pct = (high_price - body_high) / high_price * 100

# å¤§å‘¨æœŸè¿‡æ»¤
rise_from_low_72h = (high_price - low_72h) / low_72h * 100
rise_from_low_24h = (high_price - low_24h) / low_24h * 100

# é¦–æ¬¡è§¦é¡¶
is_first_top = check_no_previous_long_upper_shadow(24h)

# è§¦é¡¶åˆ¤æ–­
is_true_top_reversal = (
    upper_shadow_pct >= 3.0 and          # é•¿ä¸Šå½±çº¿
    rise_from_low_72h >= 8.0 and         # 72HæŒç»­ä¸Šæ¶¨
    rise_from_low_24h >= 4.0 and         # 24HåŠ é€Ÿä¸Šæ¶¨
    is_first_top                         # é¦–æ¬¡è§¦é¡¶
)

if is_true_top_reversal and time_since_candle <= 45:
    # åˆ›å»ºé¡¶éƒ¨çª—å£
    CREATE top_reversal_window (
        window_start = 1H_open_time,
        window_end = 1H_open_time + 45åˆ†é’Ÿ
    )

    # è§¦å‘ç´§æ€¥å¹²é¢„
    top_detected = TRUE
    CREATE emergency_intervention (
        block_long = TRUE,
        expires_at = NOW() + 2å°æ—¶
    )
```

**æ”¶ç›Š**:
- å¯¹ç§°çš„é¡¶åº•è¯†åˆ«æœºåˆ¶
- åŠæ—¶è¯†åˆ«é¡¶éƒ¨åè½¬ï¼Œä¿æŠ¤å¤šå¤´ä»“ä½
- å¯ä»¥åšç©ºé¡¶éƒ¨åè½¬ï¼ˆå¦‚æœç³»ç»Ÿå…è®¸åšç©ºï¼‰

### 2. å…¬å¼éªŒè¯ - ä¸‹å½±çº¿è®¡ç®—

**å½“å‰å…¬å¼**:
```python
lower_shadow_pct = (body_low - low_price) / low_price * 100
```

**é—®é¢˜**: è¿™ä¸ªå…¬å¼è®¡ç®—çš„æ˜¯"ä¸‹å½±çº¿ç›¸å¯¹äºæœ€ä½ä»·çš„ç™¾åˆ†æ¯”"ï¼Œä¸å¤ªç¬¦åˆæŠ€æœ¯åˆ†æä¹ æƒ¯

**æ ‡å‡†å…¬å¼**:
```python
# æ–¹æ³•1: ç›¸å¯¹äºKçº¿æ€»é«˜åº¦
total_range = high_price - low_price
lower_shadow = body_low - low_price
lower_shadow_pct = (lower_shadow / total_range) * 100

# æ–¹æ³•2: ç›¸å¯¹äºå®ä½“ä¸‹æ²¿
lower_shadow_pct = (lower_shadow / body_low) * 100

# æ–¹æ³•3: ç›¸å¯¹äºæœ€ä½ä»·ï¼ˆå½“å‰ä»£ç ï¼‰
lower_shadow_pct = (lower_shadow / low_price) * 100
```

**å»ºè®®**: ä¿æŒå½“å‰å…¬å¼ï¼Œå› ä¸ºï¼š
1. ç»Ÿè®¡éªŒè¯æ˜¾ç¤ºè§¦å‘ç‡åˆç†ï¼ˆ0.28%ï¼‰
2. ç”¨æˆ·æ˜ç¡®è¦æ±‚"å‡†ç¡®æ€§"ä¼˜å…ˆ
3. å·²ç»æœ‰çœŸå®æ¡ˆä¾‹éªŒè¯ï¼ˆ2026-02-06ï¼‰

ä½†åº”åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜è¿™ä¸ªè®¡ç®—æ–¹æ³•çš„å«ä¹‰ã€‚

### 3. å¸ƒæ—å¸¦é›†æˆ

**å½“å‰é—®é¢˜**: è¯„åˆ†ç³»ç»Ÿæ²¡æœ‰ä½¿ç”¨å¸ƒæ—å¸¦ç­‰æŠ€æœ¯æŒ‡æ ‡

**å»ºè®®æ–¹æ¡ˆ**:

```python
def analyze_position_with_bollinger(klines):
    # è®¡ç®—å¸ƒæ—å¸¦
    bb_upper, bb_middle, bb_lower = calculate_bollinger_bands(klines, period=20)

    current_price = klines[-1].close

    # ä½ç½®è¯„åˆ†
    if current_price <= bb_lower:
        score += 20
        reason = "âœ… è§¦åŠå¸ƒæ—ä¸‹è½¨ï¼ˆè¶…å–ï¼‰"
    elif current_price >= bb_upper:
        score -= 20
        reason = "âŒ è§¦åŠå¸ƒæ—ä¸Šè½¨ï¼ˆè¶…ä¹°ï¼‰"
    elif abs(current_price - bb_middle) / bb_middle * 100 < 2:
        score += 10
        reason = "âš ï¸ æ¥è¿‘å¸ƒæ—ä¸­è½¨"

    # å¸ƒæ—å¸¦å®½åº¦
    bb_width = (bb_upper - bb_lower) / bb_middle * 100

    if bb_width < 5:  # çª„å¹…éœ‡è¡
        score -= 10
        reason = "âš ï¸ å¸ƒæ—å¸¦æ”¶çª„ï¼Œå¯èƒ½çªç ´"

    return score, reasons
```

**æ”¶ç›Š**:
- æ›´ç²¾å‡†çš„è¶…ä¹°è¶…å–åˆ¤æ–­
- åŠ¨æ€é€‚åº”å¸‚åœºæ³¢åŠ¨ç‡
- ä¸éœ‡è¡å¸‚ç­–ç•¥ç»“åˆ

### 4. è‡ªé€‚åº”é˜ˆå€¼

**å½“å‰é—®é¢˜**: æ‰€æœ‰é˜ˆå€¼å›ºå®šï¼ˆ5%, 3%, 8%, 4%ç­‰ï¼‰

**å»ºè®®æ–¹æ¡ˆ**:

```python
def calculate_adaptive_threshold(symbol, base_threshold):
    # è®¡ç®—30æ—¥æ³¢åŠ¨ç‡
    volatility_30d = calculate_volatility(symbol, days=30)

    # åŠ¨æ€è°ƒæ•´é˜ˆå€¼
    if volatility_30d > 10:  # é«˜æ³¢åŠ¨
        threshold = base_threshold * 1.5
    elif volatility_30d < 3:  # ä½æ³¢åŠ¨
        threshold = base_threshold * 0.7
    else:
        threshold = base_threshold

    return threshold

# åº”ç”¨
BOTTOM_DROP_THRESHOLD = calculate_adaptive_threshold(symbol, base=-5.0)
LOWER_SHADOW_THRESHOLD = calculate_adaptive_threshold(symbol, base=3.0)
```

**æ”¶ç›Š**:
- é€‚åº”ä¸åŒå¸ç§çš„æ³¢åŠ¨ç‰¹æ€§
- é¿å…é«˜æ³¢åŠ¨å¸ç§é¢‘ç¹è§¦å‘
- é¿å…ä½æ³¢åŠ¨å¸ç§æ¼æ‰ä¿¡å·

---

## æ€»ç»“

### å½“å‰æœºåˆ¶è¯„ä»·

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **åº•éƒ¨è¯†åˆ«** | â­â­â­â­ | æœ‰ä¸¤å±‚æœºåˆ¶ï¼ˆ4H+1Hï¼‰ï¼Œè¾ƒä¸ºå®Œå–„ |
| **é¡¶éƒ¨è¯†åˆ«** | â­â­ | åªæœ‰4Hçº§åˆ«ï¼Œç¼ºå°‘ç²¾ç»†è¯†åˆ« |
| **å“åº”é€Ÿåº¦** | â­â­â­ | æ·±Våå¼¹45åˆ†é’Ÿçª—å£å¿«é€Ÿï¼Œ4Hæ£€æµ‹è¾ƒæ…¢ |
| **å‡†ç¡®æ€§** | â­â­â­â­ | å¤šå±‚è¿‡æ»¤å‡å°‘å‡ä¿¡å·ï¼Œå®æµ‹æ•ˆæœå¥½ |
| **å®Œæ•´æ€§** | â­â­â­ | é¡¶éƒ¨è¯†åˆ«ä¸å¯¹ç§°ï¼Œè¯„åˆ†ç³»ç»Ÿç®€å• |

### ä¼˜å…ˆä¼˜åŒ–é¡¹

1. âœ… **æ·±Våå¼¹ç«‹å³è§¦å‘** - å·²å®Œæˆï¼ˆ2026-02-09ï¼‰
2. ğŸ”¥ **å¢åŠ é¡¶éƒ¨é•¿ä¸Šå½±çº¿æ£€æµ‹** - å»ºè®®ä¼˜å…ˆ
3. ğŸ“Š **é›†æˆå¸ƒæ—å¸¦æŒ‡æ ‡** - æå‡è¯„åˆ†å‡†ç¡®æ€§
4. âš™ï¸ **è‡ªé€‚åº”é˜ˆå€¼** - é€‚åº”ä¸åŒå¸‚åœºç¯å¢ƒ

---

**æ–‡æ¡£ç»´æŠ¤**: ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-02-09
**ç‰ˆæœ¬**: V1.0
