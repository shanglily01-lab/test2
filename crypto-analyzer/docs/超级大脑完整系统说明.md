# è¶…çº§å¤§è„‘äº¤æ˜“ç³»ç»Ÿ - å®Œæ•´è¯´æ˜æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: V1.0
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-09
> **é€‚ç”¨ç‰ˆæœ¬**: è¶…çº§å¤§è„‘ V5.0+
> **ç³»ç»ŸçŠ¶æ€**: ç”Ÿäº§è¿è¡Œä¸­

---

## ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [åŒå¼•æ“æ¶æ„](#åŒå¼•æ“æ¶æ„)
3. [æ ¸å¿ƒäº¤æ˜“æœºåˆ¶](#æ ¸å¿ƒäº¤æ˜“æœºåˆ¶)
4. [é£é™©æ§åˆ¶ç³»ç»Ÿ](#é£é™©æ§åˆ¶ç³»ç»Ÿ)
5. [Big4è¶‹åŠ¿ç³»ç»Ÿ](#big4è¶‹åŠ¿ç³»ç»Ÿ)
6. [æŒä»“ç®¡ç†ç³»ç»Ÿ](#æŒä»“ç®¡ç†ç³»ç»Ÿ)
7. [é…ç½®å‚æ•°è¯´æ˜](#é…ç½®å‚æ•°è¯´æ˜)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿå®šä½

è¶…çº§å¤§è„‘æ˜¯ä¸€ä¸ª**å…¨è‡ªåŠ¨é‡åŒ–äº¤æ˜“ç³»ç»Ÿ**ï¼Œé‡‡ç”¨åŒå¼•æ“æ¶æ„ï¼ŒåŒæ—¶è¿è¡ŒUæœ¬ä½åˆçº¦å’Œå¸æœ¬ä½åˆçº¦äº¤æ˜“ã€‚

### æ ¸å¿ƒç‰¹ç‚¹

```
1. åŒå¼•æ“ç‹¬ç«‹è¿è¡Œ
   - Uæœ¬ä½: ç™½åå•åšå¤š + Big4ç ´ä½
   - å¸æœ¬ä½: å…¨å¸‚åœºåšå¤šåšç©º + Big4ç ´ä½

2. Big4ç»Ÿä¸€è¶‹åŠ¿åˆ¤æ–­
   - BTC/ETH/BNB/SOL å››å¤§å¤©ç‹
   - ç ´ä½æ£€æµ‹ã€ç´§æ€¥å¹²é¢„ã€æ·±Våå¼¹

3. å¤šå±‚é£é™©æ§åˆ¶
   - å›ºå®šæ­¢æŸæ­¢ç›ˆ
   - åè½¬æ­¢æŸ
   - ç§»åŠ¨æ­¢ç›ˆ
   - æ­¢æŸç†”æ–­
   - Big4ç´§æ€¥å¹³ä»“

4. è‡ªé€‚åº”ä¼˜åŒ–
   - æ¯æ—¥å‡Œæ™¨2ç‚¹è‡ªåŠ¨ä¼˜åŒ–å‚æ•°
   - 4å¤§ä¼˜åŒ–é—®é¢˜è‡ªæˆ‘é…ç½®
```

### ç³»ç»Ÿç»“æ„

```
smart_trader_service.py (Uæœ¬ä½ä¸»æœåŠ¡)
    |
    +-- SmartDecisionBrain (å†³ç­–å¼•æ“)
    |   +-- BreakoutSystem (ç ´ä½ç³»ç»Ÿ)
    |   +-- Big4TrendDetector (è¶‹åŠ¿æ£€æµ‹)
    |   +-- 10ç»´åº¦è¯„åˆ†ç³»ç»Ÿ
    |
    +-- PositionManagerV3 (æŒä»“ç®¡ç†)
    |   +-- å›ºå®šæ­¢æŸæ­¢ç›ˆ
    |   +-- åè½¬æ­¢æŸ
    |   +-- ç§»åŠ¨æ­¢ç›ˆ
    |   +-- Big4ç´§æ€¥å¹³ä»“
    |
    +-- RangeMarketDetector (éœ‡è¡å¸‚æ£€æµ‹)
    +-- BollingerMeanReversionStrategy (å¸ƒæ—å‡å€¼å›å½’)
    +-- TradingModeSwitcher (äº¤æ˜“æ¨¡å¼åˆ‡æ¢)

coin_futures_trader_service.py (å¸æœ¬ä½ä¸»æœåŠ¡)
    |
    +-- CoinFuturesDecisionBrain (å†³ç­–å¼•æ“)
    |   +-- BreakoutSystem (ç ´ä½ç³»ç»Ÿ)
    |   +-- 10ç»´åº¦è¯„åˆ†ç³»ç»Ÿ
    |
    +-- CoinFuturesPositionManager (æŒä»“ç®¡ç†)
        +-- å›ºå®šæ­¢æŸæ­¢ç›ˆ
        +-- åè½¬æ­¢æŸ
```

---

## åŒå¼•æ“æ¶æ„

### Uæœ¬ä½å¼•æ“ (SmartDecisionBrain)

**æ–‡ä»¶**: `app/services/smart_decision_brain.py`

#### äº¤æ˜“å¸ç§

```python
# ç™½åå•ï¼ˆåªåšLONGï¼‰
whitelist_long = [
    'BCH/USDT', 'ENA/USDT', 'WIF/USDT', 'TAO/USDT',
    'DASH/USDT', 'ETC/USDT', 'NEAR/USDT', 'AAVE/USDT',
    'SUI/USDT', 'UNI/USDT', 'SOL/USDT'
]

# é»‘åå•ï¼ˆåšå¤šåšç©ºï¼‰
blacklist = [
    'PEPE/USDT', 'DOGE/USDT', 'SHIB/USDT', '1000BONK/USDT',
    '1000PEPE/USDT', 'NEIRO/USDT'
]
```

#### è¯„åˆ†ä½“ç³»

| è¯„åˆ†ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|---------|------|------|
| ä½ç½®è¯„åˆ† | 30åˆ† | åŸºäºå¸ƒæ—å¸¦ä½ç½® |
| è¶‹åŠ¿è¯„åˆ† | 20åˆ† | MAå‡çº¿æ–¹å‘ |
| ç›ˆäºæ¯”è¯„åˆ† | 30åˆ† | æ­¢ç›ˆç©ºé—´/æ­¢æŸç©ºé—´ |
| **Big4ç ´ä½åŠ æƒ** | **Â±20~Â±50åˆ†** | åŒå‘åŠ åˆ†ï¼Œåå‘å‡åˆ† |

**å¼€ä»“é˜ˆå€¼**: 30åˆ†

#### ä»“ä½é…ç½®

```python
# ç™½åå•
position_size_usdt = 600     # ä¿è¯é‡‘ 600U
leverage = 10                # æ æ† 10x
max_positions = 15           # æœ€å¤§æŒä»“æ•°

# é»‘åå•
blacklist_position_size_usdt = 300  # ä¿è¯é‡‘ 300U
leverage = 10                        # æ æ† 10x
max_blacklist_positions = 3          # æœ€å¤§æŒä»“æ•°
```

#### æ­¢æŸæ­¢ç›ˆ

```python
# ç™½åå•
take_profit_pct = 2.5%      # å›ºå®šæ­¢ç›ˆ
stop_loss_pct = 3.0%        # å›ºå®šæ­¢æŸ

# é»‘åå•
take_profit_pct = 2.5%      # å›ºå®šæ­¢ç›ˆ
stop_loss_pct = 3.0%        # å›ºå®šæ­¢æŸ
```

### å¸æœ¬ä½å¼•æ“ (CoinFuturesDecisionBrain)

**æ–‡ä»¶**: `coin_futures_trader_service.py`

#### äº¤æ˜“å¸ç§

```python
# å…¨å¸‚åœºæ‰«æï¼ˆè¿‡æ»¤è§„åˆ™ï¼‰
1. 24Hæˆäº¤é‡ > 5000ä¸‡USD
2. ä»·æ ¼ > $0.01
3. æ”¯æŒå¸æœ¬ä½åˆçº¦
4. éç¨³å®šå¸
```

#### è¯„åˆ†ä½“ç³»

**10ç»´åº¦ç»¼åˆè¯„åˆ†**:

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| ä½ç½®è¯„åˆ† | 10åˆ† | å¸ƒæ—å¸¦ä½ç½® |
| è¶‹åŠ¿è¯„åˆ† | 10åˆ† | MAæ–¹å‘ |
| åŠ¨é‡è¯„åˆ† | 10åˆ† | RSI/MACD |
| é‡èƒ½è¯„åˆ† | 10åˆ† | æˆäº¤é‡æ”¾å¤§ |
| æ³¢åŠ¨ç‡è¯„åˆ† | 10åˆ† | ATRæ³¢åŠ¨ç‡ |
| æ”¯æ’‘é˜»åŠ› | 10åˆ† | å…³é”®ä»·ä½ |
| å¸‚åœºæƒ…ç»ª | 10åˆ† | æ¶¨è·Œå¹…æ’è¡Œ |
| èµ„é‡‘æµå‘ | 10åˆ† | å¤§å•æµå…¥æµå‡º |
| æŒä»“é‡ | 10åˆ† | OIå˜åŒ– |
| **Big4ç ´ä½åŠ æƒ** | **Â±20~Â±50åˆ†** | åŒå‘åŠ åˆ†ï¼Œåå‘å‡åˆ† |

**å¼€ä»“é˜ˆå€¼**: 35åˆ†ï¼ˆæ›´ä¸¥æ ¼ï¼‰

#### ä»“ä½é…ç½®

```python
position_size_usdt = 300    # ç­‰å€¼ä¿è¯é‡‘ 300U
leverage = 10               # æ æ† 10x
max_positions = 10          # æœ€å¤§æŒä»“æ•°
```

#### æ­¢æŸæ­¢ç›ˆ

```python
take_profit_pct = 3.0%      # å›ºå®šæ­¢ç›ˆ
stop_loss_pct = 3.0%        # å›ºå®šæ­¢æŸ
```

---

## æ ¸å¿ƒäº¤æ˜“æœºåˆ¶

### 1. Big4ç ´ä½ç³»ç»Ÿ

#### ç ´ä½æ£€æµ‹é€»è¾‘

**Big4å¸ç§**: BTC/USDT, ETH/USDT, BNB/USDT, SOL/USDT

**æ£€æµ‹é¢‘ç‡**: æ¯5åˆ†é’Ÿ

**ä¸‰å¤§ç‰¹å¾éªŒè¯** (æ€»åˆ†â‰¥70åˆ†è§¦å‘):

| ç‰¹å¾ | æƒé‡ | éªŒè¯é€»è¾‘ |
|------|------|----------|
| **24Hæå€¼çªç ´** | 40åˆ† | æœ€è¿‘1~3æ ¹5M Kçº¿çªç ´24Hæœ€é«˜/æœ€ä½ä»· |
| **æ— å½±çº¿å½¢æ€** | 30åˆ† | å½±çº¿<20%ï¼ŒKçº¿å®ä½“>60%ï¼Œå¼ºåŠ¿ç ´ä½ |
| **æˆäº¤é‡æ”¾å¤§** | 30åˆ† | å½“å‰æˆäº¤é‡ > å†å²å‡å€¼Ã—1.5 |

**Big4åŠ æƒ**:
```python
BTC: 40% æƒé‡
ETH: 30% æƒé‡
BNB: 15% æƒé‡
SOL: 15% æƒé‡

åŠ æƒæ€»åˆ† = BTCåˆ†æ•°Ã—40% + ETHåˆ†æ•°Ã—30% + BNBåˆ†æ•°Ã—15% + SOLåˆ†æ•°Ã—15%
```

#### ç ´ä½å½±å“

**ä¿¡å·åŠ æƒè§„åˆ™**:

| ç ´ä½å¼ºåº¦ | åŒå‘ä¿¡å· | åå‘ä¿¡å· | è¯´æ˜ |
|----------|----------|----------|------|
| 90+ | +50åˆ† | -50åˆ† | æå¼ºç ´ä½ï¼Œå®Œå…¨é˜»æ­¢åå‘ |
| 80-90 | +40åˆ† | -40åˆ† | å¼ºç ´ä½ï¼Œé˜»æ­¢è¯„åˆ†<90çš„åå‘ |
| 70-80 | +30åˆ† | -30åˆ† | ä¸­ç ´ä½ï¼Œé˜»æ­¢è¯„åˆ†<80çš„åå‘ |
| <70 | +20åˆ† | -20åˆ† | å¼±ç ´ä½ |

**æŒä»“å¤„ç†**:

```python
# å¼ºåº¦90+: æ— æ¡ä»¶å¹³æ‰€æœ‰åå‘ä»“
if strength >= 90:
    close_all_opposite_positions()

# å¼ºåº¦80-90: å¹³äºæŸçš„åå‘ä»“
elif strength >= 80:
    close_losing_opposite_positions()

# å¼ºåº¦70-80: å¹³å¤§å¹…äºæŸçš„åå‘ä»“ï¼ˆ>5%ä¿è¯é‡‘ï¼‰
elif strength >= 70:
    close_heavy_losing_positions(threshold=5%)

# åŒå‘æŒä»“: æ”¾å®½æ­¢æŸ
widen_stop_loss_for_same_direction()
```

#### æ”¶æ•›æœºåˆ¶

**å››ç»´æ”¶æ•›**:

| ç»´åº¦ | é…ç½® | è¯´æ˜ |
|------|------|------|
| **æ—¶é—´æ”¶æ•›** | 30åˆ†é’Ÿå¼€ä»“çª—å£ + 4å°æ—¶å¤±æ•ˆ | é˜²æ­¢ä¿¡å·æ³›æ»¥ |
| **æ•°é‡æ”¶æ•›** | æ¯å¸ç§æœ€å¤š5æ¬¡å¼€ä»“ | æ§åˆ¶å•å¸ç§é£é™© |
| **ä»·æ ¼æ”¶æ•›** | ä»·æ ¼åè½¬1%å¤±æ•ˆ | åŠæ—¶è¯†åˆ«å‡ç ´ä½ |
| **è¶‹åŠ¿æ”¶æ•›** | è¶‹åŠ¿åå‘2%å¤±æ•ˆ | è¶‹åŠ¿ç»“æŸåœæ­¢ä¿¡å· |

**ç¤ºä¾‹**:
```
ç ´ä½è§¦å‘æ—¶é—´: 2026-02-09 10:00
ç ´ä½æ–¹å‘: DOWN
ç ´ä½å¼ºåº¦: 85

æ”¶æ•›é™åˆ¶:
- å¼€ä»“çª—å£: 10:00 ~ 10:30 (30åˆ†é’Ÿ)
- æ¯å¸ç§æœ€å¤šå¼€5æ¬¡: BTC/USDT 0/5, ETH/USDT 0/5, ...
- ä»·æ ¼åè½¬1%å¤±æ•ˆ: å¦‚æœä»·æ ¼å›å‡1%ï¼Œç ´ä½å¤±æ•ˆ
- è¶‹åŠ¿åå‘2%å¤±æ•ˆ: å¦‚æœè¶‹åŠ¿åè½¬2%ï¼Œç ´ä½å¤±æ•ˆ
- æ€»å¤±æ•ˆæ—¶é—´: 14:00 (4å°æ—¶å)
```

### 2. Big4ç´§æ€¥å¹²é¢„æœºåˆ¶

**è§¦å‘æ¡ä»¶**:

```python
1. Big4å¼ºåº¦ >= 12 (å¼ºçƒˆä¿¡å·)
2. Big4æ–¹å‘ä¸æŒä»“æ–¹å‘ç›¸å
3. Big4ä¿¡å·åœ¨10åˆ†é’Ÿå†…æ›´æ–°
```

**æ‰§è¡ŒåŠ¨ä½œ**:

```python
1. ç«‹å³è·å–å½“å‰ä»·æ ¼
2. è®¡ç®—å®ç°ç›ˆäº
3. å¸‚ä»·å¹³ä»“
4. æ›´æ–°æ•°æ®åº“: close_reason = 'Big4ç´§æ€¥å¹²é¢„'
5. è§£å†»ä¿è¯é‡‘
6. è®°å½•æ—¥å¿— (CRITICALçº§åˆ«)
```

**æ£€æµ‹é¢‘ç‡**: æ¯30ç§’ï¼ˆåœ¨æŒä»“ç®¡ç†å¾ªç¯ä¸­ï¼‰

**ä¼˜å…ˆçº§**: æœ€é«˜ï¼ˆåœ¨æ‰€æœ‰æ­¢æŸæ£€æµ‹ä¹‹å‰æ‰§è¡Œï¼‰

**ç¤ºä¾‹åœºæ™¯**:

```
æŒä»“çŠ¶æ€: BTC/USDT LONG @ $95,000
çªå‘äº‹ä»¶: é‡å¤§åˆ©ç©ºæ¶ˆæ¯
Big4çŠ¶æ€: BULL(8) â†’ BEAR(15)
ç³»ç»ŸåŠ¨ä½œ: è§¦å‘ç´§æ€¥å¹²é¢„ â†’ ç«‹å³å¹³ä»“
```

### 3. æ·±Våå¼¹æŠ¢åå¼¹

#### ä¸¤é˜¶æ®µæœºåˆ¶

æ·±Våå¼¹åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹æœºåˆ¶ï¼š

**é˜¶æ®µ1: åå¼¹çª—å£ï¼ˆç«‹å³è§¦å‘ï¼Œç”¨äºæŠ¢åå¼¹ï¼‰**

```python
# æ£€æµ‹åˆ°1Hé•¿ä¸‹å½±çº¿ + å¤§å‘¨æœŸè¿‡æ»¤ â†’ ç«‹å³åˆ›å»º45åˆ†é’Ÿåå¼¹çª—å£

# è§¦å‘æ¡ä»¶ï¼ˆåŒæ—¶æ»¡è¶³ï¼‰
1. 1Hä¸‹å½±çº¿ >= 3.0% (body_low - low_price) / low_price * 100
2. 72HæŒç»­ä¸‹è·Œ >= 8% (ä»72Hæœ€é«˜ç‚¹åˆ°å½“å‰ä½ç‚¹)
3. 24HåŠ é€Ÿä¸‹è·Œ >= 4% (ä»24Hæœ€é«˜ç‚¹åˆ°å½“å‰ä½ç‚¹)
4. é¦–æ¬¡è§¦åº• (24Hå†…æ²¡æœ‰å…¶ä»–é•¿ä¸‹å½±çº¿)
5. è·ç¦»1H Kçº¿ç”Ÿæˆ <= 45åˆ†é’Ÿ

# æ‰§è¡ŒåŠ¨ä½œ
â†’ ç«‹å³åˆ›å»º bounce_window è®°å½•
â†’ 45åˆ†é’Ÿå†…å…¨å¸‚åœºæŠ¢åå¼¹ï¼ˆLONG 70%ä»“ä½ï¼Œæ­¢ç›ˆ3.5%ï¼Œæ­¢æŸ2.5%ï¼‰
â†’ ä¸éœ€è¦ç­‰å¾…15M Kçº¿ç¡®è®¤
```

**é˜¶æ®µ2: ç´§æ€¥å¹²é¢„ï¼ˆç¦æ­¢åšç©ºä¿æŠ¤ï¼‰** âœ… å·²ä¼˜åŒ–

æ·±Våå¼¹æ£€æµ‹æœ‰ä¸¤ç§ç´§æ€¥å¹²é¢„è§¦å‘æ–¹å¼ï¼š

```python
# æ–¹å¼1: 4Hçº§åˆ«å‰§çƒˆæ³¢åŠ¨æ£€æµ‹ï¼ˆç«‹å³è§¦å‘ï¼‰
if 4Hè·Œå¹… > 5% and ä»·æ ¼å¼€å§‹åå¼¹:
    bottom_detected = True
    â†’ ç«‹å³åˆ›å»º emergency_intervention (ç¦æ­¢åšç©º2å°æ—¶)

# æ–¹å¼2: 1Hé•¿ä¸‹å½±çº¿æ£€æµ‹ï¼ˆâœ… å·²ä¼˜åŒ–ä¸ºç«‹å³è§¦å‘ï¼‰
if 1Hé•¿ä¸‹å½±çº¿ >= 3% and æ»¡è¶³å¤§å‘¨æœŸæ¡ä»¶:
    bottom_detected = True
    â†’ ç«‹å³åˆ›å»º emergency_intervention (ç¦æ­¢åšç©º2å°æ—¶)
    â†’ ä¸bounce_windowåŒæ­¥åˆ›å»º
    â†’ ä¸ç­‰å¾…15Mé˜³çº¿ç¡®è®¤

# âœ… ä¼˜åŒ–å®Œæˆ (2026-02-09)ï¼š
# - bounce_windowå’Œemergency_interventionåŒæ­¥åˆ›å»º
# - æ£€æµ‹åˆ°çœŸæ·±Vç«‹å³ç¦æ­¢åšç©º
# - å…¨é¢ä¿æŠ¤åå¼¹ä»“ä½ï¼Œé€»è¾‘ä¸€è‡´
```

#### åå¼¹çª—å£åˆ›å»º

**é‡è¦**: ä¸€æ—¦æ£€æµ‹åˆ°çœŸæ·±Vï¼Œ**ç«‹å³åˆ›å»ºåå¼¹çª—å£ï¼Œä¸ç­‰å¾…15Mç¡®è®¤**

**åˆ›å»ºæ¡ä»¶** (åŒæ—¶æ»¡è¶³):

```python
1. 1Hé•¿ä¸‹å½±çº¿ >= 3% (é•¿ä¸‹å½±çº¿ = è§¦åº•å¿«é€Ÿåå¼¹)
2. 72Hè·Œå¹… >= 8% (å¤§å‘¨æœŸæŒç»­ä¸‹è·Œ)
3. 24Hè·Œå¹… >= 4% (è¿‘æœŸåŠ é€Ÿä¸‹è·Œ)
4. é¦–æ¬¡è§¦åº• (24Hå†…æ— å…¶ä»–é•¿ä¸‹å½±çº¿)
5. è·ç¦»1H Kçº¿ç”Ÿæˆæ—¶é—´ <= 45åˆ†é’Ÿ (å®æ—¶æ£€æµ‹)
```

**è®¾è®¡ç†å¿µ**:
- é•¿ä¸‹å½±çº¿æœ¬èº«å°±æ˜¯åå¼¹çš„è¯æ®ï¼ˆä»·æ ¼å·²ç»ä»æœ€ä½ç‚¹æ‹‰å›ï¼‰
- æ— éœ€ç­‰å¾…15Mé˜³çº¿ï¼Œå¦åˆ™é”™è¿‡æœ€ä½³å…¥åœºç‚¹
- 45åˆ†é’Ÿçª—å£ç»™äº¤æ˜“å‘˜å……è¶³æ—¶é—´å…¥åœº

**çª—å£é…ç½®**:

```python
window_start = 1H Kçº¿å¼€ç›˜æ—¶é—´
window_end = 1H Kçº¿å¼€ç›˜æ—¶é—´ + 45åˆ†é’Ÿ

# æ•°æ®åº“è®°å½•
INSERT INTO bounce_window (
    account_id, trading_type, symbol,
    trigger_time, window_start, window_end,
    lower_shadow_pct, trigger_price,
    bounce_entered, notes
)
```

**äº¤æ˜“ç­–ç•¥**:

```python
# åœ¨45åˆ†é’Ÿçª—å£å†…
bounce_opp = {
    'symbol': symbol,
    'side': 'LONG',
    'score': 100,  # æœ€é«˜ä¼˜å…ˆçº§
    'strategy': 'emergency_bounce',
    'signal_type': 'EMERGENCY_BOUNCE',
    'position_size_pct': 70,   # æ¿€è¿›ä»“ä½70%
    'take_profit_pct': 3.5,    # æ¿€è¿›æ­¢ç›ˆ3.5%
    'stop_loss_pct': 2.5,      # æ­¢æŸ2.5%
}
```

**ç´§æ€¥å¹²é¢„è§¦å‘æœºåˆ¶** âœ… å·²ä¼˜åŒ–:

```python
# æ–¹å¼1: 4Hçº§åˆ«å‰§çƒˆæ³¢åŠ¨ï¼ˆç«‹å³è§¦å‘ï¼‰
if 4Hè·Œå¹… > 5% and ä»·æ ¼åå¼¹:
    CREATE emergency_intervention (
        intervention_type = 'BOTTOM_BOUNCE',
        block_short = TRUE,  # ç¦æ­¢åšç©º2å°æ—¶
        expires_at = NOW() + 2å°æ—¶
    )

# æ–¹å¼2: 1Hé•¿ä¸‹å½±çº¿ï¼ˆâœ… å·²ä¼˜åŒ–ä¸ºç«‹å³è§¦å‘ï¼‰
if is_true_deep_v and time_since_candle <= 45:
    # åŒæ­¥åˆ›å»ºåå¼¹çª—å£å’Œç´§æ€¥å¹²é¢„
    bounce_opportunity = True
    bottom_detected = True

    CREATE bounce_window (...)
    CREATE emergency_intervention (
        intervention_type = 'BOTTOM_BOUNCE',
        block_short = TRUE,
        expires_at = NOW() + 2å°æ—¶
    )

# âœ… ä¼˜åŒ–å®Œæˆï¼š
# - æ£€æµ‹åˆ°çœŸæ·±Vç«‹å³åˆ›å»ºä¸¤æ¡è®°å½•
# - é€»è¾‘ä¸€è‡´ï¼Œå…¨é¢ä¿æŠ¤
```

#### å®é™…æ¡ˆä¾‹åˆ†æ

**2026-02-06 00:00 UTC (åŒ—äº¬æ—¶é—´08:00)**:

```
BTC/USDT æ·±Våå¼¹å…¨æµç¨‹:

ã€é˜¶æ®µ1: åå¼¹çª—å£ - ç«‹å³è§¦å‘ã€‘
  1H Kçº¿: å¼€ç›˜ $94,262 â†’ æœ€ä½ $89,417 â†’ æ”¶ç›˜ $93,681

  æ£€æµ‹ç»“æœ:
  âœ“ ä¸‹å½±çº¿: 5.13% (æ»¡è¶³ >= 3%)
  âœ“ 72Hè·Œå¹…: -24.46% (æ»¡è¶³ <= -8%)
  âœ“ 24Hè·Œå¹…: -18.44% (æ»¡è¶³ <= -4%)
  âœ“ é¦–æ¬¡è§¦åº•: æ˜¯ (24Hå†…æ— å…¶ä»–é•¿ä¸‹å½±çº¿)

  â†’ ç«‹å³åˆ›å»º bounce_window è®°å½•
  â†’ åå¼¹çª—å£: 00:00 ~ 00:45 (45åˆ†é’Ÿ)
  â†’ äº¤æ˜“ç­–ç•¥: LONG 70%ä»“ä½, æ­¢ç›ˆ3.5%, æ­¢æŸ2.5%
  â†’ åœ¨00:00~00:45ä»»æ„æ—¶åˆ»éƒ½å¯ä»¥æŠ¢åå¼¹å…¥åœº

ã€é˜¶æ®µ2: ç´§æ€¥å¹²é¢„ - âœ… å·²ä¼˜åŒ–ä¸ºç«‹å³è§¦å‘ã€‘
  ä¼˜åŒ–å‰: éœ€è¦ç­‰15Mè¿ç»­4æ ¹é˜³çº¿ç¡®è®¤
  ä¼˜åŒ–å: æ£€æµ‹åˆ°é•¿ä¸‹å½±çº¿ç«‹å³è§¦å‘

  â†’ ç«‹å³åˆ›å»º emergency_intervention è®°å½•
  â†’ ç¦æ­¢åšç©º2å°æ—¶
  â†’ å¤±æ•ˆæ—¶é—´: 02:00
  â†’ ä¸bounce_windowåŒæ­¥åˆ›å»ºï¼ˆæ—¶é—´å·® < 1ç§’ï¼‰

  ä¼˜åŒ–æ”¶ç›Š:
  â†’ âœ… ç«‹å³ä¿æŠ¤åå¼¹ä»“ä½
  â†’ âœ… é€»è¾‘ä¸€è‡´ï¼ˆå…è®¸æŠ¢åå¼¹å°±åº”è¯¥ç¦æ­¢åšç©ºï¼‰
  â†’ âœ… é¿å…æŠ¢åå¼¹è¿‡ç¨‹ä¸­è¢«åšç©ºä¿¡å·å¹²æ‰°

ã€å…³é”®ç‚¹ã€‘
- âœ… åå¼¹çª—å£: ç«‹å³åˆ›å»ºï¼Œä¸ç­‰15M
- âœ… ç´§æ€¥å¹²é¢„: ç«‹å³åˆ›å»ºï¼Œä¸ç­‰15Mï¼ˆå·²ä¼˜åŒ–ï¼‰
- 1Hé•¿ä¸‹å½±çº¿æœ¬èº«å°±è¯æ˜äº†åº•éƒ¨åå¼¹
- å…¨é¢ä¿æŠ¤ï¼Œä¸ç»™åšç©ºæœºä¼š
```

### 4. éœ‡è¡å¸‚ç­–ç•¥

#### éœ‡è¡å¸‚æ£€æµ‹

**æ£€æµ‹æŒ‡æ ‡**:

```python
1. å¸ƒæ—å¸¦å®½åº¦ < å†å²å‡å€¼çš„60%
2. ATRæ³¢åŠ¨ç‡ < å†å²å‡å€¼çš„70%
3. ä»·æ ¼åœ¨å¸ƒæ—å¸¦ä¸­è½¨Â±5%èŒƒå›´å†…æ³¢åŠ¨
4. 24Hæ¶¨è·Œå¹… < 3%
```

**æ£€æµ‹å‘¨æœŸ**: 4Hï¼ˆä½¿ç”¨4H Kçº¿æ•°æ®ï¼‰

#### å¸ƒæ—å‡å€¼å›å½’ç­–ç•¥

**å¼€ä»“ä¿¡å·**:

```python
# åšå¤šä¿¡å·
if price <= lower_band:  # ä»·æ ¼è§¦åŠä¸‹è½¨
    and RSI < 30         # è¶…å–
    and volume > avg_volume * 1.2:  # æˆäº¤é‡æ”¾å¤§
        å¼€ä»“LONG

# åšç©ºä¿¡å·
if price >= upper_band:  # ä»·æ ¼è§¦åŠä¸Šè½¨
    and RSI > 70         # è¶…ä¹°
    and volume > avg_volume * 1.2:  # æˆäº¤é‡æ”¾å¤§
        å¼€ä»“SHORT
```

**å¹³ä»“ä¿¡å·**:

```python
# å›å½’ä¸­è½¨å¹³ä»“
if position == LONG and price >= middle_band:
    å¹³ä»“

if position == SHORT and price <= middle_band:
    å¹³ä»“
```

---

## é£é™©æ§åˆ¶ç³»ç»Ÿ

### 1. å›ºå®šæ­¢æŸæ­¢ç›ˆ

**Uæœ¬ä½**:
```python
take_profit_pct = 2.5%
stop_loss_pct = 3.0%
```

**å¸æœ¬ä½**:
```python
take_profit_pct = 3.0%
stop_loss_pct = 3.0%
```

**æ£€æµ‹é¢‘ç‡**: æ¯30ç§’

### 2. åè½¬æ­¢æŸ

**è§¦å‘æ¡ä»¶**:

```python
# åšå¤šæŒä»“
if position_side == 'LONG':
    if current_price < entry_price * (1 - 0.01):  # æµ®äº1%
        if MA5 < MA20:  # è¶‹åŠ¿åè½¬
            è§¦å‘åè½¬æ­¢æŸ

# åšç©ºæŒä»“
if position_side == 'SHORT':
    if current_price > entry_price * (1 + 0.01):  # æµ®äº1%
        if MA5 > MA20:  # è¶‹åŠ¿åè½¬
            è§¦å‘åè½¬æ­¢æŸ
```

**è¯´æ˜**: å½“æµ®äº1%ä¸”è¶‹åŠ¿åè½¬æ—¶ï¼Œç«‹å³å¹³ä»“ï¼Œé¿å…æ›´å¤§äºæŸ

### 3. ç§»åŠ¨æ­¢ç›ˆ

**è§¦å‘æ¡ä»¶**:

```python
# æµ®ç›ˆè¶…è¿‡1.5%
if unrealized_pnl_pct >= 1.5:
    å¯åŠ¨ç§»åŠ¨æ­¢ç›ˆ

# å›æ’¤0.8%å¹³ä»“
if price_drops_from_peak >= 0.8:
    è§¦å‘ç§»åŠ¨æ­¢ç›ˆå¹³ä»“
```

**ç¤ºä¾‹**:

```
å…¥åœºä»·: $100
å½“å‰ä»·: $102 (æµ®ç›ˆ2%)
å³°å€¼ä»·: $103 (æµ®ç›ˆ3%)

ç§»åŠ¨æ­¢ç›ˆå¯åŠ¨: $101.5 (æµ®ç›ˆ1.5%)
å›æ’¤è§¦å‘ä»·: $102.176 (ä»å³°å€¼å›æ’¤0.8%)

å½“ä»·æ ¼è·Œè‡³$102.176æ—¶ï¼Œè§¦å‘ç§»åŠ¨æ­¢ç›ˆå¹³ä»“
```

### 4. æŒä»“è¶…æ—¶æ­¢æŸ

**é…ç½®**:

```python
max_holding_hours = 24  # æœ€å¤§æŒä»“æ—¶é—´24å°æ—¶
```

**è§¦å‘æ¡ä»¶**:

```python
if holding_time >= 24 hours:
    if unrealized_pnl < 0:  # äºæŸçŠ¶æ€
        è§¦å‘è¶…æ—¶æ­¢æŸ
```

### 5. æ­¢æŸç†”æ–­æœºåˆ¶

#### å¸æœ¬ä½ç†”æ–­

**è§¦å‘æ¡ä»¶**:

```python
# æ£€æŸ¥æœ€è¿‘10ç¬”è®¢å•
recent_10_orders = get_recent_orders(limit=10)

# ç»Ÿè®¡æ­¢æŸæ¬¡æ•°
stop_loss_count = count_stop_loss_orders(recent_10_orders)

# 5æ¬¡æ­¢æŸè§¦å‘ç†”æ–­
if stop_loss_count >= 5:
    æš‚åœå¼€ä»“2å°æ—¶
```

**ç†”æ–­é…ç½®**:

```python
check_orders = 10           # æ£€æŸ¥æœ€è¿‘10ç¬”è®¢å•
stop_loss_threshold = 5     # 5æ¬¡æ­¢æŸè§¦å‘
suspend_duration = 2å°æ—¶    # æš‚åœå¼€ä»“æ—¶é•¿
```

**ç†”æ–­åˆ¤æ–­é€»è¾‘**:

```python
# ä» futures_orders.notes å­—æ®µåˆ¤æ–­å¹³ä»“åŸå› 
notes_keywords = ['å›ºå®šæ­¢æŸ', 'åè½¬æ­¢æŸ', 'ç§»åŠ¨æ­¢ç›ˆå›æ’¤', 'è¶…æ—¶æ­¢æŸ']

if any(keyword in order['notes'] for keyword in notes_keywords):
    count_as_stop_loss += 1
```

#### Uæœ¬ä½ç†”æ–­

**æ€»äºæŸç´§æ€¥å¹²é¢„**:

```python
# è§¦å‘æ¡ä»¶
total_realized_pnl = get_total_realized_pnl()

if total_realized_pnl < -600:  # æ€»äºæŸè¶…è¿‡600U
    æš‚åœå¼€ä»“2å°æ—¶
```

**é…ç½®**:

```python
loss_threshold = -600       # äºæŸé˜ˆå€¼ -600U
suspend_duration = 2å°æ—¶    # æš‚åœå¼€ä»“æ—¶é•¿
```

### 6. Big4ç´§æ€¥å¹³ä»“

**è§¦å‘æ¡ä»¶**:

```python
1. Big4å¼ºåº¦ >= 12
2. Big4æ–¹å‘ä¸æŒä»“æ–¹å‘ç›¸å
3. Big4ä¿¡å·åœ¨10åˆ†é’Ÿå†…æ›´æ–°
```

**æ‰§è¡Œä¼˜å…ˆçº§**: æœ€é«˜ï¼ˆåœ¨æ‰€æœ‰å…¶ä»–æ­¢æŸæ£€æµ‹ä¹‹å‰ï¼‰

**æ£€æµ‹é¢‘ç‡**: æ¯30ç§’

---

## Big4è¶‹åŠ¿ç³»ç»Ÿ

### Big4å¸ç§

```python
BIG4_SYMBOLS = ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT']
```

### è¶‹åŠ¿æ£€æµ‹

**æ£€æµ‹é€»è¾‘**:

```python
# 1H Kçº¿: 30æ ¹ï¼ˆä¸»å¯¼æ–¹å‘ï¼‰
h1_candles = get_klines(symbol, '1h', limit=30)
h1_score = calculate_trend_score(h1_candles)

# 15M Kçº¿: 30æ ¹ï¼ˆè¶‹åŠ¿ç¡®è®¤ï¼‰
m15_candles = get_klines(symbol, '15m', limit=30)
m15_score = calculate_trend_score(m15_candles)

# 5M Kçº¿: 3æ ¹ï¼ˆä¹°å–æ—¶æœºï¼‰
m5_candles = get_klines(symbol, '5m', limit=3)
m5_score = calculate_breakout_score(m5_candles)

# ç»¼åˆè¯„åˆ†
total_score = h1_score * 0.5 + m15_score * 0.3 + m5_score * 0.2
```

**è¶‹åŠ¿åˆ¤æ–­**:

```python
if bullish_count >= 3:  # è‡³å°‘3ä¸ªBig4çœ‹æ¶¨
    overall_signal = 'BULLISH'
elif bearish_count >= 3:  # è‡³å°‘3ä¸ªBig4çœ‹è·Œ
    overall_signal = 'BEARISH'
else:
    overall_signal = 'NEUTRAL'
```

### å¦å†³æƒæœºåˆ¶

**è§¦å‘æ¡ä»¶**:

```python
Big4å¼ºåº¦ >= 12 ä¸”æ–¹å‘ä¸å¼€ä»“æ–¹å‘ç›¸å
```

**æ‰§è¡ŒåŠ¨ä½œ**:

```python
# å¼€ä»“å‰æ£€æŸ¥
big4_result = get_big4_result()

if big4_result['signal_strength'] >= 12:
    if big4_direction != position_side:
        æ‹’ç»å¼€ä»“
        logger.warning(f"[BIG4-VETO] Big4å¦å†³: {reason}")
```

### ä¿¡å·å¼ºåº¦ç­‰çº§

| å¼ºåº¦èŒƒå›´ | å«ä¹‰ | åŠ¨ä½œ |
|---------|------|------|
| 0-5 | å¼±ä¿¡å· | æ— ç‰¹æ®Šå¤„ç† |
| 6-11 | ä¸­ç­‰ä¿¡å· | å‚ä¸è¯„åˆ†ç³»ç»Ÿ |
| 12-15 | å¼ºçƒˆä¿¡å· | è§¦å‘ç´§æ€¥å¹²é¢„/å¦å†³æƒ |
| 16+ | æç«¯ä¿¡å· | ç´§æ€¥å¹²é¢„+å…¨å±€å‘Šè­¦ |

---

## æŒä»“ç®¡ç†ç³»ç»Ÿ

### PositionManagerV3 (Uæœ¬ä½)

**æ–‡ä»¶**: `app/services/position_manager_v3.py`

**ç®¡ç†å¾ªç¯**:

```python
async def manage_position(self, position):
    while True:
        # Step 1: Big4ç´§æ€¥æ£€æµ‹ (æœ€é«˜ä¼˜å…ˆçº§)
        if self.big4_emergency_enabled:
            big4_emergency = await self.check_big4_emergency(...)
            if big4_emergency['should_close']:
                await self.close_position(...)
                break

        # Step 2: è·å–å½“å‰ä»·æ ¼
        current_price = await self.get_current_price(...)

        # Step 3: åè½¬æ­¢æŸæ£€æµ‹
        if self.reversal_stop_enabled:
            reversal_check = await self.check_reversal_stop(...)
            if reversal_check['should_close']:
                await self.close_position(...)
                break

        # Step 4: ç§»åŠ¨æ­¢ç›ˆæ£€æµ‹
        if self.trailing_profit_enabled:
            trailing_check = await self.check_trailing_profit(...)
            if trailing_check['should_close']:
                await self.close_position(...)
                break

        # Step 5: å›ºå®šæ­¢æŸæ­¢ç›ˆæ£€æµ‹
        fixed_check = await self.check_fixed_stops(...)
        if fixed_check['should_close']:
            await self.close_position(...)
            break

        # Step 6: è¶…æ—¶æ£€æµ‹
        if self.max_holding_hours:
            timeout_check = await self.check_timeout(...)
            if timeout_check['should_close']:
                await self.close_position(...)
                break

        # ç­‰å¾…30ç§’
        await asyncio.sleep(30)
```

### CoinFuturesPositionManager (å¸æœ¬ä½)

**æ–‡ä»¶**: `app/services/coin_futures_position_manager.py`

**ç®¡ç†å¾ªç¯**:

```python
async def manage_position(self, position):
    while True:
        # Step 1: è·å–å½“å‰ä»·æ ¼
        current_price = await self.get_current_price(...)

        # Step 2: åè½¬æ­¢æŸæ£€æµ‹
        reversal_check = await self.check_reversal_stop(...)
        if reversal_check['should_close']:
            await self.close_position(...)
            break

        # Step 3: å›ºå®šæ­¢æŸæ­¢ç›ˆæ£€æµ‹
        fixed_check = await self.check_fixed_stops(...)
        if fixed_check['should_close']:
            await self.close_position(...)
            break

        # ç­‰å¾…30ç§’
        await asyncio.sleep(30)
```

---

## é…ç½®å‚æ•°è¯´æ˜

### V3é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `config/v3_config.json`

```json
{
  "account_config": {
    "account_id": 2,
    "trading_type": "usdt_futures",
    "position_size_usdt": 600,
    "leverage": 10,
    "max_positions": 15
  },
  "risk_management": {
    "fixed_stop_loss_pct": 3.0,
    "fixed_take_profit_pct": 2.5,
    "reversal_stop_loss_enabled": true,
    "reversal_stop_loss_threshold": -1.0,
    "trailing_profit_enabled": true,
    "trailing_profit_trigger": 1.5,
    "trailing_profit_callback": 0.8,
    "max_holding_hours": 24
  },
  "big4_config": {
    "emergency_monitor": {
      "enabled": true,
      "emergency_strength_threshold": 12,
      "check_interval_seconds": 60
    },
    "veto_power": {
      "enabled": true,
      "veto_strength_threshold": 12
    },
    "deep_v_detection": {
      "enabled": true,
      "lower_shadow_threshold": 3.0,
      "drop_72h_threshold": -8.0,
      "drop_24h_threshold": -4.0,
      "bounce_window_minutes": 45
    }
  },
  "circuit_breaker": {
    "enabled": true,
    "check_recent_orders": 10,
    "stop_loss_threshold": 5,
    "suspend_duration_hours": 2
  },
  "emergency_intervention": {
    "enabled": true,
    "loss_threshold": -600,
    "suspend_duration_hours": 2
  }
}
```

### å¸æœ¬ä½é…ç½®

**æ–‡ä»¶**: `config/coin_futures_config.json`

```json
{
  "account_config": {
    "account_id": 1,
    "trading_type": "coin_futures",
    "position_size_usdt": 300,
    "leverage": 10,
    "max_positions": 10
  },
  "risk_management": {
    "fixed_stop_loss_pct": 3.0,
    "fixed_take_profit_pct": 3.0,
    "reversal_stop_loss_enabled": true,
    "max_holding_hours": null
  },
  "circuit_breaker": {
    "enabled": true,
    "check_recent_orders": 10,
    "stop_loss_threshold": 5,
    "suspend_duration_hours": 2
  }
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆ2026-02-06çš„æ·±Våå¼¹æ²¡æœ‰åˆ›å»ºbounce_windowè®°å½•?

**A**: æ·±Våå¼¹çª—å£åªåœ¨å®æ—¶æ£€æµ‹æ—¶åˆ›å»ºï¼Œæœ‰ä¸¥æ ¼çš„æ—¶é—´é™åˆ¶:

```python
# åªæœ‰åœ¨1H Kçº¿ç”Ÿæˆå45åˆ†é’Ÿå†…æ£€æµ‹åˆ°æ‰ä¼šåˆ›å»º
if is_true_deep_v and time_since_candle <= 45:
    create_bounce_window()
```

å¦‚æœæ£€æµ‹æ—¶å·²ç»è¶…è¿‡45åˆ†é’Ÿï¼Œç³»ç»Ÿè®¤ä¸ºåå¼¹çª—å£å·²è¿‡æœŸï¼Œä¸å†åˆ›å»ºã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿ `smart_trading_service` 24å°æ—¶è¿è¡Œ
2. Big4æ£€æµ‹é—´éš”è®¾ç½®ä¸º15åˆ†é’Ÿï¼ˆè¶³å¤Ÿåœ¨45åˆ†é’Ÿå†…æ•è·ï¼‰
3. æ£€æŸ¥æ—¥å¿—ç¡®è®¤æœåŠ¡åœ¨å…³é”®æ—¶åˆ»æ˜¯å¦è¿è¡Œ

### Q2: ç ´ä½ç³»ç»Ÿæ¯ä¸ªå¸ç§æœ€å¤šå¼€5ä¸ªä»“ä½ï¼Œè¿˜æ˜¯æ€»å…±5ä¸ª?

**A**: **æ¯ä¸ªå¸ç§æœ€å¤š5ä¸ªä»“ä½**ï¼Œä¸æ˜¯æ€»å…±5ä¸ªã€‚

```python
# breakout_convergence.py
self.max_openings_per_symbol = 5  # æ¯ä¸ªå¸ç§æœ€å¤š5æ¬¡
self.opened_symbols = {}  # {symbol: count}

# ç¤ºä¾‹
opened_symbols = {
    'BTC/USDT': 3,   # BTCå·²å¼€3æ¬¡
    'ETH/USDT': 5,   # ETHå·²å¼€5æ¬¡ï¼ˆè¾¾åˆ°ä¸Šé™ï¼‰
    'SOL/USDT': 2    # SOLå·²å¼€2æ¬¡
}
# æ€»å¼€ä»“æ•°: 10æ¬¡
```

### Q3: Big4ç´§æ€¥å¹²é¢„å’Œç ´ä½ç³»ç»Ÿæœ‰ä»€ä¹ˆåŒºåˆ«?

**A**:

| åŠŸèƒ½ | Big4ç´§æ€¥å¹²é¢„ | ç ´ä½ç³»ç»Ÿ |
|------|------------|---------|
| **è§¦å‘æ¡ä»¶** | Big4å¼ºåº¦â‰¥12 ä¸”æ–¹å‘ç›¸å | Big4åŠ æƒåˆ†â‰¥70 ä¸”çªç ´24Hæå€¼ |
| **ä¸»è¦ä½œç”¨** | ç´§æ€¥å¹³ä»“åå‘æŒä»“ | ä¿¡å·åŠ æƒ + ç ´ä½å¼€ä»“ |
| **æ£€æµ‹é¢‘ç‡** | æ¯30ç§’ | æ¯5åˆ†é’Ÿ |
| **ä¼˜å…ˆçº§** | æœ€é«˜ï¼ˆåœ¨æ‰€æœ‰æ­¢æŸå‰ï¼‰ | é«˜ï¼ˆå½±å“å¼€ä»“å†³ç­–ï¼‰ |
| **æ‰§è¡ŒåŠ¨ä½œ** | ç«‹å³å¹³ä»“ | åŠ æƒè¯„åˆ† + å¹³åå‘ä»“ |

**é…åˆä½¿ç”¨**:
- ç ´ä½ç³»ç»Ÿ: åˆ¤æ–­å¸‚åœºè¶‹åŠ¿ï¼Œç»™å‡ºå¼€ä»“æ–¹å‘
- ç´§æ€¥å¹²é¢„: ä¿æŠ¤æŒä»“ï¼Œé¿å…é‡å¤§äºæŸ

### Q4: æ­¢æŸç†”æ–­æœºåˆ¶å¦‚ä½•åˆ¤æ–­æ­¢æŸè®¢å•?

**A**:

**å¸æœ¬ä½**: ä» `futures_orders.notes` å­—æ®µåˆ¤æ–­

```python
# è¯†åˆ«å…³é”®è¯
stop_loss_keywords = [
    'å›ºå®šæ­¢æŸ',
    'åè½¬æ­¢æŸ',
    'ç§»åŠ¨æ­¢ç›ˆå›æ’¤',
    'è¶…æ—¶æ­¢æŸ'
]

# æ£€æŸ¥noteså­—æ®µ
if any(keyword in order['notes'] for keyword in stop_loss_keywords):
    count_as_stop_loss = True
```

**Uæœ¬ä½**: æ£€æŸ¥ `realized_pnl < 0` ä¸”æœ‰æ­¢æŸå…³é”®è¯

```python
if order['realized_pnl'] < 0 and any(keyword in order['notes'] for keyword in stop_loss_keywords):
    count_as_stop_loss = True
```

### Q5: å¦‚ä½•æ‰‹åŠ¨è§¦å‘æ·±Våå¼¹æ£€æµ‹?

**A**:

**æ–¹æ³•1: è°ƒæ•´æ—¶é—´çª—å£** (æµ‹è¯•ç”¨)

```python
# big4_trend_detector.py line 716
# ä¿®æ”¹å‰
if is_true_deep_v and time_since_candle <= 45:

# ä¿®æ”¹åï¼ˆå…è®¸æ£€æµ‹24å°æ—¶å†…çš„æ·±Vï¼‰
if is_true_deep_v and time_since_candle <= 1440:
```

**æ–¹æ³•2: è¿è¡Œæµ‹è¯•è„šæœ¬**

```bash
python test_deep_v_server.py --manual-trigger
```

**æ–¹æ³•3: é€šè¿‡APIè§¦å‘**

```python
from app.services.big4_trend_detector import Big4TrendDetector

detector = Big4TrendDetector()
result = detector.detect_market_trend()

if result['emergency_intervention']['bounce_opportunity']:
    print("æ£€æµ‹åˆ°åå¼¹æœºä¼š!")
```

### Q6: å¦‚ä½•æŸ¥çœ‹å½“å‰ç ´ä½çŠ¶æ€?

**A**:

**Uæœ¬ä½**:
```python
brain = SmartDecisionBrain(db_config, exchange=exchange)
status = brain.get_breakout_status()

print(f"ç ´ä½æ´»è·ƒ: {status['active']}")
if status['active']:
    print(f"æ–¹å‘: {status['market']['direction']}")
    print(f"å¼ºåº¦: {status['market']['strength']}")
    print(f"å·²å¼€ä»“: {status['convergence']['opened_count']}")
    print(f"å‰©ä½™çª—å£: {status['convergence']['remaining_window']/60:.0f}åˆ†é’Ÿ")
```

**å¸æœ¬ä½**:
```python
brain = CoinFuturesDecisionBrain(db_config)
status = brain.get_breakout_status()
```

### Q7: å¦‚ä½•ç¦ç”¨æŸä¸ªé£é™©æ§åˆ¶æœºåˆ¶?

**A**: ä¿®æ”¹ `config/v3_config.json`:

```json
{
  "risk_management": {
    "reversal_stop_loss_enabled": false,  // ç¦ç”¨åè½¬æ­¢æŸ
    "trailing_profit_enabled": false,     // ç¦ç”¨ç§»åŠ¨æ­¢ç›ˆ
    "max_holding_hours": null            // ç¦ç”¨è¶…æ—¶æ­¢æŸ
  },
  "big4_config": {
    "emergency_monitor": {
      "enabled": false  // ç¦ç”¨Big4ç´§æ€¥ç›‘æ§
    }
  },
  "circuit_breaker": {
    "enabled": false  // ç¦ç”¨æ­¢æŸç†”æ–­
  }
}
```

**æ³¨æ„**: ç¦ç”¨é£é™©æ§åˆ¶ä¼šå¢åŠ äºæŸé£é™©ï¼Œä»…åœ¨å……åˆ†ç†è§£åæ“ä½œã€‚

### Q8: æ·±Våå¼¹çš„ç´§æ€¥å¹²é¢„ä¸ºä»€ä¹ˆè¦ç­‰15Mç¡®è®¤ï¼Ÿâœ… å·²ä¿®å¤

**A**: è¿™ä¸ªé—®é¢˜å·²åœ¨ 2026-02-09 ä¿®å¤ï¼Œç°åœ¨ç«‹å³è§¦å‘ï¼Œä¸ç­‰15Mç¡®è®¤ã€‚

**ä¿®å¤å‰çš„é—®é¢˜**:
```
1. æ£€æµ‹åˆ°1Hé•¿ä¸‹å½±çº¿ â†’ ç«‹å³åˆ›å»ºbounce_windowï¼ˆå…è®¸æŠ¢åå¼¹ï¼‰
2. ç­‰å¾…15Mè¿ç»­3æ ¹é˜³çº¿ â†’ æ‰åˆ›å»ºemergency_interventionï¼ˆç¦æ­¢åšç©ºï¼‰

é—®é¢˜ï¼š
- å…è®¸æŠ¢åå¼¹çš„åŒæ—¶ï¼Œæ²¡æœ‰ç¦æ­¢åšç©º
- å¯èƒ½åœ¨æŠ¢åå¼¹è¿‡ç¨‹ä¸­è¢«åšç©ºä¿¡å·å¹²æ‰°
- é€»è¾‘ä¸ä¸€è‡´ï¼šæ—¢ç„¶ç›¸ä¿¡é•¿ä¸‹å½±çº¿å¯ä»¥æŠ¢åå¼¹ï¼Œä¸ºä»€ä¹ˆä¸ç«‹å³ç¦æ­¢åšç©ºï¼Ÿ
```

**ä¿®å¤åçš„é€»è¾‘** âœ…:
```python
# big4_trend_detector.py line 716
if is_true_deep_v and time_since_candle <= 45:
    # åˆ›å»ºåå¼¹çª—å£
    bounce_opportunity = True
    bounce_symbols.append(symbol)

    # ğŸ”¥ åŒæ—¶æ ‡è®°ä¸ºbottom_detectedï¼ˆä¸ç­‰15Mç¡®è®¤ï¼‰
    bottom_detected = True
    trigger_symbols.append(
        f"{symbol.split('/')[0]}æ·±Våè½¬(1Hä¸‹å½±{lower_shadow_pct:.1f}%)"
    )

# bounce_windowå’Œemergency_interventionåŒæ­¥åˆ›å»º
```

**ä¿®å¤æ”¶ç›Š**:
- âœ… ç«‹å³ç¦æ­¢åšç©ºï¼Œä¿æŠ¤åå¼¹ä»“ä½
- âœ… é€»è¾‘ä¸€è‡´ï¼šæ£€æµ‹åˆ°æ·±Vå°±å…¨é¢ä¿æŠ¤
- âœ… å‡å°‘æŠ¢åå¼¹å¤±è´¥é£é™©

**æµ‹è¯•éªŒè¯**:
```bash
python test_deep_v_immediate_intervention.py
```

---

## ç›‘æ§æŒ‡æ ‡

### å…³é”®æ—¥å¿—

**ç ´ä½æ£€æµ‹**:
```
[Big4ç ´ä½æ£€æµ‹] DOWNæ–¹å‘, å¼ºåº¦82.5
[ç ´ä½ä¼šè¯] DOWN_1707478923 å¼€å§‹, çª—å£30åˆ†é’Ÿ
```

**ä¿¡å·åŠ æƒ**:
```
[ç ´ä½åŠ æƒ] WIF/USDT SHORT: åŸºç¡€50 + ç ´ä½40 = 90åˆ†
```

**ç´§æ€¥å¹²é¢„**:
```
[BIG4-EMERGENCY] BTC/USDT LONG è§¦å‘ç´§æ€¥å¹³ä»“! åŸå› : Big4 BEAR(15) vs LONG
```

**æ·±Våå¼¹**:
```
çœŸæ·±Våè½¬! BTC/USDT ä¸‹å½±5.13%, 72Hè·Œ-24.46%, 24Hè·Œ-18.44%, é¦–æ¬¡è§¦åº•
åå¼¹çª—å£å·²ä¿å­˜: BTC/USDT ä¸‹å½±5.1%, çª—å£è‡³08:45
```

### æ•°æ®åº“æŸ¥è¯¢

**æ£€æŸ¥æ­¢æŸç†”æ–­çŠ¶æ€**:
```sql
SELECT * FROM emergency_intervention
WHERE account_id = 2
AND expires_at > NOW()
ORDER BY created_at DESC;
```

**æ£€æŸ¥åå¼¹çª—å£**:
```sql
SELECT * FROM bounce_window
WHERE account_id = 2
AND window_end > NOW()
ORDER BY trigger_time DESC;
```

**ç»Ÿè®¡ç ´ä½å¼€ä»“**:
```sql
SELECT symbol, COUNT(*) as count, AVG(realized_pnl) as avg_pnl
FROM futures_positions
WHERE notes LIKE '%ç ´ä½å¼€ä»“%'
AND close_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY symbol
ORDER BY count DESC;
```

**ç»Ÿè®¡ç´§æ€¥å¹²é¢„æ•ˆæœ**:
```sql
SELECT
    close_reason,
    COUNT(*) as count,
    AVG(realized_pnl) as avg_pnl,
    SUM(realized_pnl) as total_pnl
FROM futures_positions
WHERE close_reason IN ('Big4ç´§æ€¥å¹²é¢„', 'å›ºå®šæ­¢æŸ', 'åè½¬æ­¢æŸ')
AND close_time >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY close_reason;
```

---

## ç³»ç»Ÿç»´æŠ¤

### æ—¥å¸¸æ£€æŸ¥æ¸…å•

- [ ] æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€ (`ps aux | grep smart_trader`)
- [ ] æ£€æŸ¥æœ€è¿‘1å°æ—¶æ—¥å¿— (`tail -100 logs/smart_trader_*.log`)
- [ ] æ£€æŸ¥æœªå¹³ä»“æŒä»“æ•°é‡å’Œæµ®åŠ¨ç›ˆäº
- [ ] æ£€æŸ¥ç´§æ€¥å¹²é¢„è®°å½•æ˜¯å¦å¼‚å¸¸
- [ ] æ£€æŸ¥æ­¢æŸç†”æ–­æ˜¯å¦é¢‘ç¹è§¦å‘
- [ ] æ£€æŸ¥è´¦æˆ·æ€»ç›ˆäºå’ŒæŒä»“åˆ†å¸ƒ

### æ¯å‘¨åˆ†æ

- [ ] ç»Ÿè®¡ç ´ä½ç³»ç»Ÿå‡†ç¡®ç‡
- [ ] ç»Ÿè®¡æ·±Våå¼¹æˆåŠŸç‡
- [ ] åˆ†ææ­¢æŸç†”æ–­è§¦å‘åŸå› 
- [ ] Review Big4ç´§æ€¥å¹²é¢„æ•ˆæœ
- [ ] ä¼˜åŒ–è¯„åˆ†é˜ˆå€¼å‚æ•°

### å‚æ•°ä¼˜åŒ–å»ºè®®

**æ ¹æ®å®ç›˜æ•°æ®è°ƒæ•´**:

1. **å¼€ä»“é˜ˆå€¼**: å¦‚æœå¼€ä»“è¿‡é¢‘ï¼Œæé«˜é˜ˆå€¼ï¼ˆ30â†’35ï¼‰
2. **æ­¢æŸæ­¢ç›ˆ**: æ ¹æ®èƒœç‡å’Œç›ˆäºæ¯”è°ƒæ•´
3. **ç ´ä½å¼ºåº¦é˜ˆå€¼**: æ ¹æ®å‡ç ´ä½é¢‘ç‡è°ƒæ•´ï¼ˆ70â†’75ï¼‰
4. **ç†”æ–­å‚æ•°**: æ ¹æ®æ­¢æŸåˆ†å¸ƒè°ƒæ•´ï¼ˆ5æ¬¡â†’4æ¬¡ï¼‰

---

## ç›¸å…³æ–‡æ¡£

- [Big4ç´§æ€¥å¹²é¢„æœºåˆ¶è¯´æ˜.md](./Big4ç´§æ€¥å¹²é¢„æœºåˆ¶è¯´æ˜.md)
- [è¶…çº§å¤§è„‘V5.0æ›´æ–°è¯´æ˜.md](./è¶…çº§å¤§è„‘V5.0æ›´æ–°è¯´æ˜.md)
- [äº¤æ˜“ç³»ç»Ÿå®Œæ•´é€»è¾‘æ–‡æ¡£.md](./äº¤æ˜“ç³»ç»Ÿå®Œæ•´é€»è¾‘æ–‡æ¡£.md)

---

**æ–‡æ¡£ç»´æŠ¤**: ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-02-09
**ç‰ˆæœ¬**: V1.0
**çŠ¶æ€**: ç”Ÿäº§è¿è¡Œä¸­
