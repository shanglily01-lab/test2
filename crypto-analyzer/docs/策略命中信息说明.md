# 策略命中信息说明

## 什么是"命中信息"？

"命中信息"（Strategy Hits）是指**策略检测到交易信号时记录的所有相关信息**，无论最终是否执行了交易。

## 命中信息包括什么？

### 1. 信号类型 ✅

记录检测到的交易信号：

- **BUY_LONG**：做多买入信号（EMA9向上穿越EMA26）
- **BUY_SHORT**：做空买入信号（EMA9向下穿越EMA26）
- **SELL**：卖出/平仓信号（死叉信号）

### 2. 技术指标数据 📊

记录信号触发时的技术指标值：

- `ema_short`：短期EMA值（如EMA9）
- `ema_long`：长期EMA值（如EMA26）
- `ma10`、`ema10`：MA10和EMA10的值
- `ma5`、`ema5`：MA5和EMA5的值
- `current_price`：当前价格
- `ema_cross_strength_pct`：EMA交叉强度百分比
- `ma10_ema10_strength_pct`：MA10/EMA10强度百分比

### 3. 过滤条件检查结果 🔍

记录为什么执行或为什么没有执行：

- `volume_ratio`：成交量放大倍数
- `volume_condition_met`：成交量条件是否满足
- `ma10_ema10_trend_ok`：MA10/EMA10趋势过滤是否通过
- `trend_confirm_ok`：趋势持续性检查是否通过
- `signal_strength_ok`：信号强度过滤是否通过

### 4. 执行结果 💰

记录最终是否执行了交易：

- `executed`：是否已执行交易（true/false）
- `execution_result`：执行结果
  - `SUCCESS`：执行成功
  - `FAILED`：执行失败
  - `SKIPPED`：跳过（条件不满足）
- `execution_reason`：执行或跳过的原因
- `position_id`：如果执行成功，关联的持仓ID
- `order_id`：如果执行成功，关联的订单ID

## 命中信息 vs 订单信息

### 命中信息（Strategy Hits）
- ✅ **记录所有信号**：包括未执行的信号
- ✅ **记录原因**：为什么执行或为什么没有执行
- ✅ **记录技术数据**：信号触发时的技术指标值
- ✅ **用于分析**：分析策略表现、信号质量、过滤条件效果

### 订单信息（Orders/Positions）
- ✅ **只记录已执行的交易**
- ✅ **记录交易详情**：价格、数量、手续费等
- ✅ **用于交易管理**：查看持仓、订单历史等

## 示例

### 示例1：检测到买入信号但未执行

```json
{
  "signal_type": "BUY_LONG",
  "symbol": "BTC/USDT",
  "current_price": 45000.0,
  "ema_short": 45100.0,
  "ema_long": 44900.0,
  "volume_ratio": 0.8,
  "volume_condition_met": false,  // 成交量条件不满足
  "ma10_ema10_trend_ok": true,
  "trend_confirm_ok": true,
  "signal_strength_ok": true,
  "executed": false,  // 未执行
  "execution_result": "SKIPPED",
  "execution_reason": "条件未满足: 成交量条件"
}
```

### 示例2：检测到买入信号并执行成功

```json
{
  "signal_type": "BUY_LONG",
  "symbol": "BTC/USDT",
  "current_price": 45000.0,
  "ema_short": 45100.0,
  "ema_long": 44900.0,
  "volume_ratio": 1.5,
  "volume_condition_met": true,  // 成交量条件满足
  "ma10_ema10_trend_ok": true,
  "trend_confirm_ok": true,
  "signal_strength_ok": true,
  "executed": true,  // 已执行
  "execution_result": "SUCCESS",
  "execution_reason": "所有条件满足，已执行开仓",
  "position_id": 123,
  "order_id": "456"
}
```

### 示例3：检测到卖出信号并平仓

```json
{
  "signal_type": "SELL",
  "symbol": "BTC/USDT",
  "current_price": 46000.0,
  "ema_short": 45900.0,
  "ema_long": 46100.0,
  "volume_ratio": 1.2,
  "volume_condition_met": true,
  "executed": true,
  "execution_result": "SUCCESS",
  "execution_reason": "卖出信号触发，已平仓",
  "position_id": 123
}
```

## 为什么需要命中信息？

### 1. 策略分析 📈
- 分析策略的信号质量
- 统计信号命中率
- 分析哪些信号最终执行了，哪些没有

### 2. 优化策略 ⚙️
- 查看过滤条件的效果
- 分析为什么某些信号没有执行
- 调整策略参数

### 3. 回测验证 🔄
- 对比实际执行和信号检测
- 分析策略的准确性
- 评估策略表现

### 4. 问题排查 🐛
- 查看策略是否正常工作
- 分析为什么没有执行交易
- 排查策略执行问题

## 总结

**命中信息 ≠ 订单信息**

- **命中信息**：记录所有检测到的信号（包括未执行的），用于分析和优化
- **订单信息**：只记录已执行的交易，用于交易管理

命中信息是一个更全面的记录，帮助你了解策略的完整运行情况，而不仅仅是交易结果。

