# ETF æ•°æ®çˆ¬è™«ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ç³»ç»Ÿå·²å®ç°ä» [Farside Investors](https://farside.co.uk/) ç½‘ç«™è‡ªåŠ¨çˆ¬å–æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠ ETF èµ„é‡‘æµå‘æ•°æ®çš„åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨åŒ–è°ƒåº¦
- **æ‰§è¡Œæ—¶é—´**: æ¯å¤© 13:17 è‡ªåŠ¨è¿è¡Œ
- **é‡‡é›†èŒƒå›´**: BTC ETF + ETH ETF
- **æ•°æ®æ¥æº**: Farside.co.ukï¼ˆç¾å›½æ—¶é—´ä¸‹åˆ1ç‚¹å·¦å³æ›´æ–°æ•°æ®ï¼‰

### 2. å¤šæ•°æ®æºç­–ç•¥
ç³»ç»Ÿé‡‡ç”¨ä¸‰å±‚æ•°æ®æºå®¹é”™æœºåˆ¶ï¼š

```
ä¼˜å…ˆçº§ 1: SoSoValue API (æ¨è)
   â†“ å¤±è´¥
ä¼˜å…ˆçº§ 2: CoinGlass API (å¤‡é€‰)
   â†“ å¤±è´¥
ä¼˜å…ˆçº§ 3: Farside ç½‘é¡µçˆ¬è™« (æœ€ç»ˆä¿éšœ)
```

### 3. æ™ºèƒ½è§£æ
- âœ… è‡ªåŠ¨è¯†åˆ« ETF äº§å“ ticker (IBIT, GBTC, FBTC, ETHE ç­‰)
- âœ… æ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼ (MM/DD/YYYY, DD/MM/YYYY)
- âœ… æ™ºèƒ½å¤„ç†é‡‘é¢å•ä½ ($, M, K)
- âœ… æ­£ç¡®å¤„ç†æ­£è´Ÿæ•°èµ„é‡‘æµå…¥/æµå‡º
- âœ… å®¹é”™å¤„ç†ï¼ˆç¼ºå¤±æ•°æ®ã€æ ¼å¼å¼‚å¸¸ç­‰ï¼‰

## å®‰è£…ä¾èµ–

### å¿…éœ€ä¾èµ–

```bash
pip install beautifulsoup4==4.12.2 lxml==4.9.3 requests==2.31.0
```

æˆ–å®‰è£…å®Œæ•´ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: è‡ªåŠ¨è°ƒåº¦ï¼ˆæ¨èï¼‰

å¯åŠ¨è°ƒåº¦å™¨åï¼Œç³»ç»Ÿä¼šåœ¨æ¯å¤© 13:17 è‡ªåŠ¨æ‰§è¡Œ ETF æ•°æ®é‡‡é›†ï¼š

```bash
cd /home/tonny/code/test2/crypto-analyzer
python3 app/scheduler.py
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
[13:17:00] å¼€å§‹é‡‡é›† ETF æ•°æ®...
ğŸ“Š ä» Farside è·å– BTC ETF æ•°æ®...
  âœ“ æ‰¾åˆ° 13 ä¸ªåˆ—: ['Date', 'IBIT', 'FBTC', 'ARKB', 'BITB']...
  âœ“ è§£ææ—¥æœŸ: 2025-11-05
  âœ… æˆåŠŸè§£æ 12 ä¸ª ETF æ•°æ®
  âœ“ ETFæ•°æ®é‡‡é›†å®Œæˆ: BTC (12/12), ETH (9/9), æ€»è®¡ 21 æ¡
```

### æ–¹æ³• 2: æ‰‹åŠ¨æ‰§è¡Œ

#### å®Œæ•´æµ‹è¯•ï¼ˆåŒ…å«æ•°æ®åº“ä¿å­˜ï¼‰

```bash
python3 scripts/test_farside_scraper.py
```

**è¾“å‡ºå†…å®¹**ï¼š
- é˜¶æ®µ 1: çˆ¬å– BTC å’Œ ETH ETF æ•°æ®
- é˜¶æ®µ 2: ä¿å­˜åˆ°æ•°æ®åº“å¹¶ç”Ÿæˆç»Ÿè®¡

#### ç®€åŒ–æµ‹è¯•ï¼ˆä»…çˆ¬å–éªŒè¯ï¼‰

```bash
python3 scripts/test_farside_simple.py
```

**è¾“å‡ºå†…å®¹**ï¼š
- éªŒè¯ç½‘ç«™å¯è®¿é—®æ€§
- è§£æ HTML è¡¨æ ¼ç»“æ„
- æ˜¾ç¤ºæœ€æ–°æ•°æ®æ ·æœ¬

#### Python ä»£ç è°ƒç”¨

```python
from app.collectors.crypto_etf_collector import CryptoETFCollector
from app.database.db_service import DatabaseService
from datetime import date

# åˆå§‹åŒ–ï¼ˆä¸è¿æ¥æ•°æ®åº“ï¼Œä»…çˆ¬å–ï¼‰
collector = CryptoETFCollector(db_service=None)

# çˆ¬å– BTC ETF æ•°æ®
btc_data = collector.fetch_farside_data('BTC')

# çˆ¬å– ETH ETF æ•°æ®
eth_data = collector.fetch_farside_data('ETH')

# å®Œæ•´é‡‡é›†æµç¨‹ï¼ˆåŒ…å«æ•°æ®åº“ä¿å­˜ï¼‰
db_service = DatabaseService(config['database'])
collector = CryptoETFCollector(db_service)

results = collector.collect_daily_data(
    target_date=date.today(),
    asset_types=['BTC', 'ETH']
)
```

## æ•°æ®ç»“æ„

### è¾“å…¥ï¼ˆFarside ç½‘é¡µï¼‰

Farside ç½‘ç«™æä¾›çš„ HTML è¡¨æ ¼æ ¼å¼ï¼š

```
| Date       | IBIT    | FBTC   | ARKB   | ... |
|------------|---------|--------|--------|-----|
| 11/05/2025 | 234.5M  | -12.3M | 45.6M  | ... |
```

### è¾“å‡ºï¼ˆETF æ•°æ®è®°å½•ï¼‰

```python
{
    'ticker': 'IBIT',                    # ETF ä»£ç 
    'trade_date': date(2025, 11, 5),    # äº¤æ˜“æ—¥æœŸ
    'net_inflow': 234500000.0,          # å‡€æµå…¥ï¼ˆç¾å…ƒï¼‰
    'gross_inflow': 0,                  # æ€»æµå…¥ï¼ˆFarside ä¸æä¾›ï¼‰
    'gross_outflow': 0,                 # æ€»æµå‡ºï¼ˆFarside ä¸æä¾›ï¼‰
    'aum': None,                        # èµ„äº§ç®¡ç†è§„æ¨¡
    'btc_holdings': None,               # BTC æŒä»“é‡
    'eth_holdings': None,               # ETH æŒä»“é‡
    'shares_outstanding': None,         # æµé€šè‚¡ä»½
    'nav': None,                        # å‡€å€¼
    'close_price': None,                # æ”¶ç›˜ä»·
    'volume': None,                     # äº¤æ˜“é‡
    'data_source': 'farside'            # æ•°æ®æ¥æº
}
```

## è°ƒåº¦é…ç½®

### ä¿®æ”¹é‡‡é›†æ—¶é—´

ç¼–è¾‘ `app/scheduler.py`ï¼š

```python
# ä¿®æ”¹ä¸ºå…¶ä»–æ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰
schedule.every().day.at("14:30").do(
    lambda: asyncio.run(self.collect_etf_data())
)
```

### ç¦ç”¨ ETF é‡‡é›†

åœ¨ `config.yaml` ä¸­æ·»åŠ ï¼š

```yaml
etf_collector:
  enabled: false
```

### ä¿®æ”¹é‡‡é›†é¢‘ç‡

```python
# æ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡
schedule.every(6).hours.do(
    lambda: asyncio.run(self.collect_etf_data())
)

# æ¯å¤©å¤šæ¬¡æ‰§è¡Œï¼ˆä¾‹å¦‚ 13:17 å’Œ 21:00ï¼‰
schedule.every().day.at("13:17").do(...)
schedule.every().day.at("21:00").do(...)
```

## æ•°æ®å­˜å‚¨

### æ•°æ®åº“è¡¨ç»“æ„

**crypto_etf_products**: ETF äº§å“ä¿¡æ¯
- `id`: ä¸»é”®
- `ticker`: ETF ä»£ç  (IBIT, GBTC, etc.)
- `name`: ETF åç§°
- `issuer`: å‘è¡Œæ–¹ (BlackRock, Grayscale, etc.)
- `asset_type`: èµ„äº§ç±»å‹ (BTC, ETH)

**crypto_etf_flows**: ETF èµ„é‡‘æµå‘ï¼ˆæ—¥åº¦æ•°æ®ï¼‰
- `id`: ä¸»é”®
- `etf_id`: å…³è” ETF äº§å“ ID
- `ticker`: ETF ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `net_inflow`: å‡€æµå…¥
- `aum`: èµ„äº§ç®¡ç†è§„æ¨¡
- `btc_holdings`: BTC æŒä»“é‡
- `eth_holdings`: ETH æŒä»“é‡
- `data_source`: æ•°æ®æ¥æº (farside, sosovalue, coinglass)

**crypto_etf_daily_summary**: æ¯æ—¥æ±‡æ€»æ•°æ®
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `asset_type`: èµ„äº§ç±»å‹
- `total_net_inflow`: æ€»å‡€æµå…¥
- `total_aum`: æ€» AUM
- `etf_count`: ETF æ•°é‡
- `inflow_count`: æµå…¥ ETF æ•°é‡
- `outflow_count`: æµå‡º ETF æ•°é‡

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆé€‰æ‹© 13:17 è¿™ä¸ªæ—¶é—´ï¼Ÿ

A: Farside.co.uk é€šå¸¸åœ¨ç¾å›½ä¸œéƒ¨æ—¶é—´ä¸‹åˆ 1:00 å·¦å³æ›´æ–°å‰ä¸€äº¤æ˜“æ—¥çš„æ•°æ®ã€‚13:17 (UTC+8 åŒ—äº¬æ—¶é—´) å¯¹åº”ç¾ä¸œæ—¶é—´å‡Œæ™¨ï¼Œç¡®ä¿æ•°æ®å·²æ›´æ–°ã€‚

### Q2: å¦‚æœ Farside ç½‘ç«™ç»“æ„å˜åŒ–æ€ä¹ˆåŠï¼Ÿ

A: ç³»ç»Ÿé‡‡ç”¨ä¸‰å±‚å®¹é”™æœºåˆ¶ï¼Œå³ä½¿ Farside çˆ¬è™«å¤±è´¥ï¼Œä»ä¼šå°è¯•ä» SoSoValue å’Œ CoinGlass API è·å–æ•°æ®ã€‚å¦‚éœ€ä¿®å¤ Farside çˆ¬è™«ï¼Œè¯·ç¼–è¾‘ `app/collectors/crypto_etf_collector.py` ä¸­çš„ `fetch_farside_data` æ–¹æ³•ã€‚

### Q3: å¦‚ä½•éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®é‡‡é›†ï¼Ÿ

A:
1. æŸ¥çœ‹è°ƒåº¦å™¨æ—¥å¿—ï¼š`logs/scheduler_YYYY-MM-DD.log`
2. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š`python3 scripts/test_farside_scraper.py`
3. æŸ¥è¯¢æ•°æ®åº“ï¼š
```sql
SELECT * FROM crypto_etf_flows
WHERE trade_date = CURDATE()
ORDER BY net_inflow DESC;
```

### Q4: æ•°æ®é‡‡é›†å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. **ç½‘ç»œè¿æ¥**: ç¡®ä¿èƒ½è®¿é—® farside.co.uk
2. **ä¾èµ–åº“**: ç¡®è®¤å·²å®‰è£… beautifulsoup4 å’Œ lxml
3. **æ•°æ®åº“è¿æ¥**: æ£€æŸ¥ config.yaml ä¸­çš„æ•°æ®åº“é…ç½®
4. **æ—¥å¿—è¾“å‡º**: æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

æ‰‹åŠ¨æµ‹è¯•ï¼š
```bash
# æµ‹è¯•ç½‘ç»œè¿æ¥
curl -I https://farside.co.uk/btc/

# æµ‹è¯•çˆ¬è™«
python3 scripts/test_farside_simple.py
```

### Q5: æ”¯æŒå“ªäº› ETF äº§å“ï¼Ÿ

A: ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ« Farside ç½‘ç«™ä¸Šåˆ—å‡ºçš„æ‰€æœ‰ ETF äº§å“ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š

**BTC ETF**:
- IBIT (BlackRock)
- FBTC (Fidelity)
- GBTC (Grayscale)
- ARKB (ARK)
- BITB (Bitwise)
- BTCO (Invesco)
- etc.

**ETH ETF**:
- ETHE (Grayscale)
- FETH (Fidelity)
- ETHW (Bitwise)
- etc.

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Scheduler (è°ƒåº¦å™¨)                       â”‚
â”‚                   æ¯å¤© 13:17 è§¦å‘é‡‡é›†                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CryptoETFCollector (é‡‡é›†å™¨)                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ SoSoValue APIâ”‚â†’ â”‚CoinGlass API â”‚â†’ â”‚Farside Scraperâ”‚     â”‚
â”‚  â”‚   (ä¼˜å…ˆçº§1)   â”‚  â”‚   (ä¼˜å…ˆçº§2)   â”‚  â”‚   (ä¼˜å…ˆçº§3)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                               â”‚
â”‚  æ•°æ®å¤„ç†:                                                    â”‚
â”‚  - æ—¥æœŸè§£æ (å¤šæ ¼å¼æ”¯æŒ)                                      â”‚
â”‚  - é‡‘é¢è§£æ ($, M, K, æ­£è´Ÿæ•°)                                â”‚
â”‚  - ETF ticker è¯†åˆ«                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DatabaseService (æ•°æ®åº“)                   â”‚
â”‚                                                               â”‚
â”‚  - crypto_etf_products (ETFäº§å“)                             â”‚
â”‚  - crypto_etf_flows (èµ„é‡‘æµå‘)                               â”‚
â”‚  - crypto_etf_daily_summary (æ¯æ—¥æ±‡æ€»)                       â”‚
â”‚  - crypto_etf_sentiment (å¸‚åœºæƒ…ç»ª)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç»´æŠ¤å»ºè®®

1. **å®šæœŸæ£€æŸ¥æ•°æ®è´¨é‡**: æ¯å‘¨æŸ¥çœ‹ä¸€æ¬¡é‡‡é›†æ—¥å¿—ï¼Œç¡®ä¿æ•°æ®å®Œæ•´
2. **ç›‘æ§ç½‘ç«™ç»“æ„å˜åŒ–**: Farside å¯èƒ½æ›´æ–°ç½‘ç«™å¸ƒå±€ï¼Œéœ€è¦ç›¸åº”è°ƒæ•´è§£æé€»è¾‘
3. **å¤‡ä»½æ•°æ®**: å®šæœŸå¤‡ä»½ ETF æ•°æ®è¡¨
4. **æ›´æ–° ETF äº§å“åˆ—è¡¨**: æ–° ETF äº§å“ä¸Šå¸‚æ—¶ï¼Œéœ€è¦åœ¨ `crypto_etf_products` è¡¨ä¸­æ·»åŠ 

## ç›¸å…³æ–‡æ¡£

- æ•°æ®åº“è®¾è®¡ï¼š`docs/database_schema.md`
- API æ–‡æ¡£ï¼š`docs/api_documentation.md`
- éƒ¨ç½²æŒ‡å—ï¼š`docs/deployment_guide.md`

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚
