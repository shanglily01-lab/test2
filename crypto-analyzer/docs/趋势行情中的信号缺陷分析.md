# è¶‹åŠ¿è¡Œæƒ…ä¸­çš„ä¿¡å·ç¼ºé™·åˆ†æ

> **é—®é¢˜**: åœ¨ä»Šæ—¥è¶‹åŠ¿è¡Œæƒ…ä¸­èƒœç‡ä»… 1/11 (9.1%)
> **æ—¥æœŸ**: 2026-02-09
> **ç³»ç»Ÿç‰ˆæœ¬**: è¶…çº§å¤§è„‘ V5.0

---

## é—®é¢˜ç°è±¡

### ä»Šæ—¥è¡¨ç°
- **æ€»è®¢å•**: 11ç¬”
- **ç›ˆåˆ©è®¢å•**: 1ç¬”
- **äºæŸè®¢å•**: 10ç¬”
- **èƒœç‡**: 9.1%
- **ç»“è®º**: åœ¨è¶‹åŠ¿è¡Œæƒ…ä¸­è¡¨ç°æå·®

---

## æ ¸å¿ƒç¼ºé™·åˆ†æ

### 1. ç™½åå•åªåšå¤šçš„è‡´å‘½ç¼ºé™·

**å½“å‰ç­–ç•¥**:
```python
# smart_decision_brain.py
whitelist_long = [
    'BCH/USDT', 'ENA/USDT', 'WIF/USDT', 'TAO/USDT',
    'DASH/USDT', 'ETC/USDT', 'NEAR/USDT', 'AAVE/USDT',
    'SUI/USDT', 'UNI/USDT', 'SOL/USDT'
]

# ç™½åå•åªåšLONG
signal_direction = 'LONG'
```

**é—®é¢˜**:
- å½“å¸‚åœºè¿›å…¥**ä¸‹è·Œè¶‹åŠ¿**æ—¶ï¼Œç™½åå•å¸ç§å…¨éƒ¨åšå¤š
- é€†åŠ¿å¼€ä»“ï¼Œ10ç¬”æ­¢æŸå…¨éƒ¨è§¦å‘
- Big4ç ´ä½DOWNä¿¡å·ä¼šç»™-50åˆ†ï¼Œä½†ä»æœ‰å¯èƒ½å¼€ä»“ï¼ˆå¦‚æœåŸºç¡€åˆ†å¤Ÿé«˜ï¼‰

**çœŸå®åœºæ™¯**:
```
09:00 - å¸‚åœºå¼€å§‹ä¸‹è·Œ
10:00 - BTCç ´ä½DOWNï¼ŒBig4 BEARISHå¼ºåº¦15
11:00 - ç³»ç»Ÿä»ç„¶æ‰«æç™½åå•åšå¤šä¿¡å·
12:00 - BCHè¯„åˆ†35åˆ† â†’ å¼€ä»“LONG
13:00 - ç»§ç»­ä¸‹è·Œ â†’ æ­¢æŸ-3%
14:00 - WIFè¯„åˆ†32åˆ† â†’ å¼€ä»“LONG
15:00 - ç»§ç»­ä¸‹è·Œ â†’ æ­¢æŸ-3%
...
ç»“æœ: è¿ç»­10ç¬”æ­¢æŸ
```

### 2. Big4å¦å†³æƒä¸å¤Ÿå¼º

**å½“å‰é€»è¾‘**:
```python
# ç ´ä½ç³»ç»ŸåŠ æƒ
if big4_strength >= 12 and direction_opposite:
    boost_score = -50  # å‡50åˆ†

    # ä½†å¦‚æœåŸºç¡€åˆ†å¾ˆé«˜ï¼ˆæ¯”å¦‚45åˆ†ï¼‰ï¼Œå‡50åˆ†åä»æœ‰-5åˆ†
    # åªè¦total_score >= threshold (30åˆ†)å°±å¼€ä»“
```

**é—®é¢˜**:
- Big4å¦å†³æƒåªæ˜¯å‡åˆ†ï¼Œä¸æ˜¯å®Œå…¨ç¦æ­¢
- ç ´ä½DOWNå¼ºåº¦90æ—¶ï¼Œåå‘ä¿¡å·å‡50åˆ†
- ä½†å¦‚æœåŸºç¡€åˆ†50ï¼Œå‡50åè¿˜æœ‰0åˆ†ï¼Œä»å¯èƒ½æ»¡è¶³æŸäº›æ¡ä»¶å¼€ä»“

**åº”è¯¥**:
```python
# å®Œå…¨ç¦æ­¢é€†Big4æ–¹å‘å¼€ä»“
if big4_strength >= 12 and direction_opposite:
    return {
        'decision': False,
        'reason': f'ğŸš« Big4å¼ºåŠ›å¦å†³: {big4_signal}(å¼ºåº¦{big4_strength})'
    }
```

### 3. ç¼ºå°‘è¶‹åŠ¿è·Ÿéšæœºåˆ¶

**å½“å‰é—®é¢˜**:
- åªæœ‰"ä½ç½®è¯„åˆ†"ï¼ˆ30åˆ†ï¼‰+ "è¶‹åŠ¿è¯„åˆ†"ï¼ˆ20åˆ†ï¼‰+ "ç›ˆäºæ¯”"ï¼ˆ30åˆ†ï¼‰
- è¶‹åŠ¿è¯„åˆ†åªçœ‹30æ—¥é˜³é˜´çº¿æ¯”ä¾‹
- æ²¡æœ‰æ˜ç¡®çš„è¶‹åŠ¿è·Ÿéšä¿¡å·

**ç¼ºå¤±çš„æœºåˆ¶**:
```python
# åº”è¯¥æœ‰ï¼š
if å¸‚åœºè¿›å…¥å¼ºåŠ¿ä¸‹è·Œè¶‹åŠ¿:
    1. åœæ­¢æ‰€æœ‰åšå¤šä¿¡å·
    2. å¯åŠ¨åšç©ºä¿¡å·ï¼ˆå¦‚æœå…è®¸ï¼‰
    3. æˆ–è€…å®Œå…¨åœæ­¢äº¤æ˜“

# å½“å‰æ²¡æœ‰ï¼š
- MAå‡çº¿ç³»ç»Ÿï¼ˆMA5/MA20/MA60ï¼‰
- è¶‹åŠ¿å¼ºåº¦åˆ¤æ–­
- åŠ¨æ€è°ƒæ•´å¼€ä»“æ–¹å‘
```

### 4. æ­¢æŸç†”æ–­è§¦å‘å¤ªæ™š

**å½“å‰é…ç½®**:
```python
# æ­¢æŸç†”æ–­é…ç½®
check_recent_orders = 10      # æ£€æŸ¥æœ€è¿‘10ç¬”
stop_loss_threshold = 5       # 5æ¬¡æ­¢æŸè§¦å‘
suspend_duration = 2å°æ—¶      # æš‚åœ2å°æ—¶
```

**é—®é¢˜**:
- éœ€è¦è¿ç»­5æ¬¡æ­¢æŸæ‰è§¦å‘ç†”æ–­
- åœ¨ä»Šå¤©çš„æ¡ˆä¾‹ä¸­ï¼Œ10ç¬”äºæŸæ‰1ç¬”ç›ˆåˆ©
- ç†”æ–­æœºåˆ¶æ¥å¾—å¤ªæ™šï¼Œå‰5ç¬”å·²ç»äºæŸä¸¥é‡

**åº”è¯¥**:
```python
# æ›´æ¿€è¿›çš„ç†”æ–­æ¡ä»¶
check_recent_orders = 5       # æ£€æŸ¥æœ€è¿‘5ç¬”
stop_loss_threshold = 3       # 3æ¬¡æ­¢æŸè§¦å‘ï¼ˆ60%èƒœç‡å‘Šè­¦ï¼‰
consecutive_loss = 3          # æˆ–è¿ç»­3æ¬¡äºæŸç«‹å³ç†”æ–­
```

### 5. æ²¡æœ‰å¸‚åœºç¯å¢ƒè¯†åˆ«

**å½“å‰é—®é¢˜**:
- åªæœ‰éœ‡è¡å¸‚/è¶‹åŠ¿å¸‚çš„ç®€å•åˆ¤æ–­
- ä½†æ²¡æœ‰åŠ¨æ€è°ƒæ•´äº¤æ˜“ç­–ç•¥

**ç¼ºå¤±çš„åŠŸèƒ½**:
```python
# åº”è¯¥æœ‰å¸‚åœºç¯å¢ƒåˆ†ç±»
MARKET_ENV = {
    'STRONG_UPTREND': {      # å¼ºåŠ¿ä¸Šæ¶¨
        'allow_long': True,
        'allow_short': False,
        'position_size': 1.2x  # åŠ å¤§ä»“ä½
    },
    'WEAK_UPTREND': {        # å¼±åŠ¿ä¸Šæ¶¨
        'allow_long': True,
        'allow_short': False,
        'position_size': 1.0x
    },
    'RANGE': {               # éœ‡è¡å¸‚
        'allow_long': True,
        'allow_short': True,
        'position_size': 0.8x
    },
    'WEAK_DOWNTREND': {      # å¼±åŠ¿ä¸‹è·Œ
        'allow_long': False,
        'allow_short': True,
        'position_size': 1.0x
    },
    'STRONG_DOWNTREND': {    # å¼ºåŠ¿ä¸‹è·Œ â† ä»Šå¤©çš„æƒ…å†µ
        'allow_long': False,  # å®Œå…¨ç¦æ­¢åšå¤š
        'allow_short': True,
        'position_size': 1.2x
    }
}
```

---

## è§£å†³æ–¹æ¡ˆ

### ä¼˜å…ˆçº§1: ç«‹å³å®æ–½ï¼ˆé˜²æ­¢ç»§ç»­äºæŸï¼‰

#### æ–¹æ¡ˆ1.1: å¼ºåŒ–Big4å¦å†³æƒ

```python
# smart_decision_brain.py: should_trade()

# åœ¨å¼€ä»“å‰å¼ºåˆ¶æ£€æŸ¥Big4
big4_result = self.get_big4_result()

if big4_result:
    big4_signal = big4_result['overall_signal']
    big4_strength = big4_result['signal_strength']

    # ğŸ”¥ å¼ºåŠ›å¦å†³ï¼šå¼ºåº¦>=12ä¸”æ–¹å‘ç›¸åæ—¶å®Œå…¨ç¦æ­¢å¼€ä»“
    if big4_strength >= 12:
        if big4_signal == 'BEARISH' and signal_direction == 'LONG':
            return {
                'decision': False,
                'direction': None,
                'score': 0,
                'reasons': [f'ğŸš« Big4å¼ºåŠ›å¦å†³: BEARISH(å¼ºåº¦{big4_strength:.0f}) ç¦æ­¢åšå¤š'],
                'trade_params': {}
            }
        elif big4_signal == 'BULLISH' and signal_direction == 'SHORT':
            return {
                'decision': False,
                'direction': None,
                'score': 0,
                'reasons': [f'ğŸš« Big4å¼ºåŠ›å¦å†³: BULLISH(å¼ºåº¦{big4_strength:.0f}) ç¦æ­¢åšç©º'],
                'trade_params': {}
            }
```

**æ”¶ç›Š**:
- å®Œå…¨é˜»æ­¢é€†Big4æ–¹å‘å¼€ä»“
- ä»Šå¤©çš„10ç¬”äºæŸä¸­ï¼Œè‡³å°‘8ç¬”å¯ä»¥é¿å…
- é¢„è®¡æŒ½å›æŸå¤±: 8 Ã— $18 = $144

#### æ–¹æ¡ˆ1.2: æ›´æ¿€è¿›çš„ç†”æ–­æœºåˆ¶

```python
# config/v3_config.json

{
  "circuit_breaker": {
    "enabled": true,
    "check_recent_orders": 5,        // æ”¹ä¸º5ç¬”
    "stop_loss_threshold": 3,        // æ”¹ä¸º3æ¬¡ï¼ˆ60%å°±å‘Šè­¦ï¼‰
    "consecutive_loss_threshold": 3, // æ–°å¢: è¿ç»­3æ¬¡äºæŸç«‹å³ç†”æ–­
    "suspend_duration_hours": 2
  }
}
```

```python
# position_manager_v3.py: check_circuit_breaker()

# æ–°å¢è¿ç»­äºæŸæ£€æµ‹
recent_5 = get_recent_orders(limit=5)
consecutive_losses = 0

for order in recent_5:
    if order['realized_pnl'] < 0:
        consecutive_losses += 1
    else:
        break

# è¿ç»­3æ¬¡äºæŸç«‹å³ç†”æ–­
if consecutive_losses >= 3:
    CREATE emergency_intervention(
        intervention_type='CIRCUIT_BREAKER',
        block_long=True,
        block_short=True,
        trigger_reason=f'è¿ç»­{consecutive_losses}æ¬¡äºæŸï¼Œç´§æ€¥ç†”æ–­',
        expires_at=NOW() + 2å°æ—¶
    )
```

**æ”¶ç›Š**:
- ç¬¬3ç¬”äºæŸåç«‹å³ç†”æ–­ï¼Œé¿å…åç»­7ç¬”
- é¢„è®¡æŒ½å›æŸå¤±: 7 Ã— $18 = $126

### ä¼˜å…ˆçº§2: çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å¤©å†…ï¼‰

#### æ–¹æ¡ˆ2.1: å¢åŠ MAè¶‹åŠ¿è¿‡æ»¤

```python
# smart_decision_brain.py: new method

def check_ma_trend(self, klines_1h):
    """
    æ£€æŸ¥MAå‡çº¿è¶‹åŠ¿

    Returns:
        'STRONG_UP', 'UP', 'NEUTRAL', 'DOWN', 'STRONG_DOWN'
    """
    if len(klines_1h) < 60:
        return 'NEUTRAL'

    closes = [k['close'] for k in klines_1h]

    # è®¡ç®—MA
    ma5 = sum(closes[-5:]) / 5
    ma20 = sum(closes[-20:]) / 20
    ma60 = sum(closes[-60:]) / 60
    current = closes[-1]

    # åˆ¤æ–­è¶‹åŠ¿
    if ma5 > ma20 > ma60 and current > ma5:
        # å¤šå¤´æ’åˆ—
        if (current - ma60) / ma60 * 100 > 5:
            return 'STRONG_UP'
        return 'UP'

    elif ma5 < ma20 < ma60 and current < ma5:
        # ç©ºå¤´æ’åˆ—
        if (ma60 - current) / ma60 * 100 > 5:
            return 'STRONG_DOWN'  # â† ä»Šå¤©çš„æƒ…å†µ
        return 'DOWN'

    return 'NEUTRAL'

# åœ¨should_trade()ä¸­ä½¿ç”¨
ma_trend = self.check_ma_trend(klines_1h)

if ma_trend == 'STRONG_DOWN' and signal_direction == 'LONG':
    return {
        'decision': False,
        'reasons': ['ğŸš« å¼ºåŠ¿ä¸‹è·Œè¶‹åŠ¿ï¼Œç¦æ­¢åšå¤š']
    }

if ma_trend == 'STRONG_UP' and signal_direction == 'SHORT':
    return {
        'decision': False,
        'reasons': ['ğŸš« å¼ºåŠ¿ä¸Šæ¶¨è¶‹åŠ¿ï¼Œç¦æ­¢åšç©º']
    }
```

**æ”¶ç›Š**:
- MAå‡çº¿æ˜ç¡®åˆ¤æ–­è¶‹åŠ¿æ–¹å‘
- é¿å…é€†è¶‹åŠ¿å¼€ä»“
- ä¸Big4é…åˆï¼ŒåŒé‡ä¿æŠ¤

#### æ–¹æ¡ˆ2.2: æš‚åœç™½åå•äº¤æ˜“åŠŸèƒ½

```python
# config/v3_config.json

{
  "whitelist_config": {
    "enabled": true,
    "pause_on_big4_opposite": true,  // æ–°å¢: Big4åå‘æ—¶æš‚åœç™½åå•
    "pause_threshold": 12             // Big4å¼ºåº¦é˜ˆå€¼
  }
}
```

```python
# smart_trader_service.py

if self.whitelist_config['pause_on_big4_opposite']:
    big4_result = self.brain.get_big4_result()

    if big4_result and big4_result['signal_strength'] >= 12:
        if big4_result['overall_signal'] == 'BEARISH':
            logger.warning(f"ğŸš« Big4å¼ºåŠ¿ä¸‹è·Œ(å¼ºåº¦{big4_result['signal_strength']:.0f})ï¼Œæš‚åœç™½åå•äº¤æ˜“")
            skip_whitelist_scan = True
```

**æ”¶ç›Š**:
- ä¿ç•™ç™½åå•æœºåˆ¶ï¼Œä½†åœ¨æç«¯è¡Œæƒ…ä¸‹ç¦ç”¨
- çµæ´»é…ç½®ï¼Œä¸å½±å“æ­£å¸¸è¡Œæƒ…

### ä¼˜å…ˆçº§3: ä¸­æœŸä¼˜åŒ–ï¼ˆ1å‘¨å†…ï¼‰

#### æ–¹æ¡ˆ3.1: å®ç°è¶‹åŠ¿è·Ÿéšç­–ç•¥

```python
# new file: app/services/trend_following_strategy.py

class TrendFollowingStrategy:
    """
    è¶‹åŠ¿è·Ÿéšç­–ç•¥

    æ ¸å¿ƒç†å¿µ: The trend is your friend
    """

    def detect_trend_strength(self, symbol):
        """
        æ£€æµ‹è¶‹åŠ¿å¼ºåº¦

        Returns:
            {
                'trend': 'STRONG_UP' | 'UP' | 'NEUTRAL' | 'DOWN' | 'STRONG_DOWN',
                'strength': 0-100,
                'should_trade': bool,
                'direction': 'LONG' | 'SHORT' | None
            }
        """
        # 1. MAå‡çº¿åˆ¤æ–­
        ma_trend = self.calculate_ma_trend(symbol)

        # 2. Big4ç¡®è®¤
        big4_trend = self.get_big4_trend()

        # 3. åŠ¨é‡ç¡®è®¤
        momentum = self.calculate_momentum(symbol)

        # 4. ç»¼åˆåˆ¤æ–­
        if ma_trend == 'STRONG_DOWN' and big4_trend == 'BEARISH':
            return {
                'trend': 'STRONG_DOWN',
                'strength': 85,
                'should_trade': True,
                'direction': 'SHORT'  # å¦‚æœå…è®¸åšç©º
            }

        if ma_trend == 'DOWN' and big4_trend == 'BEARISH':
            return {
                'trend': 'DOWN',
                'strength': 65,
                'should_trade': False,  # è¶‹åŠ¿ç¡®è®¤ä½†ä¸å¤Ÿå¼ºï¼Œè§‚æœ›
                'direction': None
            }
```

#### æ–¹æ¡ˆ3.2: åŠ¨æ€ä»“ä½ç®¡ç†

```python
# æ ¹æ®å¸‚åœºç¯å¢ƒè°ƒæ•´ä»“ä½

POSITION_SIZE_MULTIPLIER = {
    'STRONG_UPTREND': 1.3,      # åŠ å¤§ä»“ä½
    'WEAK_UPTREND': 1.0,
    'RANGE': 0.7,               # å‡å°ä»“ä½
    'WEAK_DOWNTREND': 0.5,      # å¤§å¹…å‡å°
    'STRONG_DOWNTREND': 0.0     # å®Œå…¨åœæ­¢ï¼ˆæˆ–åšç©º1.3xï¼‰
}

# åœ¨å¼€ä»“æ—¶åŠ¨æ€è°ƒæ•´
market_env = detect_market_environment()
position_size_usdt = base_position_size * POSITION_SIZE_MULTIPLIER[market_env]
```

---

## å®æ–½è®¡åˆ’

### ç¬¬1å¤©ï¼ˆä»Šå¤©ï¼‰- ç´§æ€¥ä¿®å¤

- [x] æ–‡æ¡£åˆ†æå®Œæˆ
- [ ] å®æ–½æ–¹æ¡ˆ1.1: å¼ºåŒ–Big4å¦å†³æƒ
- [ ] å®æ–½æ–¹æ¡ˆ1.2: æ›´æ¿€è¿›ç†”æ–­
- [ ] æµ‹è¯•éªŒè¯
- [ ] éƒ¨ç½²ä¸Šçº¿

**é¢„æœŸæ”¶ç›Š**: é¿å…70-80%çš„é€†åŠ¿äºæŸ

### ç¬¬2-3å¤© - çŸ­æœŸä¼˜åŒ–

- [ ] å®æ–½æ–¹æ¡ˆ2.1: MAè¶‹åŠ¿è¿‡æ»¤
- [ ] å®æ–½æ–¹æ¡ˆ2.2: ç™½åå•æš‚åœåŠŸèƒ½
- [ ] å›æµ‹éªŒè¯
- [ ] éƒ¨ç½²ä¸Šçº¿

**é¢„æœŸæ”¶ç›Š**: èƒœç‡æå‡åˆ°40-50%

### ç¬¬4-7å¤© - ä¸­æœŸä¼˜åŒ–

- [ ] è®¾è®¡è¶‹åŠ¿è·Ÿéšç­–ç•¥
- [ ] å®ç°åŠ¨æ€ä»“ä½ç®¡ç†
- [ ] å®Œæ•´å›æµ‹
- [ ] é€æ­¥éƒ¨ç½²

**é¢„æœŸæ”¶ç›Š**: èƒœç‡æå‡åˆ°55-60%ï¼Œè¶‹åŠ¿è¡Œæƒ…ç›ˆåˆ©èƒ½åŠ›æ˜¾è‘—æå‡

---

## é£é™©æç¤º

### æ–¹æ¡ˆ1.1é£é™©
- è¿‡å¼ºçš„å¦å†³å¯èƒ½é”™è¿‡åè½¬æœºä¼š
- å»ºè®®: åªåœ¨å¼ºåº¦>=12æ—¶è§¦å‘ï¼Œä¿ç•™çµæ´»æ€§

### æ–¹æ¡ˆ1.2é£é™©
- è¿‡äºæ¿€è¿›çš„ç†”æ–­å¯èƒ½é”™è¿‡åç»­æœºä¼š
- å»ºè®®: 2å°æ—¶æš‚åœåè‡ªåŠ¨è§£é™¤ï¼Œå…è®¸å†æ¬¡å°è¯•

### æ–¹æ¡ˆ2.1é£é™©
- MAå‡çº¿å­˜åœ¨æ»åæ€§
- å»ºè®®: ä¸Big4é…åˆä½¿ç”¨ï¼ŒåŒé‡ç¡®è®¤

---

## æ€»ç»“

### ä»Šå¤©çš„æ•™è®­

1. **ç™½åå•åªåšå¤šæ˜¯åŒåˆƒå‰‘**: ç‰›å¸‚èµšé’±ï¼Œç†Šå¸‚äºæŸ
2. **Big4å¦å†³æƒä¸å¤Ÿå¼º**: åº”è¯¥å®Œå…¨ç¦æ­¢ï¼Œè€Œéå‡åˆ†
3. **ç¼ºå°‘è¶‹åŠ¿è¯†åˆ«**: æ²¡æœ‰æ„è¯†åˆ°å¸‚åœºç¯å¢ƒå·²æ”¹å˜
4. **ç†”æ–­æ¥å¾—å¤ªæ™š**: 5æ¬¡æ­¢æŸé—¨æ§›å¤ªé«˜

### æ ¸å¿ƒåŸåˆ™

> **The trend is your friend**
> è¶‹åŠ¿æ˜¯ä½ çš„æœ‹å‹ï¼Œä¸è¦é€†åŠ¿è€Œä¸º

### ç«‹å³è¡ŒåŠ¨

**æœ€ç´§æ€¥**: å®æ–½æ–¹æ¡ˆ1.1å’Œ1.2ï¼Œä»Šå¤©ä¸‹åˆä¸Šçº¿
**ç†ç”±**: å¦‚æœä»Šå¤©ç»§ç»­è¿™æ ·çš„è¡Œæƒ…ï¼Œä¸ä¼˜åŒ–ä¼šç»§ç»­äºæŸ

---

**æ–‡æ¡£åˆ›å»º**: 2026-02-09
**é—®é¢˜ä¸¥é‡æ€§**: ğŸ”´ Critical
**éœ€è¦ç«‹å³ä¿®å¤**: âœ… Yes
