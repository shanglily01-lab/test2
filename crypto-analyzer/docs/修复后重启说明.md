# 修复 strategy_id 字段后重启说明

## 修复内容

已将 `strategy_hits` 表的 `strategy_id` 字段从 `INT` 改为 `BIGINT`，以支持大数字的策略ID。

## 是否需要重启？

### ✅ strategy_scheduler - **建议重启**

**原因：**
- 之前因为数据库错误（strategy_id 超出范围）可能无法保存数据
- 重启后可以确保使用修复后的表结构正常保存数据

**重启方法：**
```bash
# 1. 停止当前运行的 strategy_scheduler
# 如果使用 screen:
screen -r strategy
# 然后按 Ctrl+C 停止

# 或者查找进程并结束:
ps aux | grep strategy_scheduler
kill <PID>

# 2. 重新启动
python app/strategy_scheduler.py

# 或者使用 screen:
screen -S strategy
python app/strategy_scheduler.py
# 按 Ctrl+A 然后按 D 分离会话
```

### ⚠️ main 服务 - **可选重启**

**原因：**
- main 服务只是查询 `strategy_hits` 表（通过 `/api/strategies/hits` API）
- 数据库表结构修改后，查询功能不受影响
- 但为了保险起见，也可以重启

**重启方法：**
```bash
# 1. 停止当前运行的 main 服务
# 如果使用 uvicorn:
# 找到进程并结束，或者按 Ctrl+C

# 2. 重新启动
uvicorn app.main:app --host 0.0.0.0 --port 8000

# 或者使用其他启动方式
```

## 验证修复

重启后，运行检查脚本验证：

```bash
python scripts/check_strategy_execution.py
```

应该能看到：
- 策略执行器正常运行
- 检测到信号时能正常保存到数据库
- 没有数据库错误

## 注意事项

1. **重启顺序**：建议先重启 strategy_scheduler，再重启 main（如果需要）
2. **数据安全**：重启不会影响已保存的数据
3. **服务中断**：重启期间策略不会执行，但时间很短（几秒钟）

