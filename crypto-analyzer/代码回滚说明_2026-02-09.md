# 超级大脑代码回滚说明

**回滚时间**: 2026-02-09
**回滚目标**: 2026-02-04 20:25 (提交 c007b8a)
**回滚原因**: V2/V3并行策略效果不佳，恢复到传统模式

## 回滚的提交

从当前版本回滚到：
```
commit c007b8a68f75887ebc49543ef1df81701d8fac68
Date:   Wed Feb 4 20:25:23 2026 +0800
fix: 添加模式筛选逻辑并升级最差交易对到黑名单3级
```

## 恢复的核心组件

### 1. 主启动服务
- `smart_trader_service.py`
  - 移除 V3 模块（SmartEntryExecutorV3, PositionManagerV3, SignalScorerV3）
  - 移除 V2 模块（SignalScorerV2）
  - 恢复传统信号检测逻辑
  - 恢复 RangeMarketDetector, BollingerMeanReversionStrategy, TradingModeSwitcher

### 2. 智能建仓执行器
- `app/services/smart_entry_executor.py`
  - 恢复到传统的分批建仓逻辑

### 3. 智能平仓优化器
- `app/services/smart_exit_optimizer.py`
  - 恢复到原有的止盈止损逻辑

### 4. 恢复的其他组件
- `app/services/advanced_signal_detector.py` - 高级信号检测器
- `app/services/smart_decision_brain_enhanced.py` - 增强版超级大脑
- `app/services/market_observer.py` - 市场观察器
- `app/services/market_regime_manager.py` - 市场机制管理器
- 等多个支持组件

## 主要变更对比

### 开仓阈值
- **V3版本**: 50分（激进）
- **回滚后**: 35分（平衡）

### 信号系统
- **V3版本**: 多时间周期评分（1H + 15M + 5M + Big4）
- **回滚后**: 传统信号组合 + 趋势/震荡模式切换

### 建仓方式
- **V3版本**: 5M K线确认后一次性精准入场
- **回滚后**: 智能分批建仓（3批次）

### 止损策略
- **V3版本**:
  - 初始止损 1.5%
  - 快速止损 0-15分钟>1%, 15-30分钟>1.5%, 30-60分钟>2%
- **回滚后**:
  - 传统止损逻辑（需要验证具体参数）

## 移除的模块

以下模块在回滚后不再使用：
- `app/services/smart_entry_executor_v3.py`
- `app/services/position_manager_v3.py`
- `app/strategies/signal_scorer_v3.py`
- `app/strategies/signal_scorer_v2.py`

## 2月4日版本的核心特性

根据提交信息，2月4日版本的主要优化：

### 1. 模式筛选逻辑
- **TREND模式**: 只接受包含'TREND'的信号
- **RANGE模式**: 只接受包含'RANGE'的信号
- 自动过滤不匹配当前市场模式的信号

### 2. 黑名单升级
永久禁止以下表现最差的交易对（Level 3黑名单）：
- ZAMA/USDT: 11笔, 36.4%胜率, -$281.24
- DASH/USDT: 7笔, 14.3%胜率, -$279.68
- DOGE/USDT: 5笔, 0%胜率, -$202.51
- CHZ/USDT: 5笔, 0%胜率, -$187.73

### 3. 历史性能数据（2月1-4日）
- **TREND策略**: 99笔, 51.5%胜率, +$428 ✅
- **RANGE策略**: 5笔, 80.0%胜率, +$41 ✅
- **OTHER策略**: 289笔, 38.1%胜率, -$1417 ❌

## 验证要点

回滚后需要验证：
1. ✅ `smart_trader_service.py` 不再导入 V2/V3 模块
2. ✅ 开仓阈值恢复到 35 分
3. ✅ 模式筛选逻辑存在（TREND/RANGE过滤）
4. ✅ 黑名单从 `trading_blacklist` 表加载
5. ⚠️ 需要确认止损参数是否合理

## 后续建议

1. **监控24-48小时**: 观察传统模式的表现
2. **对比数据**: 与V3模式的数据进行对比分析
3. **逐步优化**: 在传统模式基础上进行渐进式优化
4. **保留V3代码**: V3相关文件保留在代码库中，以备将来参考

---

**回滚操作**:
```bash
git checkout c007b8a -- smart_trader_service.py
git checkout c007b8a -- app/services/
```

**提交信息**: feat: 回滚超级大脑到2月4日传统模式版本
