================================================================================
数据库表结构文档
================================================================================


================================================================================
表名: adaptive_params
================================================================================
CREATE TABLE `adaptive_params` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `param_key` varchar(100) NOT NULL COMMENT '参数键名, 如 long_stop_loss_pct',
  `param_value` decimal(10,6) NOT NULL COMMENT '参数值',
  `param_type` varchar(50) NOT NULL COMMENT '参数类型: long/short',
  `description` varchar(255) DEFAULT NULL COMMENT '参数描述',
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  `updated_by` varchar(100) DEFAULT 'adaptive_optimizer' COMMENT '更新来源',
  PRIMARY KEY (`id`),
  UNIQUE KEY `param_key` (`param_key`),
  KEY `idx_param_key` (`param_key`),
  KEY `idx_param_type` (`param_type`),
  KEY `idx_updated_at` (`updated_at`)
) ENGINE=InnoDB AUTO_INCREMENT=86 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='自适应参数表'


================================================================================
表名: big4_trend_history
================================================================================
CREATE TABLE `big4_trend_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `overall_signal` varchar(20) DEFAULT NULL,
  `signal_strength` decimal(5,2) DEFAULT NULL,
  `bullish_count` int(11) DEFAULT NULL,
  `bearish_count` int(11) DEFAULT NULL,
  `recommendation` text DEFAULT NULL,
  `btc_signal` varchar(20) DEFAULT NULL,
  `btc_strength` decimal(5,2) DEFAULT NULL,
  `btc_reason` text DEFAULT NULL,
  `btc_is_consolidating` tinyint(1) DEFAULT NULL,
  `btc_price_change_6h` decimal(10,4) DEFAULT NULL,
  `btc_1h_dominant` varchar(20) DEFAULT NULL,
  `btc_15m_dominant` varchar(20) DEFAULT NULL,
  `eth_signal` varchar(20) DEFAULT NULL,
  `eth_strength` decimal(5,2) DEFAULT NULL,
  `eth_reason` text DEFAULT NULL,
  `eth_is_consolidating` tinyint(1) DEFAULT NULL,
  `eth_price_change_6h` decimal(10,4) DEFAULT NULL,
  `eth_1h_dominant` varchar(20) DEFAULT NULL,
  `eth_15m_dominant` varchar(20) DEFAULT NULL,
  `bnb_signal` varchar(20) DEFAULT NULL,
  `bnb_strength` decimal(5,2) DEFAULT NULL,
  `bnb_reason` text DEFAULT NULL,
  `bnb_is_consolidating` tinyint(1) DEFAULT NULL,
  `bnb_price_change_6h` decimal(10,4) DEFAULT NULL,
  `bnb_1h_dominant` varchar(20) DEFAULT NULL,
  `bnb_15m_dominant` varchar(20) DEFAULT NULL,
  `sol_signal` varchar(20) DEFAULT NULL,
  `sol_strength` decimal(5,2) DEFAULT NULL,
  `sol_reason` text DEFAULT NULL,
  `sol_is_consolidating` tinyint(1) DEFAULT NULL,
  `sol_price_change_6h` decimal(10,4) DEFAULT NULL,
  `sol_1h_dominant` varchar(20) DEFAULT NULL,
  `sol_15m_dominant` varchar(20) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_overall_signal` (`overall_signal`,`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=51959 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci


================================================================================
表名: blockchain_gas_daily
================================================================================
CREATE TABLE `blockchain_gas_daily` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `chain_name` varchar(50) NOT NULL COMMENT '链名称: ethereum, bsc, polygon, arbitrum, optimism, avalanche',
  `chain_display_name` varchar(50) NOT NULL COMMENT '链显示名称: Ethereum, BSC, Polygon, Arbitrum, Optimism, Avalanche',
  `date` date NOT NULL COMMENT '统计日期',
  `total_gas_used` decimal(30,0) NOT NULL DEFAULT 0 COMMENT '总Gas消耗量',
  `total_transactions` bigint(20) NOT NULL DEFAULT 0 COMMENT '总交易笔数',
  `avg_gas_per_tx` decimal(20,2) NOT NULL DEFAULT 0.00 COMMENT '平均每笔交易Gas消耗',
  `avg_gas_price` decimal(30,0) NOT NULL DEFAULT 0 COMMENT '平均Gas价格(Wei/Gwei)',
  `max_gas_price` decimal(30,0) DEFAULT NULL COMMENT '最高Gas价格',
  `min_gas_price` decimal(30,0) DEFAULT NULL COMMENT '最低Gas价格',
  `native_token_price_usd` decimal(18,8) DEFAULT NULL COMMENT '原生代币价格(USD)',
  `total_gas_value_usd` decimal(24,2) NOT NULL DEFAULT 0.00 COMMENT '总Gas价值(USD)',
  `avg_gas_value_usd` decimal(18,8) NOT NULL DEFAULT 0.00000000 COMMENT '平均每笔交易Gas价值(USD)',
  `total_blocks` bigint(20) NOT NULL DEFAULT 0 COMMENT '总区块数',
  `avg_block_size` decimal(20,2) DEFAULT NULL COMMENT '平均区块大小',
  `active_addresses` bigint(20) DEFAULT NULL COMMENT '活跃地址数',
  `new_addresses` bigint(20) DEFAULT NULL COMMENT '新增地址数',
  `data_source` varchar(100) DEFAULT NULL COMMENT '数据来源',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_chain_date` (`chain_name`,`date`),
  KEY `idx_date` (`date`),
  KEY `idx_chain_name` (`chain_name`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=358 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='区块链Gas消耗日统计表'


================================================================================
表名: blockchain_gas_daily_summary
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`admin`@`%` SQL SECURITY DEFINER VIEW `blockchain_gas_daily_summary` AS select `blockchain_gas_daily`.`date` AS `date`,count(distinct `blockchain_gas_daily`.`chain_name`) AS `chain_count`,sum(`blockchain_gas_daily`.`total_gas_used`) AS `total_gas_used_all_chains`,sum(`blockchain_gas_daily`.`total_transactions`) AS `total_transactions_all_chains`,sum(`blockchain_gas_daily`.`total_gas_value_usd`) AS `total_gas_value_usd_all_chains`,avg(`blockchain_gas_daily`.`avg_gas_value_usd`) AS `avg_gas_value_usd_per_tx`,sum(`blockchain_gas_daily`.`active_addresses`) AS `total_active_addresses` from `blockchain_gas_daily` group by `blockchain_gas_daily`.`date` order by `blockchain_gas_daily`.`date` desc


================================================================================
表名: corporate_treasury_companies
================================================================================
CREATE TABLE `corporate_treasury_companies` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `company_name` varchar(100) NOT NULL COMMENT '公司名称',
  `ticker_symbol` varchar(20) DEFAULT NULL COMMENT '股票代码',
  `category` varchar(50) DEFAULT NULL COMMENT '分类：mining, holding, payment等',
  `description` text DEFAULT NULL COMMENT '公司简介',
  `official_website` varchar(255) DEFAULT NULL COMMENT '官网',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否活跃监控',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `company_name` (`company_name`) USING BTREE,
  KEY `idx_company_name` (`company_name`) USING BTREE,
  KEY `idx_ticker` (`ticker_symbol`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=108 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='企业金库公司基础信息'


================================================================================
表名: corporate_treasury_financing
================================================================================
CREATE TABLE `corporate_treasury_financing` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `company_id` int(11) NOT NULL COMMENT '公司ID',
  `financing_date` date NOT NULL COMMENT '融资日期',
  `financing_type` varchar(50) DEFAULT NULL COMMENT '融资类型：equity, convertible_note, loan, atm等',
  `amount` decimal(20,2) DEFAULT NULL COMMENT '融资金额(USD)',
  `purpose` text DEFAULT NULL COMMENT '用途说明',
  `announcement_url` varchar(500) DEFAULT NULL COMMENT '公告链接',
  `notes` text DEFAULT NULL COMMENT '备注',
  `data_source` varchar(50) DEFAULT 'manual' COMMENT '数据来源',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_company_date` (`company_id`,`financing_date`) USING BTREE,
  KEY `idx_financing_type` (`financing_type`) USING BTREE,
  KEY `idx_financing_date` (`financing_date`) USING BTREE,
  CONSTRAINT `corporate_treasury_financing_ibfk_1` FOREIGN KEY (`company_id`) REFERENCES `corporate_treasury_companies` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='企业融资记录'


================================================================================
表名: corporate_treasury_purchases
================================================================================
CREATE TABLE `corporate_treasury_purchases` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `company_id` int(11) NOT NULL COMMENT '公司ID',
  `purchase_date` date NOT NULL COMMENT '购买日期',
  `asset_type` varchar(20) NOT NULL COMMENT '资产类型：BTC, ETH',
  `quantity` decimal(20,8) NOT NULL COMMENT '购买数量',
  `average_price` decimal(20,2) DEFAULT NULL COMMENT '平均购买价格(USD)',
  `total_amount` decimal(20,2) DEFAULT NULL COMMENT '购买总金额(USD)',
  `cumulative_holdings` decimal(20,8) DEFAULT NULL COMMENT '累计持仓量',
  `announcement_url` varchar(500) DEFAULT NULL COMMENT '公告链接',
  `notes` text DEFAULT NULL COMMENT '备注',
  `data_source` varchar(50) DEFAULT 'manual' COMMENT '数据来源',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_company_date` (`company_id`,`purchase_date`) USING BTREE,
  KEY `idx_asset_type` (`asset_type`) USING BTREE,
  KEY `idx_purchase_date` (`purchase_date`) USING BTREE,
  CONSTRAINT `corporate_treasury_purchases_ibfk_1` FOREIGN KEY (`company_id`) REFERENCES `corporate_treasury_companies` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4552 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='企业金库购买记录'


================================================================================
表名: corporate_treasury_stock_prices
================================================================================
CREATE TABLE `corporate_treasury_stock_prices` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `company_id` int(11) NOT NULL COMMENT '公司ID',
  `trade_date` date NOT NULL COMMENT '交易日期',
  `open_price` decimal(10,2) DEFAULT NULL COMMENT '开盘价',
  `close_price` decimal(10,2) DEFAULT NULL COMMENT '收盘价',
  `high_price` decimal(10,2) DEFAULT NULL COMMENT '最高价',
  `low_price` decimal(10,2) DEFAULT NULL COMMENT '最低价',
  `volume` bigint(20) DEFAULT NULL COMMENT '成交量',
  `market_cap` decimal(20,2) DEFAULT NULL COMMENT '市值',
  `change_pct` decimal(10,4) DEFAULT NULL COMMENT '涨跌幅(%)',
  `data_source` varchar(50) DEFAULT 'manual' COMMENT '数据来源',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `unique_company_date` (`company_id`,`trade_date`) USING BTREE,
  KEY `idx_trade_date` (`trade_date`) USING BTREE,
  CONSTRAINT `corporate_treasury_stock_prices_ibfk_1` FOREIGN KEY (`company_id`) REFERENCES `corporate_treasury_companies` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='企业股价数据'


================================================================================
表名: corporate_treasury_summary
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `corporate_treasury_summary` AS select `c`.`id` AS `id`,`c`.`company_name` AS `company_name`,`c`.`ticker_symbol` AS `ticker_symbol`,`c`.`category` AS `category`,(select `corporate_treasury_purchases`.`cumulative_holdings` from `corporate_treasury_purchases` where `corporate_treasury_purchases`.`company_id` = `c`.`id` and `corporate_treasury_purchases`.`asset_type` = 'BTC' order by `corporate_treasury_purchases`.`purchase_date` desc limit 1) AS `btc_holdings`,(select sum(`corporate_treasury_purchases`.`total_amount`) from `corporate_treasury_purchases` where `corporate_treasury_purchases`.`company_id` = `c`.`id` and `corporate_treasury_purchases`.`asset_type` = 'BTC') AS `btc_total_investment`,(select `corporate_treasury_purchases`.`cumulative_holdings` from `corporate_treasury_purchases` where `corporate_treasury_purchases`.`company_id` = `c`.`id` and `corporate_treasury_purchases`.`asset_type` = 'ETH' order by `corporate_treasury_purchases`.`purchase_date` desc limit 1) AS `eth_holdings`,(select sum(`corporate_treasury_purchases`.`total_amount`) from `corporate_treasury_purchases` where `corporate_treasury_purchases`.`company_id` = `c`.`id` and `corporate_treasury_purchases`.`asset_type` = 'ETH') AS `eth_total_investment`,(select max(`corporate_treasury_purchases`.`purchase_date`) from `corporate_treasury_purchases` where `corporate_treasury_purchases`.`company_id` = `c`.`id`) AS `last_purchase_date`,(select sum(`corporate_treasury_financing`.`amount`) from `corporate_treasury_financing` where `corporate_treasury_financing`.`company_id` = `c`.`id`) AS `total_financing`,(select max(`corporate_treasury_financing`.`financing_date`) from `corporate_treasury_financing` where `corporate_treasury_financing`.`company_id` = `c`.`id`) AS `last_financing_date`,(select `corporate_treasury_stock_prices`.`close_price` from `corporate_treasury_stock_prices` where `corporate_treasury_stock_prices`.`company_id` = `c`.`id` order by `corporate_treasury_stock_prices`.`trade_date` desc limit 1) AS `latest_stock_price`,(select `corporate_treasury_stock_prices`.`change_pct` from `corporate_treasury_stock_prices` where `corporate_treasury_stock_prices`.`company_id` = `c`.`id` order by `corporate_treasury_stock_prices`.`trade_date` desc limit 1) AS `latest_change_pct`,`c`.`is_active` AS `is_active` from `corporate_treasury_companies` `c` where `c`.`is_active` = 1


================================================================================
表名: crypto_etf_daily_summary
================================================================================
CREATE TABLE `crypto_etf_daily_summary` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trade_date` date NOT NULL COMMENT '交易日期',
  `asset_type` varchar(20) NOT NULL COMMENT '资产类型: BTC, ETH',
  `total_net_inflow` decimal(20,2) DEFAULT 0.00 COMMENT '总净流入',
  `total_gross_inflow` decimal(20,2) DEFAULT 0.00 COMMENT '总流入',
  `total_gross_outflow` decimal(20,2) DEFAULT 0.00 COMMENT '总流出',
  `total_aum` decimal(20,2) DEFAULT NULL COMMENT '总AUM',
  `total_holdings` decimal(20,8) DEFAULT NULL COMMENT '总持仓量',
  `etf_count` int(11) DEFAULT 0 COMMENT '统计的ETF数量',
  `inflow_count` int(11) DEFAULT 0 COMMENT '净流入ETF数量',
  `outflow_count` int(11) DEFAULT 0 COMMENT '净流出ETF数量',
  `top_inflow_ticker` varchar(20) DEFAULT NULL COMMENT '最大流入ETF',
  `top_inflow_amount` decimal(20,2) DEFAULT NULL COMMENT '最大流入金额',
  `top_outflow_ticker` varchar(20) DEFAULT NULL COMMENT '最大流出ETF',
  `top_outflow_amount` decimal(20,2) DEFAULT NULL COMMENT '最大流出金额',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_date_asset` (`trade_date`,`asset_type`) USING BTREE,
  KEY `idx_trade_date` (`trade_date`) USING BTREE,
  KEY `idx_asset_type` (`asset_type`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=265 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='加密货币ETF每日汇总'


================================================================================
表名: crypto_etf_events
================================================================================
CREATE TABLE `crypto_etf_events` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `event_date` date NOT NULL COMMENT '事件日期',
  `asset_type` varchar(20) DEFAULT NULL COMMENT '相关资产: BTC, ETH, ALL',
  `event_type` varchar(50) NOT NULL COMMENT '事件类型: new_launch, milestone, record_inflow, record_outflow',
  `title` varchar(200) NOT NULL COMMENT '事件标题',
  `description` text DEFAULT NULL COMMENT '事件描述',
  `impact_level` varchar(20) DEFAULT NULL COMMENT '影响程度: high, medium, low',
  `related_etf_id` int(11) DEFAULT NULL COMMENT '相关ETF ID',
  `related_ticker` varchar(20) DEFAULT NULL COMMENT '相关ETF代码',
  `amount` decimal(20,2) DEFAULT NULL COMMENT '相关金额',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_event_date` (`event_date`) USING BTREE,
  KEY `idx_asset_type` (`asset_type`) USING BTREE,
  KEY `idx_event_type` (`event_type`) USING BTREE,
  KEY `related_etf_id` (`related_etf_id`) USING BTREE,
  CONSTRAINT `crypto_etf_events_ibfk_1` FOREIGN KEY (`related_etf_id`) REFERENCES `crypto_etf_products` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='ETF重要事件记录'


================================================================================
表名: crypto_etf_flows
================================================================================
CREATE TABLE `crypto_etf_flows` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `etf_id` int(11) NOT NULL COMMENT 'ETF产品ID',
  `ticker` varchar(20) NOT NULL COMMENT 'ETF代码',
  `trade_date` date NOT NULL COMMENT '交易日期',
  `net_inflow` decimal(20,2) DEFAULT 0.00 COMMENT '净流入 (USD)',
  `gross_inflow` decimal(20,2) DEFAULT 0.00 COMMENT '总流入 (USD)',
  `gross_outflow` decimal(20,2) DEFAULT 0.00 COMMENT '总流出 (USD)',
  `aum` decimal(20,2) DEFAULT NULL COMMENT '管理资产规模 (USD)',
  `btc_holdings` decimal(20,8) DEFAULT NULL COMMENT 'BTC持仓量',
  `eth_holdings` decimal(20,8) DEFAULT NULL COMMENT 'ETH持仓量',
  `shares_outstanding` decimal(20,2) DEFAULT NULL COMMENT '流通股数',
  `nav` decimal(18,8) DEFAULT NULL COMMENT '单位净值',
  `close_price` decimal(18,8) DEFAULT NULL COMMENT '收盘价',
  `volume` decimal(20,2) DEFAULT NULL COMMENT '交易量',
  `data_source` varchar(50) DEFAULT 'manual' COMMENT '数据来源',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_etf_date` (`etf_id`,`trade_date`) USING BTREE,
  KEY `idx_ticker_date` (`ticker`,`trade_date`) USING BTREE,
  KEY `idx_trade_date` (`trade_date`) USING BTREE,
  KEY `idx_net_inflow` (`net_inflow`) USING BTREE,
  CONSTRAINT `crypto_etf_flows_ibfk_1` FOREIGN KEY (`etf_id`) REFERENCES `crypto_etf_products` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1202 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='加密货币ETF每日资金流向'


================================================================================
表名: crypto_etf_products
================================================================================
CREATE TABLE `crypto_etf_products` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ticker` varchar(20) NOT NULL COMMENT 'ETF代码，如 IBIT, FBTC',
  `full_name` varchar(200) NOT NULL COMMENT '完整名称',
  `provider` varchar(100) NOT NULL COMMENT '发行方，如 BlackRock, Fidelity',
  `asset_type` varchar(20) NOT NULL COMMENT '资产类型: BTC, ETH',
  `etf_type` varchar(20) NOT NULL COMMENT 'ETF类型: spot, futures',
  `launch_date` date DEFAULT NULL COMMENT '上市日期',
  `official_website` varchar(500) DEFAULT NULL COMMENT '官网链接',
  `expense_ratio` decimal(5,4) DEFAULT NULL COMMENT '费用率 (%)',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否活跃',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `ticker` (`ticker`) USING BTREE,
  KEY `idx_ticker` (`ticker`) USING BTREE,
  KEY `idx_asset_type` (`asset_type`) USING BTREE,
  KEY `idx_provider` (`provider`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='加密货币ETF产品信息'


================================================================================
表名: crypto_etf_sentiment
================================================================================
CREATE TABLE `crypto_etf_sentiment` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trade_date` date NOT NULL COMMENT '交易日期',
  `asset_type` varchar(20) NOT NULL COMMENT '资产类型: BTC, ETH',
  `sentiment_score` decimal(5,2) DEFAULT NULL COMMENT '情绪评分 (0-100)',
  `flow_trend` varchar(20) DEFAULT NULL COMMENT '资金流向趋势: strong_inflow, inflow, neutral, outflow, strong_outflow',
  `consecutive_inflow_days` int(11) DEFAULT 0 COMMENT '连续流入天数',
  `consecutive_outflow_days` int(11) DEFAULT 0 COMMENT '连续流出天数',
  `ma_5day_inflow` decimal(20,2) DEFAULT NULL COMMENT '5日均流入',
  `ma_10day_inflow` decimal(20,2) DEFAULT NULL COMMENT '10日均流入',
  `ma_20day_inflow` decimal(20,2) DEFAULT NULL COMMENT '20日均流入',
  `mtd_net_inflow` decimal(20,2) DEFAULT NULL COMMENT '月累计净流入',
  `ytd_net_inflow` decimal(20,2) DEFAULT NULL COMMENT '年累计净流入',
  `created_at` timestamp NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_date_asset` (`trade_date`,`asset_type`) USING BTREE,
  KEY `idx_trade_date` (`trade_date`) USING BTREE,
  KEY `idx_sentiment_score` (`sentiment_score`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='ETF市场情绪指标'


================================================================================
表名: daily_review_opportunities
================================================================================
CREATE TABLE `daily_review_opportunities` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `review_date` date NOT NULL,
  `symbol` varchar(20) NOT NULL,
  `timeframe` varchar(10) NOT NULL,
  `move_type` varchar(10) NOT NULL,
  `start_time` datetime NOT NULL,
  `end_time` datetime NOT NULL,
  `price_change_pct` float NOT NULL,
  `volume_ratio` float NOT NULL,
  `captured` tinyint(1) NOT NULL,
  `capture_delay_minutes` int(11) DEFAULT NULL,
  `signal_type` varchar(50) DEFAULT NULL,
  `position_pnl_pct` float DEFAULT NULL,
  `miss_reason` text DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_review_date` (`review_date`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_captured` (`captured`),
  KEY `idx_timeframe` (`timeframe`)
) ENGINE=InnoDB AUTO_INCREMENT=61 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='大行情机会详情表'


================================================================================
表名: daily_review_reports
================================================================================
CREATE TABLE `daily_review_reports` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `date` date NOT NULL,
  `report_json` mediumtext NOT NULL,
  `total_opportunities` int(11) DEFAULT NULL,
  `captured_count` int(11) DEFAULT NULL,
  `missed_count` int(11) DEFAULT NULL,
  `capture_rate` float DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_date` (`date`),
  KEY `idx_date` (`date`),
  KEY `idx_capture_rate` (`capture_rate`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='每日复盘报告主表'


================================================================================
表名: daily_review_signal_analysis
================================================================================
CREATE TABLE `daily_review_signal_analysis` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `review_date` date NOT NULL,
  `signal_type` varchar(200) NOT NULL,
  `total_trades` int(11) NOT NULL,
  `win_trades` int(11) NOT NULL,
  `loss_trades` int(11) NOT NULL,
  `win_rate` float NOT NULL,
  `avg_pnl` float NOT NULL,
  `best_trade` float DEFAULT NULL,
  `worst_trade` float DEFAULT NULL,
  `long_trades` int(11) NOT NULL,
  `short_trades` int(11) NOT NULL,
  `avg_holding_minutes` float DEFAULT NULL,
  `captured_opportunities` int(11) NOT NULL,
  `rating` varchar(20) DEFAULT NULL,
  `score` int(11) DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_review_signal` (`review_date`,`signal_type`),
  KEY `idx_review_date` (`review_date`),
  KEY `idx_score` (`score`)
) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='信号分析表'


================================================================================
表名: ema_signals
================================================================================
CREATE TABLE `ema_signals` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `timeframe` varchar(10) NOT NULL COMMENT '时间周期 (5m, 15m, 1h)',
  `signal_type` varchar(10) NOT NULL COMMENT '信号类型 (BUY, SELL)',
  `signal_strength` varchar(20) NOT NULL COMMENT '信号强度 (weak, medium, strong)',
  `timestamp` datetime NOT NULL COMMENT '信号时间',
  `price` decimal(20,8) NOT NULL COMMENT '当前价格',
  `short_ema` decimal(20,8) NOT NULL COMMENT '短期EMA值',
  `long_ema` decimal(20,8) NOT NULL COMMENT '长期EMA值',
  `ema_config` varchar(50) NOT NULL COMMENT 'EMA配置 (如 EMA9/EMA21)',
  `volume_ratio` decimal(10,2) NOT NULL COMMENT '成交量放大倍数',
  `volume_type` varchar(10) DEFAULT NULL COMMENT '成交量类型：放量或缩量',
  `price_change_pct` decimal(10,4) NOT NULL COMMENT '价格变动百分比',
  `ema_distance_pct` decimal(10,4) NOT NULL COMMENT 'EMA距离百分比',
  `created_at` timestamp NULL DEFAULT current_timestamp() COMMENT '记录创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_symbol` (`symbol`) USING BTREE,
  KEY `idx_timestamp` (`timestamp`) USING BTREE,
  KEY `idx_signal_type` (`signal_type`) USING BTREE,
  KEY `idx_created_at` (`created_at`) USING BTREE,
  KEY `idx_symbol_timestamp` (`symbol`,`timestamp`) USING BTREE,
  KEY `idx_signal_type_timestamp` (`signal_type`,`timestamp`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=176 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='EMA信号记录表'


================================================================================
表名: funding_rate_data
================================================================================
CREATE TABLE `funding_rate_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `funding_rate` float NOT NULL,
  `funding_time` bigint(20) NOT NULL,
  `timestamp` datetime NOT NULL,
  `mark_price` decimal(18,8) DEFAULT NULL,
  `index_price` decimal(18,8) DEFAULT NULL,
  `next_funding_time` bigint(20) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_timestamp` (`timestamp`) USING BTREE,
  KEY `ix_funding_rate_data_symbol` (`symbol`) USING BTREE,
  KEY `idx_symbol_funding_time` (`symbol`,`funding_time`) USING BTREE,
  KEY `ix_funding_rate_data_timestamp` (`timestamp`) USING BTREE,
  KEY `ix_funding_rate_data_funding_time` (`funding_time`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1948784 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: funding_rate_stats
================================================================================
CREATE TABLE `funding_rate_stats` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `current_rate` decimal(10,6) DEFAULT NULL COMMENT '当前资金费率',
  `current_rate_pct` decimal(10,6) DEFAULT NULL COMMENT '当前资金费率 (%)',
  `rate_24h_ago` decimal(10,6) DEFAULT NULL COMMENT '24小时前费率',
  `rate_avg_7d` decimal(10,6) DEFAULT NULL COMMENT '7天平均费率',
  `rate_avg_30d` decimal(10,6) DEFAULT NULL COMMENT '30天平均费率',
  `rate_max_7d` decimal(10,6) DEFAULT NULL COMMENT '7天最高费率',
  `rate_min_7d` decimal(10,6) DEFAULT NULL COMMENT '7天最低费率',
  `trend` varchar(20) DEFAULT NULL COMMENT '趋势: strongly_bullish/bullish/neutral/bearish/strongly_bearish',
  `market_sentiment` varchar(20) DEFAULT NULL COMMENT '市场情绪: overheated/normal/oversold',
  `funding_score` decimal(5,2) DEFAULT NULL COMMENT '资金费率评分 (0-100)',
  `exchange` varchar(20) DEFAULT NULL COMMENT '交易所',
  `updated_at` datetime NOT NULL COMMENT '最后更新时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `symbol` (`symbol`) USING BTREE,
  KEY `idx_current_rate` (`current_rate`) USING BTREE,
  KEY `idx_trend` (`trend`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=242838 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='资金费率统计表 - 每5分钟更新'


================================================================================
表名: futures_funding_fees
================================================================================
CREATE TABLE `futures_funding_fees` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `position_id` int(11) NOT NULL COMMENT '持仓ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `funding_rate` decimal(18,8) NOT NULL COMMENT '资金费率',
  `position_value` decimal(20,2) NOT NULL COMMENT '仓位价值',
  `funding_fee` decimal(20,8) NOT NULL COMMENT '资金费用（正数=支出，负数=收入）',
  `funding_time` datetime NOT NULL COMMENT '结算时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_account_position` (`account_id`,`position_id`) USING BTREE,
  KEY `idx_funding_time` (`funding_time`) USING BTREE,
  KEY `position_id` (`position_id`) USING BTREE,
  CONSTRAINT `futures_funding_fees_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `futures_funding_fees_ibfk_2` FOREIGN KEY (`position_id`) REFERENCES `futures_positions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='合约资金费率记录表'


================================================================================
表名: futures_klines
================================================================================
CREATE TABLE `futures_klines` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `timeframe` varchar(10) NOT NULL COMMENT '时间周期(1m,5m,15m,1h,4h,1d)',
  `open_time` datetime NOT NULL COMMENT '开盘时间',
  `close_time` datetime NOT NULL COMMENT '收盘时间',
  `open_price` decimal(20,8) NOT NULL COMMENT '开盘价',
  `high_price` decimal(20,8) NOT NULL COMMENT '最高价',
  `low_price` decimal(20,8) NOT NULL COMMENT '最低价',
  `close_price` decimal(20,8) NOT NULL COMMENT '收盘价',
  `volume` decimal(20,8) NOT NULL DEFAULT 0.00000000 COMMENT '成交量',
  `quote_volume` decimal(20,8) NOT NULL DEFAULT 0.00000000 COMMENT '成交额(USDT)',
  `trades` int(11) NOT NULL DEFAULT 0 COMMENT '成交笔数',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_symbol_timeframe_time` (`symbol`,`timeframe`,`open_time`),
  KEY `idx_symbol_timeframe` (`symbol`,`timeframe`),
  KEY `idx_open_time` (`open_time`),
  KEY `idx_symbol_open_time` (`symbol`,`open_time`)
) ENGINE=InnoDB AUTO_INCREMENT=214057 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='合约K线数据表'


================================================================================
表名: futures_liquidations
================================================================================
CREATE TABLE `futures_liquidations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `position_id` int(11) NOT NULL COMMENT '持仓ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `position_side` varchar(10) NOT NULL COMMENT '仓位方向',
  `quantity` decimal(18,8) NOT NULL COMMENT '强平数量',
  `entry_price` decimal(18,8) NOT NULL COMMENT '开仓价',
  `liquidation_price` decimal(18,8) NOT NULL COMMENT '强平价',
  `mark_price` decimal(18,8) NOT NULL COMMENT '触发时标记价格',
  `loss_amount` decimal(20,2) NOT NULL COMMENT '损失金额',
  `margin_lost` decimal(20,2) NOT NULL COMMENT '保证金损失',
  `leverage` int(11) NOT NULL COMMENT '杠杆倍数',
  `liquidation_time` datetime NOT NULL COMMENT '强平时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_liquidation_time` (`liquidation_time`) USING BTREE,
  KEY `position_id` (`position_id`) USING BTREE,
  CONSTRAINT `futures_liquidations_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `futures_liquidations_ibfk_2` FOREIGN KEY (`position_id`) REFERENCES `futures_positions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='合约强平记录表'


================================================================================
表名: futures_long_short_ratio
================================================================================
CREATE TABLE `futures_long_short_ratio` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `period` varchar(10) NOT NULL,
  `long_account` float NOT NULL COMMENT '做多账户数比例(%)',
  `short_account` float NOT NULL COMMENT '做空账户数比例(%)',
  `long_position` float DEFAULT NULL COMMENT '做多持仓量比例(%)',
  `short_position` float DEFAULT NULL COMMENT '做空持仓量比例(%)',
  `long_short_position_ratio` float DEFAULT NULL COMMENT '持仓量多空比率',
  `long_short_ratio` float NOT NULL COMMENT '账户数多空比率',
  `timestamp` datetime NOT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `ix_futures_long_short_ratio_timestamp` (`timestamp`) USING BTREE,
  KEY `idx_symbol_timestamp` (`symbol`,`timestamp`) USING BTREE,
  KEY `ix_futures_long_short_ratio_symbol` (`symbol`) USING BTREE,
  KEY `idx_exchange_symbol_period` (`exchange`,`symbol`,`period`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1588630 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: futures_open_interest
================================================================================
CREATE TABLE `futures_open_interest` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `open_interest` decimal(20,8) NOT NULL,
  `open_interest_value` decimal(20,2) DEFAULT NULL,
  `timestamp` datetime NOT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `ix_futures_open_interest_symbol` (`symbol`) USING BTREE,
  KEY `idx_exchange_symbol` (`exchange`,`symbol`) USING BTREE,
  KEY `ix_futures_open_interest_timestamp` (`timestamp`) USING BTREE,
  KEY `idx_symbol_timestamp` (`symbol`,`timestamp`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1588613 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: futures_orders
================================================================================
CREATE TABLE `futures_orders` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `strategy_id` bigint(11) DEFAULT NULL COMMENT '策略ID',
  `timeout_minutes` int(11) DEFAULT 0 COMMENT '限价单超时时间（分钟），0表示不超时',
  `order_id` varchar(50) NOT NULL COMMENT '订单ID',
  `position_id` int(11) DEFAULT NULL COMMENT '关联的持仓ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(20) NOT NULL COMMENT '订单方向: OPEN_LONG(开多), OPEN_SHORT(开空), CLOSE_LONG(平多), CLOSE_SHORT(平空)',
  `order_type` varchar(20) NOT NULL DEFAULT 'MARKET' COMMENT '订单类型: MARKET(市价), LIMIT(限价), STOP_MARKET(止损市价), TAKE_PROFIT_MARKET(止盈市价)',
  `leverage` int(11) NOT NULL DEFAULT 1 COMMENT '杠杆倍数',
  `price` decimal(18,8) DEFAULT NULL COMMENT '委托价格(限价单)',
  `quantity` decimal(18,8) NOT NULL COMMENT '委托数量',
  `executed_quantity` decimal(18,8) DEFAULT 0.00000000 COMMENT '已成交数量',
  `margin` decimal(20,2) DEFAULT NULL COMMENT '占用保证金',
  `total_value` decimal(20,2) DEFAULT NULL COMMENT '名义价值',
  `executed_value` decimal(20,2) DEFAULT 0.00 COMMENT '已成交价值',
  `fee` decimal(20,8) DEFAULT 0.00000000 COMMENT '手续费',
  `fee_rate` decimal(10,6) DEFAULT 0.000400 COMMENT '手续费率(默认0.04%)',
  `status` varchar(20) NOT NULL DEFAULT 'PENDING' COMMENT '订单状态: PENDING, FILLED, PARTIALLY_FILLED, CANCELLED, REJECTED',
  `avg_fill_price` decimal(18,8) DEFAULT NULL COMMENT '平均成交价格',
  `fill_time` datetime DEFAULT NULL COMMENT '成交时间',
  `stop_price` decimal(18,8) DEFAULT NULL COMMENT '触发价格',
  `stop_loss_price` decimal(18,8) DEFAULT NULL COMMENT '止损价格',
  `take_profit_price` decimal(18,8) DEFAULT NULL COMMENT '止盈价格',
  `order_source` varchar(500) DEFAULT NULL,
  `entry_signal_type` varchar(50) DEFAULT NULL,
  `signal_id` int(11) DEFAULT NULL COMMENT '关联的信号ID',
  `realized_pnl` decimal(20,2) DEFAULT NULL COMMENT '已实现盈亏',
  `pnl_pct` decimal(10,4) DEFAULT NULL COMMENT '收益率(%)',
  `notes` text DEFAULT NULL COMMENT '订单备注',
  `cancellation_reason` varchar(100) DEFAULT NULL COMMENT '取消原因: manual(手动取消)/strategy_signal(策略信号取消)/risk_control(风控取消)/system(系统取消)/expired(订单过期)',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `canceled_at` datetime DEFAULT NULL COMMENT '订单取消时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `order_id` (`order_id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE,
  KEY `idx_status` (`status`) USING BTREE,
  KEY `idx_position_id` (`position_id`) USING BTREE,
  KEY `idx_created_at` (`created_at`) USING BTREE,
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_user_id` (`user_id`),
  CONSTRAINT `futures_orders_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `futures_orders_ibfk_2` FOREIGN KEY (`position_id`) REFERENCES `futures_positions` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=62233 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='模拟合约订单表'


================================================================================
表名: futures_positions
================================================================================
CREATE TABLE `futures_positions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对(如 BTC/USDT)',
  `position_side` varchar(10) NOT NULL COMMENT '持仓方向: LONG(多头), SHORT(空头)',
  `leverage` int(11) NOT NULL DEFAULT 1 COMMENT '杠杆倍数(1-125)',
  `quantity` decimal(18,8) NOT NULL COMMENT '持仓数量（币）',
  `notional_value` decimal(20,2) NOT NULL COMMENT '名义价值（quantity * entry_price）',
  `margin` decimal(20,2) NOT NULL COMMENT '占用保证金（notional_value / leverage）',
  `entry_price` decimal(18,8) NOT NULL COMMENT '开仓均价',
  `mark_price` decimal(18,8) DEFAULT NULL COMMENT '标记价格（用于计算未实现盈亏）',
  `liquidation_price` decimal(18,8) DEFAULT NULL COMMENT '强平价格',
  `unrealized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '未实现盈亏',
  `unrealized_pnl_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '未实现收益率(%)',
  `realized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '已实现盈亏',
  `stop_loss_price` decimal(18,8) DEFAULT NULL COMMENT '止损价格',
  `take_profit_price` decimal(18,8) DEFAULT NULL COMMENT '止盈价格',
  `stop_loss_pct` decimal(5,2) DEFAULT NULL COMMENT '止损百分比(%)',
  `take_profit_pct` decimal(5,2) DEFAULT NULL COMMENT '止盈百分比(%)',
  `entry_ema_diff` decimal(18,8) DEFAULT NULL COMMENT 'å¼€ä»“æ—¶EMA9-EMA26å·®å€¼',
  `total_funding_fee` decimal(20,8) DEFAULT 0.00000000 COMMENT '累计资金费率',
  `open_time` datetime NOT NULL COMMENT '开仓时间',
  `last_update_time` datetime DEFAULT NULL COMMENT '最后更新时间',
  `close_time` datetime DEFAULT NULL COMMENT '平仓时间',
  `holding_hours` int(11) DEFAULT 0 COMMENT '持仓小时数',
  `status` varchar(20) DEFAULT 'open' COMMENT '状态: open(持仓中), closed(已平仓), liquidated(已强平)',
  `source` varchar(50) DEFAULT 'manual' COMMENT '来源: manual(手动), signal(信号), auto(自动)',
  `signal_id` int(11) DEFAULT NULL COMMENT '关联的信号ID',
  `strategy_id` bigint(20) DEFAULT NULL COMMENT '策略ID',
  `notes` text DEFAULT NULL COMMENT '备注',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `max_profit_pct` decimal(10,4) DEFAULT 0.0000,
  `max_profit_price` decimal(18,8) DEFAULT NULL,
  `trailing_stop_activated` tinyint(1) DEFAULT 0,
  `trailing_stop_price` decimal(18,8) DEFAULT NULL,
  `entry_signal_type` varchar(500) DEFAULT NULL,
  `entry_score` int(11) DEFAULT NULL COMMENT '开仓得分',
  `signal_components` text DEFAULT NULL COMMENT '信号组成（JSON格式）',
  `entry_reason` varchar(500) DEFAULT NULL,
  `live_position_id` int(11) DEFAULT NULL COMMENT 'å…³è”çš„å®žç›˜æŒä»“ID',
  `max_hold_minutes` int(11) DEFAULT NULL COMMENT '最大持仓时间(分钟)',
  `timeout_at` timestamp NULL DEFAULT NULL COMMENT '超时平仓时间',
  `batch_plan` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '分批建仓计划 {"batches": [{"ratio": 0.3, "filled": false, "price": null}]}' CHECK (json_valid(`batch_plan`)),
  `batch_filled` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '已完成批次记录' CHECK (json_valid(`batch_filled`)),
  `entry_signal_time` datetime DEFAULT NULL COMMENT '信号发出时间',
  `avg_entry_price` decimal(20,8) DEFAULT NULL COMMENT '平均入场价（加权平均）',
  `planned_close_time` datetime DEFAULT NULL COMMENT '计划平仓时间',
  `close_extended` tinyint(1) DEFAULT 0 COMMENT '是否延长平仓时间',
  `extended_close_time` datetime DEFAULT NULL COMMENT '延长后的平仓时间',
  `max_profit_time` datetime DEFAULT NULL COMMENT '达到最高盈利的时间',
  `coin_margin` tinyint(1) DEFAULT 0 COMMENT '是否币本位合约(0=U本位,1=币本位)',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_status` (`status`) USING BTREE,
  KEY `idx_position_side` (`position_side`) USING BTREE,
  KEY `idx_open_time` (`open_time`) USING BTREE,
  KEY `idx_user_id` (`user_id`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_symbol_strategy` (`symbol`,`strategy_id`),
  KEY `idx_timeout_at` (`timeout_at`),
  KEY `idx_entry_signal_time` (`entry_signal_time`),
  KEY `idx_planned_close_time` (`planned_close_time`),
  KEY `idx_close_extended` (`close_extended`),
  CONSTRAINT `futures_positions_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=8282 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='合约持仓表（支持超级大脑智能建仓/平仓优化）'


================================================================================
表名: futures_trades
================================================================================
CREATE TABLE `futures_trades` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `order_id` varchar(50) NOT NULL COMMENT '订单ID',
  `position_id` int(11) DEFAULT NULL COMMENT '持仓ID',
  `trade_id` varchar(50) NOT NULL COMMENT '成交ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(20) NOT NULL COMMENT 'OPEN_LONG, OPEN_SHORT, CLOSE_LONG, CLOSE_SHORT',
  `price` decimal(18,8) NOT NULL COMMENT '成交价格',
  `quantity` decimal(18,8) NOT NULL COMMENT '成交数量',
  `notional_value` decimal(20,2) NOT NULL COMMENT '名义价值',
  `leverage` int(11) NOT NULL COMMENT '杠杆倍数',
  `margin` decimal(20,2) NOT NULL COMMENT '占用保证金',
  `fee` decimal(20,8) DEFAULT 0.00000000 COMMENT '手续费',
  `fee_rate` decimal(10,6) DEFAULT NULL COMMENT '手续费率',
  `realized_pnl` decimal(20,2) DEFAULT NULL COMMENT '已实现盈亏',
  `pnl_pct` decimal(10,4) DEFAULT NULL COMMENT '收益率(%)',
  `roi` decimal(10,4) DEFAULT NULL COMMENT '投资回报率(基于保证金%)',
  `entry_price` decimal(18,8) DEFAULT NULL COMMENT '开仓价',
  `close_price` decimal(18,8) DEFAULT NULL COMMENT '平仓价格(仅CLOSE_LONG/CLOSE_SHORT时有值)',
  `trade_time` datetime NOT NULL COMMENT '成交时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `trade_id` (`trade_id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE,
  KEY `idx_position_id` (`position_id`) USING BTREE,
  KEY `idx_trade_time` (`trade_time`) USING BTREE,
  CONSTRAINT `futures_trades_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE,
  CONSTRAINT `futures_trades_ibfk_2` FOREIGN KEY (`position_id`) REFERENCES `futures_positions` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB AUTO_INCREMENT=14219 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='模拟合约交易历史表'


================================================================================
表名: futures_trading_accounts
================================================================================
CREATE TABLE `futures_trading_accounts` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '账户ID',
  `user_id` int(11) DEFAULT 1 COMMENT '用户ID',
  `account_name` varchar(100) NOT NULL COMMENT '账户名称',
  `initial_balance` decimal(20,2) DEFAULT 10000.00 COMMENT '初始余额',
  `current_balance` decimal(20,2) DEFAULT 10000.00 COMMENT '当前可用余额',
  `frozen_balance` decimal(20,2) DEFAULT 0.00 COMMENT '冻结余额（持仓保证金）',
  `total_equity` decimal(20,2) DEFAULT 10000.00 COMMENT '总权益 = 可用 + 冻结 + 未实现盈亏',
  `total_profit_loss` decimal(20,2) DEFAULT 0.00 COMMENT '总盈亏',
  `total_profit_loss_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '总盈亏百分比',
  `realized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '已实现盈亏',
  `unrealized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '未实现盈亏',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `winning_trades` int(11) DEFAULT 0 COMMENT '盈利次数',
  `losing_trades` int(11) DEFAULT 0 COMMENT '亏损次数',
  `win_rate` decimal(5,2) DEFAULT 0.00 COMMENT '胜率',
  `max_balance` decimal(20,2) DEFAULT 10000.00 COMMENT '历史最高余额',
  `max_drawdown` decimal(20,2) DEFAULT 0.00 COMMENT '最大回撤金额',
  `max_drawdown_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '最大回撤百分比',
  `max_position_size` decimal(5,2) DEFAULT 0.10 COMMENT '最大单仓位比例（默认10%）',
  `max_daily_loss` decimal(20,2) DEFAULT NULL COMMENT '每日最大亏损限制',
  `default_leverage` int(11) DEFAULT 10 COMMENT '默认杠杆倍数',
  `default_stop_loss_pct` decimal(5,2) DEFAULT 0.02 COMMENT '默认止损百分比（2%）',
  `default_take_profit_pct` decimal(5,2) DEFAULT 0.05 COMMENT '默认止盈百分比（5%）',
  `strategy_name` varchar(100) DEFAULT NULL COMMENT '当前使用的策略名称',
  `auto_trading` tinyint(1) DEFAULT 0 COMMENT '是否自动交易',
  `status` varchar(20) DEFAULT 'active' COMMENT '账户状态：active/inactive/suspended',
  `is_default` tinyint(1) DEFAULT 0 COMMENT '是否默认账户',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  `account_type` varchar(20) DEFAULT 'usdt_futures' COMMENT '账户类型: usdt_futures/coin_futures',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='合约交易账户表'


================================================================================
表名: hyperliquid_leaderboard_history
================================================================================
CREATE TABLE `hyperliquid_leaderboard_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `record_date` date NOT NULL COMMENT '记录日期',
  `period_type` varchar(20) NOT NULL COMMENT '周期类型: day/week/month/allTime',
  `total_traders` int(11) DEFAULT 0 COMMENT '总交易者数',
  `total_positive_pnl` int(11) DEFAULT 0 COMMENT '盈利交易者数',
  `total_negative_pnl` int(11) DEFAULT 0 COMMENT '亏损交易者数',
  `avg_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '平均PnL',
  `median_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '中位数PnL',
  `top10_avg_pnl` decimal(20,2) DEFAULT 0.00 COMMENT 'Top10平均PnL',
  `recorded_at` datetime NOT NULL COMMENT '记录时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_date_period` (`record_date`,`period_type`) USING BTREE,
  KEY `idx_record_date` (`record_date`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 排行榜统计历史'


================================================================================
表名: hyperliquid_monitored_wallets
================================================================================
CREATE TABLE `hyperliquid_monitored_wallets` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `label` varchar(100) DEFAULT NULL COMMENT '标签',
  `monitor_type` varchar(50) DEFAULT 'auto' COMMENT '监控类型: auto/manual',
  `is_monitoring` tinyint(1) DEFAULT 1 COMMENT '是否监控中',
  `discovered_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '发现时PnL',
  `discovered_roi` decimal(10,4) DEFAULT 0.0000 COMMENT '发现时ROI',
  `discovered_account_value` decimal(20,2) DEFAULT 0.00 COMMENT '发现时账户价值',
  `discovered_at` datetime NOT NULL COMMENT '发现时间',
  `last_check_at` datetime DEFAULT NULL COMMENT '最后检查时间',
  `last_trade_at` datetime DEFAULT NULL COMMENT '最后交易时间',
  `check_count` int(11) DEFAULT 0 COMMENT '检查次数',
  `created_at` datetime NOT NULL COMMENT '创建时间',
  `updated_at` datetime NOT NULL COMMENT '更新时间',
  `notes` text DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_trader_id` (`trader_id`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_is_monitoring` (`is_monitoring`) USING BTREE,
  KEY `idx_last_check` (`last_check_at`) USING BTREE,
  CONSTRAINT `hyperliquid_monitored_wallets_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=16086 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 监控钱包列表'


================================================================================
表名: hyperliquid_monthly_performance
================================================================================
CREATE TABLE `hyperliquid_monthly_performance` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `month_start` date NOT NULL COMMENT '月开始日期',
  `month_end` date NOT NULL COMMENT '月结束日期',
  `pnl` decimal(20,2) DEFAULT 0.00 COMMENT '本月盈亏(USD)',
  `roi` decimal(10,4) DEFAULT 0.0000 COMMENT '本月ROI(%)',
  `volume` decimal(20,2) DEFAULT 0.00 COMMENT '本月交易量(USD)',
  `account_value` decimal(20,2) DEFAULT 0.00 COMMENT '账户价值(USD)',
  `pnl_rank` int(11) DEFAULT NULL COMMENT 'PnL排名',
  `roi_rank` int(11) DEFAULT NULL COMMENT 'ROI排名',
  `recorded_at` datetime NOT NULL COMMENT '记录时间',
  `data_source` varchar(50) DEFAULT 'leaderboard' COMMENT '数据来源',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_trader_month` (`trader_id`,`month_start`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_month` (`month_start`) USING BTREE,
  KEY `idx_pnl` (`pnl`) USING BTREE,
  KEY `idx_roi` (`roi`) USING BTREE,
  CONSTRAINT `hyperliquid_monthly_performance_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 交易者月度表现'


================================================================================
表名: hyperliquid_performance_snapshots
================================================================================
CREATE TABLE `hyperliquid_performance_snapshots` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `snapshot_date` date NOT NULL COMMENT '快照日期',
  `day_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '日盈亏',
  `day_roi` decimal(10,4) DEFAULT 0.0000 COMMENT '日ROI',
  `day_volume` decimal(20,2) DEFAULT 0.00 COMMENT '日交易量',
  `week_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '周盈亏',
  `week_roi` decimal(10,4) DEFAULT 0.0000 COMMENT '周ROI',
  `week_volume` decimal(20,2) DEFAULT 0.00 COMMENT '周交易量',
  `month_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '月盈亏',
  `month_roi` decimal(10,4) DEFAULT 0.0000 COMMENT '月ROI',
  `month_volume` decimal(20,2) DEFAULT 0.00 COMMENT '月交易量',
  `alltime_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '历史总盈亏',
  `alltime_roi` decimal(10,4) DEFAULT 0.0000 COMMENT '历史总ROI',
  `alltime_volume` decimal(20,2) DEFAULT 0.00 COMMENT '历史总交易量',
  `account_value` decimal(20,2) DEFAULT 0.00 COMMENT '账户价值',
  `recorded_at` datetime NOT NULL COMMENT '记录时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_trader_snapshot` (`trader_id`,`snapshot_date`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_snapshot_date` (`snapshot_date`) USING BTREE,
  KEY `idx_week_pnl` (`week_pnl`) USING BTREE,
  CONSTRAINT `hyperliquid_performance_snapshots_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1697 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 交易者表现快照(每日)'


================================================================================
表名: hyperliquid_symbol_aggregation
================================================================================
CREATE TABLE `hyperliquid_symbol_aggregation` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '币种代码，如 BTC',
  `period` varchar(10) NOT NULL DEFAULT '24h' COMMENT '统计周期: 24h/7d/30d',
  `net_flow` decimal(20,2) DEFAULT NULL COMMENT '净流入 (USD，正数=流入，负数=流出)',
  `inflow` decimal(20,2) DEFAULT NULL COMMENT '总流入 (USD)',
  `outflow` decimal(20,2) DEFAULT NULL COMMENT '总流出 (USD)',
  `long_trades` int(11) DEFAULT NULL COMMENT '做多交易数',
  `short_trades` int(11) DEFAULT NULL COMMENT '做空交易数',
  `total_trades` int(11) DEFAULT NULL COMMENT '总交易数',
  `long_short_ratio` decimal(10,4) DEFAULT NULL COMMENT '多空比率',
  `total_volume` decimal(20,2) DEFAULT NULL COMMENT '总交易量 (USD)',
  `avg_trade_size` decimal(20,2) DEFAULT NULL COMMENT '平均交易规模 (USD)',
  `max_trade_size` decimal(20,2) DEFAULT NULL COMMENT '最大单笔交易 (USD)',
  `active_wallets` int(11) DEFAULT NULL COMMENT '活跃钱包数',
  `unique_wallets` int(11) DEFAULT NULL COMMENT '参与交易的唯一钱包数',
  `total_pnl` decimal(20,2) DEFAULT NULL COMMENT '总盈亏 (USD)',
  `avg_pnl` decimal(18,2) DEFAULT NULL COMMENT '平均盈亏 (USD)',
  `win_rate` decimal(5,2) DEFAULT NULL COMMENT '胜率 (%)',
  `hyperliquid_score` decimal(5,2) DEFAULT NULL COMMENT 'Hyperliquid评分 (0-100)',
  `hyperliquid_signal` varchar(20) DEFAULT NULL COMMENT '信号: STRONG_BULLISH/BULLISH/NEUTRAL/BEARISH/STRONG_BEARISH',
  `sentiment` varchar(20) DEFAULT NULL COMMENT '聪明钱情绪: bullish/bearish/neutral',
  `updated_at` datetime NOT NULL COMMENT '最后更新时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_symbol_period` (`symbol`,`period`) USING BTREE,
  KEY `idx_net_flow` (`net_flow`) USING BTREE,
  KEY `idx_total_volume` (`total_volume`) USING BTREE,
  KEY `idx_hyperliquid_score` (`hyperliquid_score`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=103117 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid币种聚合数据 - 每10分钟更新'


================================================================================
表名: hyperliquid_traders
================================================================================
CREATE TABLE `hyperliquid_traders` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `display_name` varchar(100) DEFAULT NULL COMMENT '显示名称',
  `first_seen` datetime NOT NULL COMMENT '首次发现时间',
  `last_updated` datetime NOT NULL COMMENT '最后更新时间',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否活跃',
  `notes` text DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `address` (`address`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_last_updated` (`last_updated`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=15189 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 交易者基本信息'


================================================================================
表名: hyperliquid_wallet_fund_changes
================================================================================
CREATE TABLE `hyperliquid_wallet_fund_changes` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `change_type` varchar(50) NOT NULL COMMENT '变动类型: DEPOSIT/WITHDRAW/PNL/FUNDING',
  `amount` decimal(20,2) NOT NULL COMMENT '变动金额(USD)',
  `balance_before` decimal(20,2) DEFAULT NULL COMMENT '变动前余额',
  `balance_after` decimal(20,2) DEFAULT NULL COMMENT '变动后余额',
  `change_time` datetime NOT NULL COMMENT '变动时间',
  `detected_at` datetime NOT NULL COMMENT '检测时间',
  `raw_data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '原始数据' CHECK (json_valid(`raw_data`)),
  `notes` text DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_trader_id` (`trader_id`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_change_type` (`change_type`) USING BTREE,
  KEY `idx_change_time` (`change_time`) USING BTREE,
  CONSTRAINT `hyperliquid_wallet_fund_changes_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 钱包资金变动记录'


================================================================================
表名: hyperliquid_wallet_positions
================================================================================
CREATE TABLE `hyperliquid_wallet_positions` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `snapshot_time` datetime NOT NULL COMMENT '快照时间',
  `coin` varchar(20) NOT NULL COMMENT '币种',
  `side` varchar(10) NOT NULL COMMENT '方向: LONG/SHORT',
  `size` decimal(20,8) NOT NULL COMMENT '持仓数量',
  `entry_price` decimal(20,8) NOT NULL COMMENT '入场价格',
  `mark_price` decimal(20,8) DEFAULT NULL COMMENT '标记价格',
  `notional_usd` decimal(20,2) NOT NULL COMMENT '仓位价值(USD)',
  `unrealized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '未实现盈亏',
  `leverage` decimal(10,2) DEFAULT 1.00 COMMENT '杠杆倍数',
  `raw_data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '原始持仓数据' CHECK (json_valid(`raw_data`)),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_trader_coin_time` (`trader_id`,`coin`,`snapshot_time`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_coin` (`coin`) USING BTREE,
  KEY `idx_snapshot_time` (`snapshot_time`) USING BTREE,
  CONSTRAINT `hyperliquid_wallet_positions_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2574745 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 钱包持仓快照'


================================================================================
表名: hyperliquid_wallet_trades
================================================================================
CREATE TABLE `hyperliquid_wallet_trades` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `coin` varchar(20) NOT NULL COMMENT '币种',
  `side` varchar(10) NOT NULL COMMENT '方向: LONG/SHORT',
  `action` varchar(20) NOT NULL COMMENT '操作类型: OPEN/CLOSE/ADD/REDUCE',
  `price` decimal(20,8) NOT NULL COMMENT '成交价格',
  `size` decimal(20,8) NOT NULL COMMENT '成交数量',
  `notional_usd` decimal(20,2) NOT NULL COMMENT '成交金额(USD)',
  `closed_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '已实现盈亏',
  `trade_time` datetime NOT NULL COMMENT '交易时间',
  `detected_at` datetime NOT NULL COMMENT '检测时间',
  `raw_data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '原始交易数据' CHECK (json_valid(`raw_data`)),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_trade_dedup` (`address`,`coin`,`side`,`trade_time`,`notional_usd`) USING BTREE,
  KEY `idx_trader_id` (`trader_id`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_coin` (`coin`) USING BTREE,
  KEY `idx_trade_time` (`trade_time`) USING BTREE,
  KEY `idx_notional` (`notional_usd`) USING BTREE,
  CONSTRAINT `hyperliquid_wallet_trades_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=13835175 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 钱包交易记录'


================================================================================
表名: hyperliquid_weekly_performance
================================================================================
CREATE TABLE `hyperliquid_weekly_performance` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trader_id` int(11) NOT NULL COMMENT '交易者ID',
  `address` varchar(66) NOT NULL COMMENT '钱包地址',
  `week_start` date NOT NULL COMMENT '周开始日期',
  `week_end` date NOT NULL COMMENT '周结束日期',
  `pnl` decimal(20,2) DEFAULT 0.00 COMMENT '本周盈亏(USD)',
  `roi` decimal(10,4) DEFAULT 0.0000 COMMENT '本周ROI(%)',
  `volume` decimal(20,2) DEFAULT 0.00 COMMENT '本周交易量(USD)',
  `account_value` decimal(20,2) DEFAULT 0.00 COMMENT '账户价值(USD)',
  `pnl_rank` int(11) DEFAULT NULL COMMENT 'PnL排名',
  `roi_rank` int(11) DEFAULT NULL COMMENT 'ROI排名',
  `recorded_at` datetime NOT NULL COMMENT '记录时间',
  `data_source` varchar(50) DEFAULT 'leaderboard' COMMENT '数据来源',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_trader_week` (`trader_id`,`week_start`) USING BTREE,
  KEY `idx_address` (`address`) USING BTREE,
  KEY `idx_week` (`week_start`) USING BTREE,
  KEY `idx_pnl` (`pnl`) USING BTREE,
  KEY `idx_roi` (`roi`) USING BTREE,
  KEY `idx_pnl_rank` (`pnl_rank`) USING BTREE,
  CONSTRAINT `hyperliquid_weekly_performance_ibfk_1` FOREIGN KEY (`trader_id`) REFERENCES `hyperliquid_traders` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=81070 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='Hyperliquid 交易者周度表现'


================================================================================
表名: investment_recommendations
================================================================================
CREATE TABLE `investment_recommendations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对，如 BTC/USDT',
  `recommendation` varchar(20) NOT NULL COMMENT '投资建议：强烈买入、买入、持有、卖出、强烈卖出',
  `confidence` decimal(5,2) NOT NULL COMMENT '置信度 0-100',
  `reasoning` text DEFAULT NULL COMMENT '推理原因',
  `technical_score` decimal(5,2) DEFAULT NULL COMMENT '技术指标评分 0-100',
  `news_sentiment_score` decimal(5,2) DEFAULT NULL COMMENT '新闻情绪评分 0-100',
  `funding_rate_score` decimal(5,2) DEFAULT NULL COMMENT '资金费率评分 0-100',
  `smart_money_score` decimal(5,2) DEFAULT NULL COMMENT '聪明钱评分 0-100',
  `onchain_score` decimal(5,2) DEFAULT NULL COMMENT '链上数据评分 0-100',
  `rsi` decimal(10,4) DEFAULT NULL COMMENT 'RSI指标值',
  `macd` decimal(10,4) DEFAULT NULL COMMENT 'MACD指标值',
  `macd_signal` decimal(10,4) DEFAULT NULL COMMENT 'MACD信号线',
  `macd_histogram` decimal(10,4) DEFAULT NULL COMMENT 'MACD柱状图',
  `current_price` decimal(18,8) DEFAULT NULL COMMENT '当前价格',
  `price_change_24h` decimal(10,4) DEFAULT NULL COMMENT '24小时价格变化%',
  `risk_level` varchar(10) DEFAULT NULL COMMENT '风险等级: LOW, MEDIUM, HIGH',
  `volatility` decimal(10,4) DEFAULT NULL COMMENT '波动率',
  `created_at` timestamp NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` timestamp NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_symbol` (`symbol`) USING BTREE,
  KEY `idx_symbol` (`symbol`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE,
  KEY `idx_confidence` (`confidence`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='投资建议表'


================================================================================
表名: investment_recommendations_cache
================================================================================
CREATE TABLE `investment_recommendations_cache` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `total_score` decimal(5,2) DEFAULT NULL COMMENT '总评分 (0-100)',
  `technical_score` decimal(5,2) DEFAULT NULL COMMENT '技术指标评分 (0-100)',
  `news_score` decimal(5,2) DEFAULT NULL COMMENT '新闻情绪评分 (0-100)',
  `funding_score` decimal(5,2) DEFAULT NULL COMMENT '资金费率评分 (0-100)',
  `hyperliquid_score` decimal(5,2) DEFAULT NULL COMMENT 'Hyperliquid评分 (0-100)',
  `ethereum_score` decimal(5,2) DEFAULT NULL COMMENT '以太坊链上评分 (0-100)',
  `signal` varchar(20) NOT NULL COMMENT '信号: STRONG_BUY/BUY/HOLD/SELL/STRONG_SELL',
  `confidence` decimal(5,2) DEFAULT NULL COMMENT '置信度 (0-100)',
  `current_price` decimal(18,8) DEFAULT NULL COMMENT '当前价格',
  `entry_price` decimal(18,8) DEFAULT NULL COMMENT '建议入场价',
  `stop_loss` decimal(18,8) DEFAULT NULL COMMENT '止损价',
  `take_profit` decimal(18,8) DEFAULT NULL COMMENT '止盈价',
  `potential_gain_pct` decimal(10,4) DEFAULT NULL COMMENT '潜在收益 (%)',
  `potential_loss_pct` decimal(10,4) DEFAULT NULL COMMENT '潜在损失 (%)',
  `risk_reward_ratio` decimal(10,4) DEFAULT NULL COMMENT '风险回报比',
  `risk_level` varchar(20) DEFAULT NULL COMMENT '风险等级: LOW/MEDIUM/HIGH/VERY_HIGH',
  `risk_factors` text DEFAULT NULL COMMENT '风险因素 (JSON数组)',
  `reasons` text DEFAULT NULL COMMENT '推荐理由 (JSON数组)',
  `analysis_summary` text DEFAULT NULL COMMENT '分析摘要',
  `has_technical` tinyint(1) DEFAULT 0 COMMENT '是否有技术指标数据',
  `has_news` tinyint(1) DEFAULT 0 COMMENT '是否有新闻数据',
  `has_funding` tinyint(1) DEFAULT 0 COMMENT '是否有资金费率数据',
  `has_hyperliquid` tinyint(1) DEFAULT 0 COMMENT '是否有Hyperliquid数据',
  `has_ethereum` tinyint(1) DEFAULT 0 COMMENT '是否有以太坊链上数据',
  `data_completeness` decimal(5,2) DEFAULT NULL COMMENT '数据完整性 (0-100%)',
  `updated_at` datetime NOT NULL COMMENT '最后更新时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `symbol` (`symbol`) USING BTREE,
  KEY `idx_signal` (`signal`) USING BTREE,
  KEY `idx_total_score` (`total_score`) USING BTREE,
  KEY `idx_confidence` (`confidence`) USING BTREE,
  KEY `idx_risk_level` (`risk_level`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=222488 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='投资建议缓存表 - 每5分钟更新'


================================================================================
表名: kline_data
================================================================================
CREATE TABLE `kline_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `timeframe` varchar(10) NOT NULL,
  `open_time` bigint(20) NOT NULL,
  `close_time` bigint(20) DEFAULT NULL,
  `timestamp` datetime NOT NULL,
  `open_price` decimal(18,8) NOT NULL,
  `high_price` decimal(18,8) NOT NULL,
  `low_price` decimal(18,8) NOT NULL,
  `close_price` decimal(18,8) NOT NULL,
  `volume` decimal(20,8) DEFAULT NULL,
  `quote_volume` decimal(24,2) DEFAULT NULL,
  `number_of_trades` int(11) DEFAULT NULL,
  `taker_buy_base_volume` decimal(20,8) DEFAULT NULL,
  `taker_buy_quote_volume` decimal(24,2) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `idx_unique_kline` (`symbol`,`exchange`,`timeframe`,`timestamp`),
  KEY `ix_kline_data_symbol` (`symbol`) USING BTREE,
  KEY `idx_symbol_timeframe_time` (`symbol`,`timeframe`,`open_time`) USING BTREE,
  KEY `ix_kline_data_open_time` (`open_time`) USING BTREE,
  KEY `idx_timestamp` (`timestamp`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=14246178 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: live_futures_orders
================================================================================
CREATE TABLE `live_futures_orders` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `position_id` int(11) DEFAULT NULL COMMENT '关联持仓ID',
  `binance_order_id` varchar(50) NOT NULL COMMENT '币安订单ID',
  `client_order_id` varchar(50) DEFAULT NULL COMMENT '客户端订单ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(10) NOT NULL COMMENT 'BUY/SELL',
  `position_side` varchar(10) DEFAULT NULL COMMENT 'LONG/SHORT',
  `order_type` varchar(20) NOT NULL COMMENT 'MARKET/LIMIT/STOP_MARKET/TAKE_PROFIT_MARKET',
  `price` decimal(18,8) DEFAULT NULL COMMENT '委托价格',
  `stop_price` decimal(18,8) DEFAULT NULL COMMENT '触发价格',
  `quantity` decimal(18,8) NOT NULL COMMENT '委托数量',
  `executed_quantity` decimal(18,8) DEFAULT 0.00000000 COMMENT '已成交数量',
  `avg_fill_price` decimal(18,8) DEFAULT NULL COMMENT '平均成交价',
  `commission` decimal(20,8) DEFAULT 0.00000000 COMMENT '手续费',
  `commission_asset` varchar(10) DEFAULT 'USDT' COMMENT '手续费资产',
  `status` varchar(20) NOT NULL COMMENT 'NEW/FILLED/PARTIALLY_FILLED/CANCELED/REJECTED/EXPIRED',
  `realized_pnl` decimal(20,8) DEFAULT NULL COMMENT '已实现盈亏',
  `source` varchar(50) DEFAULT 'manual' COMMENT '订单来源',
  `strategy_id` bigint(20) DEFAULT NULL COMMENT '策略ID',
  `order_time` datetime DEFAULT NULL COMMENT '下单时间',
  `fill_time` datetime DEFAULT NULL COMMENT '成交时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_account_symbol` (`account_id`,`symbol`),
  KEY `idx_binance_order_id` (`binance_order_id`),
  KEY `idx_status` (`status`),
  KEY `idx_order_time` (`order_time`),
  KEY `idx_user_id` (`user_id`),
  CONSTRAINT `live_futures_orders_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `live_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='实盘合约订单表'


================================================================================
表名: live_futures_positions
================================================================================
CREATE TABLE `live_futures_positions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对(如 BTC/USDT)',
  `position_side` varchar(10) NOT NULL COMMENT '持仓方向: LONG/SHORT',
  `leverage` int(11) NOT NULL DEFAULT 1 COMMENT '杠杆倍数',
  `quantity` decimal(18,8) NOT NULL COMMENT '持仓数量',
  `notional_value` decimal(20,2) DEFAULT NULL COMMENT '名义价值',
  `margin` decimal(20,2) DEFAULT NULL COMMENT '占用保证金',
  `entry_price` decimal(18,8) NOT NULL COMMENT '开仓均价',
  `mark_price` decimal(18,8) DEFAULT NULL COMMENT '标记价格',
  `liquidation_price` decimal(18,8) DEFAULT NULL COMMENT '强平价格',
  `close_price` decimal(18,8) DEFAULT NULL COMMENT '平仓价格',
  `unrealized_pnl` decimal(20,8) DEFAULT 0.00000000 COMMENT '未实现盈亏',
  `realized_pnl` decimal(20,8) DEFAULT 0.00000000 COMMENT '已实现盈亏',
  `stop_loss_price` decimal(18,8) DEFAULT NULL COMMENT '止损价格',
  `take_profit_price` decimal(18,8) DEFAULT NULL COMMENT '止盈价格',
  `binance_order_id` varchar(50) DEFAULT NULL COMMENT '币安开仓订单ID',
  `sl_order_id` varchar(50) DEFAULT NULL COMMENT '止损订单ID',
  `tp_order_id` varchar(50) DEFAULT NULL COMMENT '止盈订单ID',
  `entry_ema_diff` decimal(18,8) DEFAULT NULL COMMENT 'å¼€ä»“æ—¶EMA9-EMA26å·®å€¼',
  `open_time` datetime NOT NULL COMMENT '开仓时间',
  `close_time` datetime DEFAULT NULL COMMENT '平仓时间',
  `status` varchar(50) DEFAULT 'OPEN' COMMENT '状态: OPEN/CLOSED/LIQUIDATED/PENDING/CANCELED',
  `close_reason` varchar(50) DEFAULT NULL COMMENT '平仓原因',
  `source` varchar(50) DEFAULT 'manual' COMMENT '来源: manual/signal/strategy',
  `signal_id` int(11) DEFAULT NULL COMMENT '信号ID',
  `strategy_id` bigint(20) DEFAULT NULL COMMENT '策略ID',
  `notes` text DEFAULT NULL COMMENT '备注',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `max_profit_pct` decimal(10,4) DEFAULT 0.0000,
  `max_profit_price` decimal(18,8) DEFAULT NULL,
  `trailing_stop_activated` tinyint(1) DEFAULT 0,
  `trailing_stop_price` decimal(18,8) DEFAULT NULL,
  `entry_signal_type` varchar(100) DEFAULT NULL,
  `paper_position_id` int(11) DEFAULT NULL COMMENT 'å…³è”çš„æ¨¡æ‹Ÿç›˜æŒä»“ID',
  PRIMARY KEY (`id`),
  KEY `idx_account_symbol` (`account_id`,`symbol`),
  KEY `idx_status` (`status`),
  KEY `idx_open_time` (`open_time`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_user_id` (`user_id`),
  CONSTRAINT `live_futures_positions_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `live_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1150 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='实盘合约持仓表'


================================================================================
表名: live_futures_trades
================================================================================
CREATE TABLE `live_futures_trades` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `position_id` int(11) DEFAULT NULL COMMENT '持仓ID',
  `order_id` bigint(20) DEFAULT NULL COMMENT '订单ID',
  `binance_trade_id` varchar(50) DEFAULT NULL COMMENT '币安成交ID',
  `binance_order_id` varchar(50) DEFAULT NULL COMMENT '币安订单ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(10) NOT NULL COMMENT 'BUY/SELL',
  `position_side` varchar(10) DEFAULT NULL COMMENT 'LONG/SHORT',
  `price` decimal(18,8) NOT NULL COMMENT '成交价格',
  `quantity` decimal(18,8) NOT NULL COMMENT '成交数量',
  `quote_quantity` decimal(20,8) DEFAULT NULL COMMENT '成交金额',
  `commission` decimal(20,8) DEFAULT 0.00000000 COMMENT '手续费',
  `commission_asset` varchar(10) DEFAULT 'USDT' COMMENT '手续费资产',
  `realized_pnl` decimal(20,8) DEFAULT NULL COMMENT '已实现盈亏',
  `trade_time` datetime NOT NULL COMMENT '成交时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_account_symbol` (`account_id`,`symbol`),
  KEY `idx_trade_time` (`trade_time`),
  KEY `idx_binance_trade_id` (`binance_trade_id`),
  CONSTRAINT `live_futures_trades_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `live_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='实盘交易历史表'


================================================================================
表名: live_trading_accounts
================================================================================
CREATE TABLE `live_trading_accounts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `api_key_id` int(11) DEFAULT NULL COMMENT 'å…³è”ç”¨æˆ·APIå¯†é’¥ID',
  `account_name` varchar(100) NOT NULL COMMENT '账户名称',
  `exchange` varchar(50) NOT NULL DEFAULT 'binance' COMMENT '交易所',
  `account_type` varchar(20) NOT NULL DEFAULT 'futures' COMMENT '账户类型: spot/futures',
  `api_key_ref` varchar(100) DEFAULT NULL COMMENT 'API Key引用（不存储实际key）',
  `max_position_value` decimal(20,2) DEFAULT 1000.00 COMMENT '单笔最大持仓价值(USDT)',
  `max_daily_loss` decimal(20,2) DEFAULT 100.00 COMMENT '日最大亏损(USDT)',
  `max_total_positions` int(11) DEFAULT 5 COMMENT '最大同时持仓数',
  `max_leverage` int(11) DEFAULT 10 COMMENT '最大允许杠杆',
  `total_balance` decimal(20,8) DEFAULT 0.00000000 COMMENT '总余额',
  `available_balance` decimal(20,8) DEFAULT 0.00000000 COMMENT '可用余额',
  `unrealized_pnl` decimal(20,8) DEFAULT 0.00000000 COMMENT '未实现盈亏',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `winning_trades` int(11) DEFAULT 0 COMMENT '盈利次数',
  `losing_trades` int(11) DEFAULT 0 COMMENT '亏损次数',
  `total_realized_pnl` decimal(20,8) DEFAULT 0.00000000 COMMENT '累计已实现盈亏',
  `status` varchar(20) DEFAULT 'active' COMMENT '状态: active/paused/disabled',
  `is_default` tinyint(1) DEFAULT 0 COMMENT '是否默认账户',
  `last_sync_time` datetime DEFAULT NULL COMMENT '最后同步时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_account_name` (`account_name`),
  KEY `idx_exchange` (`exchange`),
  KEY `idx_status` (`status`),
  KEY `idx_user_id` (`user_id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='实盘交易账户表'


================================================================================
表名: live_trading_logs
================================================================================
CREATE TABLE `live_trading_logs` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) DEFAULT NULL COMMENT '账户ID',
  `log_level` varchar(10) NOT NULL DEFAULT 'INFO' COMMENT '日志级别: DEBUG/INFO/WARNING/ERROR',
  `action` varchar(50) NOT NULL COMMENT '操作类型: OPEN/CLOSE/CANCEL/SYNC等',
  `symbol` varchar(20) DEFAULT NULL COMMENT '交易对',
  `message` text NOT NULL COMMENT '日志消息',
  `request_data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '请求数据' CHECK (json_valid(`request_data`)),
  `response_data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '响应数据' CHECK (json_valid(`response_data`)),
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_log_level` (`log_level`),
  KEY `idx_action` (`action`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='实盘交易日志表'


================================================================================
表名: login_logs
================================================================================
CREATE TABLE `login_logs` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT NULL COMMENT 'ç”¨æˆ·ID (ç™»å½•å¤±è´¥å¯èƒ½ä¸ºNULL)',
  `username` varchar(50) DEFAULT NULL COMMENT 'å°è¯•çš„ç”¨æˆ·å',
  `success` tinyint(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦æˆåŠŸ',
  `ip_address` varchar(45) DEFAULT NULL COMMENT 'IPåœ°å€',
  `user_agent` text DEFAULT NULL COMMENT 'æµè§ˆå™¨UA',
  `failure_reason` varchar(100) DEFAULT NULL COMMENT 'å¤±è´¥åŽŸå› ',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_ip_address` (`ip_address`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_success` (`success`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='ç™»å½•æ—¥å¿—è¡¨'


================================================================================
表名: market_observations
================================================================================
CREATE TABLE `market_observations` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `timestamp` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `overall_trend` varchar(20) DEFAULT NULL,
  `market_strength` decimal(5,2) DEFAULT NULL,
  `bullish_count` int(11) DEFAULT NULL,
  `bearish_count` int(11) DEFAULT NULL,
  `neutral_count` int(11) DEFAULT NULL,
  `btc_price` decimal(12,2) DEFAULT NULL,
  `btc_trend` varchar(20) DEFAULT NULL,
  `eth_price` decimal(12,2) DEFAULT NULL,
  `eth_trend` varchar(20) DEFAULT NULL,
  `warnings` text DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_timestamp` (`timestamp`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci


================================================================================
表名: market_regime
================================================================================
CREATE TABLE `market_regime` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对符号',
  `timeframe` varchar(10) NOT NULL DEFAULT '15m' COMMENT '时间周期',
  `regime_type` varchar(30) NOT NULL COMMENT '行情类型: strong_uptrend/weak_uptrend/strong_downtrend/weak_downtrend/ranging',
  `regime_score` decimal(5,2) DEFAULT 0.00 COMMENT '行情得分 (-100到100, 正为多头, 负为空头, 接近0为震荡)',
  `ema_diff_pct` decimal(8,4) DEFAULT NULL COMMENT 'EMA9与EMA26差值百分比',
  `adx_value` decimal(8,4) DEFAULT NULL COMMENT 'ADX值(趋势强度)',
  `trend_bars` int(11) DEFAULT NULL COMMENT '趋势持续K线数',
  `volatility` decimal(8,4) DEFAULT NULL COMMENT '波动率',
  `details` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '详细分析数据' CHECK (json_valid(`details`)),
  `detected_at` datetime NOT NULL COMMENT '检测时间',
  `created_at` datetime DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_timeframe` (`timeframe`),
  KEY `idx_regime_type` (`regime_type`),
  KEY `idx_symbol_timeframe` (`symbol`,`timeframe`),
  KEY `idx_detected_at` (`detected_at`)
) ENGINE=InnoDB AUTO_INCREMENT=124717 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='行情状态记录表'


================================================================================
表名: market_regime_changes
================================================================================
CREATE TABLE `market_regime_changes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对符号',
  `timeframe` varchar(10) NOT NULL DEFAULT '15m' COMMENT '时间周期',
  `old_regime` varchar(30) DEFAULT NULL COMMENT '原行情类型',
  `new_regime` varchar(30) NOT NULL COMMENT '新行情类型',
  `old_score` decimal(5,2) DEFAULT NULL COMMENT '原行情得分',
  `new_score` decimal(5,2) DEFAULT NULL COMMENT '新行情得分',
  `changed_at` datetime NOT NULL COMMENT '切换时间',
  `created_at` datetime DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_changed_at` (`changed_at`),
  KEY `idx_symbol_timeframe` (`symbol`,`timeframe`)
) ENGINE=InnoDB AUTO_INCREMENT=889 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='行情切换日志表'


================================================================================
表名: news_data
================================================================================
CREATE TABLE `news_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `news_id` varchar(100) DEFAULT NULL,
  `title` varchar(500) NOT NULL,
  `url` varchar(500) NOT NULL,
  `source` varchar(100) DEFAULT NULL,
  `description` varchar(2000) DEFAULT NULL,
  `published_at` varchar(100) DEFAULT NULL,
  `published_datetime` datetime DEFAULT NULL,
  `symbols` varchar(200) DEFAULT NULL,
  `sentiment` varchar(20) DEFAULT NULL,
  `sentiment_score` float DEFAULT NULL,
  `votes_positive` int(11) DEFAULT NULL,
  `votes_negative` int(11) DEFAULT NULL,
  `votes_important` int(11) DEFAULT NULL,
  `data_source` varchar(50) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `url` (`url`) USING BTREE,
  UNIQUE KEY `ix_news_data_news_id` (`news_id`) USING BTREE,
  KEY `idx_symbols` (`symbols`) USING BTREE,
  KEY `idx_sentiment` (`sentiment`) USING BTREE,
  KEY `idx_source` (`source`) USING BTREE,
  KEY `ix_news_data_published_datetime` (`published_datetime`) USING BTREE,
  KEY `idx_published_datetime` (`published_datetime`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=323918 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: news_sentiment_aggregation
================================================================================
CREATE TABLE `news_sentiment_aggregation` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '币种代码',
  `period` varchar(10) NOT NULL DEFAULT '24h' COMMENT '统计周期: 24h/7d',
  `total_news` int(11) DEFAULT NULL COMMENT '新闻总数',
  `positive_news` int(11) DEFAULT NULL COMMENT '正面新闻数',
  `negative_news` int(11) DEFAULT NULL COMMENT '负面新闻数',
  `neutral_news` int(11) DEFAULT NULL COMMENT '中性新闻数',
  `sentiment_index` decimal(10,4) DEFAULT NULL COMMENT '情绪指数 (-100 到 +100)',
  `avg_sentiment_score` decimal(5,4) DEFAULT NULL COMMENT '平均情绪分数',
  `sentiment_trend` varchar(20) DEFAULT NULL COMMENT '情绪趋势: improving/declining/stable',
  `major_events_count` int(11) DEFAULT NULL COMMENT '重大事件数量',
  `critical_news` text DEFAULT NULL COMMENT '关键新闻标题 (JSON数组)',
  `sources_count` int(11) DEFAULT NULL COMMENT '新闻来源数量',
  `top_sources` text DEFAULT NULL COMMENT '主要来源 (JSON数组)',
  `news_score` decimal(5,2) DEFAULT NULL COMMENT '新闻评分 (0-100)',
  `updated_at` datetime NOT NULL COMMENT '最后更新时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_symbol_period` (`symbol`,`period`) USING BTREE,
  KEY `idx_sentiment_index` (`sentiment_index`) USING BTREE,
  KEY `idx_news_score` (`news_score`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=78822 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='新闻情绪聚合表 - 每15分钟更新'


================================================================================
表名: optimization_history
================================================================================
CREATE TABLE `optimization_history` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `optimization_type` varchar(50) NOT NULL,
  `target_name` varchar(100) NOT NULL,
  `param_name` varchar(50) NOT NULL,
  `old_value` decimal(10,6) DEFAULT NULL,
  `new_value` decimal(10,6) DEFAULT NULL,
  `change_amount` decimal(10,6) DEFAULT NULL,
  `sample_size` int(11) DEFAULT NULL,
  `win_rate` decimal(5,4) DEFAULT NULL,
  `reason` text DEFAULT NULL,
  `optimized_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_type_target` (`optimization_type`,`target_name`)
) ENGINE=InnoDB AUTO_INCREMENT=41 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci


================================================================================
表名: optimization_history_old
================================================================================
CREATE TABLE `optimization_history_old` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `optimization_date` date NOT NULL COMMENT '优化日期',
  `analysis_hours` int(11) DEFAULT 24 COMMENT '分析时间范围(小时)',
  `blacklist_added` int(11) DEFAULT 0 COMMENT '新增黑名单数量',
  `params_updated` int(11) DEFAULT 0 COMMENT '更新参数数量',
  `high_severity_issues` int(11) DEFAULT 0 COMMENT '高严重性问题数量',
  `report_summary` text DEFAULT NULL COMMENT '优化报告摘要(JSON)',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_optimization_date` (`optimization_date`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='优化历史记录'


================================================================================
表名: optimization_logs
================================================================================
CREATE TABLE `optimization_logs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `log_type` varchar(50) NOT NULL COMMENT '日志类型: timeout/blacklist/hedge/take_profit',
  `action` varchar(100) NOT NULL COMMENT '操作: adjust_timeout/upgrade_rating/downgrade_rating/update_tp',
  `symbol` varchar(50) DEFAULT NULL COMMENT '相关交易对',
  `old_value` varchar(255) DEFAULT NULL COMMENT '旧值',
  `new_value` varchar(255) DEFAULT NULL COMMENT '新值',
  `reason` text DEFAULT NULL COMMENT '优化原因',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_log_type` (`log_type`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=2102 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='优化日志表'


================================================================================
表名: orderbook_data
================================================================================
CREATE TABLE `orderbook_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `timestamp` datetime NOT NULL,
  `best_bid` decimal(18,8) DEFAULT NULL,
  `best_ask` decimal(18,8) DEFAULT NULL,
  `spread` decimal(18,8) DEFAULT NULL,
  `bid_volume` decimal(18,8) DEFAULT NULL,
  `ask_volume` decimal(18,8) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `ix_orderbook_data_symbol` (`symbol`) USING BTREE,
  KEY `idx_symbol_timestamp` (`symbol`,`timestamp`) USING BTREE,
  KEY `ix_orderbook_data_timestamp` (`timestamp`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: paper_trading_accounts
================================================================================
CREATE TABLE `paper_trading_accounts` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `account_name` varchar(100) NOT NULL COMMENT '账户名称',
  `account_type` varchar(20) DEFAULT 'spot' COMMENT '账户类型: spot(现货), futures(期货)',
  `initial_balance` decimal(20,2) NOT NULL DEFAULT 10000.00 COMMENT '初始资金(USDT)',
  `current_balance` decimal(20,2) NOT NULL DEFAULT 10000.00 COMMENT '当前可用余额(USDT)',
  `frozen_balance` decimal(20,2) DEFAULT 0.00 COMMENT '冻结资金',
  `total_equity` decimal(20,2) DEFAULT 10000.00 COMMENT '总权益(余额+持仓市值)',
  `total_profit_loss` decimal(20,2) DEFAULT 0.00 COMMENT '总盈亏(USDT)',
  `total_profit_loss_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '总收益率(%)',
  `realized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '已实现盈亏',
  `unrealized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '未实现盈亏(持仓盈亏)',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `winning_trades` int(11) DEFAULT 0 COMMENT '盈利交易次数',
  `losing_trades` int(11) DEFAULT 0 COMMENT '亏损交易次数',
  `win_rate` decimal(5,2) DEFAULT 0.00 COMMENT '胜率(%)',
  `max_balance` decimal(20,2) DEFAULT 10000.00 COMMENT '历史最高权益',
  `max_drawdown` decimal(20,2) DEFAULT 0.00 COMMENT '最大回撤金额',
  `max_drawdown_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '最大回撤率(%)',
  `strategy_name` varchar(100) DEFAULT NULL COMMENT '使用的策略名称',
  `auto_trading` tinyint(1) DEFAULT 0 COMMENT '是否启用自动交易',
  `max_position_size` decimal(5,2) DEFAULT 20.00 COMMENT '单币种最大仓位(%)',
  `stop_loss_pct` decimal(5,2) DEFAULT 5.00 COMMENT '止损比例(%)',
  `take_profit_pct` decimal(5,2) DEFAULT 15.00 COMMENT '止盈比例(%)',
  `max_daily_loss` decimal(20,2) DEFAULT NULL COMMENT '单日最大亏损',
  `status` varchar(20) DEFAULT 'active' COMMENT '账户状态: active, suspended, closed',
  `is_default` tinyint(1) DEFAULT 0 COMMENT '是否为默认账户',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_status` (`status`) USING BTREE,
  KEY `idx_account_name` (`account_name`) USING BTREE,
  KEY `idx_user_id` (`user_id`),
  KEY `id` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='模拟交易账户表'


================================================================================
表名: paper_trading_balance_history
================================================================================
CREATE TABLE `paper_trading_balance_history` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `balance` decimal(20,2) NOT NULL COMMENT '可用余额',
  `frozen_balance` decimal(20,2) NOT NULL COMMENT '冻结余额',
  `total_equity` decimal(20,2) NOT NULL COMMENT '总权益',
  `realized_pnl` decimal(20,2) NOT NULL COMMENT '已实现盈亏',
  `unrealized_pnl` decimal(20,2) NOT NULL COMMENT '未实现盈亏',
  `total_pnl` decimal(20,2) NOT NULL COMMENT '总盈亏',
  `total_pnl_pct` decimal(10,4) NOT NULL COMMENT '总收益率(%)',
  `change_type` varchar(50) DEFAULT NULL COMMENT '变动类型: deposit(入金), withdraw(出金), trade(交易), fee(手续费), pnl_update(盈亏更新)',
  `change_amount` decimal(20,2) DEFAULT NULL COMMENT '变动金额',
  `related_order_id` varchar(50) DEFAULT NULL COMMENT '关联订单ID',
  `notes` text DEFAULT NULL COMMENT '备注',
  `snapshot_time` datetime NOT NULL COMMENT '快照时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_account_time` (`account_id`,`snapshot_time`) USING BTREE,
  KEY `idx_change_type` (`change_type`) USING BTREE,
  CONSTRAINT `paper_trading_balance_history_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=93 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='账户资金变动历史表'


================================================================================
表名: paper_trading_orders
================================================================================
CREATE TABLE `paper_trading_orders` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `order_id` varchar(50) NOT NULL COMMENT '订单ID',
  `client_order_id` varchar(50) DEFAULT NULL COMMENT '客户端订单ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(10) NOT NULL COMMENT '订单方向: BUY(买入), SELL(卖出)',
  `order_type` varchar(20) NOT NULL DEFAULT 'MARKET' COMMENT '订单类型: MARKET(市价), LIMIT(限价), STOP_LOSS(止损), TAKE_PROFIT(止盈)',
  `price` decimal(18,8) DEFAULT NULL COMMENT '委托价格(限价单)',
  `quantity` decimal(18,8) NOT NULL COMMENT '委托数量',
  `executed_quantity` decimal(18,8) DEFAULT 0.00000000 COMMENT '已成交数量',
  `total_amount` decimal(20,2) DEFAULT NULL COMMENT '总金额(USDT)',
  `executed_amount` decimal(20,2) DEFAULT 0.00 COMMENT '已成交金额',
  `fee` decimal(20,8) DEFAULT 0.00000000 COMMENT '手续费',
  `fee_asset` varchar(10) DEFAULT 'USDT' COMMENT '手续费币种',
  `status` varchar(20) NOT NULL DEFAULT 'PENDING' COMMENT '订单状态: PENDING(挂单中), FILLED(完全成交), PARTIALLY_FILLED(部分成交), CANCELLED(已撤销), REJECTED(已拒绝)',
  `avg_fill_price` decimal(18,8) DEFAULT NULL COMMENT '平均成交价格',
  `fill_time` datetime DEFAULT NULL COMMENT '成交时间',
  `stop_price` decimal(18,8) DEFAULT NULL COMMENT '止损/止盈触发价格',
  `order_source` varchar(50) DEFAULT 'manual' COMMENT '订单来源: manual(手动), signal(信号), auto(自动交易)',
  `signal_id` int(11) DEFAULT NULL COMMENT '关联的信号ID',
  `notes` text DEFAULT NULL COMMENT '订单备注',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `order_id` (`order_id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE,
  KEY `idx_status` (`status`) USING BTREE,
  KEY `idx_created_at` (`created_at`) USING BTREE,
  CONSTRAINT `paper_trading_orders_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='模拟交易订单表'


================================================================================
表名: paper_trading_pending_orders
================================================================================
CREATE TABLE `paper_trading_pending_orders` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `order_id` varchar(50) NOT NULL COMMENT '订单ID（前端生成的唯一ID）',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(10) NOT NULL COMMENT '订单方向: BUY(买入), SELL(卖出)',
  `order_type` varchar(20) NOT NULL DEFAULT 'TRIGGER' COMMENT '订单类型: TRIGGER(触发单)',
  `trigger_price` decimal(18,8) NOT NULL COMMENT '触发价格',
  `quantity` decimal(18,8) NOT NULL COMMENT '委托数量',
  `frozen_amount` decimal(20,2) DEFAULT 0.00 COMMENT '冻结资金(买入时)',
  `frozen_quantity` decimal(18,8) DEFAULT 0.00000000 COMMENT '冻结数量(卖出时)',
  `status` varchar(20) NOT NULL DEFAULT 'PENDING' COMMENT '订单状态: PENDING(待成交), EXECUTED(已执行), CANCELLED(已撤销)',
  `executed` tinyint(1) DEFAULT 0 COMMENT '是否已执行',
  `executed_at` datetime DEFAULT NULL COMMENT '执行时间',
  `executed_order_id` varchar(50) DEFAULT NULL COMMENT '执行后的订单ID',
  `order_source` varchar(50) DEFAULT 'auto' COMMENT '订单来源: auto(自动交易), manual(手动)',
  `stop_loss_price` decimal(18,8) DEFAULT NULL COMMENT '止损价格',
  `take_profit_price` decimal(18,8) DEFAULT NULL COMMENT '止盈价格',
  `notes` text DEFAULT NULL COMMENT '订单备注',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `order_id` (`order_id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE,
  KEY `idx_status` (`status`) USING BTREE,
  KEY `idx_executed` (`executed`) USING BTREE,
  KEY `idx_created_at` (`created_at`) USING BTREE,
  CONSTRAINT `paper_trading_pending_orders_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='待成交订单表'


================================================================================
表名: paper_trading_positions
================================================================================
CREATE TABLE `paper_trading_positions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对(如 BTC/USDT)',
  `position_side` varchar(10) DEFAULT 'LONG' COMMENT '持仓方向: LONG(多头), SHORT(空头)',
  `quantity` decimal(18,8) NOT NULL COMMENT '持仓数量',
  `available_quantity` decimal(18,8) NOT NULL COMMENT '可用数量(未被挂单占用)',
  `avg_entry_price` decimal(18,8) NOT NULL COMMENT '平均买入价格',
  `total_cost` decimal(20,2) NOT NULL COMMENT '总成本(USDT)',
  `current_price` decimal(18,8) DEFAULT NULL COMMENT '当前市场价格',
  `market_value` decimal(20,2) DEFAULT NULL COMMENT '当前市值',
  `unrealized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '未实现盈亏',
  `unrealized_pnl_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '未实现收益率(%)',
  `stop_loss_price` decimal(18,8) DEFAULT NULL COMMENT '止损价格',
  `take_profit_price` decimal(18,8) DEFAULT NULL COMMENT '止盈价格',
  `first_buy_time` datetime DEFAULT NULL COMMENT '首次买入时间',
  `last_update_time` datetime DEFAULT NULL COMMENT '最后更新时间',
  `holding_days` int(11) DEFAULT 0 COMMENT '持有天数',
  `status` varchar(20) DEFAULT 'open' COMMENT '持仓状态: open(持仓中), closed(已平仓)',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_status` (`status`) USING BTREE,
  CONSTRAINT `paper_trading_positions_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=42 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='模拟交易持仓表'


================================================================================
表名: paper_trading_signal_executions
================================================================================
CREATE TABLE `paper_trading_signal_executions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `signal_id` int(11) DEFAULT NULL COMMENT '信号ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `signal_type` varchar(20) NOT NULL COMMENT '信号类型: BUY, SELL, HOLD',
  `signal_strength` varchar(20) DEFAULT NULL COMMENT '信号强度: STRONG, MEDIUM, WEAK',
  `confidence_score` decimal(5,2) DEFAULT NULL COMMENT '置信度',
  `is_executed` tinyint(1) DEFAULT 0 COMMENT '是否已执行',
  `execution_status` varchar(20) DEFAULT NULL COMMENT '执行状态: success, failed, skipped',
  `order_id` varchar(50) DEFAULT NULL COMMENT '生成的订单ID',
  `decision` varchar(20) DEFAULT NULL COMMENT '决策: execute(执行), skip(跳过), reject(拒绝)',
  `decision_reason` text DEFAULT NULL COMMENT '决策原因',
  `execution_price` decimal(18,8) DEFAULT NULL COMMENT '执行价格',
  `execution_quantity` decimal(18,8) DEFAULT NULL COMMENT '执行数量',
  `execution_amount` decimal(20,2) DEFAULT NULL COMMENT '执行金额',
  `signal_time` datetime NOT NULL COMMENT '信号生成时间',
  `execution_time` datetime DEFAULT NULL COMMENT '执行时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_signal_time` (`signal_time`) USING BTREE,
  KEY `idx_execution_status` (`execution_status`) USING BTREE,
  CONSTRAINT `paper_trading_signal_executions_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='交易信号执行记录表'


================================================================================
表名: paper_trading_trades
================================================================================
CREATE TABLE `paper_trading_trades` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `order_id` varchar(50) NOT NULL COMMENT '订单ID',
  `trade_id` varchar(50) NOT NULL COMMENT '成交ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `side` varchar(10) NOT NULL COMMENT 'BUY(买入), SELL(卖出)',
  `price` decimal(18,8) NOT NULL COMMENT '成交价格',
  `quantity` decimal(18,8) NOT NULL COMMENT '成交数量',
  `total_amount` decimal(20,2) NOT NULL COMMENT '成交金额',
  `fee` decimal(20,8) DEFAULT 0.00000000 COMMENT '手续费',
  `fee_asset` varchar(10) DEFAULT 'USDT' COMMENT '手续费币种',
  `realized_pnl` decimal(20,2) DEFAULT NULL COMMENT '已实现盈亏',
  `pnl_pct` decimal(10,4) DEFAULT NULL COMMENT '收益率(%)',
  `cost_price` decimal(18,8) DEFAULT NULL COMMENT '成本价',
  `trade_time` datetime NOT NULL COMMENT '成交时间',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `trade_id` (`trade_id`) USING BTREE,
  KEY `idx_account_symbol` (`account_id`,`symbol`) USING BTREE,
  KEY `idx_order_id` (`order_id`) USING BTREE,
  KEY `idx_trade_time` (`trade_time`) USING BTREE,
  CONSTRAINT `paper_trading_trades_ibfk_1` FOREIGN KEY (`account_id`) REFERENCES `paper_trading_accounts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=37 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='模拟交易成交历史表'


================================================================================
表名: parameter_adjustments
================================================================================
CREATE TABLE `parameter_adjustments` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `adjustment_date` timestamp NOT NULL DEFAULT current_timestamp(),
  `param_group` varchar(100) DEFAULT NULL,
  `param_name` varchar(100) DEFAULT NULL,
  `old_value` varchar(100) DEFAULT NULL,
  `new_value` varchar(100) DEFAULT NULL,
  `reason` text DEFAULT NULL,
  `applied` tinyint(1) DEFAULT 1,
  PRIMARY KEY (`id`),
  KEY `idx_adjustment_date` (`adjustment_date`),
  KEY `idx_param_group` (`param_group`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='参数调整历史表'


================================================================================
表名: pending_positions
================================================================================
CREATE TABLE `pending_positions` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(50) NOT NULL,
  `direction` varchar(10) NOT NULL COMMENT 'long/short',
  `signal_type` varchar(50) NOT NULL COMMENT 'ä¿¡å·ç±»åž‹ï¼šgolden_cross/death_cross/sustained_trendç­‰',
  `signal_price` decimal(20,8) NOT NULL COMMENT 'ä¿¡å·è§¦å‘æ—¶çš„ä»·æ ¼',
  `signal_ema9` decimal(20,8) DEFAULT NULL COMMENT 'ä¿¡å·æ—¶çš„EMA9',
  `signal_ema26` decimal(20,8) DEFAULT NULL COMMENT 'ä¿¡å·æ—¶çš„EMA26',
  `signal_ema_diff_pct` decimal(10,4) DEFAULT NULL COMMENT 'ä¿¡å·æ—¶çš„EMAå·®å€¼ç™¾åˆ†æ¯”',
  `signal_reason` text DEFAULT NULL COMMENT 'å¼€ä»“åŽŸå› è¯¦æƒ…',
  `strategy_id` bigint(11) NOT NULL,
  `account_id` int(11) NOT NULL DEFAULT 2,
  `leverage` int(11) NOT NULL DEFAULT 10,
  `margin_pct` decimal(10,4) DEFAULT NULL COMMENT 'ä¿è¯é‡‘æ¯”ä¾‹',
  `status` varchar(20) NOT NULL DEFAULT 'pending' COMMENT 'pending/validated/rejected/expired',
  `validation_count` int(11) DEFAULT 0 COMMENT 'å·²è‡ªæ£€æ¬¡æ•°',
  `last_validation_time` datetime DEFAULT NULL COMMENT 'æœ€åŽè‡ªæ£€æ—¶é—´',
  `rejection_reason` text DEFAULT NULL COMMENT 'æ‹’ç»åŽŸå› ',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `expired_at` datetime DEFAULT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_status` (`status`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_strategy` (`strategy_id`),
  KEY `idx_created` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=1347 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='å¾…å¼€ä»“ä¿¡å·è¡¨'


================================================================================
表名: price_data
================================================================================
CREATE TABLE `price_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `timestamp` datetime NOT NULL,
  `price` decimal(18,8) NOT NULL,
  `open_price` decimal(18,8) DEFAULT NULL,
  `high_price` decimal(18,8) DEFAULT NULL,
  `low_price` decimal(18,8) DEFAULT NULL,
  `close_price` decimal(18,8) DEFAULT NULL,
  `volume` decimal(20,8) DEFAULT NULL,
  `quote_volume` decimal(24,2) DEFAULT NULL,
  `bid_price` decimal(18,8) DEFAULT NULL,
  `ask_price` decimal(18,8) DEFAULT NULL,
  `change_24h` float DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `idx_unique_price` (`symbol`,`exchange`,`timestamp`),
  KEY `ix_price_data_symbol` (`symbol`) USING BTREE,
  KEY `idx_exchange_symbol` (`exchange`,`symbol`) USING BTREE,
  KEY `ix_price_data_timestamp` (`timestamp`) USING BTREE,
  KEY `idx_symbol_timestamp` (`symbol`,`timestamp`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=8050883 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: price_stats_24h
================================================================================
CREATE TABLE `price_stats_24h` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `current_price` decimal(18,8) NOT NULL COMMENT '当前价格',
  `price_24h_ago` decimal(18,8) DEFAULT NULL COMMENT '24小时前价格',
  `change_24h` decimal(10,4) DEFAULT NULL COMMENT '24小时涨跌幅 (%)',
  `change_24h_abs` decimal(18,8) DEFAULT NULL COMMENT '24小时涨跌额 (绝对值)',
  `high_24h` decimal(18,8) DEFAULT NULL COMMENT '24小时最高价',
  `low_24h` decimal(18,8) DEFAULT NULL COMMENT '24小时最低价',
  `volume_24h` decimal(20,8) DEFAULT NULL COMMENT '24小时成交量 (基础货币)',
  `quote_volume_24h` decimal(24,2) DEFAULT NULL COMMENT '24小时成交额 (USDT)',
  `trades_count_24h` int(11) DEFAULT NULL COMMENT '24小时交易笔数',
  `avg_trade_size` decimal(18,8) DEFAULT NULL COMMENT '平均交易规模',
  `price_range_24h` decimal(18,8) DEFAULT NULL COMMENT '24小时价格波动范围',
  `price_range_pct` decimal(10,4) DEFAULT NULL COMMENT '24小时价格波动百分比',
  `trend` varchar(20) DEFAULT NULL COMMENT '趋势: strong_up/up/sideways/down/strong_down',
  `updated_at` datetime NOT NULL COMMENT '最后更新时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `symbol` (`symbol`) USING BTREE,
  KEY `idx_change_24h` (`change_24h`) USING BTREE,
  KEY `idx_volume_24h` (`quote_volume_24h`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE,
  KEY `idx_trend` (`trend`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=881328 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='24小时价格统计缓存 - 每1分钟更新'


================================================================================
表名: range_market_zones
================================================================================
CREATE TABLE `range_market_zones` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `timeframe` varchar(10) DEFAULT '1h' COMMENT 'K线周期',
  `support_price` decimal(20,8) NOT NULL COMMENT '支撑位价格',
  `resistance_price` decimal(20,8) NOT NULL COMMENT '阻力位价格',
  `range_pct` decimal(5,2) DEFAULT NULL COMMENT '区间幅度百分比',
  `touch_count` int(11) DEFAULT 1 COMMENT '触及次数',
  `bounce_count` int(11) DEFAULT 0 COMMENT '反弹次数',
  `confidence_score` decimal(5,2) DEFAULT 50.00 COMMENT '可信度分数 (0-100)',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否有效',
  `breakout_direction` enum('up','down','none') DEFAULT 'none' COMMENT '突破方向',
  `detected_at` timestamp NOT NULL DEFAULT current_timestamp() COMMENT '检测时间',
  `last_touch_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '最后触及时间',
  `expires_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '过期时间',
  `invalidated_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00' COMMENT '失效时间',
  PRIMARY KEY (`id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_active` (`is_active`),
  KEY `idx_confidence` (`confidence_score`),
  KEY `idx_detected_at` (`detected_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='震荡区间识别记录'


================================================================================
表名: range_trading_history
================================================================================
CREATE TABLE `range_trading_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `position_id` int(11) DEFAULT NULL COMMENT '关联的持仓ID',
  `symbol` varchar(20) NOT NULL,
  `zone_id` int(11) DEFAULT NULL COMMENT '关联的区间ID',
  `entry_reason` enum('support_bounce','resistance_bounce','bollinger_lower','bollinger_upper','grid') DEFAULT NULL COMMENT '开仓原因',
  `entry_price` decimal(20,8) DEFAULT NULL,
  `target_price` decimal(20,8) DEFAULT NULL COMMENT '目标价格',
  `actual_exit_price` decimal(20,8) DEFAULT NULL COMMENT '实际平仓价格',
  `pnl` decimal(20,8) DEFAULT NULL COMMENT '盈亏',
  `hold_time_minutes` int(11) DEFAULT NULL COMMENT '持仓时长(分钟)',
  `exit_reason` enum('take_profit','stop_loss','timeout','manual','mode_switch') DEFAULT NULL COMMENT '平仓原因',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `closed_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`id`),
  KEY `idx_position` (`position_id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_zone` (`zone_id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='震荡市交易历史记录'


================================================================================
表名: refresh_tokens
================================================================================
CREATE TABLE `refresh_tokens` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL COMMENT 'ç”¨æˆ·ID',
  `token_hash` varchar(255) NOT NULL COMMENT 'ä»¤ç‰Œå“ˆå¸Œ',
  `device_info` varchar(255) DEFAULT NULL COMMENT 'è®¾å¤‡ä¿¡æ¯',
  `ip_address` varchar(45) DEFAULT NULL COMMENT 'IPåœ°å€',
  `expires_at` datetime NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `revoked_at` datetime DEFAULT NULL COMMENT 'æ’¤é”€æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_token_hash` (`token_hash`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_expires_at` (`expires_at`),
  CONSTRAINT `refresh_tokens_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='åˆ·æ–°ä»¤ç‰Œè¡¨'


================================================================================
表名: retrospective_analysis
================================================================================
CREATE TABLE `retrospective_analysis` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `analysis_time` datetime NOT NULL COMMENT '分析执行时间',
  `period_start` datetime NOT NULL COMMENT '分析区间开始时间',
  `period_end` datetime NOT NULL COMMENT '分析区间结束时间',
  `btc_price_change_pct` decimal(10,4) DEFAULT NULL COMMENT 'BTC价格变化%',
  `btc_volatility_pct` decimal(10,4) DEFAULT NULL COMMENT 'BTC波动率%',
  `btc_direction` varchar(20) DEFAULT NULL COMMENT 'BTC方向判断',
  `eth_price_change_pct` decimal(10,4) DEFAULT NULL COMMENT 'ETH价格变化%',
  `eth_volatility_pct` decimal(10,4) DEFAULT NULL COMMENT 'ETH波动率%',
  `eth_direction` varchar(20) DEFAULT NULL COMMENT 'ETH方向判断',
  `bnb_price_change_pct` decimal(10,4) DEFAULT NULL COMMENT 'BNB价格变化%',
  `bnb_volatility_pct` decimal(10,4) DEFAULT NULL COMMENT 'BNB波动率%',
  `bnb_direction` varchar(20) DEFAULT NULL COMMENT 'BNB方向判断',
  `sol_price_change_pct` decimal(10,4) DEFAULT NULL COMMENT 'SOL价格变化%',
  `sol_volatility_pct` decimal(10,4) DEFAULT NULL COMMENT 'SOL波动率%',
  `sol_direction` varchar(20) DEFAULT NULL COMMENT 'SOL方向判断',
  `overall_market_direction` varchar(20) DEFAULT NULL COMMENT '整体市场方向',
  `big4_signal_count` int(11) DEFAULT NULL COMMENT 'Big4信号更新次数',
  `big4_bullish_count` int(11) DEFAULT NULL COMMENT 'BULLISH信号次数',
  `big4_bearish_count` int(11) DEFAULT NULL COMMENT 'BEARISH信号次数',
  `big4_neutral_count` int(11) DEFAULT NULL COMMENT 'NEUTRAL信号次数',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易数',
  `profit_trades` int(11) DEFAULT 0 COMMENT '盈利交易数',
  `loss_trades` int(11) DEFAULT 0 COMMENT '亏损交易数',
  `win_rate` decimal(5,2) DEFAULT NULL COMMENT '胜率%',
  `total_pnl` decimal(20,2) DEFAULT NULL COMMENT '总盈亏USDT',
  `counter_trend_trades` int(11) DEFAULT 0 COMMENT '逆势交易数量',
  `signal_mismatch_trades` int(11) DEFAULT 0 COMMENT 'Big4信号不匹配数量',
  `signal_lag_trades` int(11) DEFAULT 0 COMMENT '信号滞后数量',
  `false_breakout_trades` int(11) DEFAULT 0 COMMENT '震荡市误判数量',
  `performance_rating` varchar(20) DEFAULT NULL COMMENT '交易表现评价: 优秀/良好/一般/较差',
  `market_analysis_json` text DEFAULT NULL COMMENT '市场分析详细数据JSON',
  `trading_analysis_json` text DEFAULT NULL COMMENT '交易分析详细数据JSON',
  `loss_analysis_json` text DEFAULT NULL COMMENT '亏损分析详细数据JSON',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_analysis_time` (`analysis_time`),
  KEY `idx_period` (`period_start`,`period_end`),
  KEY `idx_win_rate` (`win_rate`),
  KEY `idx_pnl` (`total_pnl`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='12小时复盘分析表'


================================================================================
表名: sentinel_orders
================================================================================
CREATE TABLE `sentinel_orders` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `direction` varchar(10) NOT NULL COMMENT 'æ–¹å‘: long/short',
  `symbol` varchar(20) NOT NULL COMMENT 'äº¤æ˜“å¯¹(å¦‚ BTC/USDT)',
  `entry_price` decimal(18,8) NOT NULL COMMENT 'å…¥åœºä»·ï¼ˆåˆ›å»ºæ—¶çš„å¸‚ä»·ï¼‰',
  `stop_loss_price` decimal(18,8) NOT NULL COMMENT 'æ­¢æŸä»·',
  `take_profit_price` decimal(18,8) NOT NULL COMMENT 'æ­¢ç›ˆä»·',
  `stop_loss_pct` decimal(10,4) DEFAULT NULL COMMENT 'æ­¢æŸç™¾åˆ†æ¯”',
  `take_profit_pct` decimal(10,4) DEFAULT NULL COMMENT 'æ­¢ç›ˆç™¾åˆ†æ¯”',
  `status` varchar(20) DEFAULT 'open' COMMENT 'çŠ¶æ€: open/win/loss',
  `close_price` decimal(18,8) DEFAULT NULL COMMENT 'å¹³ä»“ä»·æ ¼',
  `close_reason` varchar(50) DEFAULT NULL COMMENT 'å¹³ä»“åŽŸå› : stop_loss/take_profit',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT 'åˆ›å»ºæ—¶é—´',
  `closed_at` datetime DEFAULT NULL COMMENT 'å¹³ä»“æ—¶é—´',
  `strategy_id` bigint(20) DEFAULT NULL COMMENT 'ç­–ç•¥ID',
  PRIMARY KEY (`id`),
  KEY `idx_direction_status` (`direction`,`status`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='å“¨å…µå•è¡¨ï¼ˆç†”æ–­åŽè™šæ‹Ÿç›‘æŽ§ï¼‰'


================================================================================
表名: signal_analysis_reports
================================================================================
CREATE TABLE `signal_analysis_reports` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `analysis_time` datetime NOT NULL,
  `total_analyzed` int(11) NOT NULL,
  `has_position` int(11) NOT NULL,
  `should_trade` int(11) NOT NULL,
  `missed_opportunities` int(11) NOT NULL,
  `wrong_direction` int(11) NOT NULL,
  `correct_captures` int(11) NOT NULL,
  `capture_rate` decimal(5,2) NOT NULL,
  `report_json` text DEFAULT NULL,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_analysis_time` (`analysis_time`)
) ENGINE=InnoDB AUTO_INCREMENT=89 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci


================================================================================
表名: signal_blacklist
================================================================================
CREATE TABLE `signal_blacklist` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `signal_type` varchar(500) DEFAULT NULL,
  `position_side` varchar(10) NOT NULL COMMENT '方向（LONG/SHORT）',
  `reason` varchar(255) DEFAULT NULL COMMENT '禁用原因',
  `total_loss` decimal(15,2) DEFAULT NULL COMMENT '历史总亏损',
  `win_rate` decimal(5,4) DEFAULT NULL COMMENT '胜率',
  `order_count` int(11) DEFAULT NULL COMMENT '订单数量',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否激活',
  `notes` text DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_signal_side` (`signal_type`,`position_side`),
  KEY `idx_active` (`is_active`),
  KEY `idx_signal_type` (`signal_type`),
  KEY `idx_side` (`position_side`)
) ENGINE=InnoDB AUTO_INCREMENT=59 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='信号黑名单表'


================================================================================
表名: signal_component_performance
================================================================================
CREATE TABLE `signal_component_performance` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `component_name` varchar(50) NOT NULL COMMENT '组件名',
  `position_side` varchar(10) NOT NULL COMMENT 'LONG/SHORT',
  `total_orders` int(11) DEFAULT 0 COMMENT '包含此组件的总订单数',
  `win_orders` int(11) DEFAULT 0 COMMENT '盈利订单数',
  `total_pnl` decimal(15,2) DEFAULT 0.00 COMMENT '总盈亏',
  `avg_pnl` decimal(10,2) DEFAULT NULL COMMENT '平均盈亏',
  `win_rate` decimal(5,4) DEFAULT NULL COMMENT '胜率',
  `contribution_score` decimal(5,2) DEFAULT NULL COMMENT '贡献度评分',
  `last_analyzed` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '上次分析时间',
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `unique_component_side` (`component_name`,`position_side`),
  KEY `idx_side` (`position_side`),
  KEY `idx_analyzed` (`last_analyzed`)
) ENGINE=InnoDB AUTO_INCREMENT=1026 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='信号组件表现统计'


================================================================================
表名: signal_position_multipliers
================================================================================
CREATE TABLE `signal_position_multipliers` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `component_name` varchar(50) NOT NULL COMMENT '信号组件名称',
  `position_side` varchar(10) NOT NULL COMMENT '方向: LONG/SHORT',
  `position_multiplier` decimal(5,2) DEFAULT 1.00 COMMENT '仓位倍数(0.5-2.0)',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `win_rate` decimal(5,4) DEFAULT 0.0000 COMMENT '胜率',
  `avg_pnl` decimal(10,2) DEFAULT 0.00 COMMENT '平均盈亏',
  `total_pnl` decimal(15,2) DEFAULT 0.00 COMMENT '总盈亏',
  `last_analyzed` timestamp NULL DEFAULT NULL COMMENT '最后分析时间',
  `adjustment_count` int(11) DEFAULT 0 COMMENT '调整次数',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否启用',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_component_side` (`component_name`,`position_side`),
  KEY `idx_performance` (`win_rate`,`total_pnl`)
) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='信号组件仓位倍数配置'


================================================================================
表名: signal_scoring_weights
================================================================================
CREATE TABLE `signal_scoring_weights` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `signal_component` varchar(50) NOT NULL COMMENT '信号组件名',
  `weight_long` decimal(5,2) NOT NULL COMMENT 'LONG权重',
  `weight_short` decimal(5,2) NOT NULL COMMENT 'SHORT权重',
  `base_weight` decimal(5,2) NOT NULL COMMENT '基准权重（初始值）',
  `performance_score` decimal(5,2) DEFAULT NULL COMMENT '表现评分（-100到100）',
  `last_adjusted` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '上次调整时间',
  `adjustment_count` int(11) DEFAULT 0 COMMENT '调整次数',
  `description` varchar(255) DEFAULT NULL COMMENT '描述',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否启用',
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `signal_component` (`signal_component`),
  KEY `idx_component` (`signal_component`),
  KEY `idx_active` (`is_active`)
) ENGINE=InnoDB AUTO_INCREMENT=24 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='信号评分权重表'


================================================================================
表名: signal_threshold_overrides
================================================================================
CREATE TABLE `signal_threshold_overrides` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `signal_type` varchar(500) NOT NULL,
  `position_side` varchar(10) NOT NULL,
  `min_score` int(11) NOT NULL,
  `reason` varchar(255) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT 1,
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_signal_side` (`signal_type`(255),`position_side`),
  KEY `idx_active` (`is_active`)
) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci


================================================================================
表名: smart_money_addresses
================================================================================
CREATE TABLE `smart_money_addresses` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `address` varchar(100) NOT NULL,
  `blockchain` varchar(20) NOT NULL,
  `label` varchar(200) DEFAULT NULL,
  `address_type` varchar(50) DEFAULT NULL,
  `total_value_usd` decimal(18,2) DEFAULT NULL,
  `win_rate` float DEFAULT NULL,
  `total_trades` int(11) DEFAULT NULL,
  `profitable_trades` int(11) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  `first_seen` datetime DEFAULT NULL,
  `last_active` datetime DEFAULT NULL,
  `data_source` varchar(50) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `ix_smart_money_addresses_address` (`address`) USING BTREE,
  KEY `idx_blockchain_type` (`blockchain`,`address_type`) USING BTREE,
  KEY `ix_smart_money_addresses_last_active` (`last_active`) USING BTREE,
  KEY `ix_smart_money_addresses_blockchain` (`blockchain`) USING BTREE,
  KEY `idx_active_last_active` (`is_active`,`last_active`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: smart_money_signals
================================================================================
CREATE TABLE `smart_money_signals` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `token_symbol` varchar(20) NOT NULL,
  `token_address` varchar(100) DEFAULT NULL,
  `blockchain` varchar(20) NOT NULL,
  `signal_type` varchar(20) NOT NULL,
  `signal_strength` varchar(20) NOT NULL,
  `confidence_score` float NOT NULL,
  `smart_money_count` int(11) DEFAULT NULL,
  `total_buy_amount_usd` decimal(18,2) DEFAULT NULL,
  `total_sell_amount_usd` decimal(18,2) DEFAULT NULL,
  `net_flow_usd` decimal(18,2) DEFAULT NULL,
  `transaction_count` int(11) DEFAULT NULL,
  `price_before` decimal(18,8) DEFAULT NULL,
  `price_current` decimal(18,8) DEFAULT NULL,
  `price_change_pct` float DEFAULT NULL,
  `signal_start_time` datetime NOT NULL,
  `signal_end_time` datetime NOT NULL,
  `timestamp` datetime NOT NULL,
  `related_tx_hashes` varchar(2000) DEFAULT NULL,
  `top_addresses` varchar(500) DEFAULT NULL,
  `is_active` tinyint(1) DEFAULT NULL,
  `is_verified` tinyint(1) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  KEY `ix_smart_money_signals_signal_type` (`signal_type`) USING BTREE,
  KEY `idx_active_confidence` (`is_active`,`confidence_score`) USING BTREE,
  KEY `idx_blockchain_token` (`blockchain`,`token_symbol`) USING BTREE,
  KEY `ix_smart_money_signals_token_symbol` (`token_symbol`) USING BTREE,
  KEY `ix_smart_money_signals_is_active` (`is_active`) USING BTREE,
  KEY `ix_smart_money_signals_timestamp` (`timestamp`) USING BTREE,
  KEY `idx_token_signal_time` (`token_symbol`,`signal_type`,`timestamp`) USING BTREE,
  KEY `ix_smart_money_signals_token_address` (`token_address`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: smart_money_transactions
================================================================================
CREATE TABLE `smart_money_transactions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tx_hash` varchar(100) NOT NULL,
  `address` varchar(100) NOT NULL,
  `blockchain` varchar(20) NOT NULL,
  `token_address` varchar(100) NOT NULL,
  `token_symbol` varchar(20) NOT NULL,
  `token_name` varchar(100) DEFAULT NULL,
  `action` varchar(20) NOT NULL,
  `amount` decimal(30,8) NOT NULL,
  `amount_usd` decimal(18,2) DEFAULT NULL,
  `price_usd` decimal(18,8) DEFAULT NULL,
  `from_address` varchar(100) DEFAULT NULL,
  `to_address` varchar(100) DEFAULT NULL,
  `dex_name` varchar(50) DEFAULT NULL,
  `contract_address` varchar(100) DEFAULT NULL,
  `block_number` bigint(20) NOT NULL,
  `block_timestamp` bigint(20) NOT NULL,
  `timestamp` datetime NOT NULL,
  `gas_used` bigint(20) DEFAULT NULL,
  `gas_price` bigint(20) DEFAULT NULL,
  `transaction_fee` decimal(18,8) DEFAULT NULL,
  `is_large_transaction` tinyint(1) DEFAULT NULL,
  `is_first_buy` tinyint(1) DEFAULT NULL,
  `signal_strength` varchar(20) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `ix_smart_money_transactions_tx_hash` (`tx_hash`) USING BTREE,
  KEY `ix_smart_money_transactions_timestamp` (`timestamp`) USING BTREE,
  KEY `ix_smart_money_transactions_token_address` (`token_address`) USING BTREE,
  KEY `ix_smart_money_transactions_blockchain` (`blockchain`) USING BTREE,
  KEY `ix_smart_money_transactions_address` (`address`) USING BTREE,
  KEY `ix_smart_money_transactions_token_symbol` (`token_symbol`) USING BTREE,
  KEY `ix_smart_money_transactions_action` (`action`) USING BTREE,
  KEY `ix_smart_money_transactions_to_address` (`to_address`) USING BTREE,
  KEY `ix_smart_money_transactions_block_number` (`block_number`) USING BTREE,
  KEY `ix_smart_money_transactions_block_timestamp` (`block_timestamp`) USING BTREE,
  KEY `idx_token_action_time` (`token_symbol`,`action`,`timestamp`) USING BTREE,
  KEY `idx_blockchain_block` (`blockchain`,`block_number`) USING BTREE,
  KEY `idx_address_token` (`address`,`token_symbol`) USING BTREE,
  KEY `idx_large_recent` (`is_large_transaction`,`timestamp`) USING BTREE,
  KEY `ix_smart_money_transactions_from_address` (`from_address`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=375677 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC


================================================================================
表名: spot_batch_history
================================================================================
CREATE TABLE `spot_batch_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `position_id` int(11) NOT NULL COMMENT '关联的持仓ID',
  `batch_number` int(11) NOT NULL COMMENT '批次号 (1-5)',
  `buy_price` decimal(20,8) NOT NULL COMMENT '买入价格',
  `quantity` decimal(20,8) NOT NULL COMMENT '买入数量',
  `cost` decimal(20,4) NOT NULL COMMENT '本批成本 (USDT)',
  `signal_strength` decimal(5,2) DEFAULT NULL COMMENT '加仓时信号强度',
  `signal_details` text DEFAULT NULL COMMENT '加仓信号详情',
  `created_at` datetime NOT NULL COMMENT '加仓时间',
  PRIMARY KEY (`id`),
  KEY `idx_position_id` (`position_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `spot_batch_history_ibfk_1` FOREIGN KEY (`position_id`) REFERENCES `spot_positions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='现货加仓记录表'


================================================================================
表名: spot_capital_usage
================================================================================
CREATE TABLE `spot_capital_usage` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `total_capital` decimal(20,4) NOT NULL COMMENT '总资金',
  `available_capital` decimal(20,4) NOT NULL COMMENT '可用资金',
  `locked_capital` decimal(20,4) NOT NULL COMMENT '锁定资金 (持仓中)',
  `active_positions` int(11) NOT NULL DEFAULT 0 COMMENT '活跃持仓数',
  `total_pnl` decimal(20,4) DEFAULT NULL COMMENT '总盈亏',
  `realized_pnl` decimal(20,4) DEFAULT NULL COMMENT '已实现盈亏',
  `unrealized_pnl` decimal(20,4) DEFAULT NULL COMMENT '未实现盈亏',
  `snapshot_time` datetime NOT NULL COMMENT '快照时间',
  PRIMARY KEY (`id`),
  KEY `idx_snapshot_time` (`snapshot_time`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='现货资金使用统计表'


================================================================================
表名: spot_positions
================================================================================
CREATE TABLE `spot_positions` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对 (如 BTC/USDT)',
  `entry_price` decimal(20,8) NOT NULL COMMENT '首次买入价格',
  `avg_entry_price` decimal(20,8) NOT NULL COMMENT '平均成本价',
  `quantity` decimal(20,8) NOT NULL COMMENT '持仓数量',
  `total_cost` decimal(20,4) NOT NULL COMMENT '总成本 (USDT)',
  `current_batch` int(11) NOT NULL DEFAULT 1 COMMENT '当前批次 (1-5)',
  `take_profit_price` decimal(20,8) DEFAULT NULL COMMENT '止盈价格',
  `stop_loss_price` decimal(20,8) DEFAULT NULL COMMENT '止损价格',
  `exit_price` decimal(20,8) DEFAULT NULL COMMENT '平仓价格',
  `pnl` decimal(20,4) DEFAULT NULL COMMENT '盈亏金额 (USDT)',
  `pnl_pct` decimal(10,6) DEFAULT NULL COMMENT '盈亏百分比',
  `close_reason` varchar(50) DEFAULT NULL COMMENT '平仓原因 (止盈/止损/手动)',
  `signal_strength` decimal(5,2) DEFAULT NULL COMMENT '开仓信号强度 (0-100)',
  `signal_details` text DEFAULT NULL COMMENT '信号详情',
  `status` varchar(20) NOT NULL DEFAULT 'active' COMMENT '状态 (active/closed)',
  `created_at` datetime NOT NULL COMMENT '创建时间',
  `updated_at` datetime NOT NULL COMMENT '更新时间',
  `closed_at` datetime DEFAULT NULL COMMENT '平仓时间',
  PRIMARY KEY (`id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_status` (`status`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='现货持仓表'


================================================================================
表名: spot_positions_v2
================================================================================
CREATE TABLE `spot_positions_v2` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `status` varchar(20) NOT NULL DEFAULT 'active' COMMENT '状态: active, closed',
  `phase` varchar(20) NOT NULL DEFAULT 'sampling' COMMENT '阶段: sampling, building, holding, exit_sampling, exit_ready, closed',
  `signal_strength` decimal(5,2) DEFAULT 0.00 COMMENT '信号强度',
  `sampling_start_time` datetime DEFAULT NULL COMMENT '采样开始时间',
  `building_start_time` datetime DEFAULT NULL COMMENT '建仓开始时间',
  `holding_start_time` datetime DEFAULT NULL COMMENT '持仓开始时间',
  `exit_sampling_start_time` datetime DEFAULT NULL COMMENT '平仓采样开始时间',
  `exit_time` datetime DEFAULT NULL COMMENT '平仓时间',
  `target_entry_price` decimal(18,8) DEFAULT 0.00000000 COMMENT '目标建仓价格',
  `current_batch` int(11) DEFAULT 0 COMMENT '当前批次 (0-5)',
  `total_batches` int(11) DEFAULT 5 COMMENT '总批次数',
  `total_quantity` decimal(18,8) DEFAULT 0.00000000 COMMENT '总数量',
  `total_cost` decimal(20,2) DEFAULT 0.00 COMMENT '总成本',
  `avg_entry_price` decimal(18,8) DEFAULT 0.00000000 COMMENT '平均建仓价格',
  `take_profit_price` decimal(18,8) DEFAULT 0.00000000 COMMENT '止盈价格 (15%)',
  `stop_loss_price` decimal(18,8) DEFAULT 0.00000000 COMMENT '止损价格 (5%)',
  `exit_price` decimal(18,8) DEFAULT 0.00000000 COMMENT '平仓价格',
  `realized_pnl` decimal(20,2) DEFAULT 0.00 COMMENT '已实现盈亏 (USDT)',
  `realized_pnl_pct` decimal(10,4) DEFAULT 0.0000 COMMENT '已实现盈亏百分比',
  `close_reason` varchar(100) DEFAULT NULL COMMENT '平仓原因',
  `sample_count` int(11) DEFAULT 0 COMMENT '采集的价格样本数量',
  `sample_price_min` decimal(18,8) DEFAULT 0.00000000 COMMENT '样本最低价',
  `sample_price_max` decimal(18,8) DEFAULT 0.00000000 COMMENT '样本最高价',
  `sample_price_avg` decimal(18,8) DEFAULT 0.00000000 COMMENT '样本平均价',
  `created_at` datetime NOT NULL DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_symbol_status` (`symbol`,`status`),
  KEY `idx_phase` (`phase`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_status_phase` (`status`,`phase`),
  KEY `idx_symbol_created` (`symbol`,`created_at`)
) ENGINE=InnoDB AUTO_INCREMENT=145 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='现货短线持仓表V2-动态价格采样策略'


================================================================================
表名: spot_signals_history
================================================================================
CREATE TABLE `spot_signals_history` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `signal_strength` decimal(5,2) NOT NULL COMMENT '信号强度 (0-100)',
  `best_strategy` varchar(50) DEFAULT NULL COMMENT '最佳策略 (A/B/C/D)',
  `score_a` decimal(5,2) DEFAULT NULL COMMENT '策略A得分 (趋势突破)',
  `score_b` decimal(5,2) DEFAULT NULL COMMENT '策略B得分 (超卖反弹)',
  `score_c` decimal(5,2) DEFAULT NULL COMMENT '策略C得分 (趋势跟随)',
  `score_d` decimal(5,2) DEFAULT NULL COMMENT '策略D得分 (多重共振)',
  `details` text DEFAULT NULL COMMENT '信号详情',
  `is_executed` tinyint(1) DEFAULT 0 COMMENT '是否已执行',
  `position_id` int(11) DEFAULT NULL COMMENT '关联的持仓ID',
  `created_at` datetime NOT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_signal_strength` (`signal_strength`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='现货信号历史表'


================================================================================
表名: spot_trading_logs
================================================================================
CREATE TABLE `spot_trading_logs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `action` varchar(20) NOT NULL COMMENT '操作类型 (open/add_batch/close)',
  `price` decimal(20,8) NOT NULL COMMENT '成交价格',
  `quantity` decimal(20,8) NOT NULL COMMENT '数量',
  `amount` decimal(20,4) NOT NULL COMMENT '金额 (USDT)',
  `position_id` int(11) DEFAULT NULL COMMENT '关联的持仓ID',
  `batch_number` int(11) DEFAULT NULL COMMENT '批次号 (仅add_batch时有值)',
  `details` text DEFAULT NULL COMMENT '操作详情',
  `created_at` datetime NOT NULL COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_action` (`action`),
  KEY `idx_position_id` (`position_id`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='现货交易日志表'


================================================================================
表名: strategy_capital_management
================================================================================
CREATE TABLE `strategy_capital_management` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `strategy_id` bigint(20) DEFAULT NULL COMMENT '策略ID（NULL表示系统操作，如充值、提现）',
  `strategy_name` varchar(100) DEFAULT NULL COMMENT '策略名称',
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `symbol` varchar(20) NOT NULL COMMENT '交易对，如 BTC/USDT',
  `trade_record_id` bigint(20) DEFAULT NULL COMMENT '关联的交易记录ID（strategy_trade_records表）',
  `position_id` int(11) DEFAULT NULL COMMENT '关联的持仓ID',
  `order_id` varchar(50) DEFAULT NULL COMMENT '关联的订单ID',
  `change_type` varchar(20) NOT NULL COMMENT '资金变化类型: FROZEN(冻结保证金), UNFROZEN(解冻保证金), REALIZED_PNL(已实现盈亏), FEE(手续费), DEPOSIT(充值), WITHDRAW(提现)',
  `action` varchar(20) DEFAULT NULL COMMENT '交易动作: BUY(买入/开仓), SELL(平仓), CLOSE(平仓)',
  `direction` varchar(10) DEFAULT NULL COMMENT '方向: long(做多), short(做空)',
  `amount_change` decimal(18,8) NOT NULL COMMENT '金额变化（正数表示增加，负数表示减少）',
  `balance_before` decimal(18,8) DEFAULT NULL COMMENT '变化前余额',
  `balance_after` decimal(18,8) DEFAULT NULL COMMENT '变化后余额',
  `frozen_before` decimal(18,8) DEFAULT NULL COMMENT '变化前冻结金额',
  `frozen_after` decimal(18,8) DEFAULT NULL COMMENT '变化后冻结金额',
  `available_before` decimal(18,8) DEFAULT NULL COMMENT '变化前可用余额',
  `available_after` decimal(18,8) DEFAULT NULL COMMENT '变化后可用余额',
  `entry_price` decimal(18,8) DEFAULT NULL COMMENT '开仓价格',
  `exit_price` decimal(18,8) DEFAULT NULL COMMENT '平仓价格',
  `quantity` decimal(18,8) DEFAULT NULL COMMENT '数量',
  `leverage` int(11) DEFAULT NULL COMMENT '杠杆倍数',
  `margin` decimal(18,8) DEFAULT NULL COMMENT '保证金',
  `realized_pnl` decimal(18,8) DEFAULT NULL COMMENT '已实现盈亏',
  `fee` decimal(18,8) DEFAULT NULL COMMENT '手续费',
  `reason` varchar(200) DEFAULT NULL COMMENT '资金变化原因，如：开仓冻结保证金、平仓解冻保证金、止损平仓等',
  `description` text DEFAULT NULL COMMENT '详细描述',
  `change_time` datetime NOT NULL COMMENT '资金变化时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '记录创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_change_type` (`change_type`),
  KEY `idx_change_time` (`change_time`),
  KEY `idx_trade_record_id` (`trade_record_id`),
  KEY `idx_position_id` (`position_id`),
  KEY `idx_strategy_symbol_time` (`strategy_id`,`symbol`,`change_time`),
  KEY `idx_account_change_time` (`account_id`,`change_time`)
) ENGINE=InnoDB AUTO_INCREMENT=1802 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='策略资金管理表 - 记录策略资金变化'


================================================================================
表名: strategy_execution_result_details
================================================================================
CREATE TABLE `strategy_execution_result_details` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `execution_result_id` int(11) NOT NULL,
  `symbol` varchar(20) NOT NULL,
  `trades_count` int(11) DEFAULT 0,
  `buy_count` int(11) DEFAULT 0,
  `sell_count` int(11) DEFAULT 0,
  `winning_trades` int(11) DEFAULT 0,
  `losing_trades` int(11) DEFAULT 0,
  `win_rate` decimal(10,2) DEFAULT NULL,
  `initial_balance` decimal(20,2) DEFAULT 10000.00,
  `final_balance` decimal(20,2) DEFAULT NULL,
  `total_pnl` decimal(20,2) DEFAULT NULL,
  `total_pnl_percent` decimal(10,2) DEFAULT NULL,
  `golden_cross_count` int(11) DEFAULT 0,
  `death_cross_count` int(11) DEFAULT 0,
  `klines_count` int(11) DEFAULT 0,
  `indicators_count` int(11) DEFAULT 0,
  `error_message` text DEFAULT NULL,
  `execution_result_data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`execution_result_data`)),
  `debug_info` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`debug_info`)),
  `debug_info_count` int(11) DEFAULT 0,
  `created_at` datetime DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_execution_result_id` (`execution_result_id`),
  KEY `idx_symbol` (`symbol`),
  CONSTRAINT `strategy_execution_result_details_ibfk_1` FOREIGN KEY (`execution_result_id`) REFERENCES `strategy_execution_results` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci


================================================================================
表名: strategy_execution_results
================================================================================
CREATE TABLE `strategy_execution_results` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `strategy_id` bigint(20) DEFAULT NULL,
  `strategy_name` varchar(200) NOT NULL,
  `account_id` int(11) NOT NULL DEFAULT 2,
  `strategy_config` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`strategy_config`)),
  `execution_start_time` datetime NOT NULL,
  `execution_end_time` datetime NOT NULL,
  `execution_duration_hours` decimal(10,2) DEFAULT NULL,
  `total_symbols` int(11) DEFAULT 0,
  `total_trades` int(11) DEFAULT 0,
  `winning_trades` int(11) DEFAULT 0,
  `losing_trades` int(11) DEFAULT 0,
  `win_rate` decimal(10,2) DEFAULT NULL,
  `initial_balance` decimal(20,2) DEFAULT 10000.00,
  `final_balance` decimal(20,2) DEFAULT NULL,
  `total_pnl` decimal(20,2) DEFAULT NULL,
  `total_pnl_percent` decimal(10,2) DEFAULT NULL,
  `max_drawdown` decimal(10,2) DEFAULT NULL,
  `status` varchar(20) DEFAULT 'completed',
  `error_message` text DEFAULT NULL,
  `created_at` datetime DEFAULT current_timestamp(),
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_strategy_name` (`strategy_name`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_execution_start_time` (`execution_start_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci


================================================================================
表名: strategy_hits
================================================================================
CREATE TABLE `strategy_hits` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `strategy_id` bigint(11) NOT NULL COMMENT '策略ID',
  `strategy_name` varchar(100) NOT NULL COMMENT '策略名称',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `account_id` int(11) NOT NULL COMMENT '账户ID',
  `signal_type` varchar(20) NOT NULL COMMENT '信号类型: BUY_LONG(做多买入), BUY_SHORT(做空买入), SELL(卖出)',
  `signal_source` varchar(50) NOT NULL COMMENT '信号来源: ema_9_26, ma_ema5, ma_ema10等',
  `signal_timeframe` varchar(10) NOT NULL COMMENT '信号时间周期: 5m, 15m, 1h',
  `signal_timestamp` datetime NOT NULL COMMENT '信号触发时间',
  `ema_short` decimal(20,8) DEFAULT NULL COMMENT '短期EMA值',
  `ema_long` decimal(20,8) DEFAULT NULL COMMENT '长期EMA值',
  `ma10` decimal(20,8) DEFAULT NULL COMMENT 'MA10值',
  `ema10` decimal(20,8) DEFAULT NULL COMMENT 'EMA10值',
  `ma5` decimal(20,8) DEFAULT NULL COMMENT 'MA5值',
  `ema5` decimal(20,8) DEFAULT NULL COMMENT 'EMA5值',
  `current_price` decimal(20,8) NOT NULL COMMENT '当前价格',
  `ema_cross_strength_pct` decimal(10,4) DEFAULT NULL COMMENT 'EMA交叉强度百分比',
  `ma10_ema10_strength_pct` decimal(10,4) DEFAULT NULL COMMENT 'MA10/EMA10强度百分比',
  `volume_ratio` decimal(10,2) DEFAULT NULL COMMENT '成交量放大倍数',
  `volume_condition_met` tinyint(1) DEFAULT NULL COMMENT '成交量条件是否满足',
  `ma10_ema10_trend_ok` tinyint(1) DEFAULT NULL COMMENT 'MA10/EMA10趋势过滤是否通过',
  `trend_confirm_ok` tinyint(1) DEFAULT NULL COMMENT '趋势持续性检查是否通过',
  `signal_strength_ok` tinyint(1) DEFAULT NULL COMMENT '信号强度过滤是否通过',
  `executed` tinyint(1) DEFAULT 0 COMMENT '是否已执行交易',
  `execution_result` varchar(20) DEFAULT NULL COMMENT '执行结果: SUCCESS, FAILED, SKIPPED',
  `execution_reason` varchar(200) DEFAULT NULL COMMENT '执行或跳过的原因',
  `position_id` int(11) DEFAULT NULL COMMENT '如果执行成功，关联的持仓ID',
  `order_id` varchar(100) DEFAULT NULL COMMENT '如果执行成功，关联的订单ID',
  `direction` varchar(10) DEFAULT NULL COMMENT '交易方向: long, short',
  `leverage` int(11) DEFAULT NULL COMMENT '杠杆倍数',
  `position_size_pct` decimal(5,2) DEFAULT NULL COMMENT '仓位大小百分比',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp() COMMENT '记录创建时间',
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '最后更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_signal_timestamp` (`signal_timestamp`),
  KEY `idx_signal_type` (`signal_type`),
  KEY `idx_executed` (`executed`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_strategy_symbol_time` (`strategy_id`,`symbol`,`signal_timestamp`)
) ENGINE=InnoDB AUTO_INCREMENT=9350 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='策略命中记录表 - 实时记录所有策略信号命中情况'


================================================================================
表名: strategy_regime_params
================================================================================
CREATE TABLE `strategy_regime_params` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `strategy_id` bigint(11) NOT NULL COMMENT '关联的策略ID',
  `regime_type` varchar(30) NOT NULL COMMENT '行情类型',
  `enabled` tinyint(1) DEFAULT 1 COMMENT '是否在该行情类型下启用交易',
  `params` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL COMMENT '该行情类型下的策略参数' CHECK (json_valid(`params`)),
  `description` varchar(500) DEFAULT NULL COMMENT '参数说明',
  `created_at` datetime DEFAULT current_timestamp(),
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_strategy_regime` (`strategy_id`,`regime_type`),
  KEY `idx_regime_type` (`regime_type`)
) ENGINE=InnoDB AUTO_INCREMENT=31 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='策略行情参数预设表'


================================================================================
表名: strategy_test_records
================================================================================
CREATE TABLE `strategy_test_records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `strategy_id` bigint(20) NOT NULL,
  `strategy_name` varchar(100) DEFAULT NULL,
  `account_id` int(11) NOT NULL,
  `symbol` varchar(20) NOT NULL,
  `action` varchar(20) NOT NULL,
  `direction` varchar(10) DEFAULT NULL,
  `position_side` varchar(10) DEFAULT NULL,
  `entry_price` decimal(18,8) DEFAULT NULL,
  `exit_price` decimal(18,8) DEFAULT NULL,
  `quantity` decimal(18,8) NOT NULL,
  `leverage` int(11) DEFAULT NULL,
  `margin` decimal(18,8) DEFAULT NULL,
  `total_value` decimal(18,8) DEFAULT NULL,
  `fee` decimal(18,8) DEFAULT NULL,
  `realized_pnl` decimal(18,8) DEFAULT NULL,
  `position_id` int(11) DEFAULT NULL,
  `order_id` varchar(50) DEFAULT NULL,
  `signal_id` int(11) DEFAULT NULL,
  `reason` varchar(200) DEFAULT NULL,
  `trade_time` datetime NOT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `ix_strategy_test_records_strategy_id` (`strategy_id`),
  KEY `ix_strategy_test_records_order_id` (`order_id`),
  KEY `ix_strategy_test_records_account_id` (`account_id`),
  KEY `idx_account_action_time` (`account_id`,`action`,`trade_time`),
  KEY `ix_strategy_test_records_symbol` (`symbol`),
  KEY `idx_strategy_symbol_time` (`strategy_id`,`symbol`,`trade_time`),
  KEY `ix_strategy_test_records_position_id` (`position_id`),
  KEY `ix_strategy_test_records_action` (`action`),
  KEY `ix_strategy_test_records_trade_time` (`trade_time`),
  KEY `idx_position_id` (`position_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci


================================================================================
表名: strategy_test_results
================================================================================
CREATE TABLE `strategy_test_results` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `strategy_id` bigint(20) DEFAULT NULL COMMENT '策略ID',
  `strategy_name` varchar(200) NOT NULL COMMENT '策略名称',
  `strategy_config` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '策略配置（完整JSON）' CHECK (json_valid(`strategy_config`)),
  `test_start_time` datetime NOT NULL COMMENT '测试开始时间',
  `test_end_time` datetime NOT NULL COMMENT '测试结束时间',
  `test_duration_hours` decimal(10,2) DEFAULT NULL COMMENT '测试时长（小时）',
  `total_symbols` int(11) DEFAULT 0 COMMENT '测试的交易对数量',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `winning_trades` int(11) DEFAULT 0 COMMENT '盈利交易次数',
  `losing_trades` int(11) DEFAULT 0 COMMENT '亏损交易次数',
  `win_rate` decimal(10,2) DEFAULT NULL COMMENT '胜率（%）',
  `initial_balance` decimal(20,2) DEFAULT 10000.00 COMMENT '初始资金',
  `final_balance` decimal(20,2) DEFAULT NULL COMMENT '最终资金',
  `total_pnl` decimal(20,2) DEFAULT NULL COMMENT '总盈亏',
  `total_pnl_percent` decimal(10,2) DEFAULT NULL COMMENT '总盈亏百分比',
  `max_drawdown` decimal(10,2) DEFAULT NULL COMMENT '最大回撤（%）',
  `status` varchar(20) DEFAULT 'completed' COMMENT '测试状态：completed, failed, running',
  `error_message` text DEFAULT NULL COMMENT '错误信息（如果测试失败）',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_strategy_name` (`strategy_name`),
  KEY `idx_test_start_time` (`test_start_time`),
  KEY `idx_created_at` (`created_at`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=473 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='策略测试结果主表'


================================================================================
表名: strategy_trade_records
================================================================================
CREATE TABLE `strategy_trade_records` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `strategy_id` bigint(20) NOT NULL COMMENT '策略ID',
  `strategy_name` varchar(100) DEFAULT NULL COMMENT '策略名称',
  `account_id` int(11) NOT NULL COMMENT '账户ID（0=测试，其他=实盘）',
  `symbol` varchar(20) NOT NULL COMMENT '交易对',
  `action` varchar(20) NOT NULL COMMENT '交易动作: BUY(买入/开仓), SELL(平仓), CLOSE(平仓)',
  `direction` varchar(10) DEFAULT NULL COMMENT '方向: long(做多), short(做空)',
  `position_side` varchar(10) DEFAULT NULL COMMENT '持仓方向: LONG, SHORT',
  `entry_price` decimal(18,8) DEFAULT NULL COMMENT '开仓价格',
  `exit_price` decimal(18,8) DEFAULT NULL COMMENT '平仓价格',
  `quantity` decimal(18,8) NOT NULL COMMENT '数量',
  `leverage` int(11) DEFAULT 1 COMMENT '杠杆倍数',
  `margin` decimal(18,8) DEFAULT NULL COMMENT '保证金',
  `total_value` decimal(18,8) DEFAULT NULL COMMENT '总价值',
  `fee` decimal(18,8) DEFAULT NULL COMMENT '手续费',
  `realized_pnl` decimal(18,8) DEFAULT NULL COMMENT '已实现盈亏',
  `position_id` int(11) DEFAULT NULL COMMENT '持仓ID',
  `order_id` varchar(50) DEFAULT NULL COMMENT '订单ID',
  `signal_id` int(11) DEFAULT NULL COMMENT '信号ID（关联strategy_hits表）',
  `reason` varchar(200) DEFAULT NULL COMMENT '交易原因，如：策略信号、止损、止盈、趋势反转等',
  `trade_time` datetime NOT NULL COMMENT '交易时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '记录创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_strategy_id` (`strategy_id`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_action` (`action`),
  KEY `idx_trade_time` (`trade_time`),
  KEY `idx_strategy_symbol_time` (`strategy_id`,`symbol`,`trade_time`),
  KEY `idx_account_action_time` (`account_id`,`action`,`trade_time`),
  KEY `idx_position_id` (`position_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='策略交易记录表 - 存储策略执行的买入、平仓等交易信息'


================================================================================
表名: symbol_risk_params
================================================================================
CREATE TABLE `symbol_risk_params` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `long_take_profit_pct` decimal(6,4) DEFAULT 0.0500 COMMENT 'LONG止盈百分比',
  `long_stop_loss_pct` decimal(6,4) DEFAULT 0.0200 COMMENT 'LONG止损百分比',
  `short_take_profit_pct` decimal(6,4) DEFAULT 0.0500 COMMENT 'SHORT止盈百分比',
  `short_stop_loss_pct` decimal(6,4) DEFAULT 0.0200 COMMENT 'SHORT止损百分比',
  `position_multiplier` decimal(5,2) DEFAULT 1.00 COMMENT '仓位倍数(0.5-2.0)',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `win_rate` decimal(5,4) DEFAULT 0.0000 COMMENT '胜率',
  `avg_pnl` decimal(10,2) DEFAULT 0.00 COMMENT '平均盈亏',
  `total_pnl` decimal(15,2) DEFAULT 0.00 COMMENT '总盈亏',
  `sharpe_ratio` decimal(6,3) DEFAULT 0.000 COMMENT '夏普比率',
  `avg_volatility` decimal(6,4) DEFAULT 0.0000 COMMENT '平均波动率',
  `max_drawdown` decimal(6,4) DEFAULT 0.0000 COMMENT '最大回撤',
  `last_optimized` timestamp NULL DEFAULT NULL COMMENT '最后优化时间',
  `optimization_count` int(11) DEFAULT 0 COMMENT '优化次数',
  `is_active` tinyint(1) DEFAULT 1 COMMENT '是否启用',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `symbol` (`symbol`),
  KEY `idx_symbol` (`symbol`),
  KEY `idx_performance` (`win_rate`,`total_pnl`),
  KEY `idx_last_optimized` (`last_optimized`)
) ENGINE=InnoDB AUTO_INCREMENT=46 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='交易对风险参数配置'


================================================================================
表名: symbol_volatility_profile
================================================================================
CREATE TABLE `symbol_volatility_profile` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(50) NOT NULL COMMENT '交易对符号',
  `long_avg_bullish_range_pct` decimal(10,6) DEFAULT NULL COMMENT 'LONG方向平均阳线波动(%)',
  `long_fixed_tp_pct` decimal(10,6) DEFAULT NULL COMMENT 'LONG固定止盈(%)',
  `long_trailing_activation_pct` decimal(10,6) DEFAULT NULL COMMENT 'LONG移动止盈激活(%)',
  `long_candles_analyzed` int(11) DEFAULT 0 COMMENT '分析的阳线数量',
  `short_avg_bearish_range_pct` decimal(10,6) DEFAULT NULL COMMENT 'SHORT方向平均阴线波动(%)',
  `short_fixed_tp_pct` decimal(10,6) DEFAULT NULL COMMENT 'SHORT固定止盈(%)',
  `short_trailing_activation_pct` decimal(10,6) DEFAULT NULL COMMENT 'SHORT移动止盈激活(%)',
  `short_candles_analyzed` int(11) DEFAULT 0 COMMENT '分析的阴线数量',
  `last_updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_symbol` (`symbol`),
  KEY `idx_last_updated` (`last_updated_at`)
) ENGINE=InnoDB AUTO_INCREMENT=1574 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='交易对波动率配置表(15M K线动态止盈)'


================================================================================
表名: system_status
================================================================================
CREATE TABLE `system_status` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `key_name` varchar(100) NOT NULL,
  `value` text DEFAULT NULL,
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `key_name` (`key_name`),
  KEY `idx_key` (`key_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci


================================================================================
表名: technical_indicators_cache
================================================================================
CREATE TABLE `technical_indicators_cache` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL COMMENT '交易对，如 BTC/USDT',
  `timeframe` varchar(10) NOT NULL DEFAULT '1h' COMMENT '时间周期',
  `rsi_value` decimal(10,2) DEFAULT NULL COMMENT 'RSI值 (0-100)',
  `rsi_signal` varchar(20) DEFAULT NULL COMMENT 'RSI信号: overbought/oversold/neutral',
  `macd_value` decimal(18,8) DEFAULT NULL COMMENT 'MACD值',
  `macd_signal_line` decimal(18,8) DEFAULT NULL COMMENT 'MACD信号线',
  `macd_histogram` decimal(18,8) DEFAULT NULL COMMENT 'MACD柱状图',
  `macd_trend` varchar(20) DEFAULT NULL COMMENT 'MACD趋势: bullish_cross/bearish_cross/neutral',
  `bb_upper` decimal(18,8) DEFAULT NULL COMMENT '布林带上轨',
  `bb_middle` decimal(18,8) DEFAULT NULL COMMENT '布林带中轨',
  `bb_lower` decimal(18,8) DEFAULT NULL COMMENT '布林带下轨',
  `bb_position` varchar(20) DEFAULT NULL COMMENT '价格位置: above_upper/below_lower/middle',
  `bb_width` decimal(10,4) DEFAULT NULL COMMENT '布林带宽度(%)',
  `ema_short` decimal(18,8) DEFAULT NULL COMMENT '短期EMA (默认12)',
  `ema_long` decimal(18,8) DEFAULT NULL COMMENT '长期EMA (默认26)',
  `ema_trend` varchar(20) DEFAULT NULL COMMENT 'EMA趋势: bullish/bearish/neutral',
  `kdj_k` decimal(10,2) DEFAULT NULL COMMENT 'K值',
  `kdj_d` decimal(10,2) DEFAULT NULL COMMENT 'D值',
  `kdj_j` decimal(10,2) DEFAULT NULL COMMENT 'J值',
  `kdj_signal` varchar(20) DEFAULT NULL COMMENT 'KDJ信号: overbought/oversold/neutral',
  `volume_24h` decimal(20,8) DEFAULT NULL COMMENT '24小时成交量',
  `volume_avg` decimal(20,8) DEFAULT NULL COMMENT '平均成交量',
  `volume_ratio` decimal(10,4) DEFAULT NULL COMMENT '成交量比率 (当前/平均)',
  `volume_signal` varchar(20) DEFAULT NULL COMMENT '成交量信号: high/low/normal',
  `technical_score` decimal(5,2) DEFAULT NULL COMMENT '技术指标综合评分 (0-100)',
  `technical_signal` varchar(20) DEFAULT NULL COMMENT '技术信号: STRONG_BUY/BUY/HOLD/SELL/STRONG_SELL',
  `data_points` int(11) DEFAULT NULL COMMENT '用于计算的数据点数量',
  `updated_at` datetime NOT NULL COMMENT '最后更新时间',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE KEY `uk_symbol_timeframe` (`symbol`,`timeframe`) USING BTREE,
  KEY `idx_updated_at` (`updated_at`) USING BTREE,
  KEY `idx_technical_score` (`technical_score`) USING BTREE,
  KEY `idx_signal` (`technical_signal`) USING BTREE,
  KEY `idx_symbol_timeframe_updated` (`symbol`,`timeframe`,`updated_at`),
  KEY `idx_timeframe_symbol_updated` (`timeframe`,`symbol`,`updated_at`)
) ENGINE=InnoDB AUTO_INCREMENT=817230 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='技术指标缓存表 - 每5分钟更新'


================================================================================
表名: trade_data
================================================================================
CREATE TABLE `trade_data` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `trade_id` bigint(20) DEFAULT NULL,
  `symbol` varchar(20) NOT NULL,
  `exchange` varchar(20) NOT NULL,
  `price` decimal(18,8) NOT NULL,
  `quantity` decimal(18,8) NOT NULL,
  `quote_quantity` decimal(18,8) DEFAULT NULL,
  `trade_time` bigint(20) NOT NULL,
  `timestamp` datetime NOT NULL,
  `is_buyer_maker` tinyint(1) DEFAULT NULL,
  `is_best_match` tinyint(1) DEFAULT NULL,
  `side` varchar(10) DEFAULT NULL,
  `created_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `ix_trade_data_trade_id` (`trade_id`),
  KEY `ix_trade_data_trade_time` (`trade_time`),
  KEY `idx_symbol_time` (`symbol`,`trade_time`),
  KEY `ix_trade_data_symbol` (`symbol`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci


================================================================================
表名: trading_control
================================================================================
CREATE TABLE `trading_control` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID: 2=U本位合约, 3=币本位合约',
  `trading_enabled` tinyint(1) DEFAULT 1 COMMENT '交易是否启用',
  `trading_type` varchar(50) NOT NULL COMMENT '交易类型: usdt_futures/coin_futures',
  `updated_by` varchar(100) DEFAULT NULL COMMENT '更新人',
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_account_type` (`account_id`,`trading_type`),
  KEY `idx_account_id` (`account_id`),
  KEY `idx_trading_type` (`trading_type`)
) ENGINE=InnoDB AUTO_INCREMENT=46 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='交易控制开关表'


================================================================================
表名: trading_cooldowns
================================================================================
CREATE TABLE `trading_cooldowns` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(20) NOT NULL,
  `cooldown_type` varchar(50) NOT NULL COMMENT 'å†·å´ç±»åž‹: consecutive_kline_stop',
  `cooldown_until` datetime NOT NULL COMMENT 'å†·å´åˆ°æœŸæ—¶é—´',
  `created_at` datetime DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_symbol_type` (`symbol`,`cooldown_type`),
  KEY `idx_cooldown_until` (`cooldown_until`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='äº¤æ˜“å†·å´æœŸè®°å½•'


================================================================================
表名: trading_mode_config
================================================================================
CREATE TABLE `trading_mode_config` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL COMMENT '账户ID (2=U本位, 3=币本位)',
  `trading_type` varchar(50) NOT NULL COMMENT '交易类型 (usdt_futures/coin_futures)',
  `mode_type` enum('trend','range','auto') DEFAULT 'trend' COMMENT '交易模式: trend=趋势, range=震荡, auto=自动',
  `is_active` tinyint(1) DEFAULT 0 COMMENT '是否启用',
  `range_min_score` int(11) DEFAULT 50 COMMENT '最低信号分数',
  `range_position_size` decimal(5,2) DEFAULT 3.00 COMMENT '单笔仓位百分比',
  `range_max_positions` int(11) DEFAULT 8 COMMENT '最大持仓数',
  `range_take_profit` decimal(5,2) DEFAULT 2.50 COMMENT '止盈百分比',
  `range_stop_loss` decimal(5,2) DEFAULT 2.00 COMMENT '止损百分比',
  `range_max_hold_hours` int(11) DEFAULT 4 COMMENT '最大持仓小时数',
  `auto_switch_enabled` tinyint(1) DEFAULT 0 COMMENT '是否允许自动切换',
  `last_switch_time` datetime DEFAULT NULL COMMENT '上次切换时间',
  `switch_cooldown_minutes` int(11) DEFAULT 120 COMMENT '切换冷却时间(分钟)',
  `updated_by` varchar(100) DEFAULT 'system',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_account_type` (`account_id`,`trading_type`),
  KEY `idx_mode_type` (`mode_type`),
  KEY `idx_active` (`is_active`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='交易模式配置表'


================================================================================
表名: trading_mode_switch_log
================================================================================
CREATE TABLE `trading_mode_switch_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `account_id` int(11) NOT NULL,
  `trading_type` varchar(50) NOT NULL,
  `from_mode` enum('trend','range','auto') DEFAULT NULL,
  `to_mode` enum('trend','range','auto') DEFAULT NULL,
  `switch_trigger` enum('manual','auto','schedule') DEFAULT 'manual',
  `big4_signal` varchar(20) DEFAULT NULL COMMENT 'Big4信号',
  `big4_strength` decimal(5,2) DEFAULT NULL COMMENT 'Big4强度',
  `market_volatility` decimal(10,4) DEFAULT NULL COMMENT '市场波动率',
  `reason` text DEFAULT NULL COMMENT '切换原因',
  `switched_by` varchar(100) DEFAULT 'system',
  `switched_at` timestamp NOT NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `idx_account` (`account_id`),
  KEY `idx_switched_at` (`switched_at`)
) ENGINE=InnoDB AUTO_INCREMENT=32 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='模式切换日志'


================================================================================
表名: trading_strategies
================================================================================
CREATE TABLE `trading_strategies` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '策略ID',
  `user_id` int(11) DEFAULT 1 COMMENT 'ç”¨æˆ·ID',
  `name` varchar(100) NOT NULL COMMENT '策略名称',
  `description` text DEFAULT NULL COMMENT '策略描述',
  `account_id` int(11) NOT NULL DEFAULT 2 COMMENT '账户ID',
  `enabled` tinyint(1) NOT NULL DEFAULT 0 COMMENT '是否启用：1=启用，0=禁用',
  `market_type` varchar(10) DEFAULT 'test' COMMENT '市场类型: test(模拟)/live(实盘)',
  `adaptive_regime` tinyint(1) DEFAULT 0 COMMENT '是否启用行情自适应',
  `sync_live` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦åŒæ­¥å®žç›˜äº¤æ˜“',
  `live_quantity_pct` decimal(5,2) DEFAULT 100.00 COMMENT 'å®žç›˜ä¸‹å•æ•°é‡ç™¾åˆ†æ¯”(ç›¸å¯¹äºŽæ¨¡æ‹Ÿ)',
  `config` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL COMMENT '策略配置（JSON格式）',
  `created_at` datetime DEFAULT current_timestamp() COMMENT '创建时间',
  `updated_at` datetime DEFAULT current_timestamp() ON UPDATE current_timestamp() COMMENT '更新时间',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_enabled` (`enabled`) USING BTREE,
  KEY `idx_account_id` (`account_id`) USING BTREE,
  KEY `idx_name` (`name`) USING BTREE,
  KEY `idx_user_id` (`user_id`) USING BTREE,
  CONSTRAINT `trading_strategies_chk_1` CHECK (json_valid(`config`))
) ENGINE=InnoDB AUTO_INCREMENT=1768311003221 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT='交易策略配置表'


================================================================================
表名: trading_symbol_rating
================================================================================
CREATE TABLE `trading_symbol_rating` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `symbol` varchar(50) NOT NULL COMMENT '交易对符号',
  `rating_level` int(11) NOT NULL DEFAULT 0 COMMENT '评级等级: 0=白名单, 1=黑名单1级, 2=黑名单2级, 3=黑名单3级(永久禁止)',
  `margin_multiplier` decimal(10,4) DEFAULT 1.0000 COMMENT '保证金倍数',
  `score_bonus` int(11) DEFAULT 0 COMMENT '开仓评分加分',
  `reason` text DEFAULT NULL COMMENT '评级原因',
  `hard_stop_loss_count` int(11) DEFAULT 0 COMMENT 'hard_stop_loss次数',
  `total_loss_amount` decimal(20,8) DEFAULT 0.00000000 COMMENT '总亏损金额(USDT)',
  `total_profit_amount` decimal(20,8) DEFAULT 0.00000000 COMMENT '总盈利金额(USDT)',
  `win_rate` decimal(5,4) DEFAULT 0.0000 COMMENT '胜率',
  `total_trades` int(11) DEFAULT 0 COMMENT '总交易次数',
  `previous_level` int(11) DEFAULT NULL COMMENT '上一个等级',
  `level_changed_at` timestamp NULL DEFAULT NULL COMMENT '等级变更时间',
  `level_change_reason` varchar(500) DEFAULT NULL COMMENT '等级变更原因',
  `stats_start_date` date NOT NULL COMMENT '统计开始日期',
  `stats_end_date` date NOT NULL COMMENT '统计结束日期',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_symbol` (`symbol`),
  KEY `idx_rating_level` (`rating_level`),
  KEY `idx_updated_at` (`updated_at`)
) ENGINE=InnoDB AUTO_INCREMENT=589 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='交易对评级表(黑名单分级制度)'


================================================================================
表名: user_api_keys
================================================================================
CREATE TABLE `user_api_keys` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL COMMENT 'ç”¨æˆ·ID',
  `exchange` varchar(50) NOT NULL DEFAULT 'binance' COMMENT 'äº¤æ˜“æ‰€: binance/gate/okxç­‰',
  `account_name` varchar(100) NOT NULL COMMENT 'è´¦æˆ·åç§°ï¼ˆç”¨æˆ·è‡ªå®šä¹‰ï¼‰',
  `api_key` varchar(500) NOT NULL COMMENT 'API Keyï¼ˆåŠ å¯†ï¼‰',
  `api_secret` varchar(500) NOT NULL COMMENT 'API Secretï¼ˆåŠ å¯†ï¼‰',
  `permissions` varchar(255) DEFAULT 'spot,futures' COMMENT 'æƒé™: spot,futures,marginç­‰',
  `is_testnet` tinyint(1) DEFAULT 0 COMMENT 'æ˜¯å¦æµ‹è¯•ç½‘',
  `status` varchar(20) DEFAULT 'active' COMMENT 'çŠ¶æ€: active/inactive/revoked',
  `max_position_value` decimal(20,2) DEFAULT 1000.00 COMMENT 'å•ç¬”æœ€å¤§æŒä»“ä»·å€¼(USDT)',
  `max_daily_loss` decimal(20,2) DEFAULT 100.00 COMMENT 'æ¯æ—¥æœ€å¤§äºæŸ(USDT)',
  `max_leverage` int(11) DEFAULT 10 COMMENT 'æœ€å¤§æ æ†',
  `last_used_at` datetime DEFAULT NULL COMMENT 'æœ€åŽä½¿ç”¨æ—¶é—´',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_exchange_account` (`user_id`,`exchange`,`account_name`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_exchange` (`exchange`),
  KEY `idx_status` (`status`),
  CONSTRAINT `user_api_keys_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='ç”¨æˆ·APIå¯†é’¥è¡¨'


================================================================================
表名: users
================================================================================
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `email` varchar(100) NOT NULL COMMENT 'é‚®ç®±',
  `password_hash` varchar(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
  `role` varchar(20) DEFAULT 'user' COMMENT 'è§’è‰²: admin/user/viewer',
  `status` varchar(20) DEFAULT 'active' COMMENT 'çŠ¶æ€: active/inactive/banned',
  `last_login` datetime DEFAULT NULL COMMENT 'æœ€åŽç™»å½•æ—¶é—´',
  `created_at` datetime NOT NULL DEFAULT current_timestamp(),
  `updated_at` datetime NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email` (`email`),
  KEY `idx_status` (`status`),
  KEY `idx_role` (`role`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='ç”¨æˆ·è¡¨'


================================================================================
表名: v_etf_daily_flows
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_etf_daily_flows` AS select `f`.`trade_date` AS `trade_date`,`p`.`asset_type` AS `asset_type`,`p`.`ticker` AS `ticker`,`p`.`provider` AS `provider`,`f`.`net_inflow` AS `net_inflow`,`f`.`gross_inflow` AS `gross_inflow`,`f`.`gross_outflow` AS `gross_outflow`,`f`.`aum` AS `aum`,`f`.`btc_holdings` AS `btc_holdings`,`f`.`eth_holdings` AS `eth_holdings`,`f`.`volume` AS `volume`,`f`.`nav` AS `nav`,`f`.`close_price` AS `close_price` from (`crypto_etf_flows` `f` join `crypto_etf_products` `p` on(`f`.`etf_id` = `p`.`id`)) where `p`.`is_active` = 1 order by `f`.`trade_date` desc,`f`.`net_inflow` desc


================================================================================
表名: v_etf_latest_flows
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_etf_latest_flows` AS select `p`.`ticker` AS `ticker`,`p`.`full_name` AS `full_name`,`p`.`provider` AS `provider`,`p`.`asset_type` AS `asset_type`,`f`.`trade_date` AS `trade_date`,`f`.`net_inflow` AS `net_inflow`,`f`.`gross_inflow` AS `gross_inflow`,`f`.`gross_outflow` AS `gross_outflow`,`f`.`aum` AS `aum`,`f`.`btc_holdings` AS `btc_holdings`,`f`.`eth_holdings` AS `eth_holdings`,rank() over ( partition by `p`.`asset_type` order by `f`.`net_inflow` desc) AS `inflow_rank` from (`crypto_etf_flows` `f` join `crypto_etf_products` `p` on(`f`.`etf_id` = `p`.`id`)) where `f`.`trade_date` = (select max(`crypto_etf_flows`.`trade_date`) from `crypto_etf_flows`) and `p`.`is_active` = 1


================================================================================
表名: v_etf_weekly_summary
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_etf_weekly_summary` AS select `f`.`trade_date` - interval weekday(`f`.`trade_date`) day AS `week_start`,`p`.`asset_type` AS `asset_type`,sum(`f`.`net_inflow`) AS `weekly_net_inflow`,avg(`f`.`net_inflow`) AS `avg_daily_inflow`,sum(`f`.`gross_inflow`) AS `weekly_gross_inflow`,sum(`f`.`gross_outflow`) AS `weekly_gross_outflow`,count(distinct `f`.`trade_date`) AS `trading_days`,avg(`f`.`aum`) AS `avg_aum` from (`crypto_etf_flows` `f` join `crypto_etf_products` `p` on(`f`.`etf_id` = `p`.`id`)) where `p`.`is_active` = 1 group by `f`.`trade_date` - interval weekday(`f`.`trade_date`) day,`p`.`asset_type` order by `f`.`trade_date` - interval weekday(`f`.`trade_date`) day desc,`p`.`asset_type`


================================================================================
表名: v_hyperliquid_active_monitors
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_hyperliquid_active_monitors` AS select `mw`.`id` AS `id`,`mw`.`address` AS `address`,`mw`.`label` AS `label`,`t`.`display_name` AS `display_name`,`mw`.`monitor_type` AS `monitor_type`,`mw`.`discovered_pnl` AS `discovered_pnl`,`mw`.`discovered_roi` AS `discovered_roi`,`mw`.`discovered_account_value` AS `discovered_account_value`,`mw`.`discovered_at` AS `discovered_at`,`mw`.`last_check_at` AS `last_check_at`,`mw`.`last_trade_at` AS `last_trade_at`,`mw`.`check_count` AS `check_count`,timestampdiff(HOUR,`mw`.`last_check_at`,current_timestamp()) AS `hours_since_check` from (`hyperliquid_monitored_wallets` `mw` join `hyperliquid_traders` `t` on(`mw`.`trader_id` = `t`.`id`)) where `mw`.`is_monitoring` = 1 order by `mw`.`last_check_at`


================================================================================
表名: v_hyperliquid_latest_positions
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_hyperliquid_latest_positions` AS select `wp`.`trader_id` AS `trader_id`,`wp`.`address` AS `address`,`t`.`display_name` AS `display_name`,`mw`.`label` AS `label`,`wp`.`coin` AS `coin`,`wp`.`side` AS `side`,`wp`.`size` AS `size`,`wp`.`entry_price` AS `entry_price`,`wp`.`mark_price` AS `mark_price`,`wp`.`notional_usd` AS `notional_usd`,`wp`.`unrealized_pnl` AS `unrealized_pnl`,`wp`.`leverage` AS `leverage`,`wp`.`snapshot_time` AS `snapshot_time` from ((`hyperliquid_wallet_positions` `wp` join `hyperliquid_traders` `t` on(`wp`.`trader_id` = `t`.`id`)) left join `hyperliquid_monitored_wallets` `mw` on(`wp`.`trader_id` = `mw`.`trader_id`)) where (`wp`.`trader_id`,`wp`.`coin`,`wp`.`snapshot_time`) in (select `hyperliquid_wallet_positions`.`trader_id`,`hyperliquid_wallet_positions`.`coin`,max(`hyperliquid_wallet_positions`.`snapshot_time`) from `hyperliquid_wallet_positions` group by `hyperliquid_wallet_positions`.`trader_id`,`hyperliquid_wallet_positions`.`coin`) order by `wp`.`snapshot_time` desc


================================================================================
表名: v_hyperliquid_trader_history
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_hyperliquid_trader_history` AS select `t`.`address` AS `address`,`t`.`display_name` AS `display_name`,`ps`.`snapshot_date` AS `snapshot_date`,`ps`.`week_pnl` AS `week_pnl`,`ps`.`week_roi` AS `week_roi`,`ps`.`week_volume` AS `week_volume`,`ps`.`month_pnl` AS `month_pnl`,`ps`.`month_roi` AS `month_roi`,`ps`.`alltime_pnl` AS `alltime_pnl`,`ps`.`alltime_roi` AS `alltime_roi`,`ps`.`account_value` AS `account_value` from (`hyperliquid_performance_snapshots` `ps` join `hyperliquid_traders` `t` on(`ps`.`trader_id` = `t`.`id`)) order by `t`.`address`,`ps`.`snapshot_date` desc


================================================================================
表名: v_hyperliquid_weekly_leaderboard
================================================================================
CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_hyperliquid_weekly_leaderboard` AS select `wp`.`week_start` AS `week_start`,`wp`.`week_end` AS `week_end`,`t`.`address` AS `address`,`t`.`display_name` AS `display_name`,`wp`.`pnl` AS `pnl`,`wp`.`roi` AS `roi`,`wp`.`volume` AS `volume`,`wp`.`account_value` AS `account_value`,`wp`.`pnl_rank` AS `pnl_rank`,`wp`.`roi_rank` AS `roi_rank`,`wp`.`recorded_at` AS `recorded_at` from (`hyperliquid_weekly_performance` `wp` join `hyperliquid_traders` `t` on(`wp`.`trader_id` = `t`.`id`)) where `wp`.`week_start` = (select max(`hyperliquid_weekly_performance`.`week_start`) from `hyperliquid_weekly_performance`) order by `wp`.`pnl` desc
